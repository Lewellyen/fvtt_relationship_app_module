{"version":3,"mappings":"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","names":["value","map","transform","getFallback","promise","description","ServiceLifecycle","SL","instance","LogLevel","fallback","metricsCollectorToken","message","v.object","v.string","v.optional","v.record","v.unknown","v.custom","entries","v.safeParse","v.array","config","match","document","game","ui","regex","metricsResult","args"],"ignoreList":[20],"sources":["../src/polyfills/cytoscape-assign-fix.ts","../src/constants.ts","../src/utils/functional/result.ts","../src/di_infrastructure/tokenutilities.ts","../src/foundry/foundrytokens.ts","../src/tokens/tokenindex.ts","../src/di_infrastructure/types/api-safe-token.ts","../src/di_infrastructure/types/servicelifecycle.ts","../src/di_infrastructure/types/serviceregistration.ts","../src/di_infrastructure/registry/ServiceRegistry.ts","../src/di_infrastructure/validation/ContainerValidator.ts","../src/di_infrastructure/cache/InstanceCache.ts","../src/di_infrastructure/resolution/ServiceResolver.ts","../src/di_infrastructure/scope/ScopeManager.ts","../src/utils/async/promise-timeout.ts","../src/config/environment.ts","../src/observability/performance-tracker-impl.ts","../src/observability/bootstrap-performance-tracker.ts","../src/di_infrastructure/container.ts","../src/services/consolelogger.ts","../node_modules/valibot/dist/index.js","../src/foundry/errors/FoundryErrors.ts","../src/foundry/validation/schemas.ts","../src/services/JournalVisibilityService.ts","../src/observability/metrics-collector.ts","../src/core/module-health-service.ts","../src/services/PerformanceTrackingService.ts","../src/services/RetryService.ts","../src/foundry/versioning/versiondetector.ts","../src/foundry/versioning/port-selection-events.ts","../src/foundry/versioning/portselector.ts","../src/foundry/versioning/portregistry.ts","../src/foundry/versioning/port-selection-observer.ts","../src/foundry/services/FoundryGameService.ts","../src/foundry/services/FoundryHooksService.ts","../src/foundry/services/FoundryDocumentService.ts","../src/foundry/services/FoundryUIService.ts","../src/foundry/services/FoundrySettingsService.ts","../src/foundry/services/FoundryI18nService.ts","../src/foundry/facades/foundry-journal-facade.ts","../src/services/LocalI18nService.ts","../src/services/I18nFacadeService.ts","../src/foundry/validation/input-validators.ts","../src/foundry/ports/v13/FoundryGamePort.ts","../src/foundry/ports/v13/FoundryHooksPort.ts","../src/foundry/ports/v13/FoundryDocumentPort.ts","../src/foundry/ports/v13/FoundryUIPort.ts","../src/foundry/ports/v13/FoundrySettingsPort.ts","../src/foundry/ports/v13/FoundryI18nPort.ts","../src/config/dependencyconfig.ts","../src/core/composition-root.ts","../src/utils/events/throttle.ts","../src/core/hooks/render-journal-directory-hook.ts","../src/core/module-hook-registrar.ts","../src/core/settings/log-level-setting.ts","../src/core/module-settings-registrar.ts","../src/core/bootstrap-error-handler.ts","../src/core/init-solid.ts"],"sourcesContent":["/**\r\n * Polyfill fr Cytoscape: Object.assign readonly 'equals' fix\r\n *\r\n *  WICHTIG: Dieser Polyfill ist ein Legacy-Patch fr die Cytoscape-Bibliothek.\r\n * NIEMALS NDERN - knnte das Verhalten der Cytoscape-Integration beeintrchtigen.\r\n */\r\n/* c8 ignore file -- Legacy polyfill, schwer testbar ohne Browser-Integration */\r\n/* eslint-disable @typescript-eslint/no-explicit-any */\r\n// Legacy polyfill: `any` required for low-level Object.assign patching\r\n\r\n// Patch Object.assign only once and keep original semantics wherever possible\r\nconst originalAssignRef = Object.assign as any;\r\nif (!(originalAssignRef && originalAssignRef.__cy_careful_patch)) {\r\n  const patched = function (target: any, ...sources: any[]) {\r\n    const filteredSources = sources.map((source) => {\r\n      if (source == null) return source;\r\n      // Create a shallow copy excluding the problematic 'equals' key\r\n      const out: any = {};\r\n      for (const key in source) {\r\n        if (Object.prototype.hasOwnProperty.call(source, key) && key !== \"equals\") {\r\n          out[key] = (source as any)[key];\r\n        }\r\n      }\r\n      return out;\r\n    });\r\n    try {\r\n      return originalAssignRef(target, ...filteredSources);\r\n    } catch {\r\n      // Fallback to naive assignment filtering readonly errors\r\n      for (const src of filteredSources) {\r\n        if (src != null) {\r\n          for (const k in src) {\r\n            try {\r\n              (target as any)[k] = (src as any)[k];\r\n            } catch {}\r\n          }\r\n        }\r\n      }\r\n      return target;\r\n    }\r\n  } as typeof Object.assign & { __cy_careful_patch?: boolean };\r\n  (patched as any).__cy_careful_patch = true;\r\n  Object.assign = patched as any;\r\n}\r\n","/**\r\n * Module-wide constants for the Foundry VTT Relationship App Module.\r\n * Contains metadata and configuration values used throughout the application.\r\n *\r\n * @constant\r\n *\r\n * @note ENCODING REQUIREMENT\r\n * All source files in this project MUST be saved as UTF-8 without BOM.\r\n * This ensures proper display of German text (, , , ) and prevents mojibake.\r\n * Configure your editor to use UTF-8 encoding for all .ts, .js, and .svelte files.\r\n */\r\n/* c8 ignore file -- Reine Konstanten-Definition, keine ausfhrbare Logik */\r\n/**\r\n * Throttle window for hook callbacks in milliseconds.\r\n * Prevents excessive processing during rapid hook fires.\r\n */\r\nexport const HOOK_THROTTLE_WINDOW_MS = 100;\r\n\r\n/**\r\n * Validation constraints for input data.\r\n */\r\nexport const VALIDATION_CONSTRAINTS = {\r\n  /** Maximum length for IDs and keys */\r\n  MAX_ID_LENGTH: 100,\r\n  /** Maximum length for names */\r\n  MAX_NAME_LENGTH: 100,\r\n  /** Maximum length for flag keys */\r\n  MAX_FLAG_KEY_LENGTH: 100,\r\n} as const;\r\n\r\n/**\r\n * Metrics collection configuration.\r\n */\r\nexport const METRICS_CONFIG = {\r\n  /** Size of circular buffer for resolution times */\r\n  RESOLUTION_TIMES_BUFFER_SIZE: 100,\r\n} as const;\r\n\r\nexport const MODULE_CONSTANTS = {\r\n  MODULE: {\r\n    ID: \"fvtt_relationship_app_module\",\r\n    NAME: \"Beziehungsnetzwerke fr Foundry\",\r\n    AUTHOR: \"Andreas Rothe\",\r\n    AUTHOR_EMAIL: \"forenadmin.tir@gmail.com\",\r\n    AUTHOR_DISCORD: \"lewellyen\",\r\n  },\r\n  LOG_PREFIX: \"Relationship App |\",\r\n  FLAGS: {\r\n    HIDDEN: \"hidden\",\r\n  },\r\n  HOOKS: {\r\n    RENDER_JOURNAL_DIRECTORY: \"renderJournalDirectory\",\r\n    INIT: \"init\",\r\n    READY: \"ready\",\r\n  },\r\n  SETTINGS: {\r\n    LOG_LEVEL: \"logLevel\",\r\n  },\r\n  API: {\r\n    /**\r\n     * Public API version for external module consumption.\r\n     * Follows semantic versioning: MAJOR.MINOR.PATCH\r\n     *\r\n     * MAJOR: Breaking changes to public API\r\n     * MINOR: New features, backwards-compatible\r\n     * PATCH: Bug fixes, backwards-compatible\r\n     */\r\n    VERSION: \"1.0.0\",\r\n  },\r\n  DEFAULTS: {\r\n    UNKNOWN_NAME: \"Unknown\",\r\n    NO_VERSION_SELECTED: -1,\r\n    CACHE_NOT_INITIALIZED: -1,\r\n    CACHE_TTL_MS: 5000,\r\n  },\r\n} as const;\r\n\r\n// Deep freeze constants for runtime immutability\r\nObject.freeze(MODULE_CONSTANTS);\r\nObject.freeze(MODULE_CONSTANTS.MODULE);\r\nObject.freeze(MODULE_CONSTANTS.API);\r\nObject.freeze(MODULE_CONSTANTS.FLAGS);\r\nObject.freeze(MODULE_CONSTANTS.HOOKS);\r\nObject.freeze(MODULE_CONSTANTS.SETTINGS);\r\nObject.freeze(MODULE_CONSTANTS.DEFAULTS);\r\nObject.freeze(VALIDATION_CONSTRAINTS);\r\nObject.freeze(METRICS_CONFIG);\r\n","/**\r\n * Utility functions for working with the Result pattern.\r\n * Provides functional error handling with type safety.\r\n *\r\n * This module contains only runtime functions - types are imported from \"@/types/result\"\r\n */\r\nimport type { Ok, Err, Result, AsyncResult } from \"@/types/result\";\r\n\r\n/**\r\n * Creates a successful Result with a value.\r\n *\r\n * @template SuccessType - The type of the successful value\r\n * @param value - The successful value to wrap\r\n * @returns A Result indicating success with the provided value\r\n *\r\n * @example\r\n * ```typescript\r\n * const success = ok(42);\r\n * // { ok: true, value: 42 }\r\n * ```\r\n */\r\nexport function ok<SuccessType>(value: SuccessType): Ok<SuccessType> {\r\n  return { ok: true, value };\r\n}\r\n\r\n/**\r\n * Creates an error Result with an error value.\r\n *\r\n * @template ErrorType - The type of the error value\r\n * @param error - The error to wrap\r\n * @returns A Result indicating failure with the provided error\r\n *\r\n * @example\r\n * ```typescript\r\n * const failure = err(\"Not found\");\r\n * // { ok: false, error: \"Not found\" }\r\n * ```\r\n */\r\nexport function err<ErrorType>(error: ErrorType): Err<ErrorType> {\r\n  return { ok: false, error };\r\n}\r\n\r\n/**\r\n * Type guard to check if a Result is successful.\r\n *\r\n * @template SuccessType - The type of the successful value\r\n * @template ErrorType - The type of the error value\r\n * @param result - The Result to check\r\n * @returns True if the Result is successful, narrowing the type to Ok<SuccessType>\r\n *\r\n * @example\r\n * ```typescript\r\n * const result = someOperation();\r\n * if (isOk(result)) {\r\n *   console.log(result.value); // Type-safe access to value\r\n * }\r\n * ```\r\n */\r\nexport function isOk<SuccessType, ErrorType>(\r\n  result: Result<SuccessType, ErrorType>\r\n): result is Ok<SuccessType> {\r\n  return result.ok;\r\n}\r\n\r\n/**\r\n * Type guard to check if a Result is an error.\r\n *\r\n * @template SuccessType - The type of the successful value\r\n * @template ErrorType - The type of the error value\r\n * @param result - The Result to check\r\n * @returns True if the Result is an error, narrowing the type to Err<ErrorType>\r\n *\r\n * @example\r\n * ```typescript\r\n * const result = someOperation();\r\n * if (isErr(result)) {\r\n *   console.error(result.error); // Type-safe access to error\r\n * }\r\n * ```\r\n */\r\nexport function isErr<SuccessType, ErrorType>(\r\n  result: Result<SuccessType, ErrorType>\r\n): result is Err<ErrorType> {\r\n  return !result.ok;\r\n}\r\n\r\n/**\r\n * Transforms the value of a successful Result.\r\n * If the Result is an error, it is returned unchanged.\r\n *\r\n * @template SuccessType - The current success type\r\n * @template NewSuccessType - The new success type after transformation\r\n * @template ErrorType - The error type\r\n * @param result - The Result to transform\r\n * @param transform - Function to transform the success value\r\n * @returns A new Result with the transformed value, or the original error\r\n *\r\n * @example\r\n * ```typescript\r\n * const num = ok(5);\r\n * const doubled = map(num, x => x * 2);\r\n * // { ok: true, value: 10 }\r\n * ```\r\n */\r\nexport function map<SuccessType, NewSuccessType, ErrorType>(\r\n  result: Result<SuccessType, ErrorType>,\r\n  transform: (value: SuccessType) => NewSuccessType\r\n): Result<NewSuccessType, ErrorType> {\r\n  return result.ok ? ok(transform(result.value)) : result;\r\n}\r\n\r\n/**\r\n * Transforms the error of a failed Result.\r\n * If the Result is successful, it is returned unchanged.\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The current error type\r\n * @template NewErrorType - The new error type after transformation\r\n * @param result - The Result to transform\r\n * @param transform - Function to transform the error value\r\n * @returns A new Result with the transformed error, or the original success\r\n *\r\n * @example\r\n * ```typescript\r\n * const failure = err(\"404\");\r\n * const formatted = mapError(failure, msg => `Error: ${msg}`);\r\n * // { ok: false, error: \"Error: 404\" }\r\n * ```\r\n */\r\nexport function mapError<SuccessType, ErrorType, NewErrorType>(\r\n  result: Result<SuccessType, ErrorType>,\r\n  transform: (error: ErrorType) => NewErrorType\r\n): Result<SuccessType, NewErrorType> {\r\n  return result.ok ? result : err(transform(result.error));\r\n}\r\n\r\n/**\r\n * Chains Result operations. If the Result is successful, applies the function to the value.\r\n * Otherwise, returns the error unchanged. This is also known as \"flatMap\" or \"bind\".\r\n *\r\n * @template SuccessType - The current success type\r\n * @template ErrorType - The error type\r\n * @template NextSuccessType - The next success type after chaining\r\n * @param result - The Result to chain\r\n * @param next - Function that returns a new Result from the success value\r\n * @returns The next Result, or the original error\r\n *\r\n * @example\r\n * ```typescript\r\n * const parseNumber = (str: string): Result<number, string> => {\r\n *   const num = parseInt(str);\r\n *   return isNaN(num) ? err(\"Invalid number\") : ok(num);\r\n * };\r\n *\r\n * const doubled = ok(\"5\").pipe(parseNumber).pipe(x => ok(x * 2));\r\n * ```\r\n */\r\nexport function andThen<SuccessType, ErrorType, NextSuccessType>(\r\n  result: Result<SuccessType, ErrorType>,\r\n  next: (value: SuccessType) => Result<NextSuccessType, ErrorType>\r\n): Result<NextSuccessType, ErrorType> {\r\n  return result.ok ? next(result.value) : result;\r\n}\r\n\r\n/**\r\n * Unwraps a successful Result or returns a fallback value if it's an error.\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The error type\r\n * @param result - The Result to unwrap\r\n * @param fallbackValue - The value to return if the Result is an error\r\n * @returns The success value, or the fallback value\r\n *\r\n * @example\r\n * ```typescript\r\n * const num = ok(42);\r\n * unwrapOr(num, 0); // 42\r\n *\r\n * const err = err(\"Failed\");\r\n * unwrapOr(err, 0); // 0\r\n * ```\r\n */\r\nexport function unwrapOr<SuccessType, ErrorType>(\r\n  result: Result<SuccessType, ErrorType>,\r\n  fallbackValue: SuccessType\r\n): SuccessType {\r\n  return result.ok ? result.value : fallbackValue;\r\n}\r\n\r\n/**\r\n * Unwraps a successful Result or computes a fallback value from the error.\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The error type\r\n * @param result - The Result to unwrap\r\n * @param getFallback - Function that computes a fallback from the error\r\n * @returns The success value, or the computed fallback value\r\n *\r\n * @example\r\n * ```typescript\r\n * const num = err(\"Not found\");\r\n * unwrapOrElse(num, error => 0); // 0\r\n * ```\r\n */\r\nexport function unwrapOrElse<SuccessType, ErrorType>(\r\n  result: Result<SuccessType, ErrorType>,\r\n  getFallback: (error: ErrorType) => SuccessType\r\n): SuccessType {\r\n  return result.ok ? result.value : getFallback(result.error);\r\n}\r\n\r\n/**\r\n * Unwraps a successful Result or throws an error if it's a failure.\r\n * Use with caution - this defeats the purpose of using Result pattern.\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The error type\r\n * @template ThrownError - The type of error to throw (must extend Error)\r\n * @param result - The Result to unwrap\r\n * @param toError - Optional function to convert the error to a thrown Error\r\n * @returns The success value\r\n * @throws ThrownError if the Result is an error\r\n *\r\n * @example\r\n * ```typescript\r\n * const num = ok(42);\r\n * getOrThrow(num); // 42\r\n *\r\n * const failure = err(\"Not found\");\r\n * getOrThrow(failure); // throws Error(\"Not found\")\r\n * ```\r\n */\r\nexport function getOrThrow<SuccessType, ErrorType, ThrownError extends Error = Error>(\r\n  result: Result<SuccessType, ErrorType>,\r\n  toError?: (error: ErrorType) => ThrownError\r\n): SuccessType {\r\n  if (result.ok) return result.value;\r\n  // Safe: when toError is provided it returns ThrownError, otherwise we create an Error which conforms to ThrownError via constraint\r\n  /* type-coverage:ignore-next-line */\r\n  const e = toError ? toError(result.error) : (new Error(String(result.error)) as ThrownError);\r\n  throw e;\r\n}\r\n\r\n/**\r\n * Executes a function and wraps the result in a Result, catching any thrown errors.\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The error type\r\n * @param fn - The function to execute\r\n * @param mapUnknownError - Function to convert caught errors to the ErrorType\r\n * @returns A Result containing either the return value or the caught error\r\n *\r\n * @example\r\n * ```typescript\r\n * const parsed = tryCatch(\r\n *   () => JSON.parse(\"{ invalid json\"),\r\n *   (e) => `Parse error: ${e}`\r\n * );\r\n * // { ok: false, error: \"Parse error: ...\" }\r\n * ```\r\n */\r\nexport function tryCatch<SuccessType, ErrorType>(\r\n  fn: () => SuccessType,\r\n  mapUnknownError: (unknownError: unknown) => ErrorType\r\n): Result<SuccessType, ErrorType> {\r\n  try {\r\n    return ok(fn());\r\n  } catch (unknownError) {\r\n    return err(mapUnknownError(unknownError));\r\n  }\r\n}\r\n\r\n/**\r\n * Combines multiple Results into a single Result containing an array of values.\r\n * If any Result is an error, returns that error immediately (short-circuits).\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The error type\r\n * @param results - Array of Results to combine\r\n * @returns A Result containing an array of values, or the first error encountered\r\n *\r\n * @example\r\n * ```typescript\r\n * const nums = [ok(1), ok(2), ok(3)];\r\n * all(nums); // { ok: true, value: [1, 2, 3] }\r\n *\r\n * const mixed = [ok(1), err(\"error\"), ok(3)];\r\n * all(mixed); // { ok: false, error: \"error\" }\r\n * ```\r\n */\r\nexport function all<SuccessType, ErrorType>(\r\n  results: Array<Result<SuccessType, ErrorType>>\r\n): Result<SuccessType[], ErrorType> {\r\n  const out: SuccessType[] = [];\r\n  for (const r of results) {\r\n    if (!r.ok) return r;\r\n    out.push(r.value);\r\n  }\r\n  return ok(out);\r\n}\r\n\r\n/**\r\n * Pattern matching for Results. Executes different handlers based on success or failure.\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The error type\r\n * @template ReturnType - The return type of both handlers\r\n * @param result - The Result to match\r\n * @param handlers - Object with onOk and onErr handlers\r\n * @returns The result of the executed handler\r\n *\r\n * @example\r\n * ```typescript\r\n * const result = ok(42);\r\n * match(result, {\r\n *   onOk: value => console.log(`Success: ${value}`),\r\n *   onErr: error => console.error(`Error: ${error}`)\r\n * });\r\n * ```\r\n */\r\nexport function match<SuccessType, ErrorType, ReturnType>(\r\n  result: Result<SuccessType, ErrorType>,\r\n  handlers: { onOk: (value: SuccessType) => ReturnType; onErr: (error: ErrorType) => ReturnType }\r\n): ReturnType {\r\n  return result.ok ? handlers.onOk(result.value) : handlers.onErr(result.error);\r\n}\r\n\r\n/**\r\n * Lifts a regular function to work with Results by wrapping it with error handling.\r\n *\r\n * @template ParamType - The function parameter type\r\n * @template SuccessType - The function return type (success type)\r\n * @template ErrorType - The error type\r\n * @param fn - The function to lift\r\n * @param mapUnknownError - Function to convert thrown errors to the ErrorType\r\n * @returns A function that returns a Result\r\n *\r\n * @example\r\n * ```typescript\r\n * const parseJSON = lift(\r\n *   (str: string) => JSON.parse(str),\r\n *   (e) => `Invalid JSON: ${e}`\r\n * );\r\n *\r\n * const result = parseJSON(\"{ invalid }\");\r\n * // { ok: false, error: \"Invalid JSON: ...\" }\r\n * ```\r\n */\r\nexport function lift<ParamType, SuccessType, ErrorType>(\r\n  fn: (param: ParamType) => SuccessType,\r\n  mapUnknownError: (unknownError: unknown) => ErrorType\r\n): (param: ParamType) => Result<SuccessType, ErrorType> {\r\n  return (param) => tryCatch(() => fn(param), mapUnknownError);\r\n}\r\n\r\n/**\r\n * Transforms the value of an async Result.\r\n * If the Result is an error, returns it unchanged.\r\n *\r\n * @template SuccessType - The current success type\r\n * @template NewSuccessType - The new success type after transformation\r\n * @template ErrorType - The error type\r\n * @param asyncResult - The async Result to transform\r\n * @param transform - Async or sync function to transform the success value\r\n * @returns A promise that resolves to a Result with the transformed value or error\r\n *\r\n * @example\r\n * ```typescript\r\n * const asyncNum = Promise.resolve(ok(5));\r\n * const doubled = await asyncMap(asyncNum, x => x * 2);\r\n * // { ok: true, value: 10 }\r\n * ```\r\n */\r\nexport async function asyncMap<SuccessType, NewSuccessType, ErrorType>(\r\n  asyncResult: AsyncResult<SuccessType, ErrorType>,\r\n  transform: (value: SuccessType) => Promise<NewSuccessType> | NewSuccessType\r\n): AsyncResult<NewSuccessType, ErrorType> {\r\n  const result = await asyncResult;\r\n  return result.ok ? ok(await transform(result.value)) : result;\r\n}\r\n\r\n/**\r\n * Chains async Result operations.\r\n * If the Result is successful, applies the async function to the value.\r\n *\r\n * @template SuccessType - The current success type\r\n * @template ErrorType - The error type\r\n * @template NextSuccessType - The next success type after chaining\r\n * @param asyncResult - The async Result to chain\r\n * @param next - Async function that returns a new async Result\r\n * @returns A promise that resolves to the chained Result or the original error\r\n *\r\n * @example\r\n * ```typescript\r\n * const fetchAndProcess = async (url: string) => {\r\n *   const data = await fromPromise(fetch(url).then(r => r.json()), e => String(e));\r\n *   return asyncAndThen(data, processDataAsync);\r\n * };\r\n * ```\r\n */\r\nexport async function asyncAndThen<SuccessType, ErrorType, NextSuccessType>(\r\n  asyncResult: AsyncResult<SuccessType, ErrorType>,\r\n  next: (value: SuccessType) => AsyncResult<NextSuccessType, ErrorType>\r\n): AsyncResult<NextSuccessType, ErrorType> {\r\n  const result = await asyncResult;\r\n  return result.ok ? next(result.value) : result;\r\n}\r\n\r\n/**\r\n * Converts a Promise into an async Result.\r\n * Catches any rejection and converts it to an error Result.\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The error type\r\n * @param promise - The Promise to convert\r\n * @param mapUnknownError - Function to convert unknown errors to the ErrorType\r\n * @returns A promise that resolves to a Result\r\n *\r\n * @example\r\n * ```typescript\r\n * const result = await fromPromise(\r\n *   fetch(\"/api/data\").then(r => r.json()),\r\n *   (e) => `Fetch failed: ${e}`\r\n * );\r\n * ```\r\n */\r\nexport async function fromPromise<SuccessType, ErrorType>(\r\n  promise: Promise<SuccessType>,\r\n  mapUnknownError: (unknownError: unknown) => ErrorType\r\n): AsyncResult<SuccessType, ErrorType> {\r\n  try {\r\n    return ok(await promise);\r\n  } catch (unknownError) {\r\n    return err(mapUnknownError(unknownError));\r\n  }\r\n}\r\n\r\n/**\r\n * Combines multiple async Results into a single Result containing an array of values.\r\n * If any Result is an error, returns that error (short-circuits).\r\n *\r\n * @template SuccessType - The success type\r\n * @template ErrorType - The error type\r\n * @param asyncResults - Array of async Results to combine\r\n * @returns A promise that resolves to a Result containing an array of values or the first error\r\n *\r\n * @example\r\n * ```typescript\r\n * const results = [\r\n *   Promise.resolve(ok(1)),\r\n *   Promise.resolve(ok(2)),\r\n *   Promise.resolve(ok(3))\r\n * ];\r\n * const combined = await asyncAll(results);\r\n * // { ok: true, value: [1, 2, 3] }\r\n * ```\r\n */\r\nexport async function asyncAll<SuccessType, ErrorType>(\r\n  asyncResults: Array<AsyncResult<SuccessType, ErrorType>>\r\n): AsyncResult<SuccessType[], ErrorType> {\r\n  const results: Result<SuccessType, ErrorType>[] = await Promise.all(asyncResults);\r\n  return all(results);\r\n}\r\n","/**\r\n * Utility function to create type-safe injection tokens for dependency injection.\r\n */\r\nimport type { InjectionToken } from \"./types/injectiontoken\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\n\r\n/**\r\n * Creates a unique, type-safe injection token for dependency injection.\r\n * Each call creates a new Symbol, ensuring uniqueness even with the same description.\r\n *\r\n * @template ServiceType - The type of service this token represents\r\n * @param description - A descriptive name for debugging purposes (appears in DevTools)\r\n * @returns A unique Symbol branded with the service type\r\n *\r\n * @example\r\n * // Create tokens for different services\r\n * const LoggerToken = createInjectionToken<Logger>('Logger');\r\n * const DatabaseToken = createInjectionToken<Database>('Database');\r\n *\r\n * // Tokens can be used with a DI container\r\n * container.register(LoggerToken, new Logger());\r\n */\r\nexport function createInjectionToken<TServiceType extends ServiceType>(\r\n  description: string\r\n): InjectionToken<TServiceType> {\r\n  return Symbol(description) as InjectionToken<TServiceType>;\r\n}\r\n","/**\r\n * Injection tokens for the Foundry abstraction layer and its versioned ports.\r\n * These tokens allow services to be resolved via the DI container without\r\n * directly depending on concrete implementations.\r\n */\r\nimport type { InjectionToken } from \"@/di_infrastructure/types/injectiontoken\";\r\nimport { createInjectionToken } from \"@/di_infrastructure/tokenutilities\";\r\nimport type { FoundryGame } from \"./interfaces/FoundryGame\";\r\nimport type { FoundryHooks } from \"./interfaces/FoundryHooks\";\r\nimport type { FoundryDocument } from \"./interfaces/FoundryDocument\";\r\nimport type { FoundryUI } from \"./interfaces/FoundryUI\";\r\nimport type { FoundrySettings } from \"./interfaces/FoundrySettings\";\r\nimport type { FoundryI18n } from \"./interfaces/FoundryI18n\";\r\nimport type { PortSelector } from \"./versioning/portselector\";\r\nimport type { PortRegistry } from \"./versioning/portregistry\";\r\nimport type { FoundryJournalFacade } from \"./facades/foundry-journal-facade.interface\";\r\n\r\n/**\r\n * Injection token for FoundryGame service.\r\n *\r\n * Provides access to Foundry's game API, specifically journal entries.\r\n * Automatically selects version-appropriate port implementation.\r\n *\r\n * @example\r\n * ```typescript\r\n * const game = container.resolve(foundryGameToken);\r\n * const entries = game.getJournalEntries();\r\n * if (entries.ok) {\r\n *   console.log(`Found ${entries.value.length} journal entries`);\r\n * }\r\n * ```\r\n */\r\nexport const foundryGameToken: InjectionToken<FoundryGame> =\r\n  createInjectionToken<FoundryGame>(\"FoundryGame\");\r\n\r\n/**\r\n * Injection token for FoundryHooks service.\r\n *\r\n * Provides access to Foundry's hook system for event registration.\r\n * Automatically selects version-appropriate port implementation.\r\n *\r\n * @example\r\n * ```typescript\r\n * const hooks = container.resolve(foundryHooksToken);\r\n * hooks.on(\"renderJournalDirectory\", (app, html) => {\r\n *   console.log(\"Journal directory rendered\");\r\n * });\r\n * ```\r\n */\r\nexport const foundryHooksToken: InjectionToken<FoundryHooks> =\r\n  createInjectionToken<FoundryHooks>(\"FoundryHooks\");\r\n\r\n/**\r\n * Injection token for FoundryDocument service.\r\n *\r\n * Provides access to Foundry's document API for flag management.\r\n * Automatically selects version-appropriate port implementation.\r\n *\r\n * @example\r\n * ```typescript\r\n * const doc = container.resolve(foundryDocumentToken);\r\n * const flag = doc.getFlag(journal, \"my-module\", \"my-flag\");\r\n * if (flag.ok) {\r\n *   console.log(\"Flag value:\", flag.value);\r\n * }\r\n * ```\r\n */\r\nexport const foundryDocumentToken: InjectionToken<FoundryDocument> =\r\n  createInjectionToken<FoundryDocument>(\"FoundryDocument\");\r\n\r\n/**\r\n * Injection token for FoundryUI service.\r\n *\r\n * Provides access to Foundry's UI manipulation API for notifications\r\n * and DOM element management.\r\n *\r\n * @example\r\n * ```typescript\r\n * const ui = container.resolve(foundryUIToken);\r\n * ui.notify(\"Operation successful\", \"info\");\r\n * ```\r\n */\r\nexport const foundryUIToken: InjectionToken<FoundryUI> =\r\n  createInjectionToken<FoundryUI>(\"FoundryUI\");\r\n\r\n/**\r\n * Injection token for PortSelector.\r\n *\r\n * Selects the appropriate port implementation based on the current\r\n * Foundry VTT version. Uses factory-based selection to prevent crashes\r\n * from incompatible port constructors.\r\n *\r\n * @remarks\r\n * This is a core infrastructure service used internally by Foundry services.\r\n * Typically not accessed directly by application code.\r\n */\r\nexport const portSelectorToken: InjectionToken<PortSelector> =\r\n  createInjectionToken<PortSelector>(\"PortSelector\");\r\n\r\n/**\r\n * Injection token for FoundryGame PortRegistry.\r\n */\r\nexport const foundryGamePortRegistryToken: InjectionToken<PortRegistry<FoundryGame>> =\r\n  createInjectionToken<PortRegistry<FoundryGame>>(\"FoundryGamePortRegistry\");\r\n\r\n/**\r\n * Injection token for FoundryHooks PortRegistry.\r\n */\r\nexport const foundryHooksPortRegistryToken: InjectionToken<PortRegistry<FoundryHooks>> =\r\n  createInjectionToken<PortRegistry<FoundryHooks>>(\"FoundryHooksPortRegistry\");\r\n\r\n/**\r\n * Injection token for FoundryDocument PortRegistry.\r\n */\r\nexport const foundryDocumentPortRegistryToken: InjectionToken<PortRegistry<FoundryDocument>> =\r\n  createInjectionToken<PortRegistry<FoundryDocument>>(\"FoundryDocumentPortRegistry\");\r\n\r\n/**\r\n * Injection token for FoundryUI PortRegistry.\r\n */\r\nexport const foundryUIPortRegistryToken: InjectionToken<PortRegistry<FoundryUI>> =\r\n  createInjectionToken<PortRegistry<FoundryUI>>(\"FoundryUIPortRegistry\");\r\n\r\n/**\r\n * Injection token for FoundrySettings service.\r\n *\r\n * Provides access to Foundry's settings system for module configuration.\r\n * Automatically selects version-appropriate port implementation.\r\n *\r\n * @example\r\n * ```typescript\r\n * const settings = container.resolve(foundrySettingsToken);\r\n * const logLevel = settings.get(\"my-module\", \"logLevel\");\r\n * if (logLevel.ok) {\r\n *   console.log(\"Current log level:\", logLevel.value);\r\n * }\r\n * ```\r\n */\r\nexport const foundrySettingsToken: InjectionToken<FoundrySettings> =\r\n  createInjectionToken<FoundrySettings>(\"FoundrySettings\");\r\n\r\n/**\r\n * Injection token for FoundrySettings PortRegistry.\r\n */\r\nexport const foundrySettingsPortRegistryToken: InjectionToken<PortRegistry<FoundrySettings>> =\r\n  createInjectionToken<PortRegistry<FoundrySettings>>(\"FoundrySettingsPortRegistry\");\r\n\r\n/**\r\n * Injection token for FoundryI18n PortRegistry.\r\n */\r\nexport const foundryI18nPortRegistryToken: InjectionToken<PortRegistry<FoundryI18n>> =\r\n  createInjectionToken<PortRegistry<FoundryI18n>>(\"FoundryI18nPortRegistry\");\r\n\r\n/**\r\n * Injection token for FoundryJournalFacade.\r\n *\r\n * Facade that combines FoundryGame, FoundryDocument, and FoundryUI\r\n * for journal-specific operations.\r\n *\r\n * **Benefits:**\r\n * - Reduces dependency count from 3 services to 1 facade\r\n * - Provides cohesive journal-specific API\r\n * - Easier to test and mock\r\n *\r\n * @example\r\n * ```typescript\r\n * const facade = container.resolve(foundryJournalFacadeToken);\r\n * const entries = facade.getJournalEntries();\r\n * if (entries.ok) {\r\n *   // Process entries\r\n * }\r\n * ```\r\n */\r\nexport const foundryJournalFacadeToken: InjectionToken<FoundryJournalFacade> =\r\n  createInjectionToken<FoundryJournalFacade>(\"FoundryJournalFacade\");\r\n","import { createInjectionToken } from \"@/di_infrastructure/tokenutilities\";\r\nimport type { Logger } from \"@/interfaces/logger\";\r\nimport type { JournalVisibilityService } from \"@/services/JournalVisibilityService\";\r\nimport type { MetricsCollector } from \"@/observability/metrics-collector\";\r\nimport type { MetricsRecorder } from \"@/observability/interfaces/metrics-recorder\";\r\nimport type { MetricsSampler } from \"@/observability/interfaces/metrics-sampler\";\r\nimport type { FoundryI18nService } from \"@/foundry/services/FoundryI18nService\";\r\nimport type { LocalI18nService } from \"@/services/LocalI18nService\";\r\nimport type { I18nFacadeService } from \"@/services/I18nFacadeService\";\r\nimport type { EnvironmentConfig } from \"@/config/environment\";\r\nimport type { ModuleHealthService } from \"@/core/module-health-service\";\r\nimport type { PerformanceTrackingService } from \"@/services/PerformanceTrackingService\";\r\nimport type { RetryService } from \"@/services/RetryService\";\r\n\r\n/**\r\n * Injection token for the application logger service.\r\n *\r\n * Resolves to ConsoleLoggerService, providing structured logging\r\n * with configurable log levels (DEBUG, INFO, WARN, ERROR).\r\n *\r\n * @example\r\n * ```typescript\r\n * const logger = container.resolve(loggerToken);\r\n * logger.info(\"Application started\");\r\n * logger.error(\"Error occurred\", { code: 500, details: error });\r\n * ```\r\n */\r\nexport const loggerToken = createInjectionToken<Logger>(\"Logger\");\r\n\r\n/**\r\n * Injection token for the MetricsCollector service.\r\n *\r\n * Provides observability and performance tracking for the DI container.\r\n * Collects metrics about service resolutions, port selections, and cache performance.\r\n *\r\n * @example\r\n * ```typescript\r\n * const metrics = container.resolve(metricsCollectorToken);\r\n * metrics.recordResolution(someToken, 2.5, true);\r\n * const snapshot = metrics.getSnapshot();\r\n * console.table(snapshot);\r\n * ```\r\n */\r\nexport const metricsCollectorToken = createInjectionToken<MetricsCollector>(\"MetricsCollector\");\r\n\r\n/**\r\n * Injection token for the MetricsRecorder interface.\r\n *\r\n * Provides minimal recording capability without full MetricsCollector features.\r\n * Use this token when you only need to record metrics, not query or sample them.\r\n *\r\n * **Design:** Implements Interface Segregation Principle - depend on minimal interface.\r\n *\r\n * @example\r\n * ```typescript\r\n * class MyService {\r\n *   static dependencies = [metricsRecorderToken] as const;\r\n *   constructor(private recorder: MetricsRecorder) {}\r\n *   // Can record but not query metrics\r\n * }\r\n * ```\r\n */\r\nexport const metricsRecorderToken = createInjectionToken<MetricsRecorder>(\"MetricsRecorder\");\r\n\r\n/**\r\n * Injection token for the MetricsSampler interface.\r\n *\r\n * Provides sampling decision capability without full MetricsCollector features.\r\n * Use this token when you only need to check if sampling should occur.\r\n *\r\n * **Design:** Implements Interface Segregation Principle - depend on minimal interface.\r\n *\r\n * @example\r\n * ```typescript\r\n * class PerformanceTracker {\r\n *   static dependencies = [metricsSamplerToken] as const;\r\n *   constructor(private sampler: MetricsSampler) {}\r\n *   // Can check sampling but not record or query\r\n * }\r\n * ```\r\n */\r\nexport const metricsSamplerToken = createInjectionToken<MetricsSampler>(\"MetricsSampler\");\r\n\r\n/**\r\n * Injection token for the JournalVisibilityService.\r\n *\r\n * Manages visibility of journal entries based on module flags.\r\n * Handles hiding/showing entries in the Foundry UI and processes\r\n * journal directory rendering.\r\n *\r\n * @example\r\n * ```typescript\r\n * const service = container.resolve(journalVisibilityServiceToken);\r\n * const hidden = service.getHiddenJournalEntries();\r\n * if (hidden.ok) {\r\n *   console.log(`Found ${hidden.value.length} hidden entries`);\r\n * }\r\n * ```\r\n */\r\nexport const journalVisibilityServiceToken = createInjectionToken<JournalVisibilityService>(\r\n  \"JournalVisibilityService\"\r\n);\r\n\r\n/**\r\n * Injection token for the FoundryI18nService.\r\n *\r\n * Provides access to Foundry VTT's i18n API via Port-Adapter pattern.\r\n * Automatically selects the correct port based on Foundry version.\r\n *\r\n * @example\r\n * ```typescript\r\n * const i18n = container.resolve(foundryI18nToken);\r\n * const result = i18n.localize(\"MODULE.SETTINGS.enableFeature\");\r\n * if (result.ok) {\r\n *   console.log(result.value);\r\n * }\r\n * ```\r\n */\r\nexport const foundryI18nToken = createInjectionToken<FoundryI18nService>(\"FoundryI18nService\");\r\n\r\n/**\r\n * Injection token for the LocalI18nService.\r\n *\r\n * Provides Foundry-independent JSON-based translations.\r\n * Used as fallback when Foundry's i18n is unavailable.\r\n *\r\n * @example\r\n * ```typescript\r\n * const i18n = container.resolve(localI18nToken);\r\n * const result = i18n.translate(\"MODULE.SETTINGS.enableFeature\");\r\n * console.log(result.value);\r\n * ```\r\n */\r\nexport const localI18nToken = createInjectionToken<LocalI18nService>(\"LocalI18nService\");\r\n\r\n/**\r\n * Injection token for the I18nFacadeService.\r\n *\r\n * Combines Foundry's i18n and local translations with intelligent fallback.\r\n * This is the recommended token to use for all internationalization needs.\r\n *\r\n * @example\r\n * ```typescript\r\n * const i18n = container.resolve(i18nFacadeToken);\r\n * const text = i18n.translate(\"MODULE.SETTINGS.enableFeature\", \"Enable Feature\");\r\n * console.log(text);\r\n * ```\r\n */\r\nexport const i18nFacadeToken = createInjectionToken<I18nFacadeService>(\"I18nFacadeService\");\r\n\r\n/**\r\n * Injection token for the EnvironmentConfig.\r\n *\r\n * Provides access to environment configuration (development/production mode,\r\n * log levels, performance tracking settings, etc.).\r\n *\r\n * Injecting ENV as a service improves testability and follows DIP\r\n * (Dependency Inversion Principle) by depending on abstraction rather than\r\n * concrete global state.\r\n *\r\n * @example\r\n * ```typescript\r\n * export class MyService {\r\n *   static dependencies = [environmentConfigToken] as const;\r\n *\r\n *   constructor(private readonly env: EnvironmentConfig) {}\r\n *\r\n *   doSomething() {\r\n *     if (this.env.isDevelopment) {\r\n *       // Development-specific logic\r\n *     }\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport const environmentConfigToken = createInjectionToken<EnvironmentConfig>(\"EnvironmentConfig\");\r\n\r\n/**\r\n * Injection token for the ModuleHealthService.\r\n *\r\n * Provides module health monitoring and diagnostics.\r\n * Checks container validation, port selection, and metrics for health assessment.\r\n *\r\n * @example\r\n * ```typescript\r\n * const healthService = container.resolve(moduleHealthServiceToken);\r\n * const health = healthService.getHealth();\r\n * console.log(`Module status: ${health.status}`);\r\n * ```\r\n */\r\nexport const moduleHealthServiceToken =\r\n  createInjectionToken<ModuleHealthService>(\"ModuleHealthService\");\r\n\r\n/**\r\n * Injection token for the PerformanceTrackingService.\r\n *\r\n * Provides centralized performance tracking with sampling support.\r\n * Automatically injects EnvironmentConfig and MetricsCollector.\r\n *\r\n * @example\r\n * ```typescript\r\n * const perfService = container.resolve(performanceTrackingServiceToken);\r\n * const result = perfService.track(() => expensiveOperation());\r\n * ```\r\n */\r\nexport const performanceTrackingServiceToken = createInjectionToken<PerformanceTrackingService>(\r\n  \"PerformanceTrackingService\"\r\n);\r\n\r\n/**\r\n * Injection token for the RetryService.\r\n *\r\n * Provides retry operations with exponential backoff and automatic logging.\r\n * Automatically injects Logger and MetricsCollector.\r\n *\r\n * @example\r\n * ```typescript\r\n * const retryService = container.resolve(retryServiceToken);\r\n * const result = await retryService.retry(\r\n *   () => fetchData(),\r\n *   { maxAttempts: 3, operationName: \"fetchData\" }\r\n * );\r\n * ```\r\n */\r\nexport const retryServiceToken = createInjectionToken<RetryService>(\"RetryService\");\r\n\r\n/**\r\n * Re-export port-related tokens for convenience.\r\n * These are defined in @/foundry/foundrytokens but exported here for easier access.\r\n */\r\nexport { portSelectorToken } from \"@/foundry/foundrytokens\";\r\n","import type { InjectionToken } from \"./injectiontoken\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\n\r\n/**\r\n * Compile-time brand marker for API-safe tokens.\r\n *\r\n * This symbol only exists at the type level and is erased at runtime.\r\n * It's used to mark tokens that are safe for external module consumption via the public API.\r\n *\r\n * @internal This is a type-level-only marker\r\n */\r\ndeclare const API_SAFE_BRAND: unique symbol;\r\n\r\n/**\r\n * Runtime registry of API-safe tokens.\r\n *\r\n * Uses Set for O(1) lookups. Since symbols are primitives (not objects),\r\n * WeakSet cannot be used. This is safe because tokens are compile-time constants\r\n * and never get garbage collected anyway.\r\n *\r\n * @internal\r\n */\r\nconst apiSafeTokens = new Set<symbol>();\r\n\r\n/**\r\n * InjectionToken branded as \"API-safe\" for external module consumption.\r\n *\r\n * Only tokens marked via `markAsApiSafe()` can be used with the throwing\r\n * `container.resolve()` method. This enforces that internal code uses\r\n * `resolveWithError()` for Result-based error handling.\r\n *\r\n * **Enforcement:**\r\n * - Compile-time: TypeScript enforces ApiSafeToken type (prevents `container.resolve(regularToken)`)\r\n * - Runtime: Symbol marker validates token was marked via markAsApiSafe()\r\n *\r\n * **Design rationale:**\r\n * - External modules (unfamiliar with Result pattern) get exception-based API\r\n * - Internal code (uses Result pattern) cannot accidentally use throwing API\r\n * - Defense-in-depth: Type system + runtime guard\r\n *\r\n * @template T - The service type this token resolves to\r\n *\r\n * @see markAsApiSafe - Function to mark tokens as API-safe\r\n * @see https://github.com/tc39/proposal-type-annotations (future TC39 standard alignment)\r\n */\r\nexport type ApiSafeToken<T extends ServiceType> = InjectionToken<T> & {\r\n  readonly [API_SAFE_BRAND]: true;\r\n};\r\n\r\n/**\r\n * Marks an injection token as safe for API exposure.\r\n *\r\n * ** RESTRICTED: Only call this in composition-root.ts**\r\n *\r\n * This function should ONLY be used when creating the public ModuleApi\r\n * to mark tokens that external modules can safely use with `api.resolve()`.\r\n *\r\n * Internal code should never call this function - it should always use\r\n * `resolveWithError()` with regular InjectionToken types.\r\n *\r\n * **Implementation:**\r\n * 1. Adds token to Set registry\r\n * 2. Returns token cast as ApiSafeToken (compile-time brand)\r\n *\r\n * **Performance:**\r\n * - Minimal runtime overhead (Set.add is O(1))\r\n * - Compile-time type checking prevents misuse\r\n *\r\n * @param token - The injection token to mark as API-safe\r\n * @returns The same token, branded as ApiSafeToken with runtime marker\r\n *\r\n * @example\r\n * ```typescript\r\n * //  CORRECT: In composition-root.ts\r\n * const api: ModuleApi = {\r\n *   tokens: {\r\n *     loggerToken: markAsApiSafe(loggerToken),\r\n *     gameToken: markAsApiSafe(foundryGameToken),\r\n *   }\r\n * };\r\n *\r\n * //  WRONG: In service code\r\n * const logger = container.resolve(markAsApiSafe(loggerToken));\r\n * // Use resolveWithError() instead!\r\n * ```\r\n */\r\nexport function markAsApiSafe<T extends ServiceType>(token: InjectionToken<T>): ApiSafeToken<T> {\r\n  // Add to Set registry (O(1) lookup)\r\n  apiSafeTokens.add(token);\r\n\r\n  // Return with compile-time brand (type cast)\r\n  /* type-coverage:ignore-next-line */\r\n  return token as ApiSafeToken<T>;\r\n}\r\n\r\n/**\r\n * Runtime validation that a token is API-safe.\r\n *\r\n * Checks if the token is in the Set registry.\r\n * Used by container.resolve() to enforce API boundary at runtime.\r\n *\r\n * This provides defense-in-depth against:\r\n * - @ts-ignore comments bypassing type checks\r\n * - Type assertions (`token as ApiSafeToken`)\r\n * - JavaScript consumers (no type checking)\r\n *\r\n * **Performance:**\r\n * - O(1) Set lookup (~1-2 nanoseconds)\r\n * - Negligible impact (~0.4% of resolve() time)\r\n * - Safe: Tokens are compile-time constants, never GC'd\r\n *\r\n * @param token - The token to validate\r\n * @returns True if token was marked via markAsApiSafe(), false otherwise\r\n *\r\n * @internal Used by ServiceContainer, not intended for external use\r\n *\r\n * @example\r\n * ```typescript\r\n * // Container.resolve() implementation:\r\n * resolve(token) {\r\n *   if (!isApiSafeTokenRuntime(token)) {\r\n *     throw new Error(\"Use resolveWithError() in internal code\");\r\n *   }\r\n *   // ...\r\n * }\r\n * ```\r\n */\r\nexport function isApiSafeTokenRuntime<T extends ServiceType>(\r\n  token: InjectionToken<T>\r\n): token is ApiSafeToken<T> {\r\n  // Check Set registry\r\n  return apiSafeTokens.has(token);\r\n}\r\n","/**\r\n * Enum for service lifecycle strategies in dependency injection.\r\n *\r\n * - SINGLETON: One shared instance across the entire application\r\n * - TRANSIENT: New instance created on each resolution\r\n * - SCOPED: One instance per container scope\r\n *\r\n * @enum {string}\r\n * @property {string} SINGLETON - One instance for all\r\n * @property {string} TRANSIENT - New instance for each resolve()\r\n * @property {string} SCOPED - One instance per scope\r\n */\r\nexport enum ServiceLifecycle {\r\n  SINGLETON = \"singleton\",\r\n  TRANSIENT = \"transient\",\r\n  SCOPED = \"scoped\",\r\n}\r\n","import type { ServiceLifecycle } from \"./servicelifecycle\";\r\nimport type { InjectionToken } from \"./injectiontoken\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport type { ServiceClass } from \"./serviceclass\";\r\nimport type { FactoryFunction } from \"./servicefactory\";\r\nimport type { Result } from \"@/types/result\";\r\nimport type { ContainerError } from \"../interfaces/containererror\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\nimport { ServiceLifecycle as SL } from \"./servicelifecycle\";\r\n\r\n/**\r\n * Represents a service registration in the DI container.\r\n * Stores all metadata required to create and manage service instances.\r\n *\r\n * Design: Uses separate optional fields instead of union type to:\r\n * - Prevent accidental calls to placeholder alias factories\r\n * - Make provider type clear and type-safe\r\n * - Support proper cloning for child scopes\r\n *\r\n * Use static factory methods to create instances:\r\n * - ServiceRegistration.createClass()\r\n * - ServiceRegistration.createFactory()\r\n * - ServiceRegistration.createValue()\r\n * - ServiceRegistration.createAlias()\r\n */\r\nexport class ServiceRegistration {\r\n  /**\r\n   * Private constructor - use static factory methods instead.\r\n   * This prevents direct construction with invalid parameters\r\n   * and ensures Result-based error handling.\r\n   */\r\n  private constructor(\r\n    public readonly lifecycle: ServiceLifecycle,\r\n    public readonly dependencies: readonly InjectionToken<ServiceType>[], // Immutable array\r\n    public readonly providerType: \"class\" | \"factory\" | \"value\" | \"alias\",\r\n\r\n    // Exactly one of these must be set based on providerType:\r\n    public readonly serviceClass?: ServiceClass<ServiceType>,\r\n    public readonly factory?: FactoryFunction<ServiceType>,\r\n    public readonly value?: ServiceType,\r\n    public readonly aliasTarget?: InjectionToken<ServiceType>\r\n  ) {\r\n    // NO validation here - trust factory methods to provide valid data\r\n  }\r\n\r\n  /**\r\n   * Creates a class-based registration.\r\n   * @param lifecycle - Service lifecycle (SINGLETON, TRANSIENT, SCOPED)\r\n   * @param dependencies - Array of dependency tokens\r\n   * @param serviceClass - The class to instantiate\r\n   * @returns Result with registration or validation error\r\n   */\r\n  static createClass(\r\n    lifecycle: ServiceLifecycle,\r\n    dependencies: readonly InjectionToken<ServiceType>[],\r\n    serviceClass: ServiceClass<ServiceType>\r\n  ): Result<ServiceRegistration, ContainerError> {\r\n    if (!serviceClass) {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: \"serviceClass is required for class registration\",\r\n      });\r\n    }\r\n\r\n    return ok(\r\n      new ServiceRegistration(\r\n        lifecycle,\r\n        dependencies,\r\n        \"class\",\r\n        serviceClass,\r\n        undefined,\r\n        undefined,\r\n        undefined\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Creates a factory-based registration.\r\n   * @param lifecycle - Service lifecycle (SINGLETON, TRANSIENT, SCOPED)\r\n   * @param dependencies - Array of dependency tokens\r\n   * @param factory - Factory function that creates instances\r\n   * @returns Result with registration or validation error\r\n   */\r\n  static createFactory(\r\n    lifecycle: ServiceLifecycle,\r\n    dependencies: readonly InjectionToken<ServiceType>[],\r\n    factory: FactoryFunction<ServiceType>\r\n  ): Result<ServiceRegistration, ContainerError> {\r\n    if (!factory) {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: \"factory is required for factory registration\",\r\n      });\r\n    }\r\n\r\n    return ok(\r\n      new ServiceRegistration(\r\n        lifecycle,\r\n        dependencies,\r\n        \"factory\",\r\n        undefined,\r\n        factory,\r\n        undefined,\r\n        undefined\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Creates a value-based registration (always SINGLETON).\r\n   * @param value - The value to register\r\n   * @returns Result with registration or validation error\r\n   */\r\n  static createValue(value: ServiceType): Result<ServiceRegistration, ContainerError> {\r\n    if (value === undefined) {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: \"value cannot be undefined for value registration\",\r\n      });\r\n    }\r\n\r\n    if (typeof value === \"function\") {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message:\r\n          \"registerValue() only accepts plain values, not functions or classes. Use registerClass() or registerFactory() instead.\",\r\n      });\r\n    }\r\n\r\n    return ok(\r\n      new ServiceRegistration(SL.SINGLETON, [], \"value\", undefined, undefined, value, undefined)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Creates an alias registration (always SINGLETON).\r\n   * @param targetToken - The token to resolve instead\r\n   * @returns Result with registration or validation error\r\n   */\r\n  static createAlias(\r\n    targetToken: InjectionToken<ServiceType>\r\n  ): Result<ServiceRegistration, ContainerError> {\r\n    if (!targetToken) {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: \"targetToken is required for alias registration\",\r\n      });\r\n    }\r\n\r\n    return ok(\r\n      new ServiceRegistration(\r\n        SL.SINGLETON,\r\n        [targetToken],\r\n        \"alias\",\r\n        undefined,\r\n        undefined,\r\n        undefined,\r\n        targetToken\r\n      )\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Creates a clone of this registration.\r\n   * Used when child containers inherit registrations from parent.\r\n   *\r\n   * @returns A new ServiceRegistration instance with cloned dependencies array\r\n   */\r\n  clone(): ServiceRegistration {\r\n    return new ServiceRegistration(\r\n      this.lifecycle,\r\n      [...this.dependencies], // Clone array to prevent shared mutations\r\n      this.providerType,\r\n      this.serviceClass,\r\n      this.factory,\r\n      this.value,\r\n      this.aliasTarget\r\n    );\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { InjectionToken } from \"../types/injectiontoken\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport type { ServiceClass } from \"../types/serviceclass\";\r\nimport type { FactoryFunction } from \"../types/servicefactory\";\r\nimport type { ServiceDependencies } from \"../types/servicedependencies\";\r\nimport { ServiceLifecycle } from \"../types/servicelifecycle\";\r\nimport type { ContainerError } from \"../interfaces/containererror\";\r\nimport { ServiceRegistration } from \"../types/serviceregistration\";\r\nimport { ok, err, isErr } from \"@/utils/functional/result\";\r\n\r\n/**\r\n * Type for service classes that declare their dependencies.\r\n */\r\ntype ServiceClassWithDependencies<T extends ServiceType> = ServiceClass<T> & {\r\n  dependencies?: ReadonlyArray<InjectionToken<ServiceType>>;\r\n};\r\n\r\n/**\r\n * Type guard to check if a service class has a dependencies property.\r\n *\r\n * @template T - The service type\r\n * @param cls - The service class to check\r\n * @returns True if the class has a dependencies property\r\n */\r\nfunction hasDependencies<T extends ServiceType>(\r\n  cls: ServiceClass<T>\r\n): cls is ServiceClassWithDependencies<T> {\r\n  return \"dependencies\" in cls;\r\n}\r\n\r\n/**\r\n * Registry for service registrations.\r\n *\r\n * Responsibilities:\r\n * - Manage service registrations (add, retrieve, check existence)\r\n * - Validate registrations (no duplicates, valid values)\r\n * - Support cloning for child containers\r\n * - Enforce registration limits (DoS protection)\r\n *\r\n * This class does NOT handle:\r\n * - Service resolution (that's ServiceResolver's job)\r\n * - Dependency validation (that's ContainerValidator's job)\r\n */\r\nexport class ServiceRegistry {\r\n  private readonly MAX_REGISTRATIONS = 10000; // DoS protection: prevent unlimited registrations\r\n  private registrations = new Map<InjectionToken<ServiceType>, ServiceRegistration>();\r\n  private lifecycleIndex = new Map<ServiceLifecycle, Set<InjectionToken<ServiceType>>>();\r\n\r\n  /**\r\n   * Updates the lifecycle index when a service is registered.\r\n   *\r\n   * @param token - The injection token\r\n   * @param lifecycle - The service lifecycle\r\n   */\r\n  private updateLifecycleIndex(\r\n    token: InjectionToken<ServiceType>,\r\n    lifecycle: ServiceLifecycle\r\n  ): void {\r\n    if (!this.lifecycleIndex.has(lifecycle)) {\r\n      this.lifecycleIndex.set(lifecycle, new Set());\r\n    }\r\n    // Set is created above when absent; bang is safe for subsequent access\r\n    /* type-coverage:ignore-next-line */\r\n    this.lifecycleIndex.get(lifecycle)!.add(token);\r\n  }\r\n\r\n  /**\r\n   * Registers a service class with automatic dependency injection.\r\n   *\r\n   * @template TServiceType - The type of service to register\r\n   * @param token - The injection token identifying this service\r\n   * @param serviceClass - The class to instantiate\r\n   * @param lifecycle - Service lifecycle (SINGLETON, TRANSIENT, SCOPED)\r\n   * @returns Result indicating success or error\r\n   */\r\n  registerClass<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    serviceClass: ServiceClass<TServiceType>,\r\n    lifecycle: ServiceLifecycle\r\n  ): Result<void, ContainerError> {\r\n    // Check registration limit (DoS protection)\r\n    if (this.registrations.size >= this.MAX_REGISTRATIONS) {\r\n      return err({\r\n        code: \"MaxRegistrationsExceeded\",\r\n        message: `Cannot register more than ${this.MAX_REGISTRATIONS} services`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    if (this.registrations.has(token)) {\r\n      return err({\r\n        code: \"DuplicateRegistration\",\r\n        message: `Service ${String(token)} already registered`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    const dependencies = hasDependencies(serviceClass) ? (serviceClass.dependencies ?? []) : [];\r\n\r\n    // Use static factory method for validation\r\n    const registrationResult = ServiceRegistration.createClass(\r\n      lifecycle,\r\n      dependencies,\r\n      serviceClass\r\n    );\r\n\r\n    /* c8 ignore start -- ServiceRegistration.createClass validation tested in serviceregistration.test.ts; error propagation complex to test */\r\n    if (isErr(registrationResult)) {\r\n      return registrationResult;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    this.registrations.set(token, registrationResult.value);\r\n    this.updateLifecycleIndex(token, lifecycle);\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Registers a factory function for creating service instances.\r\n   *\r\n   * @template TServiceType - The type of service this factory creates\r\n   * @param token - The injection token identifying this service\r\n   * @param factory - Factory function that creates instances\r\n   * @param lifecycle - Service lifecycle (SINGLETON, TRANSIENT, SCOPED)\r\n   * @param dependencies - Array of tokens this factory depends on\r\n   * @returns Result indicating success or error\r\n   */\r\n  registerFactory<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    factory: FactoryFunction<TServiceType>,\r\n    lifecycle: ServiceLifecycle,\r\n    dependencies: ServiceDependencies\r\n  ): Result<void, ContainerError> {\r\n    // Check registration limit (DoS protection)\r\n    if (this.registrations.size >= this.MAX_REGISTRATIONS) {\r\n      return err({\r\n        code: \"MaxRegistrationsExceeded\",\r\n        message: `Cannot register more than ${this.MAX_REGISTRATIONS} services`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    if (this.registrations.has(token)) {\r\n      return err({\r\n        code: \"DuplicateRegistration\",\r\n        message: `Service ${String(token)} already registered`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    // Use static factory method for validation\r\n    const registrationResult = ServiceRegistration.createFactory(lifecycle, dependencies, factory);\r\n\r\n    /* c8 ignore start -- ServiceRegistration.createFactory validation tested in serviceregistration.test.ts; error propagation complex to test */\r\n    if (isErr(registrationResult)) {\r\n      return registrationResult;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    this.registrations.set(token, registrationResult.value);\r\n    this.updateLifecycleIndex(token, lifecycle);\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Registers a constant value (always SINGLETON lifecycle).\r\n   *\r\n   * @template TServiceType - The type of value to register\r\n   * @param token - The injection token identifying this value\r\n   * @param value - The value to register\r\n   * @returns Result indicating success or error\r\n   */\r\n  registerValue<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    value: TServiceType\r\n  ): Result<void, ContainerError> {\r\n    // Check registration limit (DoS protection)\r\n    if (this.registrations.size >= this.MAX_REGISTRATIONS) {\r\n      return err({\r\n        code: \"MaxRegistrationsExceeded\",\r\n        message: `Cannot register more than ${this.MAX_REGISTRATIONS} services`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    if (this.registrations.has(token)) {\r\n      return err({\r\n        code: \"DuplicateRegistration\",\r\n        message: `Service ${String(token)} already registered`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    // Use static factory method for validation (includes function check)\r\n    const registrationResult = ServiceRegistration.createValue(value);\r\n\r\n    /* c8 ignore start -- ServiceRegistration.createValue validation tested in serviceregistration.test.ts; error propagation complex to test */\r\n    if (isErr(registrationResult)) {\r\n      return registrationResult;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    this.registrations.set(token, registrationResult.value);\r\n    this.updateLifecycleIndex(token, ServiceLifecycle.SINGLETON); // Values are always SINGLETON\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Registers an alias that points to another token.\r\n   *\r\n   * @template TServiceType - The type of service\r\n   * @param aliasToken - The alias token\r\n   * @param targetToken - The token to resolve instead\r\n   * @returns Result indicating success or error\r\n   */\r\n  registerAlias<TServiceType extends ServiceType>(\r\n    aliasToken: InjectionToken<TServiceType>,\r\n    targetToken: InjectionToken<TServiceType>\r\n  ): Result<void, ContainerError> {\r\n    // Check registration limit (DoS protection)\r\n    if (this.registrations.size >= this.MAX_REGISTRATIONS) {\r\n      return err({\r\n        code: \"MaxRegistrationsExceeded\",\r\n        message: `Cannot register more than ${this.MAX_REGISTRATIONS} services`,\r\n        tokenDescription: String(aliasToken),\r\n      });\r\n    }\r\n\r\n    if (this.registrations.has(aliasToken)) {\r\n      return err({\r\n        code: \"DuplicateRegistration\",\r\n        message: `Service ${String(aliasToken)} already registered`,\r\n        tokenDescription: String(aliasToken),\r\n      });\r\n    }\r\n\r\n    // Use static factory method for validation\r\n    const registrationResult = ServiceRegistration.createAlias(targetToken);\r\n\r\n    /* c8 ignore start -- ServiceRegistration.createAlias validation tested in serviceregistration.test.ts; error propagation complex to test */\r\n    if (isErr(registrationResult)) {\r\n      return registrationResult;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    this.registrations.set(aliasToken, registrationResult.value);\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Retrieves a service registration.\r\n   *\r\n   * @template TServiceType - The type of service\r\n   * @param token - The injection token identifying the service\r\n   * @returns The registration or undefined if not found\r\n   */\r\n  getRegistration<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>\r\n  ): ServiceRegistration | undefined {\r\n    return this.registrations.get(token);\r\n  }\r\n\r\n  /**\r\n   * Returns all registrations.\r\n   * Used by ContainerValidator for dependency validation.\r\n   *\r\n   * @returns Map of all registrations\r\n   */\r\n  getAllRegistrations(): Map<InjectionToken<ServiceType>, ServiceRegistration> {\r\n    return new Map(this.registrations); // Defensive copy\r\n  }\r\n\r\n  /**\r\n   * Returns all registrations for a specific lifecycle.\r\n   * More efficient than filtering getAllRegistrations() when only one lifecycle is needed.\r\n   *\r\n   * @param lifecycle - The lifecycle to query\r\n   * @returns Array of registrations with the specified lifecycle\r\n   */\r\n  getRegistrationsByLifecycle(lifecycle: ServiceLifecycle): ServiceRegistration[] {\r\n    const tokens = this.lifecycleIndex.get(lifecycle) ?? new Set();\r\n    return Array.from(tokens)\r\n      .map((token) => this.registrations.get(token))\r\n      .filter((reg): reg is ServiceRegistration => reg !== undefined);\r\n  }\r\n\r\n  /**\r\n   * Checks if a service is registered.\r\n   *\r\n   * @template TServiceType - The type of service\r\n   * @param token - The injection token to check\r\n   * @returns True if registered, false otherwise\r\n   */\r\n  has<TServiceType extends ServiceType>(token: InjectionToken<TServiceType>): boolean {\r\n    return this.registrations.has(token);\r\n  }\r\n\r\n  /**\r\n   * Clears all registrations.\r\n   * Warning: This removes all configured services.\r\n   */\r\n  clear(): void {\r\n    this.registrations.clear();\r\n    this.lifecycleIndex.clear();\r\n  }\r\n\r\n  /**\r\n   * Creates a deep clone of this registry for child containers.\r\n   *\r\n   * Important: Creates a new Map instance with cloned ServiceRegistration objects\r\n   * to prevent child containers from mutating parent registrations.\r\n   *\r\n   * @returns A new ServiceRegistry with cloned registrations\r\n   */\r\n  clone(): ServiceRegistry {\r\n    const clonedRegistry = new ServiceRegistry();\r\n\r\n    // Create new Map with cloned ServiceRegistration objects\r\n    for (const [token, registration] of this.registrations.entries()) {\r\n      clonedRegistry.registrations.set(token, registration.clone());\r\n    }\r\n\r\n    // Clone lifecycle index\r\n    for (const [lifecycle, tokens] of this.lifecycleIndex.entries()) {\r\n      clonedRegistry.lifecycleIndex.set(lifecycle, new Set(tokens));\r\n    }\r\n\r\n    return clonedRegistry;\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { ContainerError } from \"../interfaces/containererror\";\r\nimport type { InjectionToken } from \"../types/injectiontoken\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport type { ServiceRegistry } from \"../registry/ServiceRegistry\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\n\r\n/**\r\n * Validates service registrations and dependencies.\r\n *\r\n * Responsibilities:\r\n * - Check that all dependencies are registered\r\n * - Detect circular dependencies using DFS\r\n * - Validate alias targets exist\r\n *\r\n * Design:\r\n * - STATEFUL: Maintains cache for performance optimization\r\n * - Cache is cleared on each validate() call for fresh validation\r\n * - Returns aggregated errors for comprehensive feedback\r\n * - Can be extended later with granular validator components\r\n * - Performance optimization: Caches validated sub-graphs for large dependency trees (>500 services)\r\n *\r\n * Note: While this class has internal state, it can be shared between parent and child containers\r\n * because the cache is cleared on each validation run, preventing stale state issues.\r\n */\r\nexport class ContainerValidator {\r\n  // Performance optimization: Cache for validated sub-graphs\r\n  // Prevents redundant DFS traversals in large dependency trees (>500 services)\r\n  private validatedSubgraphs = new Set<InjectionToken<ServiceType>>();\r\n  /**\r\n   * Validates all registrations in the registry.\r\n   *\r\n   * Performs three checks:\r\n   * 1. All dependencies are registered\r\n   * 2. All alias targets exist\r\n   * 3. No circular dependencies\r\n   *\r\n   * @param registry - The service registry to validate\r\n   * @returns Result with void on success, or array of errors\r\n   */\r\n  validate(registry: ServiceRegistry): Result<void, ContainerError[]> {\r\n    // Clear cache for fresh validation\r\n    this.validatedSubgraphs = new Set<InjectionToken<ServiceType>>();\r\n\r\n    const errors: ContainerError[] = [\r\n      ...this.validateDependencies(registry),\r\n      ...this.validateAliasTargets(registry),\r\n      ...this.detectCircularDependencies(registry),\r\n    ];\r\n\r\n    return errors.length > 0 ? err(errors) : ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Checks that all declared dependencies are registered.\r\n   *\r\n   * @param registry - The service registry to check\r\n   * @returns Array of errors for missing dependencies\r\n   */\r\n  private validateDependencies(registry: ServiceRegistry): ContainerError[] {\r\n    const errors: ContainerError[] = [];\r\n    const registrations = registry.getAllRegistrations();\r\n\r\n    for (const [token, registration] of registrations.entries()) {\r\n      for (const dep of registration.dependencies) {\r\n        if (!registry.has(dep)) {\r\n          errors.push({\r\n            code: \"TokenNotRegistered\",\r\n            message: `${String(token)} depends on ${String(dep)} which is not registered`,\r\n            tokenDescription: String(dep),\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return errors;\r\n  }\r\n\r\n  /**\r\n   * Checks that all alias targets are registered.\r\n   *\r\n   * @param registry - The service registry to check\r\n   * @returns Array of errors for missing alias targets\r\n   */\r\n  private validateAliasTargets(registry: ServiceRegistry): ContainerError[] {\r\n    const errors: ContainerError[] = [];\r\n    const registrations = registry.getAllRegistrations();\r\n\r\n    for (const [token, registration] of registrations.entries()) {\r\n      if (registration.providerType === \"alias\" && registration.aliasTarget) {\r\n        if (!registry.has(registration.aliasTarget)) {\r\n          errors.push({\r\n            code: \"AliasTargetNotFound\",\r\n            message: `Alias ${String(token)} points to ${String(registration.aliasTarget)} which is not registered`,\r\n            tokenDescription: String(registration.aliasTarget),\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    return errors;\r\n  }\r\n\r\n  /**\r\n   * Detects circular dependencies using depth-first search.\r\n   *\r\n   * @param registry - The service registry to check\r\n   * @returns Array of errors for detected cycles\r\n   */\r\n  private detectCircularDependencies(registry: ServiceRegistry): ContainerError[] {\r\n    const errors: ContainerError[] = [];\r\n    const visited = new Set<InjectionToken<ServiceType>>();\r\n    const registrations = registry.getAllRegistrations();\r\n\r\n    for (const token of registrations.keys()) {\r\n      const visiting = new Set<InjectionToken<ServiceType>>();\r\n      const path: InjectionToken<ServiceType>[] = [];\r\n\r\n      const error = this.checkCycleForToken(registry, token, visiting, visited, path);\r\n      if (error) {\r\n        errors.push(error);\r\n      }\r\n    }\r\n\r\n    return errors;\r\n  }\r\n\r\n  /**\r\n   * Recursively checks for cycles starting from a specific token.\r\n   *\r\n   * **Algorithm: Depth-First Search (DFS) with Three-Color Marking**\r\n   *\r\n   * Three states for each node (token):\r\n   * - WHITE (unvisited): Not in `visiting` or `visited` sets\r\n   * - GRAY (visiting): In `visiting` set (currently in DFS recursion stack)\r\n   * - BLACK (visited): In `visited` set (fully processed, all descendants checked)\r\n   *\r\n   * Cycle Detection:\r\n   * - If we encounter a GRAY node during traversal, we've found a back edge  cycle\r\n   * - GRAY nodes represent the current path from root to current node\r\n   * - Encountering a GRAY node means we're trying to visit an ancestor  circular dependency\r\n   *\r\n   * Performance Optimization:\r\n   * - `validatedSubgraphs` cache prevents redundant traversals of already-validated subtrees\r\n   * - Crucial for large dependency graphs (>500 services)\r\n   * - BLACK nodes can be safely skipped (all their descendants are cycle-free)\r\n   *\r\n   * Time Complexity: O(V + E) where V = number of services, E = number of dependencies\r\n   * Space Complexity: O(V) for visiting/visited sets + O(D) for recursion depth D\r\n   *\r\n   * @param registry - The service registry\r\n   * @param token - Current token being checked (current node in DFS)\r\n   * @param visiting - GRAY nodes: tokens currently in the DFS recursion stack\r\n   * @param visited - BLACK nodes: tokens fully processed in this validation run\r\n   * @param path - Current dependency path for error reporting (stack trace)\r\n   * @returns ContainerError if cycle detected, null otherwise\r\n   *\r\n   * @example\r\n   * Cycle A  B  C  A will be detected when:\r\n   * 1. Start at A (mark GRAY)\r\n   * 2. Visit B (mark GRAY)\r\n   * 3. Visit C (mark GRAY)\r\n   * 4. Try to visit A  A is GRAY  Back edge detected  Cycle!\r\n   */\r\n  private checkCycleForToken(\r\n    registry: ServiceRegistry,\r\n    token: InjectionToken<ServiceType>,\r\n    visiting: Set<InjectionToken<ServiceType>>,\r\n    visited: Set<InjectionToken<ServiceType>>,\r\n    path: InjectionToken<ServiceType>[]\r\n  ): ContainerError | null {\r\n    // GRAY node encountered: Back edge detected  Cycle exists\r\n    // This token is already in the current DFS path (visiting set)\r\n    // Example: A  B  C  A (when we reach A again from C)\r\n    if (visiting.has(token)) {\r\n      const cyclePath = [...path, token].map(String).join(\"  \");\r\n      return {\r\n        code: \"CircularDependency\",\r\n        message: `Circular dependency: ${cyclePath}`,\r\n        tokenDescription: String(token),\r\n      };\r\n    }\r\n\r\n    // Performance optimization: Skip already validated sub-graphs\r\n    // This token and all its descendants have been proven cycle-free\r\n    // Avoids redundant traversals in DAGs with shared dependencies\r\n    if (this.validatedSubgraphs.has(token)) {\r\n      return null;\r\n    }\r\n\r\n    // BLACK node: Already fully processed in this validation run\r\n    // All descendants of this token have been checked (no cycle below it)\r\n    // Cross edge or forward edge in DFS terminology\r\n    /* c8 ignore start -- Visited check for graph traversal; tested via circular dependency tests */\r\n    if (visited.has(token)) {\r\n      return null;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    // Mark as GRAY: Add to current DFS path\r\n    // This token is now being visited (in recursion stack)\r\n    visiting.add(token);\r\n    path.push(token);\r\n\r\n    // DFS: Recursively check all dependencies (children in dependency graph)\r\n    // If any child has a cycle, propagate error up immediately\r\n    const registration = registry.getRegistration(token);\r\n    if (registration) {\r\n      for (const dep of registration.dependencies) {\r\n        const error = this.checkCycleForToken(registry, dep, visiting, visited, path);\r\n        if (error) return error; // Short-circuit: Stop on first cycle found\r\n      }\r\n    }\r\n\r\n    // Mark as BLACK: All descendants checked, no cycles found\r\n    // Remove from GRAY set (no longer in active DFS path)\r\n    // Add to BLACK set (fully processed, can be safely skipped in future)\r\n    visiting.delete(token);\r\n    path.pop();\r\n    visited.add(token);\r\n    this.validatedSubgraphs.add(token); // Cache for performance (persists across validation runs)\r\n\r\n    return null; // No cycle found in this subtree\r\n  }\r\n}\r\n","import type { InjectionToken } from \"../types/injectiontoken\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport type { MetricsCollector } from \"@/observability/metrics-collector\";\r\n\r\n/**\r\n * Cache for service instances (Singleton and Scoped lifecycles).\r\n *\r\n * Responsibilities:\r\n * - Store and retrieve service instances by token\r\n * - Provide access to all instances for disposal\r\n * - Simple get/set/has/clear operations\r\n * - Track cache hits/misses for observability (when MetricsCollector is injected)\r\n *\r\n * Note: This class does NOT handle disposal logic - that's ScopeManager's responsibility.\r\n */\r\nexport class InstanceCache {\r\n  private instances = new Map<InjectionToken<ServiceType>, ServiceType>();\r\n  private metricsCollector: MetricsCollector | null = null;\r\n\r\n  /**\r\n   * Injects the MetricsCollector for cache hit/miss tracking.\r\n   * Called after container validation to enable observability.\r\n   *\r\n   * @param collector - The metrics collector instance\r\n   */\r\n  setMetricsCollector(collector: MetricsCollector): void {\r\n    this.metricsCollector = collector;\r\n  }\r\n\r\n  /**\r\n   * Retrieves a cached service instance.\r\n   *\r\n   * @template TServiceType - The type of service to retrieve\r\n   * @param token - The injection token identifying the service\r\n   * @returns The cached instance or undefined if not found\r\n   */\r\n  get<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>\r\n  ): TServiceType | undefined {\r\n    const hasInstance = this.instances.has(token);\r\n    // Track cache access for observability (hit = instance found, miss = not found)\r\n    this.metricsCollector?.recordCacheAccess(hasInstance);\r\n    // Map stores instances keyed by token; cast narrows from ServiceType union to generic TServiceType\r\n    /* type-coverage:ignore-next-line */\r\n    return this.instances.get(token) as TServiceType | undefined;\r\n  }\r\n\r\n  /**\r\n   * Stores a service instance in the cache.\r\n   *\r\n   * @template TServiceType - The type of service to store\r\n   * @param token - The injection token identifying the service\r\n   * @param instance - The service instance to cache\r\n   */\r\n  set<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    instance: TServiceType\r\n  ): void {\r\n    this.instances.set(token, instance);\r\n  }\r\n\r\n  /**\r\n   * Checks if a service instance is cached.\r\n   *\r\n   * @template TServiceType - The type of service to check\r\n   * @param token - The injection token identifying the service\r\n   * @returns True if the instance is cached, false otherwise\r\n   */\r\n  has<TServiceType extends ServiceType>(token: InjectionToken<TServiceType>): boolean {\r\n    const hasInstance = this.instances.has(token);\r\n    // Track cache access for observability (hit = instance found, miss = not found)\r\n    this.metricsCollector?.recordCacheAccess(hasInstance);\r\n    return hasInstance;\r\n  }\r\n\r\n  /**\r\n   * Clears all cached instances.\r\n   * Note: Does not dispose instances - call getAllInstances() first if disposal is needed.\r\n   */\r\n  clear(): void {\r\n    this.instances.clear();\r\n  }\r\n\r\n  /**\r\n   * Returns all cached instances for disposal purposes.\r\n   * Used by ScopeManager to dispose Disposable services.\r\n   *\r\n   * @returns A map of all cached instances\r\n   */\r\n  getAllInstances(): Map<InjectionToken<ServiceType>, ServiceType> {\r\n    return new Map(this.instances);\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { InjectionToken } from \"../types/injectiontoken\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport type { ContainerError } from \"../interfaces/containererror\";\r\nimport type { ServiceRegistry } from \"../registry/ServiceRegistry\";\r\nimport type { ServiceRegistration } from \"../types/serviceregistration\";\r\nimport { InstanceCache } from \"../cache/InstanceCache\";\r\nimport { ServiceLifecycle } from \"../types/servicelifecycle\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\nimport type { MetricsCollector } from \"@/observability/metrics-collector\";\r\nimport type { PerformanceTracker } from \"@/interfaces/performance-tracker\";\r\n\r\n/**\r\n * Resolves service instances based on lifecycle and registration.\r\n *\r\n * Responsibilities:\r\n * - Resolve services by token\r\n * - Handle lifecycle strategies (Singleton, Transient, Scoped)\r\n * - Handle alias resolution\r\n * - Delegate to parent resolver for Singletons\r\n *\r\n * Design:\r\n * - Works with Result pattern (no throws)\r\n * - Wraps factory errors in FactoryFailedError\r\n * - Parent resolver for Singleton sharing across scopes\r\n * - PerformanceTracker injected via constructor (avoids circular dependency)\r\n * - MetricsCollector injected after container validation for metrics recording\r\n */\r\nexport class ServiceResolver {\r\n  private metricsCollector: MetricsCollector | null = null;\r\n\r\n  constructor(\r\n    private readonly registry: ServiceRegistry,\r\n    private readonly cache: InstanceCache,\r\n    private readonly parentResolver: ServiceResolver | null,\r\n    private readonly scopeName: string,\r\n    private readonly performanceTracker: PerformanceTracker\r\n  ) {}\r\n\r\n  /**\r\n   * Sets the MetricsCollector for metrics recording.\r\n   * Called by ServiceContainer after validation.\r\n   *\r\n   * @param collector - The metrics collector instance\r\n   */\r\n  setMetricsCollector(collector: MetricsCollector): void {\r\n    this.metricsCollector = collector;\r\n  }\r\n\r\n  /**\r\n   * Resolves a service by token.\r\n   *\r\n   * Handles:\r\n   * - Alias resolution (recursive)\r\n   * - Lifecycle-specific resolution (Singleton/Transient/Scoped)\r\n   * - Parent delegation for Singletons\r\n   * - Factory error wrapping\r\n   *\r\n   * Performance tracking is handled by the injected PerformanceTracker.\r\n   *\r\n   * @template TServiceType - The type of service to resolve\r\n   * @param token - The injection token identifying the service\r\n   * @returns Result with service instance or error\r\n   */\r\n  resolve<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>\r\n  ): Result<TServiceType, ContainerError> {\r\n    return this.performanceTracker.track(\r\n      () => {\r\n        // Check if service is registered\r\n        const registration = this.registry.getRegistration(token);\r\n        if (!registration) {\r\n          const stack = new Error().stack;\r\n          const error: ContainerError = {\r\n            code: \"TokenNotRegistered\",\r\n            message: `Service ${String(token)} not registered`,\r\n            tokenDescription: String(token),\r\n            ...(stack !== undefined && { stack }), // Only include stack if defined\r\n            timestamp: Date.now(),\r\n            containerScope: this.scopeName,\r\n          };\r\n          return err(error);\r\n        }\r\n\r\n        // Handle alias resolution\r\n        if (registration.providerType === \"alias\" && registration.aliasTarget) {\r\n          // aliasTarget is defined in this branch and shares generic type by construction\r\n          /* type-coverage:ignore-next-line */\r\n          return this.resolve(registration.aliasTarget as InjectionToken<TServiceType>);\r\n        }\r\n\r\n        // Resolve based on lifecycle (all methods already return Result)\r\n        let result: Result<TServiceType, ContainerError>;\r\n\r\n        switch (registration.lifecycle) {\r\n          case ServiceLifecycle.SINGLETON:\r\n            result = this.resolveSingleton(token, registration);\r\n            break;\r\n\r\n          case ServiceLifecycle.TRANSIENT:\r\n            result = this.resolveTransient(token, registration);\r\n            break;\r\n\r\n          case ServiceLifecycle.SCOPED:\r\n            result = this.resolveScoped(token, registration);\r\n            break;\r\n\r\n          /* c8 ignore start -- Defensive: ServiceLifecycle enum ensures only valid values; this default is unreachable */\r\n          default:\r\n            result = err({\r\n              code: \"InvalidLifecycle\",\r\n              message: `Invalid service lifecycle: ${String(registration.lifecycle)}`,\r\n              tokenDescription: String(token),\r\n            });\r\n          /* c8 ignore stop */\r\n        }\r\n\r\n        return result;\r\n      },\r\n      /* c8 ignore start -- Optional chaining is defensive: metricsCollector is always injected via constructor */\r\n      (duration, result) => {\r\n        this.metricsCollector?.recordResolution(token, duration, result.ok);\r\n      }\r\n      /* c8 ignore stop */\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Instantiates a service based on registration type.\r\n   *\r\n   * CRITICAL: Returns Result to preserve error context and avoid breaking Result-Contract.\r\n   * Handles dependency resolution for classes, direct factory calls, and value returns.\r\n   *\r\n   * @template TServiceType - The type of service to instantiate\r\n   * @param token - The injection token (used for error messages)\r\n   * @param registration - The service registration metadata\r\n   * @returns Result with instance or detailed error (DependencyResolveFailed, FactoryFailed, etc.)\r\n   */\r\n  private instantiateService<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    registration: ServiceRegistration\r\n  ): Result<TServiceType, ContainerError> {\r\n    if (registration.serviceClass) {\r\n      // Class: Resolve all dependencies first\r\n      const resolvedDeps: ServiceType[] = [];\r\n\r\n      for (const dep of registration.dependencies) {\r\n        const depResult = this.resolve(dep);\r\n        /* c8 ignore start -- Dependency resolution failures tested via circular dependency and missing dependency tests */\r\n        if (!depResult.ok) {\r\n          // Return structured error with cause chain\r\n          return err({\r\n            code: \"DependencyResolveFailed\",\r\n            message: `Cannot resolve dependency ${String(dep)} for ${String(token)}`,\r\n            tokenDescription: String(dep),\r\n            cause: depResult.error,\r\n          });\r\n        }\r\n        /* c8 ignore stop */\r\n        resolvedDeps.push(depResult.value);\r\n      }\r\n\r\n      // Instantiate class with resolved dependencies\r\n      try {\r\n        // registration.serviceClass constructor returns TServiceType by definition; cast narrows union to generic type\r\n        /* type-coverage:ignore-next-line */\r\n        return ok(new registration.serviceClass(...resolvedDeps) as TServiceType);\r\n      } catch (constructorError) {\r\n        return err({\r\n          code: \"FactoryFailed\",\r\n          message: `Constructor failed for ${String(token)}: ${String(constructorError)}`,\r\n          tokenDescription: String(token),\r\n          cause: constructorError,\r\n        });\r\n      }\r\n    } else if (registration.factory) {\r\n      // Factory: Call directly\r\n      try {\r\n        // Factory is registered with the correct return type at configuration time\r\n        /* type-coverage:ignore-next-line */\r\n        return ok(registration.factory() as TServiceType);\r\n      } catch (factoryError) {\r\n        return err({\r\n          code: \"FactoryFailed\",\r\n          message: `Factory failed for ${String(token)}: ${String(factoryError)}`,\r\n          tokenDescription: String(token),\r\n          cause: factoryError,\r\n        });\r\n      }\r\n    } else if (registration.value !== undefined) {\r\n      // Value: Return as-is\r\n      // registration.value is stored with concrete type during registration\r\n      /* type-coverage:ignore-next-line */\r\n      return ok(registration.value as TServiceType);\r\n    } else {\r\n      // Invalid registration\r\n      /* c8 ignore start -- Defensive: ServiceRegistration.create* methods already ensure one of class/factory/value is set */\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: `Invalid registration for ${String(token)} - no class, factory, or value`,\r\n        tokenDescription: String(token),\r\n      });\r\n      /* c8 ignore stop */\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resolves a Singleton service.\r\n   *\r\n   * Strategy:\r\n   * 1. Try parent resolver first (for shared parent singletons)\r\n   * 2. If parent returns error:\r\n   *    - CircularDependency  propagate error\r\n   *    - TokenNotRegistered  fallback to own cache (child-specific singleton)\r\n   * 3. Use own cache for root container or child-specific singletons\r\n   *\r\n   * @template TServiceType - The type of service\r\n   * @param token - The injection token\r\n   * @param registration - The service registration\r\n   * @returns Result with instance or error\r\n   */\r\n  private resolveSingleton<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    registration: ServiceRegistration\r\n  ): Result<TServiceType, ContainerError> {\r\n    // Try parent resolver first for shared singletons\r\n    if (this.parentResolver !== null) {\r\n      const parentResult = this.parentResolver.resolve(token);\r\n\r\n      if (parentResult.ok) {\r\n        // Parent has it - use parent's singleton instance (shared)\r\n        return parentResult;\r\n      }\r\n\r\n      // Check error code to determine action\r\n      /* c8 ignore start -- Circular dependency from parent requires complex multi-level dependency setup that's already tested in container.test.ts */\r\n      if (parentResult.error.code === \"CircularDependency\") {\r\n        // Real circular dependency - propagate as-is\r\n        return parentResult;\r\n      }\r\n      /* c8 ignore stop */\r\n\r\n      // TokenNotRegistered or other error -> fallback to own cache\r\n      // This allows child-specific singleton registrations\r\n    }\r\n\r\n    // Root container OR parent doesn't have it: use own cache\r\n    if (!this.cache.has(token)) {\r\n      const instanceResult = this.instantiateService(token, registration);\r\n      if (!instanceResult.ok) {\r\n        return instanceResult; // Propagate error without wrapping\r\n      }\r\n      this.cache.set(token, instanceResult.value);\r\n    }\r\n\r\n    // Cache stores singleton instances keyed by token with concrete type during registration\r\n    /* type-coverage:ignore-next-line */\r\n    return ok(this.cache.get(token) as TServiceType);\r\n  }\r\n\r\n  /**\r\n   * Resolves a Transient service.\r\n   *\r\n   * Strategy:\r\n   * - Always create new instance (no caching)\r\n   *\r\n   * @template TServiceType - The type of service\r\n   * @param token - The injection token\r\n   * @param registration - The service registration\r\n   * @returns Result with new instance\r\n   */\r\n  private resolveTransient<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    registration: ServiceRegistration\r\n  ): Result<TServiceType, ContainerError> {\r\n    return this.instantiateService(token, registration);\r\n  }\r\n\r\n  /**\r\n   * Resolves a Scoped service.\r\n   *\r\n   *  IMPORTANT: Scoped services can ONLY be resolved in child containers.\r\n   * Attempting to resolve a scoped service in the root container will return\r\n   * a ScopeRequired error.\r\n   *\r\n   * Strategy:\r\n   * - Must be in child scope (not root)\r\n   * - One instance per scope (cached)\r\n   * - Each child scope gets its own isolated instance\r\n   *\r\n   * Use createScope() to create a child container before resolving scoped services.\r\n   *\r\n   * @template TServiceType - The type of service\r\n   * @param token - The injection token\r\n   * @param registration - The service registration\r\n   * @returns Result with scoped instance or ScopeRequired error\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * //  WRONG: Trying to resolve scoped service in root\r\n   * const root = ServiceContainer.createRoot();\r\n   * root.registerClass(RequestToken, RequestContext, SCOPED);\r\n   * root.validate();\r\n   * const result = root.resolve(RequestToken); // Error: ScopeRequired\r\n   *\r\n   * //  CORRECT: Create child scope first\r\n   * const child = root.createScope(\"request\").value!;\r\n   * child.validate(); // Child must validate separately\r\n   * const ctx = child.resolve(RequestToken); // OK\r\n   * ```\r\n   */\r\n  private resolveScoped<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    registration: ServiceRegistration\r\n  ): Result<TServiceType, ContainerError> {\r\n    // Scoped services require a child scope\r\n    if (this.parentResolver === null) {\r\n      return err({\r\n        code: \"ScopeRequired\",\r\n        message: `Scoped service ${String(token)} requires a scope container. Use createScope() to create a child container first.`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    // Check cache (one instance per scope)\r\n    if (!this.cache.has(token)) {\r\n      const instanceResult = this.instantiateService(token, registration);\r\n      /* c8 ignore start -- Error path covered by other instantiation tests; this is just error propagation */\r\n      if (!instanceResult.ok) {\r\n        return instanceResult; // Propagate error\r\n      }\r\n      /* c8 ignore stop */\r\n      this.cache.set(token, instanceResult.value);\r\n    }\r\n\r\n    // Cache stores scoped instances keyed by token with correct generic type\r\n    /* type-coverage:ignore-next-line */\r\n    return ok(this.cache.get(token) as TServiceType);\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { ContainerError } from \"../interfaces/containererror\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport type { Disposable, AsyncDisposable } from \"../interfaces/disposable\";\r\nimport { InstanceCache } from \"../cache/InstanceCache\";\r\nimport { ok, err, tryCatch, isErr } from \"@/utils/functional/result\";\r\n\r\n/**\r\n * Helper function to generate unique scope names.\r\n * Tries crypto.randomUUID(), falls back to timestamp + random.\r\n */\r\nfunction generateScopeId(): string {\r\n  try {\r\n    /* c8 ignore next -- Delegates to browser crypto implementation */\r\n    return crypto.randomUUID();\r\n  } catch {\r\n    return Date.now() + \"-\" + Math.random();\r\n  }\r\n}\r\n\r\n/**\r\n * Manages scope hierarchy and disposal lifecycle.\r\n *\r\n * Responsibilities:\r\n * - Track child scopes in hierarchy\r\n * - Generate scope names\r\n * - Dispose instances (supports both Disposable and AsyncDisposable patterns)\r\n * - Cascade disposal to children\r\n * - Enforce maximum scope depth (stack overflow protection)\r\n *\r\n * Design:\r\n * - NO dependency on ServiceResolver (avoids circular dependency)\r\n * - createChild() returns data for facade to build new container\r\n * - Disposal order: children first, then instances (critical!)\r\n * - Supports both sync (dispose()) and async (disposeAsync()) disposal modes\r\n *\r\n * Disposal Modes:\r\n * - dispose(): Synchronous disposal (for browser unload, emergency cleanup)\r\n * - disposeAsync(): Asynchronous disposal (preferred, handles async cleanup properly)\r\n */\r\nexport class ScopeManager {\r\n  private readonly MAX_SCOPE_DEPTH = 10; // Prevent deep nesting and potential stack overflow\r\n  private children = new Set<ScopeManager>();\r\n  private disposed = false;\r\n  private readonly depth: number;\r\n  private readonly scopeId: string; // Unique correlation ID for tracing\r\n\r\n  constructor(\r\n    private readonly scopeName: string,\r\n    private readonly parent: ScopeManager | null,\r\n    private readonly cache: InstanceCache,\r\n    depth: number = 0\r\n  ) {\r\n    this.depth = depth;\r\n    // Generate unique correlation ID for this scope (useful for logging/tracing)\r\n    this.scopeId = `${scopeName}-${Date.now()}-${Math.random().toString(36).slice(2, 9)}`;\r\n  }\r\n\r\n  /**\r\n   * Creates a child scope manager.\r\n   *\r\n   * Note: Returns data (scopeName, cache, childManager) instead of full container\r\n   * to avoid circular dependency with ServiceResolver.\r\n   *\r\n   * @param name - Optional custom name for the scope\r\n   * @returns Result with child scope data or error if disposed or max depth exceeded\r\n   */\r\n  createChild(\r\n    name?: string\r\n  ): Result<{ scopeName: string; cache: InstanceCache; manager: ScopeManager }, ContainerError> {\r\n    if (this.disposed) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Cannot create child scope from disposed scope: ${this.scopeName}`,\r\n      });\r\n    }\r\n\r\n    // Check maximum scope depth (stack overflow protection)\r\n    if (this.depth >= this.MAX_SCOPE_DEPTH) {\r\n      return err({\r\n        code: \"MaxScopeDepthExceeded\",\r\n        message: `Maximum scope depth of ${this.MAX_SCOPE_DEPTH} exceeded. Current depth: ${this.depth}`,\r\n      });\r\n    }\r\n\r\n    // Build hierarchical scope name\r\n    const uniqueId = name ?? `scope-${generateScopeId()}`;\r\n    const childScopeName = `${this.scopeName}.${uniqueId}`;\r\n\r\n    // Create new cache for child\r\n    const childCache = new InstanceCache();\r\n\r\n    // Create child manager with incremented depth\r\n    const childManager = new ScopeManager(childScopeName, this, childCache, this.depth + 1);\r\n\r\n    // Only add to children set AFTER successful creation\r\n    this.children.add(childManager);\r\n\r\n    return ok({\r\n      scopeName: childScopeName,\r\n      cache: childCache,\r\n      manager: childManager,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Disposes this scope and all child scopes.\r\n   *\r\n   * Disposal order (critical):\r\n   * 1. Recursively dispose all children\r\n   * 2. Dispose instances in this scope (if Disposable)\r\n   * 3. Clear instance cache\r\n   * 4. Remove from parent's children set\r\n   *\r\n   * @returns Result indicating success or disposal error\r\n   */\r\n  dispose(): Result<void, ContainerError> {\r\n    if (this.disposed) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Scope already disposed: ${this.scopeName}`,\r\n      });\r\n    }\r\n\r\n    // Mark as disposed BEFORE disposing children to prevent concurrent operations\r\n    this.disposed = true;\r\n\r\n    // Collect disposal errors instead of logging\r\n    const childDisposalErrors: Array<{ scopeName: string; error: ContainerError }> = [];\r\n\r\n    // Step 1: Recursively dispose all child scopes (children first!)\r\n    for (const child of this.children) {\r\n      const childResult = child.dispose();\r\n\r\n      if (isErr(childResult)) {\r\n        // Collect error instead of logging\r\n        childDisposalErrors.push({\r\n          scopeName: child.scopeName,\r\n          error: childResult.error,\r\n        });\r\n      }\r\n    }\r\n\r\n    // Step 2: Dispose instances in this scope\r\n    const disposeResult = this.disposeInstances();\r\n    if (!disposeResult.ok) {\r\n      return disposeResult;\r\n    }\r\n\r\n    // Step 3: Clear cache\r\n    this.cache.clear();\r\n\r\n    // Step 4: Remove from parent's children set\r\n    if (this.parent !== null) {\r\n      this.parent.children.delete(this);\r\n    }\r\n\r\n    // Return aggregated errors if any children failed\r\n    if (childDisposalErrors.length > 0) {\r\n      return err({\r\n        code: \"PartialDisposal\",\r\n        message: `Failed to dispose ${childDisposalErrors.length} child scope(s)`,\r\n        details: childDisposalErrors,\r\n      });\r\n    }\r\n\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Asynchronously disposes this scope and all child scopes.\r\n   *\r\n   * Preferred method for cleanup as it properly handles async dispose operations.\r\n   * Falls back to sync dispose() for services that only implement Disposable.\r\n   *\r\n   * Disposal order (critical):\r\n   * 1. Recursively dispose all children (async)\r\n   * 2. Dispose instances in this scope (async or sync)\r\n   * 3. Clear instance cache\r\n   * 4. Remove from parent's children set\r\n   *\r\n   * @returns Promise with Result indicating success or disposal error\r\n   */\r\n  async disposeAsync(): Promise<Result<void, ContainerError>> {\r\n    if (this.disposed) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Scope already disposed: ${this.scopeName}`,\r\n      });\r\n    }\r\n\r\n    // Mark as disposed BEFORE disposing children to prevent concurrent operations\r\n    this.disposed = true;\r\n\r\n    // Collect disposal errors instead of logging\r\n    const childDisposalErrors: Array<{ scopeName: string; error: ContainerError }> = [];\r\n\r\n    // Step 1: Recursively dispose all child scopes (children first!)\r\n    for (const child of this.children) {\r\n      const childResult = await child.disposeAsync();\r\n\r\n      if (isErr(childResult)) {\r\n        // Collect error instead of logging\r\n        childDisposalErrors.push({\r\n          scopeName: child.scopeName,\r\n          error: childResult.error,\r\n        });\r\n      }\r\n    }\r\n\r\n    // Step 2: Dispose instances in this scope (async)\r\n    const disposeResult = await this.disposeInstancesAsync();\r\n    if (!disposeResult.ok) {\r\n      return disposeResult;\r\n    }\r\n\r\n    // Step 3: Clear cache\r\n    this.cache.clear();\r\n\r\n    // Step 4: Remove from parent's children set\r\n    if (this.parent !== null) {\r\n      this.parent.children.delete(this);\r\n    }\r\n\r\n    // Return aggregated errors if any children failed\r\n    if (childDisposalErrors.length > 0) {\r\n      return err({\r\n        code: \"PartialDisposal\",\r\n        message: `Failed to dispose ${childDisposalErrors.length} child scope(s)`,\r\n        details: childDisposalErrors,\r\n      });\r\n    }\r\n\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Disposes all instances in the cache that implement Disposable (sync).\r\n   *\r\n   * @returns Result indicating success or disposal error\r\n   */\r\n  private disposeInstances(): Result<void, ContainerError> {\r\n    const instances = this.cache.getAllInstances();\r\n\r\n    for (const [token, instance] of instances.entries()) {\r\n      if (this.isDisposable(instance)) {\r\n        const result = tryCatch(\r\n          () => instance.dispose(),\r\n          (error): ContainerError => ({\r\n            code: \"DisposalFailed\",\r\n            message: `Error disposing service ${String(token)}: ${String(error)}`,\r\n            tokenDescription: String(token),\r\n            cause: error,\r\n          })\r\n        );\r\n\r\n        if (isErr(result)) {\r\n          return result;\r\n        }\r\n      }\r\n    }\r\n\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Disposes all instances in the cache that implement Disposable or AsyncDisposable (async).\r\n   * Prefers async disposal when available, falls back to sync.\r\n   *\r\n   * @returns Promise with Result indicating success or disposal error\r\n   */\r\n  private async disposeInstancesAsync(): Promise<Result<void, ContainerError>> {\r\n    const instances = this.cache.getAllInstances();\r\n\r\n    for (const [token, instance] of instances.entries()) {\r\n      // Try async disposal first (preferred)\r\n      if (this.isAsyncDisposable(instance)) {\r\n        try {\r\n          await instance.disposeAsync();\r\n        } catch (error) {\r\n          return err({\r\n            code: \"DisposalFailed\",\r\n            message: `Error disposing service ${String(token)}: ${String(error)}`,\r\n            tokenDescription: String(token),\r\n            cause: error,\r\n          });\r\n        }\r\n      }\r\n      // Fallback to sync disposal\r\n      else if (this.isDisposable(instance)) {\r\n        const result = tryCatch(\r\n          () => instance.dispose(),\r\n          (error): ContainerError => ({\r\n            code: \"DisposalFailed\",\r\n            message: `Error disposing service ${String(token)}: ${String(error)}`,\r\n            tokenDescription: String(token),\r\n            cause: error,\r\n          })\r\n        );\r\n\r\n        if (isErr(result)) {\r\n          return result;\r\n        }\r\n      }\r\n    }\r\n\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Type guard to check if an instance implements the Disposable pattern.\r\n   *\r\n   * @param instance - The service instance to check\r\n   * @returns True if instance has dispose() method\r\n   */\r\n  private isDisposable(instance: ServiceType): instance is ServiceType & Disposable {\r\n    return (\r\n      \"dispose\" in instance &&\r\n      // Narrowing via Partial so we can check dispose presence without full interface\r\n      /* type-coverage:ignore-next-line */\r\n      typeof (instance as Partial<Disposable>).dispose === \"function\"\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Type guard to check if an instance implements the AsyncDisposable pattern.\r\n   *\r\n   * @param instance - The service instance to check\r\n   * @returns True if instance has disposeAsync() method\r\n   */\r\n  private isAsyncDisposable(instance: ServiceType): instance is ServiceType & AsyncDisposable {\r\n    return (\r\n      \"disposeAsync\" in instance &&\r\n      // Narrowing via Partial so we can check disposeAsync presence without full interface\r\n      typeof (instance as { disposeAsync?: unknown }).disposeAsync === \"function\"\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Checks if this scope is disposed.\r\n   *\r\n   * @returns True if disposed, false otherwise\r\n   */\r\n  isDisposed(): boolean {\r\n    return this.disposed;\r\n  }\r\n\r\n  /**\r\n   * Gets the hierarchical scope name.\r\n   *\r\n   * @returns The scope name (e.g., \"root.child1.grandchild\")\r\n   */\r\n  getScopeName(): string {\r\n    return this.scopeName;\r\n  }\r\n\r\n  /**\r\n   * Gets the unique correlation ID for this scope.\r\n   *\r\n   * Useful for tracing and logging in distributed/concurrent scenarios.\r\n   * Each scope gets a unique ID combining name, timestamp, and random string.\r\n   *\r\n   * @returns The unique scope ID (e.g., \"root-1730761234567-abc123\")\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const scope = container.createScope(\"request\").value!;\r\n   * logger.info(`[${scope.getScopeId()}] Processing request`);\r\n   * ```\r\n   */\r\n  getScopeId(): string {\r\n    return this.scopeId;\r\n  }\r\n}\r\n","/**\r\n * Promise timeout utility.\r\n * Wraps a promise with a timeout, rejecting if the promise doesn't resolve in time.\r\n */\r\n\r\n/**\r\n * Error thrown when a promise times out.\r\n */\r\nexport class TimeoutError extends Error {\r\n  constructor(timeoutMs: number) {\r\n    super(`Operation timed out after ${timeoutMs}ms`);\r\n    this.name = \"TimeoutError\";\r\n  }\r\n}\r\n\r\n/**\r\n * Wraps a promise with a timeout.\r\n *\r\n * If the promise doesn't resolve/reject within the specified time,\r\n * it rejects with a TimeoutError.\r\n *\r\n * @template T - Type of the promise result\r\n * @param promise - Promise to wrap\r\n * @param timeoutMs - Timeout in milliseconds\r\n * @returns Promise that rejects with TimeoutError if timeout is exceeded\r\n *\r\n * @example\r\n * ```typescript\r\n * try {\r\n *   const result = await withTimeout(fetchData(), 5000);\r\n *   console.log(\"Got result:\", result);\r\n * } catch (error) {\r\n *   if (error instanceof TimeoutError) {\r\n *     console.error(\"Operation timed out\");\r\n *   }\r\n * }\r\n * ```\r\n */\r\nexport function withTimeout<T>(promise: Promise<T>, timeoutMs: number): Promise<T> {\r\n  let timeoutHandle: NodeJS.Timeout | null = null;\r\n\r\n  const timeoutPromise = new Promise<T>((_, reject) => {\r\n    timeoutHandle = setTimeout(() => {\r\n      reject(new TimeoutError(timeoutMs));\r\n    }, timeoutMs);\r\n  });\r\n\r\n  return Promise.race([\r\n    promise.finally(() => {\r\n      // Clear timeout when promise settles (either resolves or rejects)\r\n      // This prevents the timeout from firing after the promise is already settled\r\n      if (timeoutHandle !== null) {\r\n        clearTimeout(timeoutHandle);\r\n      }\r\n    }),\r\n    timeoutPromise,\r\n  ]);\r\n}\r\n","/**\r\n * Log level enumeration for controlling logging verbosity.\r\n * Lower numeric values = more verbose.\r\n */\r\nexport enum LogLevel {\r\n  DEBUG = 0,\r\n  INFO = 1,\r\n  WARN = 2,\r\n  ERROR = 3,\r\n}\r\n\r\n/**\r\n * Environment configuration for the application.\r\n * Provides environment-specific settings that can be configured via build-time variables.\r\n */\r\nexport interface EnvironmentConfig {\r\n  /** True if running in development mode */\r\n  isDevelopment: boolean;\r\n\r\n  /** True if running in production mode */\r\n  isProduction: boolean;\r\n\r\n  /** Minimum log level to output */\r\n  logLevel: LogLevel;\r\n\r\n  /** Enable performance tracking and metrics */\r\n  enablePerformanceTracking: boolean;\r\n\r\n  /** Enable debug mode features (verbose logging, performance marks, etc.) */\r\n  enableDebugMode: boolean;\r\n\r\n  /**\r\n   * Performance sampling rate for production environments (0.0 to 1.0).\r\n   * 0.01 = 1% sampling, 1.0 = 100% sampling.\r\n   * Reduces performance overhead in production by only tracking a percentage of operations.\r\n   * @default 0.01 (1% sampling in production)\r\n   */\r\n  performanceSamplingRate: number;\r\n}\r\n\r\n/**\r\n * Safely parses a sampling rate from an environment variable.\r\n * Ensures the value is a valid number between 0 and 1.\r\n *\r\n * @param envValue - Environment variable value to parse\r\n * @param fallback - Fallback value if parsing fails\r\n * @returns Valid sampling rate between 0.0 and 1.0\r\n * @internal Exported for testing\r\n */\r\nexport function parseSamplingRate(envValue: string | undefined, fallback: number): number {\r\n  const raw = parseFloat(envValue ?? String(fallback));\r\n  // Check if valid number and clamp to [0, 1] range\r\n  return Number.isFinite(raw) ? Math.min(1, Math.max(0, raw)) : fallback;\r\n}\r\n\r\n/**\r\n * Current environment configuration.\r\n * Reads from Vite environment variables (import.meta.env).\r\n */\r\nexport const ENV: EnvironmentConfig = {\r\n  isDevelopment: import.meta.env.MODE === \"development\",\r\n  isProduction: import.meta.env.MODE === \"production\",\r\n  logLevel: import.meta.env.MODE === \"development\" ? LogLevel.DEBUG : LogLevel.INFO,\r\n  enablePerformanceTracking: import.meta.env.VITE_ENABLE_PERF_TRACKING === \"true\",\r\n  enableDebugMode: import.meta.env.MODE === \"development\",\r\n  // 1% sampling in production, 100% in development\r\n  performanceSamplingRate:\r\n    import.meta.env.MODE === \"production\"\r\n      ? parseSamplingRate(import.meta.env.VITE_PERF_SAMPLING_RATE, 0.01)\r\n      : 1.0,\r\n};\r\n","/**\r\n * Shared performance tracker implementation.\r\n *\r\n * This base class contains the common logic used by both:\r\n * - BootstrapPerformanceTracker (bootstrap phase, no DI)\r\n * - PerformanceTrackingService (production phase, with DI)\r\n *\r\n * **Design Rationale:**\r\n * - Eliminates code duplication between bootstrap and production trackers\r\n * - Both implementations share identical tracking logic\r\n * - Only difference is how they're instantiated (direct vs DI)\r\n *\r\n * @see PerformanceTracker interface\r\n * @see BootstrapPerformanceTracker for bootstrap usage\r\n * @see PerformanceTrackingService for DI-based usage\r\n */\r\n\r\nimport type { PerformanceTracker } from \"@/interfaces/performance-tracker\";\r\nimport type { EnvironmentConfig } from \"@/config/environment\";\r\nimport type { MetricsSampler } from \"@/observability/interfaces/metrics-sampler\";\r\n\r\n/**\r\n * Base implementation of PerformanceTracker with shared logic.\r\n *\r\n * @example\r\n * ```typescript\r\n * // Extend in subclasses\r\n * export class MyTracker extends PerformanceTrackerImpl {\r\n *   static dependencies = [envToken, metricsToken] as const;\r\n *   // DI dependencies handled by subclass\r\n * }\r\n * ```\r\n */\r\nexport class PerformanceTrackerImpl implements PerformanceTracker {\r\n  /**\r\n   * Creates a performance tracker implementation.\r\n   *\r\n   * @param env - Environment configuration for tracking settings\r\n   * @param sampler - Optional metrics sampler for sampling decisions (null during early bootstrap)\r\n   */\r\n  constructor(\r\n    protected readonly env: EnvironmentConfig,\r\n    protected readonly sampler: MetricsSampler | null\r\n  ) {}\r\n\r\n  /**\r\n   * Tracks synchronous operation execution time.\r\n   *\r\n   * Only measures when:\r\n   * 1. Performance tracking is enabled (env.enablePerformanceTracking)\r\n   * 2. MetricsCollector is available\r\n   * 3. Sampling check passes (metricsCollector.shouldSample())\r\n   *\r\n   * @template T - Return type of the operation\r\n   * @param operation - Function to execute and measure\r\n   * @param onComplete - Optional callback invoked with duration and result\r\n   * @returns Result of the operation\r\n   */\r\n  track<T>(operation: () => T, onComplete?: (duration: number, result: T) => void): T {\r\n    // Early exit if performance tracking is disabled or sampling fails\r\n    if (!this.env.enablePerformanceTracking || !this.sampler?.shouldSample()) {\r\n      return operation();\r\n    }\r\n\r\n    const startTime = performance.now();\r\n    const result = operation();\r\n    const duration = performance.now() - startTime;\r\n\r\n    if (onComplete) {\r\n      onComplete(duration, result);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Tracks asynchronous operation execution time.\r\n   *\r\n   * Only measures when:\r\n   * 1. Performance tracking is enabled (env.enablePerformanceTracking)\r\n   * 2. MetricsCollector is available\r\n   * 3. Sampling check passes (metricsCollector.shouldSample())\r\n   *\r\n   * @template T - Return type of the async operation\r\n   * @param operation - Async function to execute and measure\r\n   * @param onComplete - Optional callback invoked with duration and result\r\n   * @returns Promise resolving to the operation result\r\n   */\r\n  async trackAsync<T>(\r\n    operation: () => Promise<T>,\r\n    onComplete?: (duration: number, result: T) => void\r\n  ): Promise<T> {\r\n    // Early exit if performance tracking is disabled or sampling fails\r\n    if (!this.env.enablePerformanceTracking || !this.sampler?.shouldSample()) {\r\n      return operation();\r\n    }\r\n\r\n    const startTime = performance.now();\r\n    const result = await operation();\r\n    const duration = performance.now() - startTime;\r\n\r\n    if (onComplete) {\r\n      onComplete(duration, result);\r\n    }\r\n\r\n    return result;\r\n  }\r\n}\r\n","/**\r\n * Lightweight performance tracker for bootstrap phase.\r\n *\r\n * This implementation is used during container initialization to avoid circular dependencies.\r\n * Unlike PerformanceTrackingService, it does NOT use dependency injection and can be\r\n * instantiated directly with its dependencies.\r\n *\r\n * **Design Rationale:**\r\n * - ServiceResolver needs performance tracking during bootstrap\r\n * - PerformanceTrackingService cannot be used (circular dependency)\r\n * - Solution: Lightweight tracker that extends shared implementation\r\n *\r\n * **Usage:**\r\n * - Bootstrap phase only (ServiceContainer.createRoot)\r\n * - Direct instantiation (no DI)\r\n * - Same behavior as PerformanceTrackingService\r\n *\r\n * @see PerformanceTracker interface\r\n * @see PerformanceTrackingService for full-featured DI-based implementation\r\n * @see PerformanceTrackerImpl for shared implementation\r\n */\r\n\r\nimport type { EnvironmentConfig } from \"@/config/environment\";\r\nimport type { MetricsSampler } from \"@/observability/interfaces/metrics-sampler\";\r\nimport { PerformanceTrackerImpl } from \"@/observability/performance-tracker-impl\";\r\n\r\n/**\r\n * Bootstrap-phase implementation of PerformanceTracker.\r\n *\r\n * Extends the shared PerformanceTrackerImpl base class to eliminate code duplication.\r\n *\r\n * @example\r\n * ```typescript\r\n * // During bootstrap (no DI available yet)\r\n * const tracker = new BootstrapPerformanceTracker(env, metricsCollector);\r\n * const resolver = new ServiceResolver(registry, cache, null, \"root\", tracker);\r\n * ```\r\n */\r\nexport class BootstrapPerformanceTracker extends PerformanceTrackerImpl {\r\n  /**\r\n   * Creates a bootstrap performance tracker.\r\n   *\r\n   * @param env - Environment configuration for tracking settings\r\n   * @param sampler - Optional metrics sampler for sampling decisions (null during early bootstrap)\r\n   */\r\n  constructor(env: EnvironmentConfig, sampler: MetricsSampler | null) {\r\n    super(env, sampler);\r\n  }\r\n}\r\n","import type { InjectionToken } from \"./types/injectiontoken\";\r\nimport type { FactoryFunction } from \"./types/servicefactory\";\r\nimport type { ServiceClass } from \"./types/serviceclass\";\r\nimport type { ServiceDependencies } from \"./types/servicedependencies\";\r\nimport type { ContainerValidationState } from \"./types/containervalidationstate\";\r\nimport type { ApiSafeToken } from \"./types/api-safe-token\";\r\nimport { isApiSafeTokenRuntime } from \"./types/api-safe-token\";\r\nimport { ServiceLifecycle } from \"@/di_infrastructure/types/servicelifecycle\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport { ok, err, isOk } from \"@/utils/functional/result\";\r\nimport type { Result } from \"@/types/result\";\r\nimport type { Container } from \"@/di_infrastructure/interfaces/container\";\r\nimport type { ContainerError } from \"@/di_infrastructure/interfaces/containererror\";\r\nimport { ServiceRegistry } from \"./registry/ServiceRegistry\";\r\nimport { ContainerValidator } from \"./validation/ContainerValidator\";\r\nimport { InstanceCache } from \"./cache/InstanceCache\";\r\nimport { ServiceResolver } from \"./resolution/ServiceResolver\";\r\nimport { ScopeManager } from \"./scope/ScopeManager\";\r\nimport { withTimeout, TimeoutError } from \"@/utils/async/promise-timeout\";\r\nimport { ENV } from \"@/config/environment\";\r\nimport { BootstrapPerformanceTracker } from \"@/observability/bootstrap-performance-tracker\";\r\n\r\n/**\r\n * Fallback factory function type for creating service instances when container resolution fails.\r\n */\r\ntype FallbackFactory<T extends ServiceType> = () => T;\r\n\r\n/**\r\n * Dependency injection container (Facade pattern).\r\n *\r\n * Delegates to specialized components:\r\n * - ServiceRegistry: manages registrations\r\n * - ContainerValidator: validates dependencies\r\n * - InstanceCache: caches instances\r\n * - ServiceResolver: resolves services\r\n * - ScopeManager: manages lifecycle and disposal\r\n *\r\n * **Scope Chain Behavior:**\r\n * When a parent container is disposed, all child containers are automatically disposed.\r\n * This ensures proper cleanup of resources across the container hierarchy.\r\n *\r\n * **Architecture:**\r\n * This is a Facade that coordinates specialized components, adhering to Single Responsibility Principle.\r\n * Each component has a focused responsibility, making the system testable and maintainable.\r\n *\r\n * @example\r\n * ```typescript\r\n * // Basic usage\r\n * const container = ServiceContainer.createRoot();\r\n * container.registerClass(LoggerToken, Logger, ServiceLifecycle.SINGLETON);\r\n * container.validate();\r\n * const logger = container.resolve(LoggerToken);\r\n * ```\r\n *\r\n * @example\r\n * ```typescript\r\n * // Scope chain with cascading disposal\r\n * const root = ServiceContainer.createRoot();\r\n * root.validate();\r\n * const child1 = root.createScope(\"child1\").value!;\r\n * const child2 = root.createScope(\"child2\").value!;\r\n *\r\n * // Disposing root automatically disposes all children\r\n * root.dispose();\r\n * ```\r\n */\r\nexport class ServiceContainer implements Container {\r\n  private registry: ServiceRegistry;\r\n  private validator: ContainerValidator;\r\n  private cache: InstanceCache;\r\n  private resolver: ServiceResolver;\r\n  private scopeManager: ScopeManager;\r\n  private validationState: ContainerValidationState;\r\n  private fallbackFactories = new Map<symbol, FallbackFactory<ServiceType>>();\r\n  private validationPromise: Promise<Result<void, ContainerError[]>> | null = null;\r\n\r\n  /**\r\n   * Private constructor - use ServiceContainer.createRoot() instead.\r\n   *\r\n   * This constructor is private to:\r\n   * - Enforce factory pattern usage\r\n   * - Prevent constructor throws (Result-Contract-breaking)\r\n   * - Make child creation explicit through createScope()\r\n   *\r\n   * @param registry - Service registry\r\n   * @param validator - Container validator (shared for parent/child)\r\n   * @param cache - Instance cache\r\n   * @param resolver - Service resolver\r\n   * @param scopeManager - Scope manager\r\n   * @param validationState - Initial validation state\r\n   */\r\n  private constructor(\r\n    registry: ServiceRegistry,\r\n    validator: ContainerValidator,\r\n    cache: InstanceCache,\r\n    resolver: ServiceResolver,\r\n    scopeManager: ScopeManager,\r\n    validationState: ContainerValidationState\r\n  ) {\r\n    this.registry = registry;\r\n    this.validator = validator;\r\n    this.cache = cache;\r\n    this.resolver = resolver;\r\n    this.scopeManager = scopeManager;\r\n    this.validationState = validationState;\r\n  }\r\n\r\n  /**\r\n   * Creates a new root container.\r\n   *\r\n   * This is the preferred way to create containers.\r\n   * All components are created fresh for the root container.\r\n   *\r\n   * **Bootstrap Performance Tracking:**\r\n   * Uses BootstrapPerformanceTracker with ENV and null MetricsCollector.\r\n   * MetricsCollector is injected later via setMetricsCollector() after validation.\r\n   *\r\n   * @returns A new root ServiceContainer\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const container = ServiceContainer.createRoot();\r\n   * container.registerClass(LoggerToken, Logger, SINGLETON);\r\n   * container.validate();\r\n   * ```\r\n   */\r\n  static createRoot(): ServiceContainer {\r\n    const registry = new ServiceRegistry();\r\n    const validator = new ContainerValidator();\r\n    const cache = new InstanceCache();\r\n    const scopeManager = new ScopeManager(\"root\", null, cache);\r\n\r\n    // Bootstrap performance tracker (no MetricsCollector yet)\r\n    const performanceTracker = new BootstrapPerformanceTracker(ENV, null);\r\n    const resolver = new ServiceResolver(registry, cache, null, \"root\", performanceTracker);\r\n\r\n    return new ServiceContainer(registry, validator, cache, resolver, scopeManager, \"registering\");\r\n  }\r\n\r\n  /**\r\n   * Register a service class with automatic dependency injection.\r\n   */\r\n  registerClass<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    serviceClass: ServiceClass<TServiceType>,\r\n    lifecycle: ServiceLifecycle\r\n  ): Result<void, ContainerError> {\r\n    if (this.scopeManager.isDisposed()) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Cannot register service on disposed container`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    if (this.validationState === \"validated\") {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: \"Cannot register after validation\",\r\n      });\r\n    }\r\n\r\n    return this.registry.registerClass(token, serviceClass, lifecycle);\r\n  }\r\n\r\n  /**\r\n   * Register a factory function.\r\n   */\r\n  registerFactory<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    factory: FactoryFunction<TServiceType>,\r\n    lifecycle: ServiceLifecycle,\r\n    dependencies: ServiceDependencies\r\n  ): Result<void, ContainerError> {\r\n    if (this.scopeManager.isDisposed()) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Cannot register service on disposed container`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    if (this.validationState === \"validated\") {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: \"Cannot register after validation\",\r\n      });\r\n    }\r\n\r\n    // Validate factory parameter\r\n    /* c8 ignore start -- TypeScript ensures factory is a function at compile time; runtime check is defensive */\r\n    if (!factory || typeof factory !== \"function\") {\r\n      return err({\r\n        code: \"InvalidFactory\",\r\n        message: \"Factory must be a function\",\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    return this.registry.registerFactory(token, factory, lifecycle, dependencies);\r\n  }\r\n\r\n  /**\r\n   * Register a constant value.\r\n   */\r\n  registerValue<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    value: TServiceType\r\n  ): Result<void, ContainerError> {\r\n    if (this.scopeManager.isDisposed()) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Cannot register service on disposed container`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    if (this.validationState === \"validated\") {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: \"Cannot register after validation\",\r\n      });\r\n    }\r\n\r\n    return this.registry.registerValue(token, value);\r\n  }\r\n\r\n  /**\r\n   * Register an alias.\r\n   */\r\n  registerAlias<TServiceType extends ServiceType>(\r\n    aliasToken: InjectionToken<TServiceType>,\r\n    targetToken: InjectionToken<TServiceType>\r\n  ): Result<void, ContainerError> {\r\n    if (this.scopeManager.isDisposed()) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Cannot register service on disposed container`,\r\n        tokenDescription: String(aliasToken),\r\n      });\r\n    }\r\n\r\n    if (this.validationState === \"validated\") {\r\n      return err({\r\n        code: \"InvalidOperation\",\r\n        message: \"Cannot register after validation\",\r\n      });\r\n    }\r\n\r\n    return this.registry.registerAlias(aliasToken, targetToken);\r\n  }\r\n\r\n  /**\r\n   * Validate all registrations.\r\n   */\r\n  validate(): Result<void, ContainerError[]> {\r\n    if (this.validationState === \"validated\") {\r\n      return ok(undefined);\r\n    }\r\n\r\n    /* c8 ignore start -- Guard against concurrent validate() calls; requires re-entrant call during validation which is not possible in normal synchronous flow */\r\n    if (this.validationState === \"validating\") {\r\n      return err([\r\n        {\r\n          code: \"InvalidOperation\",\r\n          message: \"Validation already in progress\",\r\n        },\r\n      ]);\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    this.validationState = \"validating\";\r\n\r\n    const result = this.validator.validate(this.registry);\r\n\r\n    if (result.ok) {\r\n      this.validationState = \"validated\";\r\n      // Inject MetricsCollector into resolver after validation (if available)\r\n      void this.injectMetricsCollector();\r\n    } else {\r\n      this.validationState = \"registering\";\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Injects MetricsCollector into resolver and cache after validation.\r\n   * This enables metrics recording without circular dependencies during bootstrap.\r\n   *\r\n   * Note: EnvironmentConfig is already injected via BootstrapPerformanceTracker\r\n   * during container creation, so only MetricsCollector needs to be injected here.\r\n   */\r\n  private async injectMetricsCollector(): Promise<void> {\r\n    // Dynamic import to avoid circular dependency during module loading\r\n    const { metricsCollectorToken } = await import(\"../tokens/tokenindex.js\");\r\n    const metricsResult = this.resolveWithError(metricsCollectorToken);\r\n    if (metricsResult.ok) {\r\n      this.resolver.setMetricsCollector(metricsResult.value);\r\n      this.cache.setMetricsCollector(metricsResult.value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get validation state.\r\n   */\r\n  getValidationState(): ContainerValidationState {\r\n    return this.validationState;\r\n  }\r\n\r\n  /**\r\n   * Async-safe validation for concurrent environments with timeout.\r\n   *\r\n   * Prevents race conditions when multiple callers validate simultaneously\r\n   * by ensuring only one validation runs at a time.\r\n   *\r\n   * @param timeoutMs - Timeout in milliseconds (default: 30000 = 30 seconds)\r\n   * @returns Promise resolving to validation result\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const container = ServiceContainer.createRoot();\r\n   * // ... register services\r\n   * await container.validateAsync(); // Safe for concurrent calls\r\n   * await container.validateAsync(5000); // With 5 second timeout\r\n   * ```\r\n   */\r\n  async validateAsync(timeoutMs: number = 30000): Promise<Result<void, ContainerError[]>> {\r\n    // Return immediately if already validated\r\n    /* c8 ignore start -- Fast-path optimization; tested in sync validate() */\r\n    if (this.validationState === \"validated\") {\r\n      return ok(undefined);\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    // Wait for ongoing validation\r\n    /* c8 ignore start -- Race condition guard for concurrent validateAsync calls; requires complex async timing to test */\r\n    if (this.validationPromise !== null) {\r\n      return this.validationPromise;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    // Validation already in progress (sync)\r\n    /* c8 ignore start -- Mixed sync/async validation conflict; requires calling validate() then validateAsync() which is not a real use case */\r\n    if (this.validationState === \"validating\") {\r\n      return err([\r\n        {\r\n          code: \"InvalidOperation\",\r\n          message: \"Validation already in progress\",\r\n        },\r\n      ]);\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    this.validationState = \"validating\";\r\n\r\n    // Track if timeout occurred to prevent state changes after timeout\r\n    let timedOut = false;\r\n\r\n    // Create validation task\r\n    const validationTask = Promise.resolve().then(() => {\r\n      const result = this.validator.validate(this.registry);\r\n\r\n      // Only update state if no timeout occurred\r\n      if (!timedOut) {\r\n        if (result.ok) {\r\n          this.validationState = \"validated\";\r\n        } else {\r\n          this.validationState = \"registering\";\r\n        }\r\n      }\r\n\r\n      return result;\r\n    });\r\n\r\n    // Wrap validation with timeout\r\n    try {\r\n      this.validationPromise = withTimeout(validationTask, timeoutMs);\r\n      const result = await this.validationPromise;\r\n\r\n      // Inject MetricsCollector if validation succeeded\r\n      if (result.ok) {\r\n        await this.injectMetricsCollector();\r\n      }\r\n\r\n      return result;\r\n      /* c8 ignore start -- Timeout handling requires precise race condition setup; difficult to test reliably */\r\n    } catch (error) {\r\n      // Handle timeout\r\n      if (error instanceof TimeoutError) {\r\n        timedOut = true; // Mark timeout occurred\r\n        this.validationState = \"registering\"; // Deterministisch zurcksetzen\r\n        return err([\r\n          {\r\n            code: \"InvalidOperation\",\r\n            message: `Validation timed out after ${timeoutMs}ms`,\r\n          },\r\n        ]);\r\n      }\r\n      // Re-throw unexpected errors\r\n      throw error;\r\n      /* c8 ignore stop */\r\n    } finally {\r\n      /* c8 ignore next -- State cleanup always executed; null assignment is cleanup logic not business logic */\r\n      this.validationPromise = null;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Creates a child scope container.\r\n   *\r\n   * Child containers:\r\n   * - Inherit parent registrations (cloned)\r\n   * - Can add their own registrations\r\n   * - Must call validate() before resolving\r\n   * - Share parent's singleton instances\r\n   * - Have isolated scoped instances\r\n   *\r\n   * @param name - Optional custom name for the scope\r\n   * @returns Result with child container or error\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const parent = ServiceContainer.createRoot();\r\n   * parent.registerClass(LoggerToken, Logger, SINGLETON);\r\n   * parent.validate();\r\n   *\r\n   * const child = parent.createScope(\"request\").value!;\r\n   * child.registerClass(RequestToken, RequestContext, SCOPED);\r\n   * child.validate();\r\n   *\r\n   * const logger = child.resolve(LoggerToken);   // From parent (shared)\r\n   * const ctx = child.resolve(RequestToken);      // From child (isolated)\r\n   * ```\r\n   */\r\n  createScope(name?: string): Result<ServiceContainer, ContainerError> {\r\n    if (this.scopeManager.isDisposed()) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Cannot create scope from disposed container`,\r\n      });\r\n    }\r\n\r\n    if (this.validationState !== \"validated\") {\r\n      return err({\r\n        code: \"NotValidated\",\r\n        message: \"Parent must be validated before creating scopes. Call validate() first.\",\r\n      });\r\n    }\r\n\r\n    // Create child scope (pure Result, no throws)\r\n    const scopeResult = this.scopeManager.createChild(name);\r\n    /* c8 ignore start -- ScopeManager.createChild() error paths tested in ScopeManager.test.ts; this is just error propagation */\r\n    if (!scopeResult.ok) {\r\n      return err(scopeResult.error); // Structured error, not exception\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    // Build child container components\r\n    const childRegistry = this.registry.clone();\r\n    const childCache = scopeResult.value.cache;\r\n    const childManager = scopeResult.value.manager;\r\n\r\n    // Create performance tracker for child (same as root)\r\n    const childPerformanceTracker = new BootstrapPerformanceTracker(ENV, null);\r\n    const childResolver = new ServiceResolver(\r\n      childRegistry,\r\n      childCache,\r\n      this.resolver, // Parent resolver for singleton delegation\r\n      scopeResult.value.scopeName,\r\n      childPerformanceTracker\r\n    );\r\n\r\n    // Create child using private constructor\r\n    const child = new ServiceContainer(\r\n      childRegistry,\r\n      this.validator, // Shared (stateless)\r\n      childCache,\r\n      childResolver,\r\n      childManager,\r\n      \"registering\" // FIX: Child starts in registering state, not validated!\r\n    );\r\n\r\n    return ok(child);\r\n  }\r\n\r\n  /**\r\n   * Resolve service with Result return.\r\n   */\r\n  resolveWithError<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>\r\n  ): Result<TServiceType, ContainerError> {\r\n    if (this.scopeManager.isDisposed()) {\r\n      return err({\r\n        code: \"Disposed\",\r\n        message: `Cannot resolve from disposed container`,\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    if (this.validationState !== \"validated\") {\r\n      return err({\r\n        code: \"NotValidated\",\r\n        message: \"Container must be validated before resolving. Call validate() first.\",\r\n        tokenDescription: String(token),\r\n      });\r\n    }\r\n\r\n    return this.resolver.resolve(token);\r\n  }\r\n\r\n  /**\r\n   * Resolves a service instance (throws on failure).\r\n   *\r\n   * ** FOR EXTERNAL API USE ONLY**\r\n   *\r\n   * This method is designed for the public ModuleApi to provide\r\n   * exception-based error handling for external Foundry VTT modules.\r\n   *\r\n   * **Enforcement (Defense-in-Depth):**\r\n   * - **Compile-Time:** Only accepts ApiSafeToken types\r\n   * - **Runtime:** Validates token has API_SAFE_RUNTIME_MARKER (always active)\r\n   *\r\n   * Internal code MUST use `resolveWithError()` for Result-based error handling.\r\n   *\r\n   * @param token - An API-safe injection token (from api.tokens)\r\n   * @returns The resolved service instance\r\n   * @throws {Error} If token is not API-safe or resolution fails\r\n   *\r\n   * @example External Module Usage\r\n   * ```typescript\r\n   * const api = game.modules.get('fvtt_relationship_app_module').api;\r\n   *\r\n   * try {\r\n   *   const logger = api.resolve(api.tokens.loggerToken);\r\n   *   logger.info(\"Success\");\r\n   * } catch (error) {\r\n   *   console.error(\"Failed:\", error);\r\n   * }\r\n   * ```\r\n   *\r\n   * @example Internal Code (WRONG - Use resolveWithError)\r\n   * ```typescript\r\n   * //  TypeScript Error + Runtime Error\r\n   * const logger = container.resolve(loggerToken);\r\n   *\r\n   * //  CORRECT\r\n   * const result = container.resolveWithError(loggerToken);\r\n   * if (result.ok) {\r\n   *   result.value.info(\"Success\");\r\n   * }\r\n   * ```\r\n   */\r\n  resolve<TServiceType extends ServiceType>(token: ApiSafeToken<TServiceType>): TServiceType;\r\n\r\n  /**\r\n   * @deprecated Internal code must use resolveWithError()\r\n   * @internal This overload prevents direct calls with non-branded tokens\r\n   */\r\n  resolve<TServiceType extends ServiceType>(token: InjectionToken<TServiceType>): never;\r\n\r\n  // Implementation (unified for both overloads)\r\n  resolve<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType> | ApiSafeToken<TServiceType>\r\n  ): TServiceType {\r\n    //  RUNTIME GUARD (always active for defense-in-depth)\r\n    if (!isApiSafeTokenRuntime(token)) {\r\n      throw new Error(\r\n        `API Boundary Violation: resolve() called with non-API-safe token: ${String(token)}.\\n` +\r\n          `This token was not marked via markAsApiSafe().\\n` +\r\n          `\\n` +\r\n          `Internal code MUST use resolveWithError() instead:\\n` +\r\n          `  const result = container.resolveWithError(${String(token)});\\n` +\r\n          `  if (result.ok) { /* use result.value */ }\\n` +\r\n          `\\n` +\r\n          `Only the public ModuleApi should expose resolve() for external modules.`\r\n      );\r\n    }\r\n\r\n    // Standard resolution via Result pattern\r\n    const result = this.resolveWithError(token);\r\n\r\n    if (isOk(result)) {\r\n      return result.value;\r\n    }\r\n\r\n    // Try fallback factory\r\n    const fallback = this.fallbackFactories.get(token);\r\n    if (fallback) {\r\n      // Fallbacks are registered with matching generic type for public resolve()\r\n      // Type alignment is ensured by registerFallback at registration time\r\n      // type-coverage:ignore-next-line -- Type cast required due to Map<symbol, Factory> storage\r\n      return fallback() as TServiceType;\r\n    }\r\n\r\n    // No fallback - throw with context\r\n    throw new Error(\r\n      `Cannot resolve ${String(token)}: ${result.error.message}. ` +\r\n        `No fallback factory registered for this token.`\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Check if service is registered.\r\n   */\r\n  isRegistered<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>\r\n  ): Result<boolean, never> {\r\n    return ok(this.registry.has(token));\r\n  }\r\n\r\n  /**\r\n   * Register a fallback factory for a specific token.\r\n   * This will be used when resolve() fails for that token.\r\n   *\r\n   * @param token - The injection token\r\n   * @param factory - Factory function that creates a fallback instance\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * container.registerFallback(UserServiceToken, () => new DefaultUserService());\r\n   * ```\r\n   */\r\n  registerFallback<TServiceType extends ServiceType>(\r\n    token: InjectionToken<TServiceType>,\r\n    factory: FallbackFactory<TServiceType>\r\n  ): void {\r\n    this.fallbackFactories.set(token, factory as FallbackFactory<ServiceType>);\r\n  }\r\n\r\n  /**\r\n   * Synchronously dispose container and all children.\r\n   *\r\n   * Use this for scenarios where async disposal is not possible (e.g., browser unload).\r\n   * For normal cleanup, prefer disposeAsync() which handles async disposal properly.\r\n   *\r\n   * @returns Result indicating success or disposal error\r\n   */\r\n  dispose(): Result<void, ContainerError> {\r\n    const result = this.scopeManager.dispose();\r\n\r\n    // Reset validation state after disposal (per review feedback)\r\n    if (result.ok) {\r\n      this.validationState = \"registering\";\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Asynchronously dispose container and all children.\r\n   *\r\n   * This is the preferred disposal method as it properly handles services that\r\n   * implement AsyncDisposable, allowing for proper cleanup of resources like\r\n   * database connections, file handles, or network sockets.\r\n   *\r\n   * Falls back to synchronous disposal for services implementing only Disposable.\r\n   *\r\n   * @returns Promise with Result indicating success or disposal error\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * // Preferred: async disposal\r\n   * const result = await container.disposeAsync();\r\n   * if (result.ok) {\r\n   *   console.log(\"Container disposed successfully\");\r\n   * }\r\n   *\r\n   * // Browser unload (sync required)\r\n   * window.addEventListener('beforeunload', () => {\r\n   *   container.dispose();  // Sync fallback\r\n   * });\r\n   * ```\r\n   */\r\n  async disposeAsync(): Promise<Result<void, ContainerError>> {\r\n    const result = await this.scopeManager.disposeAsync();\r\n\r\n    // Reset validation state after disposal (per review feedback)\r\n    if (result.ok) {\r\n      this.validationState = \"registering\";\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Clear all registrations and instances.\r\n   *\r\n   * IMPORTANT: Resets validation state (per review feedback).\r\n   */\r\n  clear(): Result<void, never> {\r\n    this.registry.clear();\r\n    this.cache.clear();\r\n    this.validationState = \"registering\"; // Critical: reset validation state\r\n    return ok(undefined);\r\n  }\r\n}\r\n","import type { Logger } from \"@/interfaces/logger\";\r\nimport { MODULE_CONSTANTS } from \"../constants\";\r\nimport { LogLevel } from \"@/config/environment\";\r\n\r\n/**\r\n * Traced logger wrapper that includes a trace ID in all log messages.\r\n * Decorates an existing logger to add trace ID prefixes.\r\n *\r\n * **Design Pattern:** Decorator Pattern\r\n *\r\n * **Behavior Change:** Intentionally modifies log output by adding [traceId] prefix.\r\n * This is NOT a Liskov Substitution Principle violation because:\r\n * - The behavior change is documented and intentional\r\n * - The contract (Logger interface) is fully preserved\r\n * - All Logger methods are implemented correctly\r\n * - Callers explicitly request tracing via withTraceId()\r\n * - The semantic meaning of logging is unchanged (messages are still logged)\r\n *\r\n * **Use Case:** Distributed tracing and request correlation.\r\n * Allows correlating log entries across related operations by including\r\n * a unique trace ID in all messages.\r\n *\r\n * @example\r\n * ```typescript\r\n * const logger = new ConsoleLoggerService();\r\n * const tracedLogger = logger.withTraceId(\"req-123\");\r\n *\r\n * tracedLogger.info(\"Processing request\");\r\n * // Output: \"[req-123] Processing request\"\r\n * ```\r\n */\r\nclass TracedLogger implements Logger {\r\n  constructor(\r\n    private readonly baseLogger: Logger,\r\n    private readonly traceId: string\r\n  ) {}\r\n\r\n  private formatMessage(message: string): string {\r\n    return `[${this.traceId}] ${message}`;\r\n  }\r\n\r\n  setMinLevel(level: LogLevel): void {\r\n    this.baseLogger.setMinLevel?.(level);\r\n  }\r\n\r\n  log(message: string, ...optionalParams: unknown[]): void {\r\n    this.baseLogger.log(this.formatMessage(message), ...optionalParams);\r\n  }\r\n\r\n  error(message: string, ...optionalParams: unknown[]): void {\r\n    this.baseLogger.error(this.formatMessage(message), ...optionalParams);\r\n  }\r\n\r\n  warn(message: string, ...optionalParams: unknown[]): void {\r\n    this.baseLogger.warn(this.formatMessage(message), ...optionalParams);\r\n  }\r\n\r\n  info(message: string, ...optionalParams: unknown[]): void {\r\n    this.baseLogger.info(this.formatMessage(message), ...optionalParams);\r\n  }\r\n\r\n  debug(message: string, ...optionalParams: unknown[]): void {\r\n    this.baseLogger.debug(this.formatMessage(message), ...optionalParams);\r\n  }\r\n\r\n  withTraceId(newTraceId: string): Logger {\r\n    // Nested trace IDs: combine them\r\n    return new TracedLogger(this.baseLogger, `${this.traceId}/${newTraceId}`);\r\n  }\r\n}\r\n\r\n/**\r\n * Console-based implementation of the Logger interface.\r\n * Writes log messages to the browser console with support for interactive object inspection.\r\n * Supports configurable minimum log level for filtering.\r\n *\r\n * @implements {Logger}\r\n */\r\nexport class ConsoleLoggerService implements Logger {\r\n  static dependencies = [] as const;\r\n  private minLevel: LogLevel = LogLevel.INFO;\r\n\r\n  /**\r\n   * Sets the minimum log level. Messages below this level will be ignored.\r\n   * @param level - Minimum log level\r\n   */\r\n  setMinLevel(level: LogLevel): void {\r\n    this.minLevel = level;\r\n  }\r\n\r\n  /**\r\n   * Log a message to console\r\n   * @param message - Message to log\r\n   * @param optionalParams - Additional data to log (objects will be interactive in browser console)\r\n   */\r\n  log(message: string, ...optionalParams: unknown[]): void {\r\n    // Log has no specific level, always output\r\n    console.log(`${MODULE_CONSTANTS.LOG_PREFIX} ${message}`, ...optionalParams);\r\n  }\r\n\r\n  /**\r\n   * Log an error message\r\n   * @param message - Error message to log\r\n   * @param optionalParams - Additional data to log (e.g., error objects, stack traces)\r\n   */\r\n  error(message: string, ...optionalParams: unknown[]): void {\r\n    /* c8 ignore start -- Branch: Log level filtering tested in other methods; error just delegates */\r\n    if (LogLevel.ERROR < this.minLevel) return;\r\n    /* c8 ignore stop */\r\n    console.error(`${MODULE_CONSTANTS.LOG_PREFIX} ${message}`, ...optionalParams);\r\n  }\r\n\r\n  /**\r\n   * Log a warning message\r\n   * @param message - Warning message to log\r\n   * @param optionalParams - Additional data to log\r\n   */\r\n  warn(message: string, ...optionalParams: unknown[]): void {\r\n    if (LogLevel.WARN < this.minLevel) return;\r\n    console.warn(`${MODULE_CONSTANTS.LOG_PREFIX} ${message}`, ...optionalParams);\r\n  }\r\n\r\n  /**\r\n   * Log an info message\r\n   * @param message - Info message to log\r\n   * @param optionalParams - Additional data to log\r\n   */\r\n  info(message: string, ...optionalParams: unknown[]): void {\r\n    if (LogLevel.INFO < this.minLevel) return;\r\n    console.info(`${MODULE_CONSTANTS.LOG_PREFIX} ${message}`, ...optionalParams);\r\n  }\r\n\r\n  /**\r\n   * Log a debug message\r\n   * @param message - Debug message to log\r\n   * @param optionalParams - Additional data to log (useful for inspecting complex objects)\r\n   */\r\n  debug(message: string, ...optionalParams: unknown[]): void {\r\n    if (LogLevel.DEBUG < this.minLevel) return;\r\n    console.debug(`${MODULE_CONSTANTS.LOG_PREFIX} ${message}`, ...optionalParams);\r\n  }\r\n\r\n  /**\r\n   * Creates a scoped logger that includes a trace ID in all log messages.\r\n   * The trace ID helps correlate log entries across related operations.\r\n   *\r\n   * @param traceId - Unique trace ID to include in log messages\r\n   * @returns A new Logger instance that includes the trace ID in all messages\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * import { generateTraceId } from '@/utils/trace';\r\n   *\r\n   * const traceId = generateTraceId();\r\n   * const tracedLogger = logger.withTraceId(traceId);\r\n   * tracedLogger.info('Operation started'); // [1234567890-abc123] Operation started\r\n   * ```\r\n   */\r\n  withTraceId(traceId: string): Logger {\r\n    return new TracedLogger(this, traceId);\r\n  }\r\n}\r\n","// src/storages/globalConfig/globalConfig.ts\nvar store;\nfunction setGlobalConfig(config2) {\n  store = { ...store, ...config2 };\n}\n// @__NO_SIDE_EFFECTS__\nfunction getGlobalConfig(config2) {\n  return {\n    lang: config2?.lang ?? store?.lang,\n    message: config2?.message,\n    abortEarly: config2?.abortEarly ?? store?.abortEarly,\n    abortPipeEarly: config2?.abortPipeEarly ?? store?.abortPipeEarly\n  };\n}\nfunction deleteGlobalConfig() {\n  store = void 0;\n}\n\n// src/storages/globalMessage/globalMessage.ts\nvar store2;\nfunction setGlobalMessage(message2, lang) {\n  if (!store2) store2 = /* @__PURE__ */ new Map();\n  store2.set(lang, message2);\n}\n// @__NO_SIDE_EFFECTS__\nfunction getGlobalMessage(lang) {\n  return store2?.get(lang);\n}\nfunction deleteGlobalMessage(lang) {\n  store2?.delete(lang);\n}\n\n// src/storages/schemaMessage/schemaMessage.ts\nvar store3;\nfunction setSchemaMessage(message2, lang) {\n  if (!store3) store3 = /* @__PURE__ */ new Map();\n  store3.set(lang, message2);\n}\n// @__NO_SIDE_EFFECTS__\nfunction getSchemaMessage(lang) {\n  return store3?.get(lang);\n}\nfunction deleteSchemaMessage(lang) {\n  store3?.delete(lang);\n}\n\n// src/storages/specificMessage/specificMessage.ts\nvar store4;\nfunction setSpecificMessage(reference, message2, lang) {\n  if (!store4) store4 = /* @__PURE__ */ new Map();\n  if (!store4.get(reference)) store4.set(reference, /* @__PURE__ */ new Map());\n  store4.get(reference).set(lang, message2);\n}\n// @__NO_SIDE_EFFECTS__\nfunction getSpecificMessage(reference, lang) {\n  return store4?.get(reference)?.get(lang);\n}\nfunction deleteSpecificMessage(reference, lang) {\n  store4?.get(reference)?.delete(lang);\n}\n\n// src/utils/_stringify/_stringify.ts\n// @__NO_SIDE_EFFECTS__\nfunction _stringify(input) {\n  const type = typeof input;\n  if (type === \"string\") {\n    return `\"${input}\"`;\n  }\n  if (type === \"number\" || type === \"bigint\" || type === \"boolean\") {\n    return `${input}`;\n  }\n  if (type === \"object\" || type === \"function\") {\n    return (input && Object.getPrototypeOf(input)?.constructor?.name) ?? \"null\";\n  }\n  return type;\n}\n\n// src/utils/_addIssue/_addIssue.ts\nfunction _addIssue(context, label, dataset, config2, other) {\n  const input = other && \"input\" in other ? other.input : dataset.value;\n  const expected = other?.expected ?? context.expects ?? null;\n  const received = other?.received ?? _stringify(input);\n  const issue = {\n    kind: context.kind,\n    type: context.type,\n    input,\n    expected,\n    received,\n    message: `Invalid ${label}: ${expected ? `Expected ${expected} but r` : \"R\"}eceived ${received}`,\n    requirement: context.requirement,\n    path: other?.path,\n    issues: other?.issues,\n    lang: config2.lang,\n    abortEarly: config2.abortEarly,\n    abortPipeEarly: config2.abortPipeEarly\n  };\n  const isSchema = context.kind === \"schema\";\n  const message2 = other?.message ?? context.message ?? getSpecificMessage(context.reference, issue.lang) ?? (isSchema ? getSchemaMessage(issue.lang) : null) ?? config2.message ?? getGlobalMessage(issue.lang);\n  if (message2 !== void 0) {\n    issue.message = typeof message2 === \"function\" ? (\n      // @ts-expect-error\n      message2(issue)\n    ) : message2;\n  }\n  if (isSchema) {\n    dataset.typed = false;\n  }\n  if (dataset.issues) {\n    dataset.issues.push(issue);\n  } else {\n    dataset.issues = [issue];\n  }\n}\n\n// src/utils/_getByteCount/_getByteCount.ts\nvar textEncoder;\n// @__NO_SIDE_EFFECTS__\nfunction _getByteCount(input) {\n  if (!textEncoder) {\n    textEncoder = new TextEncoder();\n  }\n  return textEncoder.encode(input).length;\n}\n\n// src/utils/_getGraphemeCount/_getGraphemeCount.ts\nvar segmenter;\n// @__NO_SIDE_EFFECTS__\nfunction _getGraphemeCount(input) {\n  if (!segmenter) {\n    segmenter = new Intl.Segmenter();\n  }\n  const segments = segmenter.segment(input);\n  let count = 0;\n  for (const _ of segments) {\n    count++;\n  }\n  return count;\n}\n\n// src/utils/_getLastMetadata/_getLastMetadata.ts\n// @__NO_SIDE_EFFECTS__\nfunction _getLastMetadata(schema, type) {\n  if (\"pipe\" in schema) {\n    const nestedSchemas = [];\n    for (let index = schema.pipe.length - 1; index >= 0; index--) {\n      const item = schema.pipe[index];\n      if (item.kind === \"schema\" && \"pipe\" in item) {\n        nestedSchemas.push(item);\n      } else if (item.kind === \"metadata\" && item.type === type) {\n        return item[type];\n      }\n    }\n    for (const nestedSchema of nestedSchemas) {\n      const result = /* @__PURE__ */ _getLastMetadata(nestedSchema, type);\n      if (result !== void 0) {\n        return result;\n      }\n    }\n  }\n}\n\n// src/utils/_getStandardProps/_getStandardProps.ts\n// @__NO_SIDE_EFFECTS__\nfunction _getStandardProps(context) {\n  return {\n    version: 1,\n    vendor: \"valibot\",\n    validate(value2) {\n      return context[\"~run\"]({ value: value2 }, getGlobalConfig());\n    }\n  };\n}\n\n// src/utils/_getWordCount/_getWordCount.ts\nvar store5;\n// @__NO_SIDE_EFFECTS__\nfunction _getWordCount(locales, input) {\n  if (!store5) {\n    store5 = /* @__PURE__ */ new Map();\n  }\n  if (!store5.get(locales)) {\n    store5.set(locales, new Intl.Segmenter(locales, { granularity: \"word\" }));\n  }\n  const segments = store5.get(locales).segment(input);\n  let count = 0;\n  for (const segment of segments) {\n    if (segment.isWordLike) {\n      count++;\n    }\n  }\n  return count;\n}\n\n// src/utils/_isLuhnAlgo/_isLuhnAlgo.ts\nvar NON_DIGIT_REGEX = /\\D/gu;\n// @__NO_SIDE_EFFECTS__\nfunction _isLuhnAlgo(input) {\n  const number2 = input.replace(NON_DIGIT_REGEX, \"\");\n  let length2 = number2.length;\n  let bit = 1;\n  let sum = 0;\n  while (length2) {\n    const value2 = +number2[--length2];\n    bit ^= 1;\n    sum += bit ? [0, 2, 4, 6, 8, 1, 3, 5, 7, 9][value2] : value2;\n  }\n  return sum % 10 === 0;\n}\n\n// src/utils/_isValidObjectKey/_isValidObjectKey.ts\n// @__NO_SIDE_EFFECTS__\nfunction _isValidObjectKey(object2, key) {\n  return Object.hasOwn(object2, key) && key !== \"__proto__\" && key !== \"prototype\" && key !== \"constructor\";\n}\n\n// src/utils/_joinExpects/_joinExpects.ts\n// @__NO_SIDE_EFFECTS__\nfunction _joinExpects(values2, separator) {\n  const list = [...new Set(values2)];\n  if (list.length > 1) {\n    return `(${list.join(` ${separator} `)})`;\n  }\n  return list[0] ?? \"never\";\n}\n\n// src/utils/entriesFromList/entriesFromList.ts\n// @__NO_SIDE_EFFECTS__\nfunction entriesFromList(list, schema) {\n  const entries2 = {};\n  for (const key of list) {\n    entries2[key] = schema;\n  }\n  return entries2;\n}\n\n// src/utils/entriesFromObjects/entriesFromObjects.ts\n// @__NO_SIDE_EFFECTS__\nfunction entriesFromObjects(schemas) {\n  const entries2 = {};\n  for (const schema of schemas) {\n    Object.assign(entries2, schema.entries);\n  }\n  return entries2;\n}\n\n// src/utils/getDotPath/getDotPath.ts\n// @__NO_SIDE_EFFECTS__\nfunction getDotPath(issue) {\n  if (issue.path) {\n    let key = \"\";\n    for (const item of issue.path) {\n      if (typeof item.key === \"string\" || typeof item.key === \"number\") {\n        if (key) {\n          key += `.${item.key}`;\n        } else {\n          key += item.key;\n        }\n      } else {\n        return null;\n      }\n    }\n    return key;\n  }\n  return null;\n}\n\n// src/utils/isOfKind/isOfKind.ts\n// @__NO_SIDE_EFFECTS__\nfunction isOfKind(kind, object2) {\n  return object2.kind === kind;\n}\n\n// src/utils/isOfType/isOfType.ts\n// @__NO_SIDE_EFFECTS__\nfunction isOfType(type, object2) {\n  return object2.type === type;\n}\n\n// src/utils/isValiError/isValiError.ts\n// @__NO_SIDE_EFFECTS__\nfunction isValiError(error) {\n  return error instanceof ValiError;\n}\n\n// src/utils/ValiError/ValiError.ts\nvar ValiError = class extends Error {\n  /**\n   * Creates a Valibot error with useful information.\n   *\n   * @param issues The error issues.\n   */\n  constructor(issues) {\n    super(issues[0].message);\n    this.name = \"ValiError\";\n    this.issues = issues;\n  }\n};\n\n// src/actions/args/args.ts\n// @__NO_SIDE_EFFECTS__\nfunction args(schema) {\n  return {\n    kind: \"transformation\",\n    type: \"args\",\n    reference: args,\n    async: false,\n    schema,\n    \"~run\"(dataset, config2) {\n      const func = dataset.value;\n      dataset.value = (...args_) => {\n        const argsDataset = this.schema[\"~run\"]({ value: args_ }, config2);\n        if (argsDataset.issues) {\n          throw new ValiError(argsDataset.issues);\n        }\n        return func(...argsDataset.value);\n      };\n      return dataset;\n    }\n  };\n}\n\n// src/actions/args/argsAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction argsAsync(schema) {\n  return {\n    kind: \"transformation\",\n    type: \"args\",\n    reference: argsAsync,\n    async: false,\n    schema,\n    \"~run\"(dataset, config2) {\n      const func = dataset.value;\n      dataset.value = async (...args2) => {\n        const argsDataset = await schema[\"~run\"]({ value: args2 }, config2);\n        if (argsDataset.issues) {\n          throw new ValiError(argsDataset.issues);\n        }\n        return func(...argsDataset.value);\n      };\n      return dataset;\n    }\n  };\n}\n\n// src/actions/await/awaitAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction awaitAsync() {\n  return {\n    kind: \"transformation\",\n    type: \"await\",\n    reference: awaitAsync,\n    async: true,\n    async \"~run\"(dataset) {\n      dataset.value = await dataset.value;\n      return dataset;\n    }\n  };\n}\n\n// src/regex.ts\nvar BASE64_REGEX = /^(?:[\\da-z+/]{4})*(?:[\\da-z+/]{2}==|[\\da-z+/]{3}=)?$/iu;\nvar BIC_REGEX = /^[A-Z]{6}(?!00)[\\dA-Z]{2}(?:[\\dA-Z]{3})?$/u;\nvar CUID2_REGEX = /^[a-z][\\da-z]*$/u;\nvar DECIMAL_REGEX = /^[+-]?(?:\\d*\\.)?\\d+$/u;\nvar DIGITS_REGEX = /^\\d+$/u;\nvar EMAIL_REGEX = /^[\\w+-]+(?:\\.[\\w+-]+)*@[\\da-z]+(?:[.-][\\da-z]+)*\\.[a-z]{2,}$/iu;\nvar EMOJI_REGEX = (\n  // eslint-disable-next-line redos-detector/no-unsafe-regex, regexp/no-dupe-disjunctions -- false positives\n  /^(?:[\\u{1F1E6}-\\u{1F1FF}]{2}|\\u{1F3F4}[\\u{E0061}-\\u{E007A}]{2}[\\u{E0030}-\\u{E0039}\\u{E0061}-\\u{E007A}]{1,3}\\u{E007F}|(?:\\p{Emoji}\\uFE0F\\u20E3?|\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation})(?:\\u200D(?:\\p{Emoji}\\uFE0F\\u20E3?|\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?|\\p{Emoji_Presentation}))*)+$/u\n);\nvar HEXADECIMAL_REGEX = /^(?:0[hx])?[\\da-fA-F]+$/u;\nvar HEX_COLOR_REGEX = /^#(?:[\\da-fA-F]{3,4}|[\\da-fA-F]{6}|[\\da-fA-F]{8})$/u;\nvar IMEI_REGEX = /^\\d{15}$|^\\d{2}-\\d{6}-\\d{6}-\\d$/u;\nvar IPV4_REGEX = (\n  // eslint-disable-next-line redos-detector/no-unsafe-regex -- false positive\n  /^(?:(?:[1-9]|1\\d|2[0-4])?\\d|25[0-5])(?:\\.(?:(?:[1-9]|1\\d|2[0-4])?\\d|25[0-5])){3}$/u\n);\nvar IPV6_REGEX = /^(?:(?:[\\da-f]{1,4}:){7}[\\da-f]{1,4}|(?:[\\da-f]{1,4}:){1,7}:|(?:[\\da-f]{1,4}:){1,6}:[\\da-f]{1,4}|(?:[\\da-f]{1,4}:){1,5}(?::[\\da-f]{1,4}){1,2}|(?:[\\da-f]{1,4}:){1,4}(?::[\\da-f]{1,4}){1,3}|(?:[\\da-f]{1,4}:){1,3}(?::[\\da-f]{1,4}){1,4}|(?:[\\da-f]{1,4}:){1,2}(?::[\\da-f]{1,4}){1,5}|[\\da-f]{1,4}:(?::[\\da-f]{1,4}){1,6}|:(?:(?::[\\da-f]{1,4}){1,7}|:)|fe80:(?::[\\da-f]{0,4}){0,4}%[\\da-z]+|::(?:f{4}(?::0{1,4})?:)?(?:(?:25[0-5]|(?:2[0-4]|1?\\d)?\\d)\\.){3}(?:25[0-5]|(?:2[0-4]|1?\\d)?\\d)|(?:[\\da-f]{1,4}:){1,4}:(?:(?:25[0-5]|(?:2[0-4]|1?\\d)?\\d)\\.){3}(?:25[0-5]|(?:2[0-4]|1?\\d)?\\d))$/iu;\nvar IP_REGEX = /^(?:(?:[1-9]|1\\d|2[0-4])?\\d|25[0-5])(?:\\.(?:(?:[1-9]|1\\d|2[0-4])?\\d|25[0-5])){3}$|^(?:(?:[\\da-f]{1,4}:){7}[\\da-f]{1,4}|(?:[\\da-f]{1,4}:){1,7}:|(?:[\\da-f]{1,4}:){1,6}:[\\da-f]{1,4}|(?:[\\da-f]{1,4}:){1,5}(?::[\\da-f]{1,4}){1,2}|(?:[\\da-f]{1,4}:){1,4}(?::[\\da-f]{1,4}){1,3}|(?:[\\da-f]{1,4}:){1,3}(?::[\\da-f]{1,4}){1,4}|(?:[\\da-f]{1,4}:){1,2}(?::[\\da-f]{1,4}){1,5}|[\\da-f]{1,4}:(?::[\\da-f]{1,4}){1,6}|:(?:(?::[\\da-f]{1,4}){1,7}|:)|fe80:(?::[\\da-f]{0,4}){0,4}%[\\da-z]+|::(?:f{4}(?::0{1,4})?:)?(?:(?:25[0-5]|(?:2[0-4]|1?\\d)?\\d)\\.){3}(?:25[0-5]|(?:2[0-4]|1?\\d)?\\d)|(?:[\\da-f]{1,4}:){1,4}:(?:(?:25[0-5]|(?:2[0-4]|1?\\d)?\\d)\\.){3}(?:25[0-5]|(?:2[0-4]|1?\\d)?\\d))$/iu;\nvar ISO_DATE_REGEX = /^\\d{4}-(?:0[1-9]|1[0-2])-(?:[12]\\d|0[1-9]|3[01])$/u;\nvar ISO_DATE_TIME_REGEX = /^\\d{4}-(?:0[1-9]|1[0-2])-(?:[12]\\d|0[1-9]|3[01])[T ](?:0\\d|1\\d|2[0-3]):[0-5]\\d$/u;\nvar ISO_TIME_REGEX = /^(?:0\\d|1\\d|2[0-3]):[0-5]\\d$/u;\nvar ISO_TIME_SECOND_REGEX = /^(?:0\\d|1\\d|2[0-3])(?::[0-5]\\d){2}$/u;\nvar ISO_TIMESTAMP_REGEX = /^\\d{4}-(?:0[1-9]|1[0-2])-(?:[12]\\d|0[1-9]|3[01])[T ](?:0\\d|1\\d|2[0-3])(?::[0-5]\\d){2}(?:\\.\\d{1,9})?(?:Z|[+-](?:0\\d|1\\d|2[0-3])(?::?[0-5]\\d)?)$/u;\nvar ISO_WEEK_REGEX = /^\\d{4}-W(?:0[1-9]|[1-4]\\d|5[0-3])$/u;\nvar MAC48_REGEX = /^(?:[\\da-f]{2}:){5}[\\da-f]{2}$|^(?:[\\da-f]{2}-){5}[\\da-f]{2}$|^(?:[\\da-f]{4}\\.){2}[\\da-f]{4}$/iu;\nvar MAC64_REGEX = /^(?:[\\da-f]{2}:){7}[\\da-f]{2}$|^(?:[\\da-f]{2}-){7}[\\da-f]{2}$|^(?:[\\da-f]{4}\\.){3}[\\da-f]{4}$|^(?:[\\da-f]{4}:){3}[\\da-f]{4}$/iu;\nvar MAC_REGEX = /^(?:[\\da-f]{2}:){5}[\\da-f]{2}$|^(?:[\\da-f]{2}-){5}[\\da-f]{2}$|^(?:[\\da-f]{4}\\.){2}[\\da-f]{4}$|^(?:[\\da-f]{2}:){7}[\\da-f]{2}$|^(?:[\\da-f]{2}-){7}[\\da-f]{2}$|^(?:[\\da-f]{4}\\.){3}[\\da-f]{4}$|^(?:[\\da-f]{4}:){3}[\\da-f]{4}$/iu;\nvar NANO_ID_REGEX = /^[\\w-]+$/u;\nvar OCTAL_REGEX = /^(?:0o)?[0-7]+$/u;\nvar RFC_EMAIL_REGEX = (\n  // eslint-disable-next-line regexp/prefer-w, no-useless-escape, regexp/no-useless-escape, regexp/require-unicode-regexp\n  /^[a-zA-Z0-9.!#$%&'*+\\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/\n);\nvar SLUG_REGEX = /^[\\da-z]+(?:[-_][\\da-z]+)*$/u;\nvar ULID_REGEX = /^[\\da-hjkmnp-tv-zA-HJKMNP-TV-Z]{26}$/u;\nvar UUID_REGEX = /^[\\da-f]{8}(?:-[\\da-f]{4}){3}-[\\da-f]{12}$/iu;\n\n// src/actions/base64/base64.ts\n// @__NO_SIDE_EFFECTS__\nfunction base64(message2) {\n  return {\n    kind: \"validation\",\n    type: \"base64\",\n    reference: base64,\n    async: false,\n    expects: null,\n    requirement: BASE64_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"Base64\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/bic/bic.ts\n// @__NO_SIDE_EFFECTS__\nfunction bic(message2) {\n  return {\n    kind: \"validation\",\n    type: \"bic\",\n    reference: bic,\n    async: false,\n    expects: null,\n    requirement: BIC_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"BIC\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/brand/brand.ts\n// @__NO_SIDE_EFFECTS__\nfunction brand(name) {\n  return {\n    kind: \"transformation\",\n    type: \"brand\",\n    reference: brand,\n    async: false,\n    name,\n    \"~run\"(dataset) {\n      return dataset;\n    }\n  };\n}\n\n// src/actions/bytes/bytes.ts\n// @__NO_SIDE_EFFECTS__\nfunction bytes(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"bytes\",\n    reference: bytes,\n    async: false,\n    expects: `${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const length2 = _getByteCount(dataset.value);\n        if (length2 !== this.requirement) {\n          _addIssue(this, \"bytes\", dataset, config2, {\n            received: `${length2}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/check/check.ts\n// @__NO_SIDE_EFFECTS__\nfunction check(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"check\",\n    reference: check,\n    async: false,\n    expects: null,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement(dataset.value)) {\n        _addIssue(this, \"input\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/check/checkAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction checkAsync(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"check\",\n    reference: checkAsync,\n    async: true,\n    expects: null,\n    requirement,\n    message: message2,\n    async \"~run\"(dataset, config2) {\n      if (dataset.typed && !await this.requirement(dataset.value)) {\n        _addIssue(this, \"input\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/checkItems/checkItems.ts\n// @__NO_SIDE_EFFECTS__\nfunction checkItems(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"check_items\",\n    reference: checkItems,\n    async: false,\n    expects: null,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        for (let index = 0; index < dataset.value.length; index++) {\n          const item = dataset.value[index];\n          if (!this.requirement(item, index, dataset.value)) {\n            _addIssue(this, \"item\", dataset, config2, {\n              input: item,\n              path: [\n                {\n                  type: \"array\",\n                  origin: \"value\",\n                  input: dataset.value,\n                  key: index,\n                  value: item\n                }\n              ]\n            });\n          }\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/checkItems/checkItemsAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction checkItemsAsync(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"check_items\",\n    reference: checkItemsAsync,\n    async: true,\n    expects: null,\n    requirement,\n    message: message2,\n    async \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const requirementResults = await Promise.all(\n          dataset.value.map(this.requirement)\n        );\n        for (let index = 0; index < dataset.value.length; index++) {\n          if (!requirementResults[index]) {\n            const item = dataset.value[index];\n            _addIssue(this, \"item\", dataset, config2, {\n              input: item,\n              path: [\n                {\n                  type: \"array\",\n                  origin: \"value\",\n                  input: dataset.value,\n                  key: index,\n                  value: item\n                }\n              ]\n            });\n          }\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/creditCard/creditCard.ts\nvar CREDIT_CARD_REGEX = /^(?:\\d{14,19}|\\d{4}(?: \\d{3,6}){2,4}|\\d{4}(?:-\\d{3,6}){2,4})$/u;\nvar SANITIZE_REGEX = /[- ]/gu;\nvar PROVIDER_REGEX_LIST = [\n  // American Express\n  /^3[47]\\d{13}$/u,\n  // Diners Club\n  /^3(?:0[0-5]|[68]\\d)\\d{11,13}$/u,\n  // Discover\n  /^6(?:011|5\\d{2})\\d{12,15}$/u,\n  // JCB\n  /^(?:2131|1800|35\\d{3})\\d{11}$/u,\n  // Mastercard\n  // eslint-disable-next-line redos-detector/no-unsafe-regex\n  /^5[1-5]\\d{2}|(?:222\\d|22[3-9]\\d|2[3-6]\\d{2}|27[01]\\d|2720)\\d{12}$/u,\n  // UnionPay\n  /^(?:6[27]\\d{14,17}|81\\d{14,17})$/u,\n  // Visa\n  /^4\\d{12}(?:\\d{3,6})?$/u\n];\n// @__NO_SIDE_EFFECTS__\nfunction creditCard(message2) {\n  return {\n    kind: \"validation\",\n    type: \"credit_card\",\n    reference: creditCard,\n    async: false,\n    expects: null,\n    requirement(input) {\n      let sanitized;\n      return CREDIT_CARD_REGEX.test(input) && // Remove any hyphens and blanks\n      (sanitized = input.replace(SANITIZE_REGEX, \"\")) && // Check if it matches a provider\n      PROVIDER_REGEX_LIST.some((regex2) => regex2.test(sanitized)) && // Check if passes luhn algorithm\n      _isLuhnAlgo(sanitized);\n    },\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement(dataset.value)) {\n        _addIssue(this, \"credit card\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/cuid2/cuid2.ts\n// @__NO_SIDE_EFFECTS__\nfunction cuid2(message2) {\n  return {\n    kind: \"validation\",\n    type: \"cuid2\",\n    reference: cuid2,\n    async: false,\n    expects: null,\n    requirement: CUID2_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"Cuid2\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/decimal/decimal.ts\n// @__NO_SIDE_EFFECTS__\nfunction decimal(message2) {\n  return {\n    kind: \"validation\",\n    type: \"decimal\",\n    reference: decimal,\n    async: false,\n    expects: null,\n    requirement: DECIMAL_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"decimal\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/description/description.ts\n// @__NO_SIDE_EFFECTS__\nfunction description(description_) {\n  return {\n    kind: \"metadata\",\n    type: \"description\",\n    reference: description,\n    description: description_\n  };\n}\n\n// src/actions/digits/digits.ts\n// @__NO_SIDE_EFFECTS__\nfunction digits(message2) {\n  return {\n    kind: \"validation\",\n    type: \"digits\",\n    reference: digits,\n    async: false,\n    expects: null,\n    requirement: DIGITS_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"digits\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/email/email.ts\n// @__NO_SIDE_EFFECTS__\nfunction email(message2) {\n  return {\n    kind: \"validation\",\n    type: \"email\",\n    reference: email,\n    expects: null,\n    async: false,\n    requirement: EMAIL_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"email\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/emoji/emoji.ts\n// @__NO_SIDE_EFFECTS__\nfunction emoji(message2) {\n  return {\n    kind: \"validation\",\n    type: \"emoji\",\n    reference: emoji,\n    async: false,\n    expects: null,\n    requirement: EMOJI_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"emoji\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/empty/empty.ts\n// @__NO_SIDE_EFFECTS__\nfunction empty(message2) {\n  return {\n    kind: \"validation\",\n    type: \"empty\",\n    reference: empty,\n    async: false,\n    expects: \"0\",\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.length > 0) {\n        _addIssue(this, \"length\", dataset, config2, {\n          received: `${dataset.value.length}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/endsWith/endsWith.ts\n// @__NO_SIDE_EFFECTS__\nfunction endsWith(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"ends_with\",\n    reference: endsWith,\n    async: false,\n    expects: `\"${requirement}\"`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !dataset.value.endsWith(this.requirement)) {\n        _addIssue(this, \"end\", dataset, config2, {\n          received: `\"${dataset.value.slice(-this.requirement.length)}\"`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/entries/entries.ts\n// @__NO_SIDE_EFFECTS__\nfunction entries(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"entries\",\n    reference: entries,\n    async: false,\n    expects: `${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (!dataset.typed) return dataset;\n      const count = Object.keys(dataset.value).length;\n      if (dataset.typed && count !== this.requirement) {\n        _addIssue(this, \"entries\", dataset, config2, {\n          received: `${count}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/everyItem/everyItem.ts\n// @__NO_SIDE_EFFECTS__\nfunction everyItem(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"every_item\",\n    reference: everyItem,\n    async: false,\n    expects: null,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !dataset.value.every(this.requirement)) {\n        _addIssue(this, \"item\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/excludes/excludes.ts\n// @__NO_SIDE_EFFECTS__\nfunction excludes(requirement, message2) {\n  const received = _stringify(requirement);\n  return {\n    kind: \"validation\",\n    type: \"excludes\",\n    reference: excludes,\n    async: false,\n    expects: `!${received}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.includes(this.requirement)) {\n        _addIssue(this, \"content\", dataset, config2, { received });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/filterItems/filterItems.ts\n// @__NO_SIDE_EFFECTS__\nfunction filterItems(operation) {\n  return {\n    kind: \"transformation\",\n    type: \"filter_items\",\n    reference: filterItems,\n    async: false,\n    operation,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.filter(this.operation);\n      return dataset;\n    }\n  };\n}\n\n// src/actions/findItem/findItem.ts\n// @__NO_SIDE_EFFECTS__\nfunction findItem(operation) {\n  return {\n    kind: \"transformation\",\n    type: \"find_item\",\n    reference: findItem,\n    async: false,\n    operation,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.find(this.operation);\n      return dataset;\n    }\n  };\n}\n\n// src/actions/finite/finite.ts\n// @__NO_SIDE_EFFECTS__\nfunction finite(message2) {\n  return {\n    kind: \"validation\",\n    type: \"finite\",\n    reference: finite,\n    async: false,\n    expects: null,\n    requirement: Number.isFinite,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement(dataset.value)) {\n        _addIssue(this, \"finite\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/flavor/flavor.ts\n// @__NO_SIDE_EFFECTS__\nfunction flavor(name) {\n  return {\n    kind: \"transformation\",\n    type: \"flavor\",\n    reference: flavor,\n    async: false,\n    name,\n    \"~run\"(dataset) {\n      return dataset;\n    }\n  };\n}\n\n// src/actions/graphemes/graphemes.ts\n// @__NO_SIDE_EFFECTS__\nfunction graphemes(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"graphemes\",\n    reference: graphemes,\n    async: false,\n    expects: `${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const count = _getGraphemeCount(dataset.value);\n        if (count !== this.requirement) {\n          _addIssue(this, \"graphemes\", dataset, config2, {\n            received: `${count}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/gtValue/gtValue.ts\n// @__NO_SIDE_EFFECTS__\nfunction gtValue(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"gt_value\",\n    reference: gtValue,\n    async: false,\n    expects: `>${requirement instanceof Date ? requirement.toJSON() : _stringify(requirement)}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !(dataset.value > this.requirement)) {\n        _addIssue(this, \"value\", dataset, config2, {\n          received: dataset.value instanceof Date ? dataset.value.toJSON() : _stringify(dataset.value)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/hash/hash.ts\nvar HASH_LENGTHS = {\n  md4: 32,\n  md5: 32,\n  sha1: 40,\n  sha256: 64,\n  sha384: 96,\n  sha512: 128,\n  ripemd128: 32,\n  ripemd160: 40,\n  tiger128: 32,\n  tiger160: 40,\n  tiger192: 48,\n  crc32: 8,\n  crc32b: 8,\n  adler32: 8\n};\n// @__NO_SIDE_EFFECTS__\nfunction hash(types, message2) {\n  return {\n    kind: \"validation\",\n    type: \"hash\",\n    reference: hash,\n    expects: null,\n    async: false,\n    requirement: RegExp(\n      types.map((type) => `^[a-f0-9]{${HASH_LENGTHS[type]}}$`).join(\"|\"),\n      \"iu\"\n    ),\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"hash\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/hexadecimal/hexadecimal.ts\n// @__NO_SIDE_EFFECTS__\nfunction hexadecimal(message2) {\n  return {\n    kind: \"validation\",\n    type: \"hexadecimal\",\n    reference: hexadecimal,\n    async: false,\n    expects: null,\n    requirement: HEXADECIMAL_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"hexadecimal\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/hexColor/hexColor.ts\n// @__NO_SIDE_EFFECTS__\nfunction hexColor(message2) {\n  return {\n    kind: \"validation\",\n    type: \"hex_color\",\n    reference: hexColor,\n    async: false,\n    expects: null,\n    requirement: HEX_COLOR_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"hex color\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/imei/imei.ts\n// @__NO_SIDE_EFFECTS__\nfunction imei(message2) {\n  return {\n    kind: \"validation\",\n    type: \"imei\",\n    reference: imei,\n    async: false,\n    expects: null,\n    requirement(input) {\n      return IMEI_REGEX.test(input) && _isLuhnAlgo(input);\n    },\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement(dataset.value)) {\n        _addIssue(this, \"IMEI\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/includes/includes.ts\n// @__NO_SIDE_EFFECTS__\nfunction includes(requirement, message2) {\n  const expects = _stringify(requirement);\n  return {\n    kind: \"validation\",\n    type: \"includes\",\n    reference: includes,\n    async: false,\n    expects,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !dataset.value.includes(this.requirement)) {\n        _addIssue(this, \"content\", dataset, config2, {\n          received: `!${expects}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/integer/integer.ts\n// @__NO_SIDE_EFFECTS__\nfunction integer(message2) {\n  return {\n    kind: \"validation\",\n    type: \"integer\",\n    reference: integer,\n    async: false,\n    expects: null,\n    requirement: Number.isInteger,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement(dataset.value)) {\n        _addIssue(this, \"integer\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/ip/ip.ts\n// @__NO_SIDE_EFFECTS__\nfunction ip(message2) {\n  return {\n    kind: \"validation\",\n    type: \"ip\",\n    reference: ip,\n    async: false,\n    expects: null,\n    requirement: IP_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"IP\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/ipv4/ipv4.ts\n// @__NO_SIDE_EFFECTS__\nfunction ipv4(message2) {\n  return {\n    kind: \"validation\",\n    type: \"ipv4\",\n    reference: ipv4,\n    async: false,\n    expects: null,\n    requirement: IPV4_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"IPv4\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/ipv6/ipv6.ts\n// @__NO_SIDE_EFFECTS__\nfunction ipv6(message2) {\n  return {\n    kind: \"validation\",\n    type: \"ipv6\",\n    reference: ipv6,\n    async: false,\n    expects: null,\n    requirement: IPV6_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"IPv6\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/isoDate/isoDate.ts\n// @__NO_SIDE_EFFECTS__\nfunction isoDate(message2) {\n  return {\n    kind: \"validation\",\n    type: \"iso_date\",\n    reference: isoDate,\n    async: false,\n    expects: null,\n    requirement: ISO_DATE_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"date\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/isoDateTime/isoDateTime.ts\n// @__NO_SIDE_EFFECTS__\nfunction isoDateTime(message2) {\n  return {\n    kind: \"validation\",\n    type: \"iso_date_time\",\n    reference: isoDateTime,\n    async: false,\n    expects: null,\n    requirement: ISO_DATE_TIME_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"date-time\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/isoTime/isoTime.ts\n// @__NO_SIDE_EFFECTS__\nfunction isoTime(message2) {\n  return {\n    kind: \"validation\",\n    type: \"iso_time\",\n    reference: isoTime,\n    async: false,\n    expects: null,\n    requirement: ISO_TIME_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"time\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/isoTimeSecond/isoTimeSecond.ts\n// @__NO_SIDE_EFFECTS__\nfunction isoTimeSecond(message2) {\n  return {\n    kind: \"validation\",\n    type: \"iso_time_second\",\n    reference: isoTimeSecond,\n    async: false,\n    expects: null,\n    requirement: ISO_TIME_SECOND_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"time-second\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/isoTimestamp/isoTimestamp.ts\n// @__NO_SIDE_EFFECTS__\nfunction isoTimestamp(message2) {\n  return {\n    kind: \"validation\",\n    type: \"iso_timestamp\",\n    reference: isoTimestamp,\n    async: false,\n    expects: null,\n    requirement: ISO_TIMESTAMP_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"timestamp\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/isoWeek/isoWeek.ts\n// @__NO_SIDE_EFFECTS__\nfunction isoWeek(message2) {\n  return {\n    kind: \"validation\",\n    type: \"iso_week\",\n    reference: isoWeek,\n    async: false,\n    expects: null,\n    requirement: ISO_WEEK_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"week\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/length/length.ts\n// @__NO_SIDE_EFFECTS__\nfunction length(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"length\",\n    reference: length,\n    async: false,\n    expects: `${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.length !== this.requirement) {\n        _addIssue(this, \"length\", dataset, config2, {\n          received: `${dataset.value.length}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/ltValue/ltValue.ts\n// @__NO_SIDE_EFFECTS__\nfunction ltValue(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"lt_value\",\n    reference: ltValue,\n    async: false,\n    expects: `<${requirement instanceof Date ? requirement.toJSON() : _stringify(requirement)}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !(dataset.value < this.requirement)) {\n        _addIssue(this, \"value\", dataset, config2, {\n          received: dataset.value instanceof Date ? dataset.value.toJSON() : _stringify(dataset.value)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/mac/mac.ts\n// @__NO_SIDE_EFFECTS__\nfunction mac(message2) {\n  return {\n    kind: \"validation\",\n    type: \"mac\",\n    reference: mac,\n    async: false,\n    expects: null,\n    requirement: MAC_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"MAC\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/mac48/mac48.ts\n// @__NO_SIDE_EFFECTS__\nfunction mac48(message2) {\n  return {\n    kind: \"validation\",\n    type: \"mac48\",\n    reference: mac48,\n    async: false,\n    expects: null,\n    requirement: MAC48_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"48-bit MAC\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/mac64/mac64.ts\n// @__NO_SIDE_EFFECTS__\nfunction mac64(message2) {\n  return {\n    kind: \"validation\",\n    type: \"mac64\",\n    reference: mac64,\n    async: false,\n    expects: null,\n    requirement: MAC64_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"64-bit MAC\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/mapItems/mapItems.ts\n// @__NO_SIDE_EFFECTS__\nfunction mapItems(operation) {\n  return {\n    kind: \"transformation\",\n    type: \"map_items\",\n    reference: mapItems,\n    async: false,\n    operation,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.map(this.operation);\n      return dataset;\n    }\n  };\n}\n\n// src/actions/maxBytes/maxBytes.ts\n// @__NO_SIDE_EFFECTS__\nfunction maxBytes(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"max_bytes\",\n    reference: maxBytes,\n    async: false,\n    expects: `<=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const length2 = _getByteCount(dataset.value);\n        if (length2 > this.requirement) {\n          _addIssue(this, \"bytes\", dataset, config2, {\n            received: `${length2}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/maxEntries/maxEntries.ts\n// @__NO_SIDE_EFFECTS__\nfunction maxEntries(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"max_entries\",\n    reference: maxEntries,\n    async: false,\n    expects: `<=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (!dataset.typed) return dataset;\n      const count = Object.keys(dataset.value).length;\n      if (dataset.typed && count > this.requirement) {\n        _addIssue(this, \"entries\", dataset, config2, {\n          received: `${count}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/maxGraphemes/maxGraphemes.ts\n// @__NO_SIDE_EFFECTS__\nfunction maxGraphemes(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"max_graphemes\",\n    reference: maxGraphemes,\n    async: false,\n    expects: `<=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const count = _getGraphemeCount(dataset.value);\n        if (count > this.requirement) {\n          _addIssue(this, \"graphemes\", dataset, config2, {\n            received: `${count}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/maxLength/maxLength.ts\n// @__NO_SIDE_EFFECTS__\nfunction maxLength(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"max_length\",\n    reference: maxLength,\n    async: false,\n    expects: `<=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.length > this.requirement) {\n        _addIssue(this, \"length\", dataset, config2, {\n          received: `${dataset.value.length}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/maxSize/maxSize.ts\n// @__NO_SIDE_EFFECTS__\nfunction maxSize(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"max_size\",\n    reference: maxSize,\n    async: false,\n    expects: `<=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.size > this.requirement) {\n        _addIssue(this, \"size\", dataset, config2, {\n          received: `${dataset.value.size}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/maxValue/maxValue.ts\n// @__NO_SIDE_EFFECTS__\nfunction maxValue(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"max_value\",\n    reference: maxValue,\n    async: false,\n    expects: `<=${requirement instanceof Date ? requirement.toJSON() : _stringify(requirement)}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !(dataset.value <= this.requirement)) {\n        _addIssue(this, \"value\", dataset, config2, {\n          received: dataset.value instanceof Date ? dataset.value.toJSON() : _stringify(dataset.value)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/maxWords/maxWords.ts\n// @__NO_SIDE_EFFECTS__\nfunction maxWords(locales, requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"max_words\",\n    reference: maxWords,\n    async: false,\n    expects: `<=${requirement}`,\n    locales,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const count = _getWordCount(this.locales, dataset.value);\n        if (count > this.requirement) {\n          _addIssue(this, \"words\", dataset, config2, {\n            received: `${count}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/metadata/metadata.ts\n// @__NO_SIDE_EFFECTS__\nfunction metadata(metadata_) {\n  return {\n    kind: \"metadata\",\n    type: \"metadata\",\n    reference: metadata,\n    metadata: metadata_\n  };\n}\n\n// src/actions/mimeType/mimeType.ts\n// @__NO_SIDE_EFFECTS__\nfunction mimeType(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"mime_type\",\n    reference: mimeType,\n    async: false,\n    expects: _joinExpects(\n      requirement.map((option) => `\"${option}\"`),\n      \"|\"\n    ),\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.includes(dataset.value.type)) {\n        _addIssue(this, \"MIME type\", dataset, config2, {\n          received: `\"${dataset.value.type}\"`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/minBytes/minBytes.ts\n// @__NO_SIDE_EFFECTS__\nfunction minBytes(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"min_bytes\",\n    reference: minBytes,\n    async: false,\n    expects: `>=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const length2 = _getByteCount(dataset.value);\n        if (length2 < this.requirement) {\n          _addIssue(this, \"bytes\", dataset, config2, {\n            received: `${length2}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/minEntries/minEntries.ts\n// @__NO_SIDE_EFFECTS__\nfunction minEntries(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"min_entries\",\n    reference: minEntries,\n    async: false,\n    expects: `>=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (!dataset.typed) return dataset;\n      const count = Object.keys(dataset.value).length;\n      if (dataset.typed && count < this.requirement) {\n        _addIssue(this, \"entries\", dataset, config2, {\n          received: `${count}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/minGraphemes/minGraphemes.ts\n// @__NO_SIDE_EFFECTS__\nfunction minGraphemes(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"min_graphemes\",\n    reference: minGraphemes,\n    async: false,\n    expects: `>=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const count = _getGraphemeCount(dataset.value);\n        if (count < this.requirement) {\n          _addIssue(this, \"graphemes\", dataset, config2, {\n            received: `${count}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/minLength/minLength.ts\n// @__NO_SIDE_EFFECTS__\nfunction minLength(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"min_length\",\n    reference: minLength,\n    async: false,\n    expects: `>=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.length < this.requirement) {\n        _addIssue(this, \"length\", dataset, config2, {\n          received: `${dataset.value.length}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/minSize/minSize.ts\n// @__NO_SIDE_EFFECTS__\nfunction minSize(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"min_size\",\n    reference: minSize,\n    async: false,\n    expects: `>=${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.size < this.requirement) {\n        _addIssue(this, \"size\", dataset, config2, {\n          received: `${dataset.value.size}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/minValue/minValue.ts\n// @__NO_SIDE_EFFECTS__\nfunction minValue(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"min_value\",\n    reference: minValue,\n    async: false,\n    expects: `>=${requirement instanceof Date ? requirement.toJSON() : _stringify(requirement)}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !(dataset.value >= this.requirement)) {\n        _addIssue(this, \"value\", dataset, config2, {\n          received: dataset.value instanceof Date ? dataset.value.toJSON() : _stringify(dataset.value)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/minWords/minWords.ts\n// @__NO_SIDE_EFFECTS__\nfunction minWords(locales, requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"min_words\",\n    reference: minWords,\n    async: false,\n    expects: `>=${requirement}`,\n    locales,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const count = _getWordCount(this.locales, dataset.value);\n        if (count < this.requirement) {\n          _addIssue(this, \"words\", dataset, config2, {\n            received: `${count}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/multipleOf/multipleOf.ts\n// @__NO_SIDE_EFFECTS__\nfunction multipleOf(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"multiple_of\",\n    reference: multipleOf,\n    async: false,\n    expects: `%${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value % this.requirement != 0) {\n        _addIssue(this, \"multiple\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/nanoid/nanoid.ts\n// @__NO_SIDE_EFFECTS__\nfunction nanoid(message2) {\n  return {\n    kind: \"validation\",\n    type: \"nanoid\",\n    reference: nanoid,\n    async: false,\n    expects: null,\n    requirement: NANO_ID_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"Nano ID\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/nonEmpty/nonEmpty.ts\n// @__NO_SIDE_EFFECTS__\nfunction nonEmpty(message2) {\n  return {\n    kind: \"validation\",\n    type: \"non_empty\",\n    reference: nonEmpty,\n    async: false,\n    expects: \"!0\",\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.length === 0) {\n        _addIssue(this, \"length\", dataset, config2, {\n          received: \"0\"\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/normalize/normalize.ts\n// @__NO_SIDE_EFFECTS__\nfunction normalize(form) {\n  return {\n    kind: \"transformation\",\n    type: \"normalize\",\n    reference: normalize,\n    async: false,\n    form,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.normalize(this.form);\n      return dataset;\n    }\n  };\n}\n\n// src/actions/notBytes/notBytes.ts\n// @__NO_SIDE_EFFECTS__\nfunction notBytes(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"not_bytes\",\n    reference: notBytes,\n    async: false,\n    expects: `!${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const length2 = _getByteCount(dataset.value);\n        if (length2 === this.requirement) {\n          _addIssue(this, \"bytes\", dataset, config2, {\n            received: `${length2}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/notEntries/notEntries.ts\n// @__NO_SIDE_EFFECTS__\nfunction notEntries(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"not_entries\",\n    reference: notEntries,\n    async: false,\n    expects: `!${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (!dataset.typed) return dataset;\n      const count = Object.keys(dataset.value).length;\n      if (dataset.typed && count === this.requirement) {\n        _addIssue(this, \"entries\", dataset, config2, {\n          received: `${count}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/notGraphemes/notGraphemes.ts\n// @__NO_SIDE_EFFECTS__\nfunction notGraphemes(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"not_graphemes\",\n    reference: notGraphemes,\n    async: false,\n    expects: `!${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const count = _getGraphemeCount(dataset.value);\n        if (count === this.requirement) {\n          _addIssue(this, \"graphemes\", dataset, config2, {\n            received: `${count}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/notLength/notLength.ts\n// @__NO_SIDE_EFFECTS__\nfunction notLength(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"not_length\",\n    reference: notLength,\n    async: false,\n    expects: `!${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.length === this.requirement) {\n        _addIssue(this, \"length\", dataset, config2, {\n          received: `${dataset.value.length}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/notSize/notSize.ts\n// @__NO_SIDE_EFFECTS__\nfunction notSize(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"not_size\",\n    reference: notSize,\n    async: false,\n    expects: `!${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.size === this.requirement) {\n        _addIssue(this, \"size\", dataset, config2, {\n          received: `${dataset.value.size}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/notValue/notValue.ts\n// @__NO_SIDE_EFFECTS__\nfunction notValue(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"not_value\",\n    reference: notValue,\n    async: false,\n    expects: requirement instanceof Date ? `!${requirement.toJSON()}` : `!${_stringify(requirement)}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && this.requirement <= dataset.value && this.requirement >= dataset.value) {\n        _addIssue(this, \"value\", dataset, config2, {\n          received: dataset.value instanceof Date ? dataset.value.toJSON() : _stringify(dataset.value)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/notValues/notValues.ts\n// @__NO_SIDE_EFFECTS__\nfunction notValues(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"not_values\",\n    reference: notValues,\n    async: false,\n    expects: `!${_joinExpects(\n      requirement.map(\n        (value2) => value2 instanceof Date ? value2.toJSON() : _stringify(value2)\n      ),\n      \"|\"\n    )}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && this.requirement.some(\n        (value2) => value2 <= dataset.value && value2 >= dataset.value\n      )) {\n        _addIssue(this, \"value\", dataset, config2, {\n          received: dataset.value instanceof Date ? dataset.value.toJSON() : _stringify(dataset.value)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/notWords/notWords.ts\n// @__NO_SIDE_EFFECTS__\nfunction notWords(locales, requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"not_words\",\n    reference: notWords,\n    async: false,\n    expects: `!${requirement}`,\n    locales,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const count = _getWordCount(this.locales, dataset.value);\n        if (count === this.requirement) {\n          _addIssue(this, \"words\", dataset, config2, {\n            received: `${count}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/octal/octal.ts\n// @__NO_SIDE_EFFECTS__\nfunction octal(message2) {\n  return {\n    kind: \"validation\",\n    type: \"octal\",\n    reference: octal,\n    async: false,\n    expects: null,\n    requirement: OCTAL_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"octal\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/parseJson/parseJson.ts\n// @__NO_SIDE_EFFECTS__\nfunction parseJson(config2, message2) {\n  return {\n    kind: \"transformation\",\n    type: \"parse_json\",\n    reference: parseJson,\n    config: config2,\n    message: message2,\n    async: false,\n    \"~run\"(dataset, config3) {\n      try {\n        dataset.value = JSON.parse(dataset.value, this.config?.reviver);\n      } catch (error) {\n        if (error instanceof Error) {\n          _addIssue(this, \"JSON\", dataset, config3, {\n            received: `\"${error.message}\"`\n          });\n          dataset.typed = false;\n        } else {\n          throw error;\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/partialCheck/utils/_isPartiallyTyped/_isPartiallyTyped.ts\n// @__NO_SIDE_EFFECTS__\nfunction _isPartiallyTyped(dataset, paths) {\n  if (dataset.issues) {\n    for (const path of paths) {\n      for (const issue of dataset.issues) {\n        let typed = false;\n        const bound = Math.min(path.length, issue.path?.length ?? 0);\n        for (let index = 0; index < bound; index++) {\n          if (\n            // @ts-expect-error\n            path[index] !== issue.path[index].key && // @ts-expect-error\n            (path[index] !== \"$\" || issue.path[index].type !== \"array\")\n          ) {\n            typed = true;\n            break;\n          }\n        }\n        if (!typed) {\n          return false;\n        }\n      }\n    }\n  }\n  return true;\n}\n\n// src/actions/partialCheck/partialCheck.ts\n// @__NO_SIDE_EFFECTS__\nfunction partialCheck(paths, requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"partial_check\",\n    reference: partialCheck,\n    async: false,\n    expects: null,\n    paths,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if ((dataset.typed || _isPartiallyTyped(dataset, paths)) && // @ts-expect-error\n      !this.requirement(dataset.value)) {\n        _addIssue(this, \"input\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/partialCheck/partialCheckAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction partialCheckAsync(paths, requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"partial_check\",\n    reference: partialCheckAsync,\n    async: true,\n    expects: null,\n    paths,\n    requirement,\n    message: message2,\n    async \"~run\"(dataset, config2) {\n      if ((dataset.typed || _isPartiallyTyped(dataset, paths)) && // @ts-expect-error\n      !await this.requirement(dataset.value)) {\n        _addIssue(this, \"input\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/rawCheck/rawCheck.ts\n// @__NO_SIDE_EFFECTS__\nfunction rawCheck(action) {\n  return {\n    kind: \"validation\",\n    type: \"raw_check\",\n    reference: rawCheck,\n    async: false,\n    expects: null,\n    \"~run\"(dataset, config2) {\n      action({\n        dataset,\n        config: config2,\n        addIssue: (info) => _addIssue(this, info?.label ?? \"input\", dataset, config2, info)\n      });\n      return dataset;\n    }\n  };\n}\n\n// src/actions/rawCheck/rawCheckAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction rawCheckAsync(action) {\n  return {\n    kind: \"validation\",\n    type: \"raw_check\",\n    reference: rawCheckAsync,\n    async: true,\n    expects: null,\n    async \"~run\"(dataset, config2) {\n      await action({\n        dataset,\n        config: config2,\n        addIssue: (info) => _addIssue(this, info?.label ?? \"input\", dataset, config2, info)\n      });\n      return dataset;\n    }\n  };\n}\n\n// src/actions/rawTransform/rawTransform.ts\n// @__NO_SIDE_EFFECTS__\nfunction rawTransform(action) {\n  return {\n    kind: \"transformation\",\n    type: \"raw_transform\",\n    reference: rawTransform,\n    async: false,\n    \"~run\"(dataset, config2) {\n      const output = action({\n        dataset,\n        config: config2,\n        addIssue: (info) => _addIssue(this, info?.label ?? \"input\", dataset, config2, info),\n        NEVER: null\n      });\n      if (dataset.issues) {\n        dataset.typed = false;\n      } else {\n        dataset.value = output;\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/rawTransform/rawTransformAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction rawTransformAsync(action) {\n  return {\n    kind: \"transformation\",\n    type: \"raw_transform\",\n    reference: rawTransformAsync,\n    async: true,\n    async \"~run\"(dataset, config2) {\n      const output = await action({\n        dataset,\n        config: config2,\n        addIssue: (info) => _addIssue(this, info?.label ?? \"input\", dataset, config2, info),\n        NEVER: null\n      });\n      if (dataset.issues) {\n        dataset.typed = false;\n      } else {\n        dataset.value = output;\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/readonly/readonly.ts\n// @__NO_SIDE_EFFECTS__\nfunction readonly() {\n  return {\n    kind: \"transformation\",\n    type: \"readonly\",\n    reference: readonly,\n    async: false,\n    \"~run\"(dataset) {\n      return dataset;\n    }\n  };\n}\n\n// src/actions/reduceItems/reduceItems.ts\n// @__NO_SIDE_EFFECTS__\nfunction reduceItems(operation, initial) {\n  return {\n    kind: \"transformation\",\n    type: \"reduce_items\",\n    reference: reduceItems,\n    async: false,\n    operation,\n    initial,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.reduce(this.operation, this.initial);\n      return dataset;\n    }\n  };\n}\n\n// src/actions/regex/regex.ts\n// @__NO_SIDE_EFFECTS__\nfunction regex(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"regex\",\n    reference: regex,\n    async: false,\n    expects: `${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"format\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/returns/returns.ts\n// @__NO_SIDE_EFFECTS__\nfunction returns(schema) {\n  return {\n    kind: \"transformation\",\n    type: \"returns\",\n    reference: returns,\n    async: false,\n    schema,\n    \"~run\"(dataset, config2) {\n      const func = dataset.value;\n      dataset.value = (...args_) => {\n        const returnsDataset = this.schema[\"~run\"](\n          { value: func(...args_) },\n          config2\n        );\n        if (returnsDataset.issues) {\n          throw new ValiError(returnsDataset.issues);\n        }\n        return returnsDataset.value;\n      };\n      return dataset;\n    }\n  };\n}\n\n// src/actions/returns/returnsAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction returnsAsync(schema) {\n  return {\n    kind: \"transformation\",\n    type: \"returns\",\n    reference: returnsAsync,\n    async: false,\n    schema,\n    \"~run\"(dataset, config2) {\n      const func = dataset.value;\n      dataset.value = async (...args_) => {\n        const returnsDataset = await this.schema[\"~run\"](\n          { value: await func(...args_) },\n          config2\n        );\n        if (returnsDataset.issues) {\n          throw new ValiError(returnsDataset.issues);\n        }\n        return returnsDataset.value;\n      };\n      return dataset;\n    }\n  };\n}\n\n// src/actions/rfcEmail/rfcEmail.ts\n// @__NO_SIDE_EFFECTS__\nfunction rfcEmail(message2) {\n  return {\n    kind: \"validation\",\n    type: \"rfc_email\",\n    reference: rfcEmail,\n    expects: null,\n    async: false,\n    requirement: RFC_EMAIL_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"email\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/safeInteger/safeInteger.ts\n// @__NO_SIDE_EFFECTS__\nfunction safeInteger(message2) {\n  return {\n    kind: \"validation\",\n    type: \"safe_integer\",\n    reference: safeInteger,\n    async: false,\n    expects: null,\n    requirement: Number.isSafeInteger,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement(dataset.value)) {\n        _addIssue(this, \"safe integer\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/size/size.ts\n// @__NO_SIDE_EFFECTS__\nfunction size(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"size\",\n    reference: size,\n    async: false,\n    expects: `${requirement}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && dataset.value.size !== this.requirement) {\n        _addIssue(this, \"size\", dataset, config2, {\n          received: `${dataset.value.size}`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/slug/slug.ts\n// @__NO_SIDE_EFFECTS__\nfunction slug(message2) {\n  return {\n    kind: \"validation\",\n    type: \"slug\",\n    reference: slug,\n    async: false,\n    expects: null,\n    requirement: SLUG_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"slug\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/someItem/someItem.ts\n// @__NO_SIDE_EFFECTS__\nfunction someItem(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"some_item\",\n    reference: someItem,\n    async: false,\n    expects: null,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !dataset.value.some(this.requirement)) {\n        _addIssue(this, \"item\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/sortItems/sortItems.ts\n// @__NO_SIDE_EFFECTS__\nfunction sortItems(operation) {\n  return {\n    kind: \"transformation\",\n    type: \"sort_items\",\n    reference: sortItems,\n    async: false,\n    operation,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.sort(this.operation);\n      return dataset;\n    }\n  };\n}\n\n// src/actions/startsWith/startsWith.ts\n// @__NO_SIDE_EFFECTS__\nfunction startsWith(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"starts_with\",\n    reference: startsWith,\n    async: false,\n    expects: `\"${requirement}\"`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !dataset.value.startsWith(this.requirement)) {\n        _addIssue(this, \"start\", dataset, config2, {\n          received: `\"${dataset.value.slice(0, this.requirement.length)}\"`\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/stringifyJson/stringifyJson.ts\n// @__NO_SIDE_EFFECTS__\nfunction stringifyJson(config2, message2) {\n  return {\n    kind: \"transformation\",\n    type: \"stringify_json\",\n    reference: stringifyJson,\n    message: message2,\n    config: config2,\n    async: false,\n    \"~run\"(dataset, config3) {\n      try {\n        const output = JSON.stringify(\n          dataset.value,\n          // @ts-expect-error\n          this.config?.replacer,\n          this.config?.space\n        );\n        if (output === void 0) {\n          _addIssue(this, \"JSON\", dataset, config3);\n          dataset.typed = false;\n        }\n        dataset.value = output;\n      } catch (error) {\n        if (error instanceof Error) {\n          _addIssue(this, \"JSON\", dataset, config3, {\n            received: `\"${error.message}\"`\n          });\n          dataset.typed = false;\n        } else {\n          throw error;\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/title/title.ts\n// @__NO_SIDE_EFFECTS__\nfunction title(title_) {\n  return {\n    kind: \"metadata\",\n    type: \"title\",\n    reference: title,\n    title: title_\n  };\n}\n\n// src/actions/toLowerCase/toLowerCase.ts\n// @__NO_SIDE_EFFECTS__\nfunction toLowerCase() {\n  return {\n    kind: \"transformation\",\n    type: \"to_lower_case\",\n    reference: toLowerCase,\n    async: false,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.toLowerCase();\n      return dataset;\n    }\n  };\n}\n\n// src/actions/toMaxValue/toMaxValue.ts\n// @__NO_SIDE_EFFECTS__\nfunction toMaxValue(requirement) {\n  return {\n    kind: \"transformation\",\n    type: \"to_max_value\",\n    reference: toMaxValue,\n    async: false,\n    requirement,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value > this.requirement ? this.requirement : dataset.value;\n      return dataset;\n    }\n  };\n}\n\n// src/actions/toMinValue/toMinValue.ts\n// @__NO_SIDE_EFFECTS__\nfunction toMinValue(requirement) {\n  return {\n    kind: \"transformation\",\n    type: \"to_min_value\",\n    reference: toMinValue,\n    async: false,\n    requirement,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value < this.requirement ? this.requirement : dataset.value;\n      return dataset;\n    }\n  };\n}\n\n// src/actions/toUpperCase/toUpperCase.ts\n// @__NO_SIDE_EFFECTS__\nfunction toUpperCase() {\n  return {\n    kind: \"transformation\",\n    type: \"to_upper_case\",\n    reference: toUpperCase,\n    async: false,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.toUpperCase();\n      return dataset;\n    }\n  };\n}\n\n// src/actions/transform/transform.ts\n// @__NO_SIDE_EFFECTS__\nfunction transform(operation) {\n  return {\n    kind: \"transformation\",\n    type: \"transform\",\n    reference: transform,\n    async: false,\n    operation,\n    \"~run\"(dataset) {\n      dataset.value = this.operation(dataset.value);\n      return dataset;\n    }\n  };\n}\n\n// src/actions/transform/transformAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction transformAsync(operation) {\n  return {\n    kind: \"transformation\",\n    type: \"transform\",\n    reference: transformAsync,\n    async: true,\n    operation,\n    async \"~run\"(dataset) {\n      dataset.value = await this.operation(dataset.value);\n      return dataset;\n    }\n  };\n}\n\n// src/actions/trim/trim.ts\n// @__NO_SIDE_EFFECTS__\nfunction trim() {\n  return {\n    kind: \"transformation\",\n    type: \"trim\",\n    reference: trim,\n    async: false,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.trim();\n      return dataset;\n    }\n  };\n}\n\n// src/actions/trimEnd/trimEnd.ts\n// @__NO_SIDE_EFFECTS__\nfunction trimEnd() {\n  return {\n    kind: \"transformation\",\n    type: \"trim_end\",\n    reference: trimEnd,\n    async: false,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.trimEnd();\n      return dataset;\n    }\n  };\n}\n\n// src/actions/trimStart/trimStart.ts\n// @__NO_SIDE_EFFECTS__\nfunction trimStart() {\n  return {\n    kind: \"transformation\",\n    type: \"trim_start\",\n    reference: trimStart,\n    async: false,\n    \"~run\"(dataset) {\n      dataset.value = dataset.value.trimStart();\n      return dataset;\n    }\n  };\n}\n\n// src/actions/ulid/ulid.ts\n// @__NO_SIDE_EFFECTS__\nfunction ulid(message2) {\n  return {\n    kind: \"validation\",\n    type: \"ulid\",\n    reference: ulid,\n    async: false,\n    expects: null,\n    requirement: ULID_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"ULID\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/url/url.ts\n// @__NO_SIDE_EFFECTS__\nfunction url(message2) {\n  return {\n    kind: \"validation\",\n    type: \"url\",\n    reference: url,\n    async: false,\n    expects: null,\n    requirement(input) {\n      try {\n        new URL(input);\n        return true;\n      } catch {\n        return false;\n      }\n    },\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement(dataset.value)) {\n        _addIssue(this, \"URL\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/uuid/uuid.ts\n// @__NO_SIDE_EFFECTS__\nfunction uuid(message2) {\n  return {\n    kind: \"validation\",\n    type: \"uuid\",\n    reference: uuid,\n    async: false,\n    expects: null,\n    requirement: UUID_REGEX,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.test(dataset.value)) {\n        _addIssue(this, \"UUID\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/value/value.ts\n// @__NO_SIDE_EFFECTS__\nfunction value(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"value\",\n    reference: value,\n    async: false,\n    expects: requirement instanceof Date ? requirement.toJSON() : _stringify(requirement),\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !(this.requirement <= dataset.value && this.requirement >= dataset.value)) {\n        _addIssue(this, \"value\", dataset, config2, {\n          received: dataset.value instanceof Date ? dataset.value.toJSON() : _stringify(dataset.value)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/values/values.ts\n// @__NO_SIDE_EFFECTS__\nfunction values(requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"values\",\n    reference: values,\n    async: false,\n    expects: `${_joinExpects(\n      requirement.map(\n        (value2) => value2 instanceof Date ? value2.toJSON() : _stringify(value2)\n      ),\n      \"|\"\n    )}`,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed && !this.requirement.some(\n        (value2) => value2 <= dataset.value && value2 >= dataset.value\n      )) {\n        _addIssue(this, \"value\", dataset, config2, {\n          received: dataset.value instanceof Date ? dataset.value.toJSON() : _stringify(dataset.value)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/actions/words/words.ts\n// @__NO_SIDE_EFFECTS__\nfunction words(locales, requirement, message2) {\n  return {\n    kind: \"validation\",\n    type: \"words\",\n    reference: words,\n    async: false,\n    expects: `${requirement}`,\n    locales,\n    requirement,\n    message: message2,\n    \"~run\"(dataset, config2) {\n      if (dataset.typed) {\n        const count = _getWordCount(this.locales, dataset.value);\n        if (count !== this.requirement) {\n          _addIssue(this, \"words\", dataset, config2, {\n            received: `${count}`\n          });\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/methods/assert/assert.ts\nfunction assert(schema, input) {\n  const issues = schema[\"~run\"]({ value: input }, { abortEarly: true }).issues;\n  if (issues) {\n    throw new ValiError(issues);\n  }\n}\n\n// src/methods/config/config.ts\n// @__NO_SIDE_EFFECTS__\nfunction config(schema, config2) {\n  return {\n    ...schema,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config_) {\n      return schema[\"~run\"](dataset, { ...config_, ...config2 });\n    }\n  };\n}\n\n// src/methods/getFallback/getFallback.ts\n// @__NO_SIDE_EFFECTS__\nfunction getFallback(schema, dataset, config2) {\n  return typeof schema.fallback === \"function\" ? (\n    // @ts-expect-error\n    schema.fallback(dataset, config2)\n  ) : (\n    // @ts-expect-error\n    schema.fallback\n  );\n}\n\n// src/methods/fallback/fallback.ts\n// @__NO_SIDE_EFFECTS__\nfunction fallback(schema, fallback2) {\n  return {\n    ...schema,\n    fallback: fallback2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const outputDataset = schema[\"~run\"](dataset, config2);\n      return outputDataset.issues ? { typed: true, value: getFallback(this, outputDataset, config2) } : outputDataset;\n    }\n  };\n}\n\n// src/methods/fallback/fallbackAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction fallbackAsync(schema, fallback2) {\n  return {\n    ...schema,\n    fallback: fallback2,\n    async: true,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const outputDataset = await schema[\"~run\"](dataset, config2);\n      return outputDataset.issues ? {\n        typed: true,\n        value: await getFallback(this, outputDataset, config2)\n      } : outputDataset;\n    }\n  };\n}\n\n// src/methods/flatten/flatten.ts\n// @__NO_SIDE_EFFECTS__\nfunction flatten(issues) {\n  const flatErrors = {};\n  for (const issue of issues) {\n    if (issue.path) {\n      const dotPath = getDotPath(issue);\n      if (dotPath) {\n        if (!flatErrors.nested) {\n          flatErrors.nested = {};\n        }\n        if (flatErrors.nested[dotPath]) {\n          flatErrors.nested[dotPath].push(issue.message);\n        } else {\n          flatErrors.nested[dotPath] = [issue.message];\n        }\n      } else {\n        if (flatErrors.other) {\n          flatErrors.other.push(issue.message);\n        } else {\n          flatErrors.other = [issue.message];\n        }\n      }\n    } else {\n      if (flatErrors.root) {\n        flatErrors.root.push(issue.message);\n      } else {\n        flatErrors.root = [issue.message];\n      }\n    }\n  }\n  return flatErrors;\n}\n\n// src/methods/forward/forward.ts\n// @__NO_SIDE_EFFECTS__\nfunction forward(action, path) {\n  return {\n    ...action,\n    \"~run\"(dataset, config2) {\n      const prevIssues = dataset.issues && [...dataset.issues];\n      dataset = action[\"~run\"](dataset, config2);\n      if (dataset.issues) {\n        for (const issue of dataset.issues) {\n          if (!prevIssues?.includes(issue)) {\n            let pathInput = dataset.value;\n            for (const key of path) {\n              const pathValue = pathInput[key];\n              const pathItem = {\n                type: \"unknown\",\n                origin: \"value\",\n                input: pathInput,\n                key,\n                value: pathValue\n              };\n              if (issue.path) {\n                issue.path.push(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              if (!pathValue) {\n                break;\n              }\n              pathInput = pathValue;\n            }\n          }\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/methods/forward/forwardAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction forwardAsync(action, path) {\n  return {\n    ...action,\n    async: true,\n    async \"~run\"(dataset, config2) {\n      const prevIssues = dataset.issues && [...dataset.issues];\n      dataset = await action[\"~run\"](dataset, config2);\n      if (dataset.issues) {\n        for (const issue of dataset.issues) {\n          if (!prevIssues?.includes(issue)) {\n            let pathInput = dataset.value;\n            for (const key of path) {\n              const pathValue = pathInput[key];\n              const pathItem = {\n                type: \"unknown\",\n                origin: \"value\",\n                input: pathInput,\n                key,\n                value: pathValue\n              };\n              if (issue.path) {\n                issue.path.push(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              if (!pathValue) {\n                break;\n              }\n              pathInput = pathValue;\n            }\n          }\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/methods/getDefault/getDefault.ts\n// @__NO_SIDE_EFFECTS__\nfunction getDefault(schema, dataset, config2) {\n  return typeof schema.default === \"function\" ? (\n    // @ts-expect-error\n    schema.default(dataset, config2)\n  ) : (\n    // @ts-expect-error\n    schema.default\n  );\n}\n\n// src/methods/getDefaults/getDefaults.ts\n// @__NO_SIDE_EFFECTS__\nfunction getDefaults(schema) {\n  if (\"entries\" in schema) {\n    const object2 = {};\n    for (const key in schema.entries) {\n      object2[key] = /* @__PURE__ */ getDefaults(schema.entries[key]);\n    }\n    return object2;\n  }\n  if (\"items\" in schema) {\n    return schema.items.map(getDefaults);\n  }\n  return getDefault(schema);\n}\n\n// src/methods/getDefaults/getDefaultsAsync.ts\n// @__NO_SIDE_EFFECTS__\nasync function getDefaultsAsync(schema) {\n  if (\"entries\" in schema) {\n    return Object.fromEntries(\n      await Promise.all(\n        Object.entries(schema.entries).map(async ([key, value2]) => [\n          key,\n          await /* @__PURE__ */ getDefaultsAsync(value2)\n        ])\n      )\n    );\n  }\n  if (\"items\" in schema) {\n    return Promise.all(schema.items.map(getDefaultsAsync));\n  }\n  return getDefault(schema);\n}\n\n// src/methods/getDescription/getDescription.ts\n// @__NO_SIDE_EFFECTS__\nfunction getDescription(schema) {\n  return _getLastMetadata(schema, \"description\");\n}\n\n// src/methods/getFallbacks/getFallbacks.ts\n// @__NO_SIDE_EFFECTS__\nfunction getFallbacks(schema) {\n  if (\"entries\" in schema) {\n    const object2 = {};\n    for (const key in schema.entries) {\n      object2[key] = /* @__PURE__ */ getFallbacks(schema.entries[key]);\n    }\n    return object2;\n  }\n  if (\"items\" in schema) {\n    return schema.items.map(getFallbacks);\n  }\n  return getFallback(schema);\n}\n\n// src/methods/getFallbacks/getFallbacksAsync.ts\n// @__NO_SIDE_EFFECTS__\nasync function getFallbacksAsync(schema) {\n  if (\"entries\" in schema) {\n    return Object.fromEntries(\n      await Promise.all(\n        Object.entries(schema.entries).map(async ([key, value2]) => [\n          key,\n          await /* @__PURE__ */ getFallbacksAsync(value2)\n        ])\n      )\n    );\n  }\n  if (\"items\" in schema) {\n    return Promise.all(schema.items.map(getFallbacksAsync));\n  }\n  return getFallback(schema);\n}\n\n// src/methods/getMetadata/getMetadata.ts\n// @__NO_SIDE_EFFECTS__\nfunction getMetadata(schema) {\n  const result = {};\n  function depthFirstMerge(schema2) {\n    if (\"pipe\" in schema2) {\n      for (const item of schema2.pipe) {\n        if (item.kind === \"schema\" && \"pipe\" in item) {\n          depthFirstMerge(item);\n        } else if (item.kind === \"metadata\" && item.type === \"metadata\") {\n          Object.assign(result, item.metadata);\n        }\n      }\n    }\n  }\n  depthFirstMerge(schema);\n  return result;\n}\n\n// src/methods/getTitle/getTitle.ts\n// @__NO_SIDE_EFFECTS__\nfunction getTitle(schema) {\n  return _getLastMetadata(schema, \"title\");\n}\n\n// src/methods/is/is.ts\n// @__NO_SIDE_EFFECTS__\nfunction is(schema, input) {\n  return !schema[\"~run\"]({ value: input }, { abortEarly: true }).issues;\n}\n\n// src/schemas/any/any.ts\n// @__NO_SIDE_EFFECTS__\nfunction any() {\n  return {\n    kind: \"schema\",\n    type: \"any\",\n    reference: any,\n    expects: \"any\",\n    async: false,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset) {\n      dataset.typed = true;\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/array/array.ts\n// @__NO_SIDE_EFFECTS__\nfunction array(item, message2) {\n  return {\n    kind: \"schema\",\n    type: \"array\",\n    reference: array,\n    expects: \"Array\",\n    async: false,\n    item,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        for (let key = 0; key < input.length; key++) {\n          const value2 = input[key];\n          const itemDataset = this.item[\"~run\"]({ value: value2 }, config2);\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/array/arrayAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction arrayAsync(item, message2) {\n  return {\n    kind: \"schema\",\n    type: \"array\",\n    reference: arrayAsync,\n    expects: \"Array\",\n    async: true,\n    item,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        const itemDatasets = await Promise.all(\n          input.map((value2) => this.item[\"~run\"]({ value: value2 }, config2))\n        );\n        for (let key = 0; key < itemDatasets.length; key++) {\n          const itemDataset = itemDatasets[key];\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: input[key]\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/bigint/bigint.ts\n// @__NO_SIDE_EFFECTS__\nfunction bigint(message2) {\n  return {\n    kind: \"schema\",\n    type: \"bigint\",\n    reference: bigint,\n    expects: \"bigint\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (typeof dataset.value === \"bigint\") {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/blob/blob.ts\n// @__NO_SIDE_EFFECTS__\nfunction blob(message2) {\n  return {\n    kind: \"schema\",\n    type: \"blob\",\n    reference: blob,\n    expects: \"Blob\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value instanceof Blob) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/boolean/boolean.ts\n// @__NO_SIDE_EFFECTS__\nfunction boolean(message2) {\n  return {\n    kind: \"schema\",\n    type: \"boolean\",\n    reference: boolean,\n    expects: \"boolean\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (typeof dataset.value === \"boolean\") {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/custom/custom.ts\n// @__NO_SIDE_EFFECTS__\nfunction custom(check2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"custom\",\n    reference: custom,\n    expects: \"unknown\",\n    async: false,\n    check: check2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (this.check(dataset.value)) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/custom/customAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction customAsync(check2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"custom\",\n    reference: customAsync,\n    expects: \"unknown\",\n    async: true,\n    check: check2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (await this.check(dataset.value)) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/date/date.ts\n// @__NO_SIDE_EFFECTS__\nfunction date(message2) {\n  return {\n    kind: \"schema\",\n    type: \"date\",\n    reference: date,\n    expects: \"Date\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value instanceof Date) {\n        if (!isNaN(dataset.value)) {\n          dataset.typed = true;\n        } else {\n          _addIssue(this, \"type\", dataset, config2, {\n            received: '\"Invalid Date\"'\n          });\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/enum/enum.ts\n// @__NO_SIDE_EFFECTS__\nfunction enum_(enum__, message2) {\n  const options = [];\n  for (const key in enum__) {\n    if (`${+key}` !== key || typeof enum__[key] !== \"string\" || !Object.is(enum__[enum__[key]], +key)) {\n      options.push(enum__[key]);\n    }\n  }\n  return {\n    kind: \"schema\",\n    type: \"enum\",\n    reference: enum_,\n    expects: _joinExpects(options.map(_stringify), \"|\"),\n    async: false,\n    enum: enum__,\n    options,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (this.options.includes(dataset.value)) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/exactOptional/exactOptional.ts\n// @__NO_SIDE_EFFECTS__\nfunction exactOptional(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"exact_optional\",\n    reference: exactOptional,\n    expects: wrapped.expects,\n    async: false,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/exactOptional/exactOptionalAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction exactOptionalAsync(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"exact_optional\",\n    reference: exactOptionalAsync,\n    expects: wrapped.expects,\n    async: true,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/file/file.ts\n// @__NO_SIDE_EFFECTS__\nfunction file(message2) {\n  return {\n    kind: \"schema\",\n    type: \"file\",\n    reference: file,\n    expects: \"File\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value instanceof File) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/function/function.ts\n// @__NO_SIDE_EFFECTS__\nfunction function_(message2) {\n  return {\n    kind: \"schema\",\n    type: \"function\",\n    reference: function_,\n    expects: \"Function\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (typeof dataset.value === \"function\") {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/instance/instance.ts\n// @__NO_SIDE_EFFECTS__\nfunction instance(class_, message2) {\n  return {\n    kind: \"schema\",\n    type: \"instance\",\n    reference: instance,\n    expects: class_.name,\n    async: false,\n    class: class_,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value instanceof this.class) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/intersect/utils/_merge/_merge.ts\n// @__NO_SIDE_EFFECTS__\nfunction _merge(value1, value2) {\n  if (typeof value1 === typeof value2) {\n    if (value1 === value2 || value1 instanceof Date && value2 instanceof Date && +value1 === +value2) {\n      return { value: value1 };\n    }\n    if (value1 && value2 && value1.constructor === Object && value2.constructor === Object) {\n      for (const key in value2) {\n        if (key in value1) {\n          const dataset = /* @__PURE__ */ _merge(value1[key], value2[key]);\n          if (dataset.issue) {\n            return dataset;\n          }\n          value1[key] = dataset.value;\n        } else {\n          value1[key] = value2[key];\n        }\n      }\n      return { value: value1 };\n    }\n    if (Array.isArray(value1) && Array.isArray(value2)) {\n      if (value1.length === value2.length) {\n        for (let index = 0; index < value1.length; index++) {\n          const dataset = /* @__PURE__ */ _merge(value1[index], value2[index]);\n          if (dataset.issue) {\n            return dataset;\n          }\n          value1[index] = dataset.value;\n        }\n        return { value: value1 };\n      }\n    }\n  }\n  return { issue: true };\n}\n\n// src/schemas/intersect/intersect.ts\n// @__NO_SIDE_EFFECTS__\nfunction intersect(options, message2) {\n  return {\n    kind: \"schema\",\n    type: \"intersect\",\n    reference: intersect,\n    expects: _joinExpects(\n      options.map((option) => option.expects),\n      \"&\"\n    ),\n    async: false,\n    options,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (this.options.length) {\n        const input = dataset.value;\n        let outputs;\n        dataset.typed = true;\n        for (const schema of this.options) {\n          const optionDataset = schema[\"~run\"]({ value: input }, config2);\n          if (optionDataset.issues) {\n            if (dataset.issues) {\n              dataset.issues.push(...optionDataset.issues);\n            } else {\n              dataset.issues = optionDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!optionDataset.typed) {\n            dataset.typed = false;\n          }\n          if (dataset.typed) {\n            if (outputs) {\n              outputs.push(optionDataset.value);\n            } else {\n              outputs = [optionDataset.value];\n            }\n          }\n        }\n        if (dataset.typed) {\n          dataset.value = outputs[0];\n          for (let index = 1; index < outputs.length; index++) {\n            const mergeDataset = _merge(dataset.value, outputs[index]);\n            if (mergeDataset.issue) {\n              _addIssue(this, \"type\", dataset, config2, {\n                received: \"unknown\"\n              });\n              break;\n            }\n            dataset.value = mergeDataset.value;\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/intersect/intersectAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction intersectAsync(options, message2) {\n  return {\n    kind: \"schema\",\n    type: \"intersect\",\n    reference: intersectAsync,\n    expects: _joinExpects(\n      options.map((option) => option.expects),\n      \"&\"\n    ),\n    async: true,\n    options,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (this.options.length) {\n        const input = dataset.value;\n        let outputs;\n        dataset.typed = true;\n        const optionDatasets = await Promise.all(\n          this.options.map((schema) => schema[\"~run\"]({ value: input }, config2))\n        );\n        for (const optionDataset of optionDatasets) {\n          if (optionDataset.issues) {\n            if (dataset.issues) {\n              dataset.issues.push(...optionDataset.issues);\n            } else {\n              dataset.issues = optionDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!optionDataset.typed) {\n            dataset.typed = false;\n          }\n          if (dataset.typed) {\n            if (outputs) {\n              outputs.push(optionDataset.value);\n            } else {\n              outputs = [optionDataset.value];\n            }\n          }\n        }\n        if (dataset.typed) {\n          dataset.value = outputs[0];\n          for (let index = 1; index < outputs.length; index++) {\n            const mergeDataset = _merge(dataset.value, outputs[index]);\n            if (mergeDataset.issue) {\n              _addIssue(this, \"type\", dataset, config2, {\n                received: \"unknown\"\n              });\n              break;\n            }\n            dataset.value = mergeDataset.value;\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/lazy/lazy.ts\n// @__NO_SIDE_EFFECTS__\nfunction lazy(getter) {\n  return {\n    kind: \"schema\",\n    type: \"lazy\",\n    reference: lazy,\n    expects: \"unknown\",\n    async: false,\n    getter,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      return this.getter(dataset.value)[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/lazy/lazyAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction lazyAsync(getter) {\n  return {\n    kind: \"schema\",\n    type: \"lazy\",\n    reference: lazyAsync,\n    expects: \"unknown\",\n    async: true,\n    getter,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      return (await this.getter(dataset.value))[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/literal/literal.ts\n// @__NO_SIDE_EFFECTS__\nfunction literal(literal_, message2) {\n  return {\n    kind: \"schema\",\n    type: \"literal\",\n    reference: literal,\n    expects: _stringify(literal_),\n    async: false,\n    literal: literal_,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value === this.literal) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/looseObject/looseObject.ts\n// @__NO_SIDE_EFFECTS__\nfunction looseObject(entries2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"loose_object\",\n    reference: looseObject,\n    expects: \"Object\",\n    async: false,\n    entries: entries2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        for (const key in this.entries) {\n          const valueSchema = this.entries[key];\n          if (key in input || (valueSchema.type === \"exact_optional\" || valueSchema.type === \"optional\" || valueSchema.type === \"nullish\") && // @ts-expect-error\n          valueSchema.default !== void 0) {\n            const value2 = key in input ? (\n              // @ts-expect-error\n              input[key]\n            ) : getDefault(valueSchema);\n            const valueDataset = valueSchema[\"~run\"]({ value: value2 }, config2);\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          } else if (valueSchema.fallback !== void 0) {\n            dataset.value[key] = getFallback(valueSchema);\n          } else if (valueSchema.type !== \"exact_optional\" && valueSchema.type !== \"optional\" && valueSchema.type !== \"nullish\") {\n            _addIssue(this, \"key\", dataset, config2, {\n              input: void 0,\n              expected: `\"${key}\"`,\n              path: [\n                {\n                  type: \"object\",\n                  origin: \"key\",\n                  input,\n                  key,\n                  // @ts-expect-error\n                  value: input[key]\n                }\n              ]\n            });\n            if (config2.abortEarly) {\n              break;\n            }\n          }\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (const key in input) {\n            if (_isValidObjectKey(input, key) && !(key in this.entries)) {\n              dataset.value[key] = input[key];\n            }\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/looseObject/looseObjectAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction looseObjectAsync(entries2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"loose_object\",\n    reference: looseObjectAsync,\n    expects: \"Object\",\n    async: true,\n    entries: entries2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        const valueDatasets = await Promise.all(\n          Object.entries(this.entries).map(async ([key, valueSchema]) => {\n            if (key in input || (valueSchema.type === \"exact_optional\" || valueSchema.type === \"optional\" || valueSchema.type === \"nullish\") && // @ts-expect-error\n            valueSchema.default !== void 0) {\n              const value2 = key in input ? (\n                // @ts-expect-error\n                input[key]\n              ) : await getDefault(valueSchema);\n              return [\n                key,\n                value2,\n                valueSchema,\n                await valueSchema[\"~run\"]({ value: value2 }, config2)\n              ];\n            }\n            return [\n              key,\n              // @ts-expect-error\n              input[key],\n              valueSchema,\n              null\n            ];\n          })\n        );\n        for (const [key, value2, valueSchema, valueDataset] of valueDatasets) {\n          if (valueDataset) {\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          } else if (valueSchema.fallback !== void 0) {\n            dataset.value[key] = await getFallback(valueSchema);\n          } else if (valueSchema.type !== \"exact_optional\" && valueSchema.type !== \"optional\" && valueSchema.type !== \"nullish\") {\n            _addIssue(this, \"key\", dataset, config2, {\n              input: void 0,\n              expected: `\"${key}\"`,\n              path: [\n                {\n                  type: \"object\",\n                  origin: \"key\",\n                  input,\n                  key,\n                  value: value2\n                }\n              ]\n            });\n            if (config2.abortEarly) {\n              break;\n            }\n          }\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (const key in input) {\n            if (_isValidObjectKey(input, key) && !(key in this.entries)) {\n              dataset.value[key] = input[key];\n            }\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/looseTuple/looseTuple.ts\n// @__NO_SIDE_EFFECTS__\nfunction looseTuple(items, message2) {\n  return {\n    kind: \"schema\",\n    type: \"loose_tuple\",\n    reference: looseTuple,\n    expects: \"Array\",\n    async: false,\n    items,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        for (let key = 0; key < this.items.length; key++) {\n          const value2 = input[key];\n          const itemDataset = this.items[key][\"~run\"]({ value: value2 }, config2);\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (let key = this.items.length; key < input.length; key++) {\n            dataset.value.push(input[key]);\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/looseTuple/looseTupleAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction looseTupleAsync(items, message2) {\n  return {\n    kind: \"schema\",\n    type: \"loose_tuple\",\n    reference: looseTupleAsync,\n    expects: \"Array\",\n    async: true,\n    items,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        const itemDatasets = await Promise.all(\n          this.items.map(async (item, key) => {\n            const value2 = input[key];\n            return [key, value2, await item[\"~run\"]({ value: value2 }, config2)];\n          })\n        );\n        for (const [key, value2, itemDataset] of itemDatasets) {\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (let key = this.items.length; key < input.length; key++) {\n            dataset.value.push(input[key]);\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/map/map.ts\n// @__NO_SIDE_EFFECTS__\nfunction map(key, value2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"map\",\n    reference: map,\n    expects: \"Map\",\n    async: false,\n    key,\n    value: value2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input instanceof Map) {\n        dataset.typed = true;\n        dataset.value = /* @__PURE__ */ new Map();\n        for (const [inputKey, inputValue] of input) {\n          const keyDataset = this.key[\"~run\"]({ value: inputKey }, config2);\n          if (keyDataset.issues) {\n            const pathItem = {\n              type: \"map\",\n              origin: \"key\",\n              input,\n              key: inputKey,\n              value: inputValue\n            };\n            for (const issue of keyDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = keyDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          const valueDataset = this.value[\"~run\"](\n            { value: inputValue },\n            config2\n          );\n          if (valueDataset.issues) {\n            const pathItem = {\n              type: \"map\",\n              origin: \"value\",\n              input,\n              key: inputKey,\n              value: inputValue\n            };\n            for (const issue of valueDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = valueDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!keyDataset.typed || !valueDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.set(keyDataset.value, valueDataset.value);\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/map/mapAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction mapAsync(key, value2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"map\",\n    reference: mapAsync,\n    expects: \"Map\",\n    async: true,\n    key,\n    value: value2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input instanceof Map) {\n        dataset.typed = true;\n        dataset.value = /* @__PURE__ */ new Map();\n        const datasets = await Promise.all(\n          [...input].map(\n            ([inputKey, inputValue]) => Promise.all([\n              inputKey,\n              inputValue,\n              this.key[\"~run\"]({ value: inputKey }, config2),\n              this.value[\"~run\"]({ value: inputValue }, config2)\n            ])\n          )\n        );\n        for (const [\n          inputKey,\n          inputValue,\n          keyDataset,\n          valueDataset\n        ] of datasets) {\n          if (keyDataset.issues) {\n            const pathItem = {\n              type: \"map\",\n              origin: \"key\",\n              input,\n              key: inputKey,\n              value: inputValue\n            };\n            for (const issue of keyDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = keyDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (valueDataset.issues) {\n            const pathItem = {\n              type: \"map\",\n              origin: \"value\",\n              input,\n              key: inputKey,\n              value: inputValue\n            };\n            for (const issue of valueDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = valueDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!keyDataset.typed || !valueDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.set(keyDataset.value, valueDataset.value);\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/nan/nan.ts\n// @__NO_SIDE_EFFECTS__\nfunction nan(message2) {\n  return {\n    kind: \"schema\",\n    type: \"nan\",\n    reference: nan,\n    expects: \"NaN\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (Number.isNaN(dataset.value)) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/never/never.ts\n// @__NO_SIDE_EFFECTS__\nfunction never(message2) {\n  return {\n    kind: \"schema\",\n    type: \"never\",\n    reference: never,\n    expects: \"never\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      _addIssue(this, \"type\", dataset, config2);\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/nonNullable/nonNullable.ts\n// @__NO_SIDE_EFFECTS__\nfunction nonNullable(wrapped, message2) {\n  return {\n    kind: \"schema\",\n    type: \"non_nullable\",\n    reference: nonNullable,\n    expects: \"!null\",\n    async: false,\n    wrapped,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value !== null) {\n        dataset = this.wrapped[\"~run\"](dataset, config2);\n      }\n      if (dataset.value === null) {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/nonNullable/nonNullableAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction nonNullableAsync(wrapped, message2) {\n  return {\n    kind: \"schema\",\n    type: \"non_nullable\",\n    reference: nonNullableAsync,\n    expects: \"!null\",\n    async: true,\n    wrapped,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (dataset.value !== null) {\n        dataset = await this.wrapped[\"~run\"](dataset, config2);\n      }\n      if (dataset.value === null) {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/nonNullish/nonNullish.ts\n// @__NO_SIDE_EFFECTS__\nfunction nonNullish(wrapped, message2) {\n  return {\n    kind: \"schema\",\n    type: \"non_nullish\",\n    reference: nonNullish,\n    expects: \"(!null & !undefined)\",\n    async: false,\n    wrapped,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (!(dataset.value === null || dataset.value === void 0)) {\n        dataset = this.wrapped[\"~run\"](dataset, config2);\n      }\n      if (dataset.value === null || dataset.value === void 0) {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/nonNullish/nonNullishAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction nonNullishAsync(wrapped, message2) {\n  return {\n    kind: \"schema\",\n    type: \"non_nullish\",\n    reference: nonNullishAsync,\n    expects: \"(!null & !undefined)\",\n    async: true,\n    wrapped,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (!(dataset.value === null || dataset.value === void 0)) {\n        dataset = await this.wrapped[\"~run\"](dataset, config2);\n      }\n      if (dataset.value === null || dataset.value === void 0) {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/nonOptional/nonOptional.ts\n// @__NO_SIDE_EFFECTS__\nfunction nonOptional(wrapped, message2) {\n  return {\n    kind: \"schema\",\n    type: \"non_optional\",\n    reference: nonOptional,\n    expects: \"!undefined\",\n    async: false,\n    wrapped,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value !== void 0) {\n        dataset = this.wrapped[\"~run\"](dataset, config2);\n      }\n      if (dataset.value === void 0) {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/nonOptional/nonOptionalAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction nonOptionalAsync(wrapped, message2) {\n  return {\n    kind: \"schema\",\n    type: \"non_optional\",\n    reference: nonOptionalAsync,\n    expects: \"!undefined\",\n    async: true,\n    wrapped,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (dataset.value !== void 0) {\n        dataset = await this.wrapped[\"~run\"](dataset, config2);\n      }\n      if (dataset.value === void 0) {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/null/null.ts\n// @__NO_SIDE_EFFECTS__\nfunction null_(message2) {\n  return {\n    kind: \"schema\",\n    type: \"null\",\n    reference: null_,\n    expects: \"null\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value === null) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/nullable/nullable.ts\n// @__NO_SIDE_EFFECTS__\nfunction nullable(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"nullable\",\n    reference: nullable,\n    expects: `(${wrapped.expects} | null)`,\n    async: false,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value === null) {\n        if (this.default !== void 0) {\n          dataset.value = getDefault(this, dataset, config2);\n        }\n        if (dataset.value === null) {\n          dataset.typed = true;\n          return dataset;\n        }\n      }\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/nullable/nullableAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction nullableAsync(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"nullable\",\n    reference: nullableAsync,\n    expects: `(${wrapped.expects} | null)`,\n    async: true,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (dataset.value === null) {\n        if (this.default !== void 0) {\n          dataset.value = await getDefault(this, dataset, config2);\n        }\n        if (dataset.value === null) {\n          dataset.typed = true;\n          return dataset;\n        }\n      }\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/nullish/nullish.ts\n// @__NO_SIDE_EFFECTS__\nfunction nullish(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"nullish\",\n    reference: nullish,\n    expects: `(${wrapped.expects} | null | undefined)`,\n    async: false,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value === null || dataset.value === void 0) {\n        if (this.default !== void 0) {\n          dataset.value = getDefault(this, dataset, config2);\n        }\n        if (dataset.value === null || dataset.value === void 0) {\n          dataset.typed = true;\n          return dataset;\n        }\n      }\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/nullish/nullishAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction nullishAsync(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"nullish\",\n    reference: nullishAsync,\n    expects: `(${wrapped.expects} | null | undefined)`,\n    async: true,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (dataset.value === null || dataset.value === void 0) {\n        if (this.default !== void 0) {\n          dataset.value = await getDefault(this, dataset, config2);\n        }\n        if (dataset.value === null || dataset.value === void 0) {\n          dataset.typed = true;\n          return dataset;\n        }\n      }\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/number/number.ts\n// @__NO_SIDE_EFFECTS__\nfunction number(message2) {\n  return {\n    kind: \"schema\",\n    type: \"number\",\n    reference: number,\n    expects: \"number\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (typeof dataset.value === \"number\" && !isNaN(dataset.value)) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/object/object.ts\n// @__NO_SIDE_EFFECTS__\nfunction object(entries2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"object\",\n    reference: object,\n    expects: \"Object\",\n    async: false,\n    entries: entries2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        for (const key in this.entries) {\n          const valueSchema = this.entries[key];\n          if (key in input || (valueSchema.type === \"exact_optional\" || valueSchema.type === \"optional\" || valueSchema.type === \"nullish\") && // @ts-expect-error\n          valueSchema.default !== void 0) {\n            const value2 = key in input ? (\n              // @ts-expect-error\n              input[key]\n            ) : getDefault(valueSchema);\n            const valueDataset = valueSchema[\"~run\"]({ value: value2 }, config2);\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          } else if (valueSchema.fallback !== void 0) {\n            dataset.value[key] = getFallback(valueSchema);\n          } else if (valueSchema.type !== \"exact_optional\" && valueSchema.type !== \"optional\" && valueSchema.type !== \"nullish\") {\n            _addIssue(this, \"key\", dataset, config2, {\n              input: void 0,\n              expected: `\"${key}\"`,\n              path: [\n                {\n                  type: \"object\",\n                  origin: \"key\",\n                  input,\n                  key,\n                  // @ts-expect-error\n                  value: input[key]\n                }\n              ]\n            });\n            if (config2.abortEarly) {\n              break;\n            }\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/object/objectAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction objectAsync(entries2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"object\",\n    reference: objectAsync,\n    expects: \"Object\",\n    async: true,\n    entries: entries2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        const valueDatasets = await Promise.all(\n          Object.entries(this.entries).map(async ([key, valueSchema]) => {\n            if (key in input || (valueSchema.type === \"exact_optional\" || valueSchema.type === \"optional\" || valueSchema.type === \"nullish\") && // @ts-expect-error\n            valueSchema.default !== void 0) {\n              const value2 = key in input ? (\n                // @ts-expect-error\n                input[key]\n              ) : await getDefault(valueSchema);\n              return [\n                key,\n                value2,\n                valueSchema,\n                await valueSchema[\"~run\"]({ value: value2 }, config2)\n              ];\n            }\n            return [\n              key,\n              // @ts-expect-error\n              input[key],\n              valueSchema,\n              null\n            ];\n          })\n        );\n        for (const [key, value2, valueSchema, valueDataset] of valueDatasets) {\n          if (valueDataset) {\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          } else if (valueSchema.fallback !== void 0) {\n            dataset.value[key] = await getFallback(valueSchema);\n          } else if (valueSchema.type !== \"exact_optional\" && valueSchema.type !== \"optional\" && valueSchema.type !== \"nullish\") {\n            _addIssue(this, \"key\", dataset, config2, {\n              input: void 0,\n              expected: `\"${key}\"`,\n              path: [\n                {\n                  type: \"object\",\n                  origin: \"key\",\n                  input,\n                  key,\n                  value: value2\n                }\n              ]\n            });\n            if (config2.abortEarly) {\n              break;\n            }\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/objectWithRest/objectWithRest.ts\n// @__NO_SIDE_EFFECTS__\nfunction objectWithRest(entries2, rest, message2) {\n  return {\n    kind: \"schema\",\n    type: \"object_with_rest\",\n    reference: objectWithRest,\n    expects: \"Object\",\n    async: false,\n    entries: entries2,\n    rest,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        for (const key in this.entries) {\n          const valueSchema = this.entries[key];\n          if (key in input || (valueSchema.type === \"exact_optional\" || valueSchema.type === \"optional\" || valueSchema.type === \"nullish\") && // @ts-expect-error\n          valueSchema.default !== void 0) {\n            const value2 = key in input ? (\n              // @ts-expect-error\n              input[key]\n            ) : getDefault(valueSchema);\n            const valueDataset = valueSchema[\"~run\"]({ value: value2 }, config2);\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          } else if (valueSchema.fallback !== void 0) {\n            dataset.value[key] = getFallback(valueSchema);\n          } else if (valueSchema.type !== \"exact_optional\" && valueSchema.type !== \"optional\" && valueSchema.type !== \"nullish\") {\n            _addIssue(this, \"key\", dataset, config2, {\n              input: void 0,\n              expected: `\"${key}\"`,\n              path: [\n                {\n                  type: \"object\",\n                  origin: \"key\",\n                  input,\n                  key,\n                  // @ts-expect-error\n                  value: input[key]\n                }\n              ]\n            });\n            if (config2.abortEarly) {\n              break;\n            }\n          }\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (const key in input) {\n            if (_isValidObjectKey(input, key) && !(key in this.entries)) {\n              const valueDataset = this.rest[\"~run\"](\n                // @ts-expect-error\n                { value: input[key] },\n                config2\n              );\n              if (valueDataset.issues) {\n                const pathItem = {\n                  type: \"object\",\n                  origin: \"value\",\n                  input,\n                  key,\n                  // @ts-expect-error\n                  value: input[key]\n                };\n                for (const issue of valueDataset.issues) {\n                  if (issue.path) {\n                    issue.path.unshift(pathItem);\n                  } else {\n                    issue.path = [pathItem];\n                  }\n                  dataset.issues?.push(issue);\n                }\n                if (!dataset.issues) {\n                  dataset.issues = valueDataset.issues;\n                }\n                if (config2.abortEarly) {\n                  dataset.typed = false;\n                  break;\n                }\n              }\n              if (!valueDataset.typed) {\n                dataset.typed = false;\n              }\n              dataset.value[key] = valueDataset.value;\n            }\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/objectWithRest/objectWithRestAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction objectWithRestAsync(entries2, rest, message2) {\n  return {\n    kind: \"schema\",\n    type: \"object_with_rest\",\n    reference: objectWithRestAsync,\n    expects: \"Object\",\n    async: true,\n    entries: entries2,\n    rest,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        const [normalDatasets, restDatasets] = await Promise.all([\n          // If key is present or its an optional schema with a default value,\n          // parse input of key or default value asynchronously\n          Promise.all(\n            Object.entries(this.entries).map(async ([key, valueSchema]) => {\n              if (key in input || (valueSchema.type === \"exact_optional\" || valueSchema.type === \"optional\" || valueSchema.type === \"nullish\") && // @ts-expect-error\n              valueSchema.default !== void 0) {\n                const value2 = key in input ? (\n                  // @ts-expect-error\n                  input[key]\n                ) : await getDefault(valueSchema);\n                return [\n                  key,\n                  value2,\n                  valueSchema,\n                  await valueSchema[\"~run\"]({ value: value2 }, config2)\n                ];\n              }\n              return [\n                key,\n                // @ts-expect-error\n                input[key],\n                valueSchema,\n                null\n              ];\n            })\n          ),\n          // Parse other entries with rest schema asynchronously\n          // Hint: We exclude specific keys for security reasons\n          Promise.all(\n            Object.entries(input).filter(\n              ([key]) => _isValidObjectKey(input, key) && !(key in this.entries)\n            ).map(\n              async ([key, value2]) => [\n                key,\n                value2,\n                await this.rest[\"~run\"]({ value: value2 }, config2)\n              ]\n            )\n          )\n        ]);\n        for (const [key, value2, valueSchema, valueDataset] of normalDatasets) {\n          if (valueDataset) {\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          } else if (valueSchema.fallback !== void 0) {\n            dataset.value[key] = await getFallback(valueSchema);\n          } else if (valueSchema.type !== \"exact_optional\" && valueSchema.type !== \"optional\" && valueSchema.type !== \"nullish\") {\n            _addIssue(this, \"key\", dataset, config2, {\n              input: void 0,\n              expected: `\"${key}\"`,\n              path: [\n                {\n                  type: \"object\",\n                  origin: \"key\",\n                  input,\n                  key,\n                  value: value2\n                }\n              ]\n            });\n            if (config2.abortEarly) {\n              break;\n            }\n          }\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (const [key, value2, valueDataset] of restDatasets) {\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/optional/optional.ts\n// @__NO_SIDE_EFFECTS__\nfunction optional(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"optional\",\n    reference: optional,\n    expects: `(${wrapped.expects} | undefined)`,\n    async: false,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value === void 0) {\n        if (this.default !== void 0) {\n          dataset.value = getDefault(this, dataset, config2);\n        }\n        if (dataset.value === void 0) {\n          dataset.typed = true;\n          return dataset;\n        }\n      }\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/optional/optionalAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction optionalAsync(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"optional\",\n    reference: optionalAsync,\n    expects: `(${wrapped.expects} | undefined)`,\n    async: true,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (dataset.value === void 0) {\n        if (this.default !== void 0) {\n          dataset.value = await getDefault(this, dataset, config2);\n        }\n        if (dataset.value === void 0) {\n          dataset.typed = true;\n          return dataset;\n        }\n      }\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/picklist/picklist.ts\n// @__NO_SIDE_EFFECTS__\nfunction picklist(options, message2) {\n  return {\n    kind: \"schema\",\n    type: \"picklist\",\n    reference: picklist,\n    expects: _joinExpects(options.map(_stringify), \"|\"),\n    async: false,\n    options,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (this.options.includes(dataset.value)) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/promise/promise.ts\n// @__NO_SIDE_EFFECTS__\nfunction promise(message2) {\n  return {\n    kind: \"schema\",\n    type: \"promise\",\n    reference: promise,\n    expects: \"Promise\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value instanceof Promise) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/record/record.ts\n// @__NO_SIDE_EFFECTS__\nfunction record(key, value2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"record\",\n    reference: record,\n    expects: \"Object\",\n    async: false,\n    key,\n    value: value2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        for (const entryKey in input) {\n          if (_isValidObjectKey(input, entryKey)) {\n            const entryValue = input[entryKey];\n            const keyDataset = this.key[\"~run\"]({ value: entryKey }, config2);\n            if (keyDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"key\",\n                input,\n                key: entryKey,\n                value: entryValue\n              };\n              for (const issue of keyDataset.issues) {\n                issue.path = [pathItem];\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = keyDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            const valueDataset = this.value[\"~run\"](\n              { value: entryValue },\n              config2\n            );\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key: entryKey,\n                value: entryValue\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!keyDataset.typed || !valueDataset.typed) {\n              dataset.typed = false;\n            }\n            if (keyDataset.typed) {\n              dataset.value[keyDataset.value] = valueDataset.value;\n            }\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/record/recordAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction recordAsync(key, value2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"record\",\n    reference: recordAsync,\n    expects: \"Object\",\n    async: true,\n    key,\n    value: value2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        const datasets = await Promise.all(\n          Object.entries(input).filter(([key2]) => _isValidObjectKey(input, key2)).map(\n            ([entryKey, entryValue]) => Promise.all([\n              entryKey,\n              entryValue,\n              this.key[\"~run\"]({ value: entryKey }, config2),\n              this.value[\"~run\"]({ value: entryValue }, config2)\n            ])\n          )\n        );\n        for (const [\n          entryKey,\n          entryValue,\n          keyDataset,\n          valueDataset\n        ] of datasets) {\n          if (keyDataset.issues) {\n            const pathItem = {\n              type: \"object\",\n              origin: \"key\",\n              input,\n              key: entryKey,\n              value: entryValue\n            };\n            for (const issue of keyDataset.issues) {\n              issue.path = [pathItem];\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = keyDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (valueDataset.issues) {\n            const pathItem = {\n              type: \"object\",\n              origin: \"value\",\n              input,\n              key: entryKey,\n              value: entryValue\n            };\n            for (const issue of valueDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = valueDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!keyDataset.typed || !valueDataset.typed) {\n            dataset.typed = false;\n          }\n          if (keyDataset.typed) {\n            dataset.value[keyDataset.value] = valueDataset.value;\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/set/set.ts\n// @__NO_SIDE_EFFECTS__\nfunction set(value2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"set\",\n    reference: set,\n    expects: \"Set\",\n    async: false,\n    value: value2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input instanceof Set) {\n        dataset.typed = true;\n        dataset.value = /* @__PURE__ */ new Set();\n        for (const inputValue of input) {\n          const valueDataset = this.value[\"~run\"](\n            { value: inputValue },\n            config2\n          );\n          if (valueDataset.issues) {\n            const pathItem = {\n              type: \"set\",\n              origin: \"value\",\n              input,\n              key: null,\n              value: inputValue\n            };\n            for (const issue of valueDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = valueDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!valueDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.add(valueDataset.value);\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/set/setAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction setAsync(value2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"set\",\n    reference: setAsync,\n    expects: \"Set\",\n    async: true,\n    value: value2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input instanceof Set) {\n        dataset.typed = true;\n        dataset.value = /* @__PURE__ */ new Set();\n        const valueDatasets = await Promise.all(\n          [...input].map(\n            async (inputValue) => [\n              inputValue,\n              await this.value[\"~run\"]({ value: inputValue }, config2)\n            ]\n          )\n        );\n        for (const [inputValue, valueDataset] of valueDatasets) {\n          if (valueDataset.issues) {\n            const pathItem = {\n              type: \"set\",\n              origin: \"value\",\n              input,\n              key: null,\n              value: inputValue\n            };\n            for (const issue of valueDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = valueDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!valueDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.add(valueDataset.value);\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/strictObject/strictObject.ts\n// @__NO_SIDE_EFFECTS__\nfunction strictObject(entries2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"strict_object\",\n    reference: strictObject,\n    expects: \"Object\",\n    async: false,\n    entries: entries2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        for (const key in this.entries) {\n          const valueSchema = this.entries[key];\n          if (key in input || (valueSchema.type === \"exact_optional\" || valueSchema.type === \"optional\" || valueSchema.type === \"nullish\") && // @ts-expect-error\n          valueSchema.default !== void 0) {\n            const value2 = key in input ? (\n              // @ts-expect-error\n              input[key]\n            ) : getDefault(valueSchema);\n            const valueDataset = valueSchema[\"~run\"]({ value: value2 }, config2);\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          } else if (valueSchema.fallback !== void 0) {\n            dataset.value[key] = getFallback(valueSchema);\n          } else if (valueSchema.type !== \"exact_optional\" && valueSchema.type !== \"optional\" && valueSchema.type !== \"nullish\") {\n            _addIssue(this, \"key\", dataset, config2, {\n              input: void 0,\n              expected: `\"${key}\"`,\n              path: [\n                {\n                  type: \"object\",\n                  origin: \"key\",\n                  input,\n                  key,\n                  // @ts-expect-error\n                  value: input[key]\n                }\n              ]\n            });\n            if (config2.abortEarly) {\n              break;\n            }\n          }\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (const key in input) {\n            if (!(key in this.entries)) {\n              _addIssue(this, \"key\", dataset, config2, {\n                input: key,\n                expected: \"never\",\n                path: [\n                  {\n                    type: \"object\",\n                    origin: \"key\",\n                    input,\n                    key,\n                    // @ts-expect-error\n                    value: input[key]\n                  }\n                ]\n              });\n              break;\n            }\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/strictObject/strictObjectAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction strictObjectAsync(entries2, message2) {\n  return {\n    kind: \"schema\",\n    type: \"strict_object\",\n    reference: strictObjectAsync,\n    expects: \"Object\",\n    async: true,\n    entries: entries2,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        dataset.typed = true;\n        dataset.value = {};\n        const valueDatasets = await Promise.all(\n          Object.entries(this.entries).map(async ([key, valueSchema]) => {\n            if (key in input || (valueSchema.type === \"exact_optional\" || valueSchema.type === \"optional\" || valueSchema.type === \"nullish\") && // @ts-expect-error\n            valueSchema.default !== void 0) {\n              const value2 = key in input ? (\n                // @ts-expect-error\n                input[key]\n              ) : await getDefault(valueSchema);\n              return [\n                key,\n                value2,\n                valueSchema,\n                await valueSchema[\"~run\"]({ value: value2 }, config2)\n              ];\n            }\n            return [\n              key,\n              // @ts-expect-error\n              input[key],\n              valueSchema,\n              null\n            ];\n          })\n        );\n        for (const [key, value2, valueSchema, valueDataset] of valueDatasets) {\n          if (valueDataset) {\n            if (valueDataset.issues) {\n              const pathItem = {\n                type: \"object\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of valueDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = valueDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!valueDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value[key] = valueDataset.value;\n          } else if (valueSchema.fallback !== void 0) {\n            dataset.value[key] = await getFallback(valueSchema);\n          } else if (valueSchema.type !== \"exact_optional\" && valueSchema.type !== \"optional\" && valueSchema.type !== \"nullish\") {\n            _addIssue(this, \"key\", dataset, config2, {\n              input: void 0,\n              expected: `\"${key}\"`,\n              path: [\n                {\n                  type: \"object\",\n                  origin: \"key\",\n                  input,\n                  key,\n                  value: value2\n                }\n              ]\n            });\n            if (config2.abortEarly) {\n              break;\n            }\n          }\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (const key in input) {\n            if (!(key in this.entries)) {\n              _addIssue(this, \"key\", dataset, config2, {\n                input: key,\n                expected: \"never\",\n                path: [\n                  {\n                    type: \"object\",\n                    origin: \"key\",\n                    input,\n                    key,\n                    // @ts-expect-error\n                    value: input[key]\n                  }\n                ]\n              });\n              break;\n            }\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/strictTuple/strictTuple.ts\n// @__NO_SIDE_EFFECTS__\nfunction strictTuple(items, message2) {\n  return {\n    kind: \"schema\",\n    type: \"strict_tuple\",\n    reference: strictTuple,\n    expects: \"Array\",\n    async: false,\n    items,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        for (let key = 0; key < this.items.length; key++) {\n          const value2 = input[key];\n          const itemDataset = this.items[key][\"~run\"]({ value: value2 }, config2);\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n        if (!(dataset.issues && config2.abortEarly) && this.items.length < input.length) {\n          _addIssue(this, \"type\", dataset, config2, {\n            input: input[this.items.length],\n            expected: \"never\",\n            path: [\n              {\n                type: \"array\",\n                origin: \"value\",\n                input,\n                key: this.items.length,\n                value: input[this.items.length]\n              }\n            ]\n          });\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/strictTuple/strictTupleAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction strictTupleAsync(items, message2) {\n  return {\n    kind: \"schema\",\n    type: \"strict_tuple\",\n    reference: strictTupleAsync,\n    expects: \"Array\",\n    async: true,\n    items,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        const itemDatasets = await Promise.all(\n          this.items.map(async (item, key) => {\n            const value2 = input[key];\n            return [key, value2, await item[\"~run\"]({ value: value2 }, config2)];\n          })\n        );\n        for (const [key, value2, itemDataset] of itemDatasets) {\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n        if (!(dataset.issues && config2.abortEarly) && this.items.length < input.length) {\n          _addIssue(this, \"type\", dataset, config2, {\n            input: input[this.items.length],\n            expected: \"never\",\n            path: [\n              {\n                type: \"array\",\n                origin: \"value\",\n                input,\n                key: this.items.length,\n                value: input[this.items.length]\n              }\n            ]\n          });\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/string/string.ts\n// @__NO_SIDE_EFFECTS__\nfunction string(message2) {\n  return {\n    kind: \"schema\",\n    type: \"string\",\n    reference: string,\n    expects: \"string\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (typeof dataset.value === \"string\") {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/symbol/symbol.ts\n// @__NO_SIDE_EFFECTS__\nfunction symbol(message2) {\n  return {\n    kind: \"schema\",\n    type: \"symbol\",\n    reference: symbol,\n    expects: \"symbol\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (typeof dataset.value === \"symbol\") {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/tuple/tuple.ts\n// @__NO_SIDE_EFFECTS__\nfunction tuple(items, message2) {\n  return {\n    kind: \"schema\",\n    type: \"tuple\",\n    reference: tuple,\n    expects: \"Array\",\n    async: false,\n    items,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        for (let key = 0; key < this.items.length; key++) {\n          const value2 = input[key];\n          const itemDataset = this.items[key][\"~run\"]({ value: value2 }, config2);\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/tuple/tupleAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction tupleAsync(items, message2) {\n  return {\n    kind: \"schema\",\n    type: \"tuple\",\n    reference: tupleAsync,\n    expects: \"Array\",\n    async: true,\n    items,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        const itemDatasets = await Promise.all(\n          this.items.map(async (item, key) => {\n            const value2 = input[key];\n            return [key, value2, await item[\"~run\"]({ value: value2 }, config2)];\n          })\n        );\n        for (const [key, value2, itemDataset] of itemDatasets) {\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/tupleWithRest/tupleWithRest.ts\n// @__NO_SIDE_EFFECTS__\nfunction tupleWithRest(items, rest, message2) {\n  return {\n    kind: \"schema\",\n    type: \"tuple_with_rest\",\n    reference: tupleWithRest,\n    expects: \"Array\",\n    async: false,\n    items,\n    rest,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        for (let key = 0; key < this.items.length; key++) {\n          const value2 = input[key];\n          const itemDataset = this.items[key][\"~run\"]({ value: value2 }, config2);\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (let key = this.items.length; key < input.length; key++) {\n            const value2 = input[key];\n            const itemDataset = this.rest[\"~run\"]({ value: value2 }, config2);\n            if (itemDataset.issues) {\n              const pathItem = {\n                type: \"array\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of itemDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = itemDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!itemDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value.push(itemDataset.value);\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/tupleWithRest/tupleWithRestAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction tupleWithRestAsync(items, rest, message2) {\n  return {\n    kind: \"schema\",\n    type: \"tuple_with_rest\",\n    reference: tupleWithRestAsync,\n    expects: \"Array\",\n    async: true,\n    items,\n    rest,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (Array.isArray(input)) {\n        dataset.typed = true;\n        dataset.value = [];\n        const [normalDatasets, restDatasets] = await Promise.all([\n          // Parse schema of each normal item\n          Promise.all(\n            this.items.map(async (item, key) => {\n              const value2 = input[key];\n              return [\n                key,\n                value2,\n                await item[\"~run\"]({ value: value2 }, config2)\n              ];\n            })\n          ),\n          // Parse other items with rest schema\n          Promise.all(\n            input.slice(this.items.length).map(async (value2, key) => {\n              return [\n                key + this.items.length,\n                value2,\n                await this.rest[\"~run\"]({ value: value2 }, config2)\n              ];\n            })\n          )\n        ]);\n        for (const [key, value2, itemDataset] of normalDatasets) {\n          if (itemDataset.issues) {\n            const pathItem = {\n              type: \"array\",\n              origin: \"value\",\n              input,\n              key,\n              value: value2\n            };\n            for (const issue of itemDataset.issues) {\n              if (issue.path) {\n                issue.path.unshift(pathItem);\n              } else {\n                issue.path = [pathItem];\n              }\n              dataset.issues?.push(issue);\n            }\n            if (!dataset.issues) {\n              dataset.issues = itemDataset.issues;\n            }\n            if (config2.abortEarly) {\n              dataset.typed = false;\n              break;\n            }\n          }\n          if (!itemDataset.typed) {\n            dataset.typed = false;\n          }\n          dataset.value.push(itemDataset.value);\n        }\n        if (!dataset.issues || !config2.abortEarly) {\n          for (const [key, value2, itemDataset] of restDatasets) {\n            if (itemDataset.issues) {\n              const pathItem = {\n                type: \"array\",\n                origin: \"value\",\n                input,\n                key,\n                value: value2\n              };\n              for (const issue of itemDataset.issues) {\n                if (issue.path) {\n                  issue.path.unshift(pathItem);\n                } else {\n                  issue.path = [pathItem];\n                }\n                dataset.issues?.push(issue);\n              }\n              if (!dataset.issues) {\n                dataset.issues = itemDataset.issues;\n              }\n              if (config2.abortEarly) {\n                dataset.typed = false;\n                break;\n              }\n            }\n            if (!itemDataset.typed) {\n              dataset.typed = false;\n            }\n            dataset.value.push(itemDataset.value);\n          }\n        }\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/undefined/undefined.ts\n// @__NO_SIDE_EFFECTS__\nfunction undefined_(message2) {\n  return {\n    kind: \"schema\",\n    type: \"undefined\",\n    reference: undefined_,\n    expects: \"undefined\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value === void 0) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/undefinedable/undefinedable.ts\n// @__NO_SIDE_EFFECTS__\nfunction undefinedable(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"undefinedable\",\n    reference: undefinedable,\n    expects: `(${wrapped.expects} | undefined)`,\n    async: false,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value === void 0) {\n        if (this.default !== void 0) {\n          dataset.value = getDefault(this, dataset, config2);\n        }\n        if (dataset.value === void 0) {\n          dataset.typed = true;\n          return dataset;\n        }\n      }\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/undefinedable/undefinedableAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction undefinedableAsync(wrapped, default_) {\n  return {\n    kind: \"schema\",\n    type: \"undefinedable\",\n    reference: undefinedableAsync,\n    expects: `(${wrapped.expects} | undefined)`,\n    async: true,\n    wrapped,\n    default: default_,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      if (dataset.value === void 0) {\n        if (this.default !== void 0) {\n          dataset.value = await getDefault(this, dataset, config2);\n        }\n        if (dataset.value === void 0) {\n          dataset.typed = true;\n          return dataset;\n        }\n      }\n      return this.wrapped[\"~run\"](dataset, config2);\n    }\n  };\n}\n\n// src/schemas/union/utils/_subIssues/_subIssues.ts\n// @__NO_SIDE_EFFECTS__\nfunction _subIssues(datasets) {\n  let issues;\n  if (datasets) {\n    for (const dataset of datasets) {\n      if (issues) {\n        issues.push(...dataset.issues);\n      } else {\n        issues = dataset.issues;\n      }\n    }\n  }\n  return issues;\n}\n\n// src/schemas/union/union.ts\n// @__NO_SIDE_EFFECTS__\nfunction union(options, message2) {\n  return {\n    kind: \"schema\",\n    type: \"union\",\n    reference: union,\n    expects: _joinExpects(\n      options.map((option) => option.expects),\n      \"|\"\n    ),\n    async: false,\n    options,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      let validDataset;\n      let typedDatasets;\n      let untypedDatasets;\n      for (const schema of this.options) {\n        const optionDataset = schema[\"~run\"]({ value: dataset.value }, config2);\n        if (optionDataset.typed) {\n          if (optionDataset.issues) {\n            if (typedDatasets) {\n              typedDatasets.push(optionDataset);\n            } else {\n              typedDatasets = [optionDataset];\n            }\n          } else {\n            validDataset = optionDataset;\n            break;\n          }\n        } else {\n          if (untypedDatasets) {\n            untypedDatasets.push(optionDataset);\n          } else {\n            untypedDatasets = [optionDataset];\n          }\n        }\n      }\n      if (validDataset) {\n        return validDataset;\n      }\n      if (typedDatasets) {\n        if (typedDatasets.length === 1) {\n          return typedDatasets[0];\n        }\n        _addIssue(this, \"type\", dataset, config2, {\n          issues: _subIssues(typedDatasets)\n        });\n        dataset.typed = true;\n      } else if (untypedDatasets?.length === 1) {\n        return untypedDatasets[0];\n      } else {\n        _addIssue(this, \"type\", dataset, config2, {\n          issues: _subIssues(untypedDatasets)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/union/unionAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction unionAsync(options, message2) {\n  return {\n    kind: \"schema\",\n    type: \"union\",\n    reference: unionAsync,\n    expects: _joinExpects(\n      options.map((option) => option.expects),\n      \"|\"\n    ),\n    async: true,\n    options,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      let validDataset;\n      let typedDatasets;\n      let untypedDatasets;\n      for (const schema of this.options) {\n        const optionDataset = await schema[\"~run\"](\n          { value: dataset.value },\n          config2\n        );\n        if (optionDataset.typed) {\n          if (optionDataset.issues) {\n            if (typedDatasets) {\n              typedDatasets.push(optionDataset);\n            } else {\n              typedDatasets = [optionDataset];\n            }\n          } else {\n            validDataset = optionDataset;\n            break;\n          }\n        } else {\n          if (untypedDatasets) {\n            untypedDatasets.push(optionDataset);\n          } else {\n            untypedDatasets = [optionDataset];\n          }\n        }\n      }\n      if (validDataset) {\n        return validDataset;\n      }\n      if (typedDatasets) {\n        if (typedDatasets.length === 1) {\n          return typedDatasets[0];\n        }\n        _addIssue(this, \"type\", dataset, config2, {\n          issues: _subIssues(typedDatasets)\n        });\n        dataset.typed = true;\n      } else if (untypedDatasets?.length === 1) {\n        return untypedDatasets[0];\n      } else {\n        _addIssue(this, \"type\", dataset, config2, {\n          issues: _subIssues(untypedDatasets)\n        });\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/unknown/unknown.ts\n// @__NO_SIDE_EFFECTS__\nfunction unknown() {\n  return {\n    kind: \"schema\",\n    type: \"unknown\",\n    reference: unknown,\n    expects: \"unknown\",\n    async: false,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset) {\n      dataset.typed = true;\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/variant/variant.ts\n// @__NO_SIDE_EFFECTS__\nfunction variant(key, options, message2) {\n  return {\n    kind: \"schema\",\n    type: \"variant\",\n    reference: variant,\n    expects: \"Object\",\n    async: false,\n    key,\n    options,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        let outputDataset;\n        let maxDiscriminatorPriority = 0;\n        let invalidDiscriminatorKey = this.key;\n        let expectedDiscriminators = [];\n        const parseOptions = (variant2, allKeys) => {\n          for (const schema of variant2.options) {\n            if (schema.type === \"variant\") {\n              parseOptions(schema, new Set(allKeys).add(schema.key));\n            } else {\n              let keysAreValid = true;\n              let currentPriority = 0;\n              for (const currentKey of allKeys) {\n                const discriminatorSchema = schema.entries[currentKey];\n                if (currentKey in input ? discriminatorSchema[\"~run\"](\n                  // @ts-expect-error\n                  { typed: false, value: input[currentKey] },\n                  { abortEarly: true }\n                ).issues : discriminatorSchema.type !== \"exact_optional\" && discriminatorSchema.type !== \"optional\" && discriminatorSchema.type !== \"nullish\") {\n                  keysAreValid = false;\n                  if (invalidDiscriminatorKey !== currentKey && (maxDiscriminatorPriority < currentPriority || maxDiscriminatorPriority === currentPriority && currentKey in input && !(invalidDiscriminatorKey in input))) {\n                    maxDiscriminatorPriority = currentPriority;\n                    invalidDiscriminatorKey = currentKey;\n                    expectedDiscriminators = [];\n                  }\n                  if (invalidDiscriminatorKey === currentKey) {\n                    expectedDiscriminators.push(\n                      schema.entries[currentKey].expects\n                    );\n                  }\n                  break;\n                }\n                currentPriority++;\n              }\n              if (keysAreValid) {\n                const optionDataset = schema[\"~run\"]({ value: input }, config2);\n                if (!outputDataset || !outputDataset.typed && optionDataset.typed) {\n                  outputDataset = optionDataset;\n                }\n              }\n            }\n            if (outputDataset && !outputDataset.issues) {\n              break;\n            }\n          }\n        };\n        parseOptions(this, /* @__PURE__ */ new Set([this.key]));\n        if (outputDataset) {\n          return outputDataset;\n        }\n        _addIssue(this, \"type\", dataset, config2, {\n          // @ts-expect-error\n          input: input[invalidDiscriminatorKey],\n          expected: _joinExpects(expectedDiscriminators, \"|\"),\n          path: [\n            {\n              type: \"object\",\n              origin: \"value\",\n              input,\n              key: invalidDiscriminatorKey,\n              // @ts-expect-error\n              value: input[invalidDiscriminatorKey]\n            }\n          ]\n        });\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/variant/variantAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction variantAsync(key, options, message2) {\n  return {\n    kind: \"schema\",\n    type: \"variant\",\n    reference: variantAsync,\n    expects: \"Object\",\n    async: true,\n    key,\n    options,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      const input = dataset.value;\n      if (input && typeof input === \"object\") {\n        let outputDataset;\n        let maxDiscriminatorPriority = 0;\n        let invalidDiscriminatorKey = this.key;\n        let expectedDiscriminators = [];\n        const parseOptions = async (variant2, allKeys) => {\n          for (const schema of variant2.options) {\n            if (schema.type === \"variant\") {\n              await parseOptions(schema, new Set(allKeys).add(schema.key));\n            } else {\n              let keysAreValid = true;\n              let currentPriority = 0;\n              for (const currentKey of allKeys) {\n                const discriminatorSchema = schema.entries[currentKey];\n                if (currentKey in input ? (await discriminatorSchema[\"~run\"](\n                  // @ts-expect-error\n                  { typed: false, value: input[currentKey] },\n                  { abortEarly: true }\n                )).issues : discriminatorSchema.type !== \"exact_optional\" && discriminatorSchema.type !== \"optional\" && discriminatorSchema.type !== \"nullish\") {\n                  keysAreValid = false;\n                  if (invalidDiscriminatorKey !== currentKey && (maxDiscriminatorPriority < currentPriority || maxDiscriminatorPriority === currentPriority && currentKey in input && !(invalidDiscriminatorKey in input))) {\n                    maxDiscriminatorPriority = currentPriority;\n                    invalidDiscriminatorKey = currentKey;\n                    expectedDiscriminators = [];\n                  }\n                  if (invalidDiscriminatorKey === currentKey) {\n                    expectedDiscriminators.push(\n                      schema.entries[currentKey].expects\n                    );\n                  }\n                  break;\n                }\n                currentPriority++;\n              }\n              if (keysAreValid) {\n                const optionDataset = await schema[\"~run\"](\n                  { value: input },\n                  config2\n                );\n                if (!outputDataset || !outputDataset.typed && optionDataset.typed) {\n                  outputDataset = optionDataset;\n                }\n              }\n            }\n            if (outputDataset && !outputDataset.issues) {\n              break;\n            }\n          }\n        };\n        await parseOptions(this, /* @__PURE__ */ new Set([this.key]));\n        if (outputDataset) {\n          return outputDataset;\n        }\n        _addIssue(this, \"type\", dataset, config2, {\n          // @ts-expect-error\n          input: input[invalidDiscriminatorKey],\n          expected: _joinExpects(expectedDiscriminators, \"|\"),\n          path: [\n            {\n              type: \"object\",\n              origin: \"value\",\n              input,\n              key: invalidDiscriminatorKey,\n              // @ts-expect-error\n              value: input[invalidDiscriminatorKey]\n            }\n          ]\n        });\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/schemas/void/void.ts\n// @__NO_SIDE_EFFECTS__\nfunction void_(message2) {\n  return {\n    kind: \"schema\",\n    type: \"void\",\n    reference: void_,\n    expects: \"void\",\n    async: false,\n    message: message2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      if (dataset.value === void 0) {\n        dataset.typed = true;\n      } else {\n        _addIssue(this, \"type\", dataset, config2);\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/methods/keyof/keyof.ts\n// @__NO_SIDE_EFFECTS__\nfunction keyof(schema, message2) {\n  return picklist(Object.keys(schema.entries), message2);\n}\n\n// src/methods/message/message.ts\n// @__NO_SIDE_EFFECTS__\nfunction message(schema, message_) {\n  return {\n    ...schema,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      return schema[\"~run\"](dataset, { ...config2, message: message_ });\n    }\n  };\n}\n\n// src/methods/omit/omit.ts\n// @__NO_SIDE_EFFECTS__\nfunction omit(schema, keys) {\n  const entries2 = {\n    ...schema.entries\n  };\n  for (const key of keys) {\n    delete entries2[key];\n  }\n  return {\n    ...schema,\n    entries: entries2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    }\n  };\n}\n\n// src/methods/parse/parse.ts\nfunction parse(schema, input, config2) {\n  const dataset = schema[\"~run\"]({ value: input }, getGlobalConfig(config2));\n  if (dataset.issues) {\n    throw new ValiError(dataset.issues);\n  }\n  return dataset.value;\n}\n\n// src/methods/parse/parseAsync.ts\nasync function parseAsync(schema, input, config2) {\n  const dataset = await schema[\"~run\"](\n    { value: input },\n    getGlobalConfig(config2)\n  );\n  if (dataset.issues) {\n    throw new ValiError(dataset.issues);\n  }\n  return dataset.value;\n}\n\n// src/methods/parser/parser.ts\n// @__NO_SIDE_EFFECTS__\nfunction parser(schema, config2) {\n  const func = (input) => parse(schema, input, config2);\n  func.schema = schema;\n  func.config = config2;\n  return func;\n}\n\n// src/methods/parser/parserAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction parserAsync(schema, config2) {\n  const func = (input) => parseAsync(schema, input, config2);\n  func.schema = schema;\n  func.config = config2;\n  return func;\n}\n\n// src/methods/partial/partial.ts\n// @__NO_SIDE_EFFECTS__\nfunction partial(schema, keys) {\n  const entries2 = {};\n  for (const key in schema.entries) {\n    entries2[key] = !keys || keys.includes(key) ? optional(schema.entries[key]) : schema.entries[key];\n  }\n  return {\n    ...schema,\n    entries: entries2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    }\n  };\n}\n\n// src/methods/partial/partialAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction partialAsync(schema, keys) {\n  const entries2 = {};\n  for (const key in schema.entries) {\n    entries2[key] = !keys || keys.includes(key) ? optionalAsync(schema.entries[key]) : schema.entries[key];\n  }\n  return {\n    ...schema,\n    entries: entries2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    }\n  };\n}\n\n// src/methods/pick/pick.ts\n// @__NO_SIDE_EFFECTS__\nfunction pick(schema, keys) {\n  const entries2 = {};\n  for (const key of keys) {\n    entries2[key] = schema.entries[key];\n  }\n  return {\n    ...schema,\n    entries: entries2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    }\n  };\n}\n\n// src/methods/pipe/pipe.ts\n// @__NO_SIDE_EFFECTS__\nfunction pipe(...pipe2) {\n  return {\n    ...pipe2[0],\n    pipe: pipe2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    \"~run\"(dataset, config2) {\n      for (const item of pipe2) {\n        if (item.kind !== \"metadata\") {\n          if (dataset.issues && (item.kind === \"schema\" || item.kind === \"transformation\")) {\n            dataset.typed = false;\n            break;\n          }\n          if (!dataset.issues || !config2.abortEarly && !config2.abortPipeEarly) {\n            dataset = item[\"~run\"](dataset, config2);\n          }\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/methods/pipe/pipeAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction pipeAsync(...pipe2) {\n  return {\n    ...pipe2[0],\n    pipe: pipe2,\n    async: true,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    },\n    async \"~run\"(dataset, config2) {\n      for (const item of pipe2) {\n        if (item.kind !== \"metadata\") {\n          if (dataset.issues && (item.kind === \"schema\" || item.kind === \"transformation\")) {\n            dataset.typed = false;\n            break;\n          }\n          if (!dataset.issues || !config2.abortEarly && !config2.abortPipeEarly) {\n            dataset = await item[\"~run\"](dataset, config2);\n          }\n        }\n      }\n      return dataset;\n    }\n  };\n}\n\n// src/methods/required/required.ts\n// @__NO_SIDE_EFFECTS__\nfunction required(schema, arg2, arg3) {\n  const keys = Array.isArray(arg2) ? arg2 : void 0;\n  const message2 = Array.isArray(arg2) ? arg3 : arg2;\n  const entries2 = {};\n  for (const key in schema.entries) {\n    entries2[key] = !keys || keys.includes(key) ? nonOptional(schema.entries[key], message2) : schema.entries[key];\n  }\n  return {\n    ...schema,\n    entries: entries2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    }\n  };\n}\n\n// src/methods/required/requiredAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction requiredAsync(schema, arg2, arg3) {\n  const keys = Array.isArray(arg2) ? arg2 : void 0;\n  const message2 = Array.isArray(arg2) ? arg3 : arg2;\n  const entries2 = {};\n  for (const key in schema.entries) {\n    entries2[key] = !keys || keys.includes(key) ? nonOptionalAsync(schema.entries[key], message2) : schema.entries[key];\n  }\n  return {\n    ...schema,\n    entries: entries2,\n    get \"~standard\"() {\n      return _getStandardProps(this);\n    }\n  };\n}\n\n// src/methods/safeParse/safeParse.ts\n// @__NO_SIDE_EFFECTS__\nfunction safeParse(schema, input, config2) {\n  const dataset = schema[\"~run\"]({ value: input }, getGlobalConfig(config2));\n  return {\n    typed: dataset.typed,\n    success: !dataset.issues,\n    output: dataset.value,\n    issues: dataset.issues\n  };\n}\n\n// src/methods/safeParse/safeParseAsync.ts\n// @__NO_SIDE_EFFECTS__\nasync function safeParseAsync(schema, input, config2) {\n  const dataset = await schema[\"~run\"](\n    { value: input },\n    getGlobalConfig(config2)\n  );\n  return {\n    typed: dataset.typed,\n    success: !dataset.issues,\n    output: dataset.value,\n    issues: dataset.issues\n  };\n}\n\n// src/methods/safeParser/safeParser.ts\n// @__NO_SIDE_EFFECTS__\nfunction safeParser(schema, config2) {\n  const func = (input) => safeParse(schema, input, config2);\n  func.schema = schema;\n  func.config = config2;\n  return func;\n}\n\n// src/methods/safeParser/safeParserAsync.ts\n// @__NO_SIDE_EFFECTS__\nfunction safeParserAsync(schema, config2) {\n  const func = (input) => safeParseAsync(schema, input, config2);\n  func.schema = schema;\n  func.config = config2;\n  return func;\n}\n\n// src/methods/summarize/summarize.ts\n// @__NO_SIDE_EFFECTS__\nfunction summarize(issues) {\n  let summary = \"\";\n  for (const issue of issues) {\n    if (summary) {\n      summary += \"\\n\";\n    }\n    summary += `\\xD7 ${issue.message}`;\n    const dotPath = getDotPath(issue);\n    if (dotPath) {\n      summary += `\n  \\u2192 at ${dotPath}`;\n    }\n  }\n  return summary;\n}\n\n// src/methods/unwrap/unwrap.ts\n// @__NO_SIDE_EFFECTS__\nfunction unwrap(schema) {\n  return schema.wrapped;\n}\nexport {\n  BASE64_REGEX,\n  BIC_REGEX,\n  CUID2_REGEX,\n  DECIMAL_REGEX,\n  DIGITS_REGEX,\n  EMAIL_REGEX,\n  EMOJI_REGEX,\n  HEXADECIMAL_REGEX,\n  HEX_COLOR_REGEX,\n  IMEI_REGEX,\n  IPV4_REGEX,\n  IPV6_REGEX,\n  IP_REGEX,\n  ISO_DATE_REGEX,\n  ISO_DATE_TIME_REGEX,\n  ISO_TIMESTAMP_REGEX,\n  ISO_TIME_REGEX,\n  ISO_TIME_SECOND_REGEX,\n  ISO_WEEK_REGEX,\n  MAC48_REGEX,\n  MAC64_REGEX,\n  MAC_REGEX,\n  NANO_ID_REGEX,\n  OCTAL_REGEX,\n  RFC_EMAIL_REGEX,\n  SLUG_REGEX,\n  ULID_REGEX,\n  UUID_REGEX,\n  ValiError,\n  _addIssue,\n  _getByteCount,\n  _getGraphemeCount,\n  _getLastMetadata,\n  _getStandardProps,\n  _getWordCount,\n  _isLuhnAlgo,\n  _isValidObjectKey,\n  _joinExpects,\n  _stringify,\n  any,\n  args,\n  argsAsync,\n  array,\n  arrayAsync,\n  assert,\n  awaitAsync,\n  base64,\n  bic,\n  bigint,\n  blob,\n  boolean,\n  brand,\n  bytes,\n  check,\n  checkAsync,\n  checkItems,\n  checkItemsAsync,\n  config,\n  creditCard,\n  cuid2,\n  custom,\n  customAsync,\n  date,\n  decimal,\n  deleteGlobalConfig,\n  deleteGlobalMessage,\n  deleteSchemaMessage,\n  deleteSpecificMessage,\n  description,\n  digits,\n  email,\n  emoji,\n  empty,\n  endsWith,\n  entries,\n  entriesFromList,\n  entriesFromObjects,\n  enum_ as enum,\n  enum_,\n  everyItem,\n  exactOptional,\n  exactOptionalAsync,\n  excludes,\n  fallback,\n  fallbackAsync,\n  file,\n  filterItems,\n  findItem,\n  finite,\n  flatten,\n  flavor,\n  forward,\n  forwardAsync,\n  function_ as function,\n  function_,\n  getDefault,\n  getDefaults,\n  getDefaultsAsync,\n  getDescription,\n  getDotPath,\n  getFallback,\n  getFallbacks,\n  getFallbacksAsync,\n  getGlobalConfig,\n  getGlobalMessage,\n  getMetadata,\n  getSchemaMessage,\n  getSpecificMessage,\n  getTitle,\n  graphemes,\n  gtValue,\n  hash,\n  hexColor,\n  hexadecimal,\n  imei,\n  includes,\n  instance,\n  integer,\n  intersect,\n  intersectAsync,\n  ip,\n  ipv4,\n  ipv6,\n  is,\n  isOfKind,\n  isOfType,\n  isValiError,\n  isoDate,\n  isoDateTime,\n  isoTime,\n  isoTimeSecond,\n  isoTimestamp,\n  isoWeek,\n  keyof,\n  lazy,\n  lazyAsync,\n  length,\n  literal,\n  looseObject,\n  looseObjectAsync,\n  looseTuple,\n  looseTupleAsync,\n  ltValue,\n  mac,\n  mac48,\n  mac64,\n  map,\n  mapAsync,\n  mapItems,\n  maxBytes,\n  maxEntries,\n  maxGraphemes,\n  maxLength,\n  maxSize,\n  maxValue,\n  maxWords,\n  message,\n  metadata,\n  mimeType,\n  minBytes,\n  minEntries,\n  minGraphemes,\n  minLength,\n  minSize,\n  minValue,\n  minWords,\n  multipleOf,\n  nan,\n  nanoid,\n  never,\n  nonEmpty,\n  nonNullable,\n  nonNullableAsync,\n  nonNullish,\n  nonNullishAsync,\n  nonOptional,\n  nonOptionalAsync,\n  normalize,\n  notBytes,\n  notEntries,\n  notGraphemes,\n  notLength,\n  notSize,\n  notValue,\n  notValues,\n  notWords,\n  null_ as null,\n  null_,\n  nullable,\n  nullableAsync,\n  nullish,\n  nullishAsync,\n  number,\n  object,\n  objectAsync,\n  objectWithRest,\n  objectWithRestAsync,\n  octal,\n  omit,\n  optional,\n  optionalAsync,\n  parse,\n  parseAsync,\n  parseJson,\n  parser,\n  parserAsync,\n  partial,\n  partialAsync,\n  partialCheck,\n  partialCheckAsync,\n  pick,\n  picklist,\n  pipe,\n  pipeAsync,\n  promise,\n  rawCheck,\n  rawCheckAsync,\n  rawTransform,\n  rawTransformAsync,\n  readonly,\n  record,\n  recordAsync,\n  reduceItems,\n  regex,\n  required,\n  requiredAsync,\n  returns,\n  returnsAsync,\n  rfcEmail,\n  safeInteger,\n  safeParse,\n  safeParseAsync,\n  safeParser,\n  safeParserAsync,\n  set,\n  setAsync,\n  setGlobalConfig,\n  setGlobalMessage,\n  setSchemaMessage,\n  setSpecificMessage,\n  size,\n  slug,\n  someItem,\n  sortItems,\n  startsWith,\n  strictObject,\n  strictObjectAsync,\n  strictTuple,\n  strictTupleAsync,\n  string,\n  stringifyJson,\n  summarize,\n  symbol,\n  title,\n  toLowerCase,\n  toMaxValue,\n  toMinValue,\n  toUpperCase,\n  transform,\n  transformAsync,\n  trim,\n  trimEnd,\n  trimStart,\n  tuple,\n  tupleAsync,\n  tupleWithRest,\n  tupleWithRestAsync,\n  ulid,\n  undefined_ as undefined,\n  undefined_,\n  undefinedable,\n  undefinedableAsync,\n  union,\n  unionAsync,\n  unknown,\n  unwrap,\n  url,\n  uuid,\n  value,\n  values,\n  variant,\n  variantAsync,\n  void_ as void,\n  void_,\n  words\n};\n","/**\r\n * Error codes for Foundry API operations.\r\n * Provides type-safe classification of Foundry-related errors.\r\n */\r\nexport type FoundryErrorCode =\r\n  | \"API_NOT_AVAILABLE\" // Foundry API (game, Hooks, etc.) not available\r\n  | \"VALIDATION_FAILED\" // Runtime validation failed\r\n  | \"NOT_FOUND\" // Entity not found by ID\r\n  | \"ACCESS_DENIED\" // Permission denied\r\n  | \"PORT_SELECTION_FAILED\" // Port selection/instantiation failed\r\n  | \"PORT_REGISTRY_ERROR\" // Port registry duplicate registration\r\n  | \"PORT_NOT_FOUND\" // No compatible port found for version\r\n  | \"OPERATION_FAILED\"; // General operation failure\r\n\r\n/**\r\n * Structured error for Foundry operations.\r\n * Provides detailed context for debugging and error handling.\r\n *\r\n * @example\r\n * ```typescript\r\n * const error: FoundryError = {\r\n *   code: \"API_NOT_AVAILABLE\",\r\n *   message: \"Foundry game API not available\",\r\n *   details: { api: \"game.journal\" }\r\n * };\r\n * ```\r\n */\r\nexport interface FoundryError {\r\n  /** Error code classifying the type of error */\r\n  code: FoundryErrorCode;\r\n\r\n  /** Human-readable error message */\r\n  message: string;\r\n\r\n  /** Optional additional context (IDs, names, etc.) */\r\n  details?: unknown;\r\n\r\n  /** Optional underlying error or exception that caused this error */\r\n  cause?: unknown;\r\n}\r\n\r\n/**\r\n * Factory for creating FoundryError instances.\r\n *\r\n * @param code - Error code\r\n * @param message - Error message\r\n * @param details - Optional additional context\r\n * @param cause - Optional underlying error\r\n * @returns FoundryError instance\r\n *\r\n * @example\r\n * ```typescript\r\n * const error = createFoundryError(\r\n *   \"NOT_FOUND\",\r\n *   \"Journal entry not found\",\r\n *   { journalId: \"abc123\" }\r\n * );\r\n * ```\r\n */\r\nexport function createFoundryError(\r\n  code: FoundryErrorCode,\r\n  message: string,\r\n  details?: unknown,\r\n  cause?: unknown\r\n): FoundryError {\r\n  return { code, message, details, cause };\r\n}\r\n\r\n/**\r\n * Type guard helper for error-like objects.\r\n */\r\ninterface ErrorLike {\r\n  code?: unknown;\r\n  message?: unknown;\r\n}\r\n\r\n/**\r\n * Checks if an object has error-like properties.\r\n */\r\nfunction isErrorLike(obj: unknown): obj is ErrorLike {\r\n  return typeof obj === \"object\" && obj !== null;\r\n}\r\n\r\n/**\r\n * Type guard to check if an error is a FoundryError.\r\n *\r\n * @param error - Error to check\r\n * @returns True if error is a FoundryError\r\n *\r\n * @example\r\n * ```typescript\r\n * if (isFoundryError(error)) {\r\n *   console.log(error.code); // Type-safe access\r\n * }\r\n * ```\r\n */\r\nexport function isFoundryError(error: unknown): error is FoundryError {\r\n  if (!isErrorLike(error)) return false;\r\n\r\n  return (\r\n    \"code\" in error &&\r\n    \"message\" in error &&\r\n    typeof error.code === \"string\" &&\r\n    typeof error.message === \"string\"\r\n  );\r\n}\r\n","import * as v from \"valibot\";\r\nimport type { Result } from \"@/types/result\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\nimport { createFoundryError } from \"@/foundry/errors/FoundryErrors\";\r\n\r\n/**\r\n * Valibot schema for JournalEntry validation.\r\n * Validates that objects from Foundry API conform to expected structure.\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention -- Schemas use PascalCase\r\nexport const JournalEntrySchema = v.object({\r\n  id: v.string(),\r\n  name: v.optional(v.string()),\r\n  flags: v.optional(v.record(v.string(), v.unknown())),\r\n  getFlag: v.optional(\r\n    v.custom<(scope: string, key: string) => unknown>((val) => typeof val === \"function\")\r\n  ),\r\n  setFlag: v.optional(\r\n    v.custom<(scope: string, key: string, value: unknown) => Promise<unknown>>(\r\n      (val) => typeof val === \"function\"\r\n    )\r\n  ),\r\n});\r\n\r\n/**\r\n * Type for validated journal entries.\r\n */\r\nexport type ValidatedJournalEntry = v.InferOutput<typeof JournalEntrySchema>;\r\n\r\n/**\r\n * Validates an array of journal entries against the schema.\r\n *\r\n * @param entries - Array of unknown objects to validate\r\n * @returns Result with validated entries or FoundryError\r\n *\r\n * @example\r\n * ```typescript\r\n * const entries = Array.from(game.journal.contents);\r\n * const result = validateJournalEntries(entries);\r\n * if (result.ok) {\r\n *   // entries are validated\r\n * }\r\n * ```\r\n */\r\nexport function validateJournalEntries(\r\n  entries: unknown[]\r\n): Result<ValidatedJournalEntry[], FoundryError> {\r\n  const result = v.safeParse(v.array(JournalEntrySchema), entries);\r\n\r\n  if (!result.success) {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        \"Journal entry validation failed\",\r\n        undefined,\r\n        result.issues\r\n      )\r\n    );\r\n  }\r\n\r\n  return ok(result.output);\r\n}\r\n\r\n/**\r\n * Valibot schema for validating setting values based on their type.\r\n * Provides type-safe validation for Foundry settings.\r\n */\r\n\r\n/**\r\n * Validates a setting value against expected types and constraints.\r\n *\r\n * @param key - Setting key for error messages\r\n * @param value - Value to validate\r\n * @param expectedType - Expected type (string, number, boolean, or specific values)\r\n * @param choices - Optional array of allowed values\r\n * @returns Result with validated value or FoundryError\r\n *\r\n * @example\r\n * ```typescript\r\n * // Validate log level\r\n * const result = validateSettingValue(\"logLevel\", \"DEBUG\", \"string\", [\"DEBUG\", \"INFO\", \"WARN\", \"ERROR\"]);\r\n * if (result.ok) {\r\n *   // value is valid\r\n * }\r\n * ```\r\n */\r\nexport function validateSettingValue(\r\n  key: string,\r\n  value: unknown,\r\n  expectedType: \"string\" | \"number\" | \"boolean\",\r\n  choices?: readonly string[]\r\n): Result<unknown, FoundryError> {\r\n  // Type validation\r\n  if (expectedType === \"string\" && typeof value !== \"string\") {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        `Setting ${key}: Expected string, got ${typeof value}`,\r\n        { key, value, expectedType }\r\n      )\r\n    );\r\n  }\r\n\r\n  if (expectedType === \"number\" && typeof value !== \"number\") {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        `Setting ${key}: Expected number, got ${typeof value}`,\r\n        { key, value, expectedType }\r\n      )\r\n    );\r\n  }\r\n\r\n  if (expectedType === \"boolean\" && typeof value !== \"boolean\") {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        `Setting ${key}: Expected boolean, got ${typeof value}`,\r\n        { key, value, expectedType }\r\n      )\r\n    );\r\n  }\r\n\r\n  // Choice validation (only for strings)\r\n  if (choices && expectedType === \"string\") {\r\n    // value is known to be string when expectedType === \"string\"\r\n    /* type-coverage:ignore-next-line */\r\n    if (!choices.includes(value as string)) {\r\n      return err(\r\n        createFoundryError(\r\n          \"VALIDATION_FAILED\",\r\n          `Setting ${key}: Invalid value \"${value}\". Allowed: ${choices.join(\", \")}`,\r\n          { key, value, choices }\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  return ok(value);\r\n}\r\n\r\n/**\r\n * Validates setting registration config.\r\n *\r\n * @param namespace - Module namespace\r\n * @param key - Setting key\r\n * @param config - Setting configuration object\r\n * @returns Result with validated config or FoundryError\r\n */\r\nexport function validateSettingConfig(\r\n  namespace: string,\r\n  key: string,\r\n  config: unknown\r\n): Result<unknown, FoundryError> {\r\n  // Namespace validation\r\n  if (!namespace || typeof namespace !== \"string\") {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        \"Invalid setting namespace: must be non-empty string\",\r\n        {\r\n          namespace,\r\n          key,\r\n        }\r\n      )\r\n    );\r\n  }\r\n\r\n  // Key validation\r\n  if (!key || typeof key !== \"string\") {\r\n    return err(\r\n      createFoundryError(\"VALIDATION_FAILED\", \"Invalid setting key: must be non-empty string\", {\r\n        namespace,\r\n        key,\r\n      })\r\n    );\r\n  }\r\n\r\n  // Config validation\r\n  if (!config || typeof config !== \"object\") {\r\n    return err(\r\n      createFoundryError(\"VALIDATION_FAILED\", \"Invalid setting config: must be object\", {\r\n        namespace,\r\n        key,\r\n      })\r\n    );\r\n  }\r\n\r\n  // Type assertion: config is now guaranteed to be object\r\n  /* type-coverage:ignore-next-line */\r\n  const configObj = config as Record<string, unknown>;\r\n\r\n  // Scope validation (if provided)\r\n  // configObj.scope is only present when scope exists and is string-like\r\n  /* type-coverage:ignore-next-line */\r\n  if (configObj.scope && ![\"world\", \"client\", \"user\"].includes(configObj.scope as string)) {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        `Invalid setting scope: \"${configObj.scope}\". Allowed: world, client, user`,\r\n        { namespace, key, scope: configObj.scope }\r\n      )\r\n    );\r\n  }\r\n\r\n  return ok(config);\r\n}\r\n\r\n// Re-export SettingConfig type for convenience\r\nexport type { SettingConfig } from \"@/foundry/interfaces/FoundrySettings\";\r\n\r\n/**\r\n * Sanitizes a string for use in HTML/CSS selectors.\r\n * Removes all characters except alphanumeric, hyphens, and underscores.\r\n * Prevents CSS injection attacks.\r\n *\r\n * @param id - The ID to sanitize\r\n * @returns Sanitized ID safe for use in selectors\r\n *\r\n * @example\r\n * ```typescript\r\n * sanitizeId(\"journal-123\");  // \"journal-123\"\r\n * sanitizeId(\"../../../etc/passwd\");  // \"etcpasswd\"\r\n * sanitizeId(\"<script>alert('xss')</script>\");  // \"scriptalertxssscript\"\r\n * ```\r\n */\r\nexport function sanitizeId(id: string): string {\r\n  return id.replace(/[^a-zA-Z0-9-_]/g, \"\");\r\n}\r\n\r\n/**\r\n * Sanitizes a string for display in HTML.\r\n * Escapes HTML entities to prevent XSS attacks.\r\n *\r\n * @param text - The text to sanitize\r\n * @returns HTML-safe text\r\n *\r\n * @example\r\n * ```typescript\r\n * sanitizeHtml(\"<script>alert('xss')</script>\");\r\n * // \"&lt;script&gt;alert('xss')&lt;/script&gt;\"\r\n *\r\n * sanitizeHtml(\"Normal text\");\r\n * // \"Normal text\"\r\n * ```\r\n */\r\nexport function sanitizeHtml(text: string): string {\r\n  const div = document.createElement(\"div\");\r\n  div.textContent = text;\r\n  return div.innerHTML;\r\n}\r\n\r\n/**\r\n * Valibot schema for validating Foundry Application objects in hooks.\r\n * Validates minimal required properties for safe hook processing.\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention -- Schemas use PascalCase\r\nexport const FoundryApplicationSchema = v.object({\r\n  // Application should have a string ID\r\n  id: v.string(),\r\n  // Application should have object property (typed as record instead of any)\r\n  object: v.optional(v.record(v.string(), v.unknown())),\r\n  // Application should have options property\r\n  options: v.optional(v.record(v.string(), v.unknown())),\r\n});\r\n\r\n/**\r\n * Type for validated Foundry Application.\r\n */\r\nexport type ValidatedFoundryApplication = v.InferOutput<typeof FoundryApplicationSchema>;\r\n\r\n/**\r\n * Validates a hook app parameter.\r\n *\r\n * @param app - Unknown app object to validate\r\n * @returns Result with validated app or FoundryError\r\n *\r\n * @example\r\n * ```typescript\r\n * const result = validateHookApp(app);\r\n * if (result.ok) {\r\n *   // app is validated and safe to use\r\n * }\r\n * ```\r\n */\r\nexport function validateHookApp(app: unknown): Result<ValidatedFoundryApplication, FoundryError> {\r\n  // Null/undefined check\r\n  if (app === null || app === undefined) {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        \"Hook app parameter is null or undefined\",\r\n        undefined,\r\n        undefined\r\n      )\r\n    );\r\n  }\r\n\r\n  const result = v.safeParse(FoundryApplicationSchema, app);\r\n\r\n  /* c8 ignore start -- Valibot validation error path tested via integration tests; detailed validation logic tested in Valibot library */\r\n  if (!result.success) {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        \"Hook app parameter validation failed\",\r\n        undefined,\r\n        result.issues\r\n      )\r\n    );\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  return ok(result.output);\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryJournalFacade } from \"@/foundry/facades/foundry-journal-facade.interface\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport type { Logger } from \"@/interfaces/logger\";\r\nimport type { FoundryJournalEntry } from \"@/foundry/types\";\r\nimport { MODULE_CONSTANTS } from \"@/constants\";\r\nimport { match } from \"@/utils/functional/result\";\r\nimport { foundryJournalFacadeToken } from \"@/foundry/foundrytokens\";\r\nimport { loggerToken } from \"@/tokens/tokenindex\";\r\nimport { sanitizeHtml } from \"@/foundry/validation/schemas\";\r\n\r\n/**\r\n * Service for managing journal entry visibility based on module flags.\r\n * Handles business logic for hiding/showing journal entries in the UI.\r\n *\r\n * **Dependencies Reduced:**\r\n * - Before: 4 dependencies (FoundryGame, FoundryDocument, FoundryUI, Logger)\r\n * - After: 2 dependencies (FoundryJournalFacade, Logger)\r\n * - Improvement: 50% reduction via Facade Pattern\r\n */\r\nexport class JournalVisibilityService {\r\n  static dependencies = [foundryJournalFacadeToken, loggerToken] as const;\r\n\r\n  constructor(\r\n    private readonly facade: FoundryJournalFacade,\r\n    private readonly logger: Logger\r\n  ) {}\r\n\r\n  /**\r\n   * Sanitizes a string for safe use in log messages.\r\n   * Escapes HTML entities to prevent log injection or display issues.\r\n   *\r\n   * Delegates to sanitizeHtml for robust DOM-based sanitization.\r\n   *\r\n   * @param input - The string to sanitize\r\n   * @returns HTML-safe string\r\n   */\r\n  private sanitizeForLog(input: string): string {\r\n    return sanitizeHtml(input);\r\n  }\r\n\r\n  /**\r\n   * Gets journal entries marked as hidden via module flag.\r\n   * Logs warnings for entries where flag reading fails to aid diagnosis.\r\n   */\r\n  getHiddenJournalEntries(): Result<FoundryJournalEntry[], FoundryError> {\r\n    const allEntriesResult = this.facade.getJournalEntries();\r\n    if (!allEntriesResult.ok) return allEntriesResult;\r\n\r\n    const hidden: FoundryJournalEntry[] = [];\r\n\r\n    for (const journal of allEntriesResult.value) {\r\n      const flagResult = this.facade.getEntryFlag<boolean>(journal, MODULE_CONSTANTS.FLAGS.HIDDEN);\r\n\r\n      if (flagResult.ok) {\r\n        if (flagResult.value === true) {\r\n          hidden.push(journal);\r\n        }\r\n        /* c8 ignore start -- Branch: Non-hidden journals (else branch) are the common case, tested implicitly */\r\n      } else {\r\n        // Log flag read errors for diagnosis without interrupting processing\r\n        const journalIdentifier = journal.name ?? journal.id;\r\n        this.logger.warn(\r\n          `Failed to read hidden flag for journal \"${this.sanitizeForLog(journalIdentifier)}\"`,\r\n          {\r\n            errorCode: flagResult.error.code,\r\n            /* c8 ignore stop */\r\n            errorMessage: flagResult.error.message,\r\n          }\r\n        );\r\n\r\n        // Note: UI notifications would need to be added to FoundryJournalFacade\r\n        // if needed, or accessed through a separate FoundryUI service injection\r\n\r\n        // Continue processing other entries\r\n      }\r\n    }\r\n\r\n    return { ok: true, value: hidden };\r\n  }\r\n\r\n  /**\r\n   * Processes journal directory HTML to hide flagged entries.\r\n   */\r\n  processJournalDirectory(htmlElement: HTMLElement): void {\r\n    this.logger.debug(\"Processing journal directory for hidden entries\");\r\n\r\n    const hiddenResult = this.getHiddenJournalEntries();\r\n    match(hiddenResult, {\r\n      onOk: (hidden) => {\r\n        this.logger.debug(`Found ${hidden.length} hidden journal entries`);\r\n        this.hideEntries(hidden, htmlElement);\r\n      },\r\n      onErr: (error) => {\r\n        this.logger.error(\"Error getting hidden journal entries\", error);\r\n      },\r\n    });\r\n  }\r\n\r\n  private hideEntries(entries: FoundryJournalEntry[], html: HTMLElement): void {\r\n    for (const journal of entries) {\r\n      const journalName = journal.name ?? MODULE_CONSTANTS.DEFAULTS.UNKNOWN_NAME;\r\n      const removeResult = this.facade.removeJournalElement(journal.id, journalName, html);\r\n      match(removeResult, {\r\n        onOk: () => {\r\n          this.logger.debug(`Removing journal entry: ${this.sanitizeForLog(journalName)}`);\r\n        },\r\n        onErr: (error) => {\r\n          this.logger.warn(\"Error removing journal entry\", error);\r\n        },\r\n      });\r\n    }\r\n  }\r\n}\r\n","import type { InjectionToken } from \"@/di_infrastructure/types/injectiontoken\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport { METRICS_CONFIG } from \"@/constants\";\r\nimport type { EnvironmentConfig } from \"@/config/environment\";\r\nimport { environmentConfigToken } from \"@/tokens/tokenindex\";\r\nimport type { MetricsRecorder } from \"@/observability/interfaces/metrics-recorder\";\r\nimport type { MetricsSampler } from \"@/observability/interfaces/metrics-sampler\";\r\n\r\n/**\r\n * Snapshot of current metrics data.\r\n * Provides read-only access to collected performance metrics.\r\n */\r\nexport interface MetricsSnapshot {\r\n  /** Total number of container service resolutions */\r\n  containerResolutions: number;\r\n  /** Number of failed resolution attempts */\r\n  resolutionErrors: number;\r\n  /** Average resolution time in milliseconds (rolling window) */\r\n  avgResolutionTimeMs: number;\r\n  /** Count of port selections by Foundry version */\r\n  portSelections: Record<number, number>;\r\n  /** Count of port selection failures by Foundry version */\r\n  portSelectionFailures: Record<number, number>;\r\n  /** Cache hit rate as percentage (0-100) */\r\n  cacheHitRate: number;\r\n}\r\n\r\n/**\r\n * Metrics collector for observability and performance tracking.\r\n *\r\n * Implements MetricsRecorder and MetricsSampler interfaces to provide\r\n * segregated access for different use cases (Interface Segregation Principle).\r\n *\r\n * Collects performance metrics for:\r\n * - Container service resolutions\r\n * - Port selections\r\n * - Cache hit/miss rates\r\n *\r\n * Metrics are only collected when ENV.enablePerformanceTracking is true.\r\n *\r\n * Now managed via Dependency Injection as a Singleton service.\r\n *\r\n * @example\r\n * ```typescript\r\n * const collector = container.resolve(metricsCollectorToken);\r\n * collector.recordResolution(token, 2.5, true);\r\n *\r\n * const snapshot = collector.getSnapshot();\r\n * console.log(`Avg resolution time: ${snapshot.avgResolutionTimeMs}ms`);\r\n * ```\r\n */\r\nexport class MetricsCollector implements MetricsRecorder, MetricsSampler {\r\n  static dependencies = [environmentConfigToken] as const;\r\n\r\n  private metrics = {\r\n    containerResolutions: 0,\r\n    resolutionErrors: 0,\r\n    cacheHits: 0,\r\n    cacheMisses: 0,\r\n    portSelections: new Map<number, number>(),\r\n    portSelectionFailures: new Map<number, number>(),\r\n  };\r\n\r\n  // Circular buffer for resolution times (more efficient than array shift)\r\n  private resolutionTimes = new Float64Array(METRICS_CONFIG.RESOLUTION_TIMES_BUFFER_SIZE);\r\n  private resolutionTimesIndex = 0;\r\n  private resolutionTimesCount = 0;\r\n  private readonly MAX_RESOLUTION_TIMES = METRICS_CONFIG.RESOLUTION_TIMES_BUFFER_SIZE;\r\n\r\n  constructor(private readonly env: EnvironmentConfig) {\r\n    // ENV injected via DI for better testability and DIP compliance\r\n  }\r\n\r\n  /**\r\n   * Records a service resolution attempt.\r\n   *\r\n   * @param token - The injection token that was resolved\r\n   * @param durationMs - Time taken to resolve in milliseconds\r\n   * @param success - Whether resolution succeeded\r\n   */\r\n  recordResolution(token: InjectionToken<ServiceType>, durationMs: number, success: boolean): void {\r\n    this.metrics.containerResolutions++;\r\n\r\n    if (!success) {\r\n      this.metrics.resolutionErrors++;\r\n    }\r\n\r\n    // Circular buffer: O(1) instead of O(n) with array shift\r\n    this.resolutionTimes[this.resolutionTimesIndex] = durationMs;\r\n    this.resolutionTimesIndex = (this.resolutionTimesIndex + 1) % this.MAX_RESOLUTION_TIMES;\r\n    this.resolutionTimesCount = Math.min(this.resolutionTimesCount + 1, this.MAX_RESOLUTION_TIMES);\r\n  }\r\n\r\n  /**\r\n   * Records a port selection event.\r\n   *\r\n   * @param version - The Foundry version for which a port was selected\r\n   */\r\n  recordPortSelection(version: number): void {\r\n    const count = this.metrics.portSelections.get(version) ?? 0;\r\n    this.metrics.portSelections.set(version, count + 1);\r\n  }\r\n\r\n  /**\r\n   * Records a port selection failure.\r\n   *\r\n   * Useful for tracking when no compatible port is available for a version.\r\n   *\r\n   * @param version - The Foundry version for which port selection failed\r\n   */\r\n  recordPortSelectionFailure(version: number): void {\r\n    const count = this.metrics.portSelectionFailures.get(version) ?? 0;\r\n    this.metrics.portSelectionFailures.set(version, count + 1);\r\n  }\r\n\r\n  /**\r\n   * Records a cache access (hit or miss).\r\n   *\r\n   * @param hit - True if cache hit, false if cache miss\r\n   */\r\n  recordCacheAccess(hit: boolean): void {\r\n    if (hit) {\r\n      this.metrics.cacheHits++;\r\n    } else {\r\n      this.metrics.cacheMisses++;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Determines if a performance operation should be sampled based on sampling rate.\r\n   *\r\n   * In production mode, uses probabilistic sampling to reduce overhead.\r\n   * In development mode, always samples (returns true).\r\n   *\r\n   * @returns True if the operation should be measured/recorded\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const metrics = container.resolve(metricsCollectorToken);\r\n   * if (metrics.shouldSample()) {\r\n   *   performance.mark('operation-start');\r\n   *   // ... operation ...\r\n   *   performance.mark('operation-end');\r\n   *   performance.measure('operation', 'operation-start', 'operation-end');\r\n   * }\r\n   * ```\r\n   */\r\n  shouldSample(): boolean {\r\n    // Always sample in development mode\r\n    /* c8 ignore start -- Development mode always returns true; tested implicitly in all metrics tests */\r\n    if (this.env.isDevelopment) {\r\n      return true;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    // Probabilistic sampling in production based on configured rate\r\n    /* c8 ignore start -- Production sampling: Math.random() behavior tested in shouldSample tests */\r\n    return Math.random() < this.env.performanceSamplingRate;\r\n    /* c8 ignore stop */\r\n  }\r\n\r\n  /**\r\n   * Gets a snapshot of current metrics.\r\n   *\r\n   * @returns Immutable snapshot of metrics data\r\n   */\r\n  getSnapshot(): MetricsSnapshot {\r\n    // Calculate average from circular buffer\r\n    let sum = 0;\r\n    for (let i = 0; i < this.resolutionTimesCount; i++) {\r\n      // Entries up to resolutionTimesCount are explicitly written before incrementing the counter\r\n      /* type-coverage:ignore-next-line */\r\n      sum += this.resolutionTimes[i]!;\r\n    }\r\n    const avgTime = this.resolutionTimesCount > 0 ? sum / this.resolutionTimesCount : 0;\r\n\r\n    const totalCacheAccess = this.metrics.cacheHits + this.metrics.cacheMisses;\r\n    const cacheHitRate =\r\n      totalCacheAccess > 0 ? (this.metrics.cacheHits / totalCacheAccess) * 100 : 0;\r\n\r\n    return {\r\n      containerResolutions: this.metrics.containerResolutions,\r\n      resolutionErrors: this.metrics.resolutionErrors,\r\n      avgResolutionTimeMs: avgTime,\r\n      portSelections: Object.fromEntries(this.metrics.portSelections),\r\n      portSelectionFailures: Object.fromEntries(this.metrics.portSelectionFailures),\r\n      cacheHitRate,\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Logs a formatted metrics summary to the console.\r\n   * Uses console.table() for easy-to-read tabular output.\r\n   */\r\n  logSummary(): void {\r\n    const snapshot = this.getSnapshot();\r\n\r\n    /* eslint-disable @typescript-eslint/naming-convention */\r\n    console.table({\r\n      \"Total Resolutions\": snapshot.containerResolutions,\r\n      Errors: snapshot.resolutionErrors,\r\n      \"Avg Time (ms)\": snapshot.avgResolutionTimeMs.toFixed(2),\r\n      \"Cache Hit Rate\": `${snapshot.cacheHitRate.toFixed(1)}%`,\r\n    });\r\n    /* eslint-enable @typescript-eslint/naming-convention */\r\n  }\r\n\r\n  /**\r\n   * Resets all collected metrics.\r\n   * Useful for testing or starting fresh measurements.\r\n   */\r\n  reset(): void {\r\n    this.metrics = {\r\n      containerResolutions: 0,\r\n      resolutionErrors: 0,\r\n      cacheHits: 0,\r\n      cacheMisses: 0,\r\n      portSelections: new Map(),\r\n      portSelectionFailures: new Map(),\r\n    };\r\n    this.resolutionTimes = new Float64Array(METRICS_CONFIG.RESOLUTION_TIMES_BUFFER_SIZE);\r\n    this.resolutionTimesIndex = 0;\r\n    this.resolutionTimesCount = 0;\r\n  }\r\n}\r\n","import type { ServiceContainer } from \"@/di_infrastructure/container\";\r\nimport type { MetricsCollector } from \"@/observability/metrics-collector\";\r\nimport type { HealthStatus } from \"@/core/module-api\";\r\nimport { metricsCollectorToken } from \"@/tokens/tokenindex\";\r\n\r\n/**\r\n * Service for monitoring module health and diagnostics.\r\n *\r\n * Responsibilities:\r\n * - Check container validation state\r\n * - Check port selection status\r\n * - Aggregate metrics for health assessment\r\n * - Provide structured health status\r\n *\r\n * Extracted from CompositionRoot to follow Single Responsibility Principle.\r\n */\r\nexport class ModuleHealthService {\r\n  static dependencies = [metricsCollectorToken] as const;\r\n\r\n  constructor(\r\n    private readonly container: ServiceContainer,\r\n    private readonly metricsCollector: MetricsCollector\r\n  ) {}\r\n\r\n  /**\r\n   * Gets the current health status of the module.\r\n   *\r\n   * Health is determined by:\r\n   * - Container validation state (must be \"validated\")\r\n   * - Port selection success (at least one port selected)\r\n   * - Resolution errors (none expected)\r\n   *\r\n   * @returns HealthStatus with overall status, individual checks, and timestamp\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const healthService = container.resolve(moduleHealthServiceToken);\r\n   * const health = healthService.getHealth();\r\n   *\r\n   * if (health.status !== 'healthy') {\r\n   *   console.warn('Module is not healthy:', health.checks);\r\n   * }\r\n   * ```\r\n   */\r\n  getHealth(): HealthStatus {\r\n    /* c8 ignore next -- Container is always validated after bootstrap, unhealthy path requires internal state manipulation */\r\n    const containerValidated = this.container.getValidationState() === \"validated\";\r\n\r\n    // Get metrics snapshot\r\n    const metrics = this.metricsCollector.getSnapshot();\r\n\r\n    // Fallback to containerValidated when performance tracking is disabled (production mode)\r\n    // If container is validated, ports must have been selected successfully\r\n    const hasPortSelections = Object.keys(metrics.portSelections).length > 0 || containerValidated;\r\n    const hasPortFailures = Object.keys(metrics.portSelectionFailures).length > 0;\r\n\r\n    // Determine overall status\r\n    let status: \"healthy\" | \"degraded\" | \"unhealthy\";\r\n    /* c8 ignore start -- Container is always validated after bootstrap; unhealthy status requires internal manipulation */\r\n    if (!containerValidated) {\r\n      status = \"unhealthy\";\r\n    } else if (hasPortFailures || metrics.resolutionErrors > 0) {\r\n      /* c8 ignore stop */\r\n      status = \"degraded\";\r\n    } else {\r\n      status = \"healthy\";\r\n    }\r\n\r\n    return {\r\n      status,\r\n      checks: {\r\n        containerValidated,\r\n        portsSelected: hasPortSelections,\r\n        lastError: hasPortFailures\r\n          ? `Port selection failures detected for versions: ${Object.keys(metrics.portSelectionFailures).join(\", \")}`\r\n          : null,\r\n      },\r\n      timestamp: new Date().toISOString(),\r\n    };\r\n  }\r\n}\r\n","/**\r\n * Service for performance tracking with sampling support.\r\n * Provides centralized performance measurement with configurable sampling rates.\r\n *\r\n * This service wraps the performance tracking logic that was previously\r\n * implemented as utility functions, making it easier to:\r\n * - Inject via DI instead of passing ENV and MetricsCollector as parameters\r\n * - Test with mocks\r\n * - Configure centrally\r\n * - Add logging and metrics without modifying call sites\r\n *\r\n * **Design:**\r\n * Extends the shared PerformanceTrackerImpl base class to enable polymorphic usage\r\n * alongside BootstrapPerformanceTracker. This allows the same interface\r\n * to be used during bootstrap (no DI) and production (with DI).\r\n */\r\n\r\nimport type { EnvironmentConfig } from \"@/config/environment\";\r\nimport type { MetricsSampler } from \"@/observability/interfaces/metrics-sampler\";\r\nimport { environmentConfigToken, metricsSamplerToken } from \"@/tokens/tokenindex\";\r\nimport { PerformanceTrackerImpl } from \"@/observability/performance-tracker-impl\";\r\n\r\n/**\r\n * Service for tracking performance of operations.\r\n *\r\n * Extends the shared PerformanceTrackerImpl base class to eliminate code duplication\r\n * with BootstrapPerformanceTracker.\r\n *\r\n * @example\r\n * ```typescript\r\n * const perfService = container.resolve(performanceTrackingServiceToken);\r\n *\r\n * // Track sync operation\r\n * const result = perfService.track(\r\n *   () => expensiveOperation(),\r\n *   (duration, result) => {\r\n *     console.log(`Operation took ${duration}ms`);\r\n *   }\r\n * );\r\n *\r\n * // Track async operation\r\n * const result = await perfService.trackAsync(\r\n *   async () => await fetchData(),\r\n *   (duration, result) => {\r\n *     metricsCollector.recordOperation(duration, result.ok);\r\n *   }\r\n * );\r\n * ```\r\n */\r\nexport class PerformanceTrackingService extends PerformanceTrackerImpl {\r\n  static dependencies = [environmentConfigToken, metricsSamplerToken] as const;\r\n\r\n  constructor(env: EnvironmentConfig, sampler: MetricsSampler) {\r\n    super(env, sampler);\r\n  }\r\n}\r\n","/**\r\n * Service for handling transient failures with automatic retry logic.\r\n * Provides retry operations with exponential backoff and optional logging.\r\n *\r\n * This service wraps the retry logic that was previously implemented\r\n * as utility functions, making it easier to:\r\n * - Inject via DI\r\n * - Add logging for retry attempts (via Logger)\r\n * - Track retry metrics (via MetricsCollector)\r\n * - Configure default retry strategies centrally\r\n */\r\n\r\nimport type { Result } from \"@/types/result\";\r\nimport { err } from \"@/utils/functional/result\";\r\nimport type { Logger } from \"@/interfaces/logger\";\r\nimport type { MetricsCollector } from \"@/observability/metrics-collector\";\r\nimport { loggerToken, metricsCollectorToken } from \"@/tokens/tokenindex\";\r\n\r\n/**\r\n * Options for retry operations.\r\n * Allows customization of retry behavior and error handling.\r\n */\r\nexport interface RetryOptions<ErrorType> {\r\n  /**\r\n   * Maximum number of retry attempts.\r\n   * Must be >= 1.\r\n   * @default 3\r\n   */\r\n  maxAttempts?: number;\r\n\r\n  /**\r\n   * Base delay in milliseconds between retry attempts.\r\n   * With exponential backoff: delayMs * attempt (100ms, 200ms, 300ms, ...)\r\n   * @default 100\r\n   */\r\n  delayMs?: number;\r\n\r\n  /**\r\n   * Exponential backoff factor.\r\n   * Delay = delayMs * (attempt ^ backoffFactor)\r\n   * @default 1 (linear backoff)\r\n   */\r\n  backoffFactor?: number;\r\n\r\n  /**\r\n   * Maps exceptions (thrown errors or unknown errors) to the expected ErrorType.\r\n   *\r\n   * This is required when ErrorType is a structured type (e.g., FoundryError)\r\n   * to prevent unsafe 'as ErrorType' casts that violate type guarantees.\r\n   *\r\n   * @param error - The caught exception (unknown type)\r\n   * @param attempt - The current attempt number (1-based)\r\n   * @returns A valid ErrorType instance\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const result = await retryService.retry(\r\n   *   () => fetchData(),\r\n   *   {\r\n   *     maxAttempts: 3,\r\n   *     mapException: (error, attempt) => ({\r\n   *       code: 'OPERATION_FAILED' as const,\r\n   *       message: `Attempt ${attempt} failed: ${String(error)}`\r\n   *     })\r\n   *   }\r\n   * );\r\n   * ```\r\n   */\r\n  mapException?: (error: unknown, attempt: number) => ErrorType;\r\n\r\n  /**\r\n   * Optional operation name for logging purposes.\r\n   * If provided, retry attempts will be logged.\r\n   */\r\n  operationName?: string;\r\n}\r\n\r\n/**\r\n * Service for retrying operations with exponential backoff.\r\n *\r\n * @example\r\n * ```typescript\r\n * const retryService = container.resolve(retryServiceToken);\r\n *\r\n * // Retry async operation\r\n * const result = await retryService.retry(\r\n *   () => foundryApi.fetchData(),\r\n *   {\r\n *     maxAttempts: 3,\r\n *     delayMs: 100,\r\n *     operationName: \"fetchData\",\r\n *     mapException: (error, attempt) => ({\r\n *       code: 'OPERATION_FAILED' as const,\r\n *       message: `Attempt ${attempt} failed: ${String(error)}`\r\n *     })\r\n *   }\r\n * );\r\n *\r\n * // Retry sync operation\r\n * const result = retryService.retrySync(\r\n *   () => parseData(input),\r\n *   { maxAttempts: 3 }\r\n * );\r\n * ```\r\n */\r\nexport class RetryService {\r\n  static dependencies = [loggerToken, metricsCollectorToken] as const;\r\n\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    private readonly metricsCollector: MetricsCollector\r\n  ) {}\r\n\r\n  /**\r\n   * Retries an async operation with exponential backoff.\r\n   *\r\n   * Useful for handling transient failures in external APIs (e.g., Foundry API calls).\r\n   *\r\n   * @template SuccessType - The success type of the operation\r\n   * @template ErrorType - The error type of the operation\r\n   * @param fn - Async function that returns a Result\r\n   * @param options - Retry configuration options (or legacy: maxAttempts number)\r\n   * @param legacyDelayMs - Legacy parameter for backward compatibility\r\n   * @returns Promise resolving to the Result (success or last error)\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * // New API with mapException (recommended for structured error types)\r\n   * const result = await retryService.retry(\r\n   *   () => foundryApi.fetchData(),\r\n   *   {\r\n   *     maxAttempts: 3,\r\n   *     delayMs: 100,\r\n   *     operationName: \"fetchData\",\r\n   *     mapException: (error, attempt) => ({\r\n   *       code: 'OPERATION_FAILED' as const,\r\n   *       message: `Attempt ${attempt} failed: ${String(error)}`\r\n   *     })\r\n   *   }\r\n   * );\r\n   *\r\n   * // Legacy API (backward compatible)\r\n   * const result = await retryService.retry(\r\n   *   () => foundryApi.fetchData(),\r\n   *   3, // maxAttempts\r\n   *   100 // delayMs\r\n   * );\r\n   * ```\r\n   */\r\n  async retry<SuccessType, ErrorType>(\r\n    fn: () => Promise<Result<SuccessType, ErrorType>>,\r\n    options: RetryOptions<ErrorType> | number = 3,\r\n    legacyDelayMs?: number\r\n  ): Promise<Result<SuccessType, ErrorType>> {\r\n    // Backward compatibility: handle legacy (maxAttempts, delayMs) signature\r\n    const opts =\r\n      typeof options === \"number\"\r\n        ? {\r\n            maxAttempts: options,\r\n            /* c8 ignore next -- Legacy API: delayMs default tested via other retry tests */\r\n            delayMs: legacyDelayMs ?? 100,\r\n            backoffFactor: 1,\r\n            /* c8 ignore next 2 -- Legacy unsafe cast function tested via legacy API tests */\r\n            /* type-coverage:ignore-next-line */\r\n            mapException: (error: unknown) => error as ErrorType, // Legacy unsafe cast\r\n            operationName: undefined,\r\n          }\r\n        : {\r\n            /* c8 ignore next -- Modern API: maxAttempts default tested in \"should use default maxAttempts of 3\" */\r\n            maxAttempts: options.maxAttempts ?? 3,\r\n            delayMs: options.delayMs ?? 100,\r\n            backoffFactor: options.backoffFactor ?? 1,\r\n            /* c8 ignore next 2 -- Default mapException tested when options.mapException is undefined */\r\n            /* type-coverage:ignore-next-line */\r\n            mapException: options.mapException ?? ((error: unknown) => error as ErrorType),\r\n            operationName: options.operationName ?? undefined,\r\n          };\r\n\r\n    // Validate maxAttempts to prevent undefined errors\r\n    if (opts.maxAttempts < 1) {\r\n      return err(opts.mapException(\"maxAttempts must be >= 1\", 0) satisfies ErrorType as ErrorType);\r\n    }\r\n\r\n    let lastError: ErrorType | undefined;\r\n    const startTime = performance.now();\r\n\r\n    for (let attempt = 1; attempt <= opts.maxAttempts; attempt++) {\r\n      try {\r\n        // Wrap fn() in try/catch to handle thrown errors (breaks Result-Pattern)\r\n        const result = await fn();\r\n\r\n        if (result.ok) {\r\n          // Log success if this wasn't the first attempt\r\n          if (attempt > 1 && opts.operationName) {\r\n            const duration = performance.now() - startTime;\r\n            this.logger.debug(\r\n              `Retry succeeded for \"${opts.operationName}\" after ${attempt} attempts (${duration.toFixed(2)}ms)`\r\n            );\r\n          }\r\n          return result;\r\n        }\r\n\r\n        lastError = result.error;\r\n\r\n        // Log retry attempt\r\n        if (opts.operationName) {\r\n          this.logger.debug(\r\n            `Retry attempt ${attempt}/${opts.maxAttempts} failed for \"${opts.operationName}\"`,\r\n            { error: lastError }\r\n          );\r\n        }\r\n\r\n        // Don't sleep after last attempt\r\n        if (attempt < opts.maxAttempts) {\r\n          // Exponential backoff: delay * (attempt ^ backoffFactor)\r\n          const delay = opts.delayMs * Math.pow(attempt, opts.backoffFactor);\r\n          await new Promise((resolve) => setTimeout(resolve, delay));\r\n        }\r\n      } catch (error) {\r\n        // Handle exception-based code that breaks Result-Pattern\r\n        // Use mapException to convert unknown error to ErrorType\r\n        lastError = opts.mapException(error, attempt);\r\n\r\n        // Log exception\r\n        if (opts.operationName) {\r\n          this.logger.warn(\r\n            `Retry attempt ${attempt}/${opts.maxAttempts} threw exception for \"${opts.operationName}\"`,\r\n            { error }\r\n          );\r\n        }\r\n\r\n        if (attempt < opts.maxAttempts) {\r\n          const delay = opts.delayMs * Math.pow(attempt, opts.backoffFactor);\r\n          await new Promise((resolve) => setTimeout(resolve, delay));\r\n        }\r\n      }\r\n    }\r\n\r\n    // Record retry failure metric\r\n    if (opts.operationName) {\r\n      const duration = performance.now() - startTime;\r\n      this.logger.warn(\r\n        `All retry attempts exhausted for \"${opts.operationName}\" after ${opts.maxAttempts} attempts (${duration.toFixed(2)}ms)`\r\n      );\r\n    }\r\n\r\n    // lastError is always defined here (at least one attempt was made)\r\n    /* type-coverage:ignore-next-line */\r\n    return err(lastError as ErrorType);\r\n  }\r\n\r\n  /**\r\n   * Retries a synchronous operation.\r\n   * Similar to retry but for sync functions.\r\n   *\r\n   * @template SuccessType - The success type\r\n   * @template ErrorType - The error type\r\n   * @param fn - Function that returns a Result\r\n   * @param options - Retry configuration options (or legacy: maxAttempts number)\r\n   * @returns The Result (success or last error)\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * // New API with mapException (recommended for structured error types)\r\n   * const result = retryService.retrySync(\r\n   *   () => parseData(input),\r\n   *   {\r\n   *     maxAttempts: 3,\r\n   *     operationName: \"parseData\",\r\n   *     mapException: (error, attempt) => ({\r\n   *       code: 'PARSE_FAILED' as const,\r\n   *       message: `Parse attempt ${attempt} failed: ${String(error)}`\r\n   *     })\r\n   *   }\r\n   * );\r\n   *\r\n   * // Legacy API (backward compatible)\r\n   * const result = retryService.retrySync(\r\n   *   () => parseData(input),\r\n   *   3 // maxAttempts\r\n   * );\r\n   * ```\r\n   */\r\n  retrySync<SuccessType, ErrorType>(\r\n    fn: () => Result<SuccessType, ErrorType>,\r\n    options: Omit<RetryOptions<ErrorType>, \"delayMs\" | \"backoffFactor\"> | number = 3\r\n  ): Result<SuccessType, ErrorType> {\r\n    // Backward compatibility: handle legacy maxAttempts signature\r\n    const opts =\r\n      typeof options === \"number\"\r\n        ? {\r\n            maxAttempts: options,\r\n            /* c8 ignore next 2 -- Legacy unsafe cast function tested via legacy API tests */\r\n            /* type-coverage:ignore-next-line */\r\n            mapException: (error: unknown) => error as ErrorType, // Legacy unsafe cast\r\n            operationName: undefined,\r\n          }\r\n        : {\r\n            /* c8 ignore next -- Default maxAttempts tested in retry.test.ts */\r\n            maxAttempts: options.maxAttempts ?? 3,\r\n            /* c8 ignore next 2 -- Default mapException tested implicitly when options.mapException is undefined */\r\n            /* type-coverage:ignore-next-line */\r\n            mapException: options.mapException ?? ((error: unknown) => error as ErrorType),\r\n            operationName: options.operationName ?? undefined,\r\n          };\r\n\r\n    // Validate maxAttempts to prevent undefined errors\r\n    if (opts.maxAttempts < 1) {\r\n      return err(opts.mapException(\"maxAttempts must be >= 1\", 0) satisfies ErrorType as ErrorType);\r\n    }\r\n\r\n    let lastError: ErrorType | undefined;\r\n\r\n    for (let attempt = 1; attempt <= opts.maxAttempts; attempt++) {\r\n      try {\r\n        // Wrap fn() in try/catch to handle thrown errors (breaks Result-Pattern)\r\n        const result = fn();\r\n\r\n        if (result.ok) {\r\n          // Log success if this wasn't the first attempt\r\n          if (attempt > 1 && opts.operationName) {\r\n            this.logger.debug(\r\n              `Retry succeeded for \"${opts.operationName}\" after ${attempt} attempts`\r\n            );\r\n          }\r\n          return result;\r\n        }\r\n\r\n        lastError = result.error;\r\n\r\n        // Log retry attempt\r\n        if (opts.operationName) {\r\n          this.logger.debug(\r\n            `Retry attempt ${attempt}/${opts.maxAttempts} failed for \"${opts.operationName}\"`,\r\n            { error: lastError }\r\n          );\r\n        }\r\n      } catch (error) {\r\n        // Handle exception-based code that breaks Result-Pattern\r\n        // Use mapException to convert unknown error to ErrorType\r\n        lastError = opts.mapException(error, attempt);\r\n\r\n        // Log exception\r\n        if (opts.operationName) {\r\n          this.logger.warn(\r\n            `Retry attempt ${attempt}/${opts.maxAttempts} threw exception for \"${opts.operationName}\"`,\r\n            { error }\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    // Log retry failure\r\n    if (opts.operationName) {\r\n      this.logger.warn(\r\n        `All retry attempts exhausted for \"${opts.operationName}\" after ${opts.maxAttempts} attempts`\r\n      );\r\n    }\r\n\r\n    // lastError is always defined here (at least one attempt was made)\r\n    /* type-coverage:ignore-next-line */\r\n    return err(lastError as ErrorType);\r\n  }\r\n}\r\n","/**\r\n * Version detection for Foundry VTT.\r\n * Extracts the major version number from Foundry's version string.\r\n */\r\n\r\nimport type { Result } from \"@/types/result\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\n\r\n/**\r\n * Cached version result to avoid repeated game.version access.\r\n * Improves performance when version is checked multiple times (e.g., during port selection).\r\n */\r\nlet cachedVersion: Result<number, string> | null = null;\r\n\r\n/**\r\n * Internal function to detect Foundry version without caching.\r\n * Called only once on first version check.\r\n */\r\nfunction detectFoundryVersion(): Result<number, string> {\r\n  if (typeof game === \"undefined\") {\r\n    return err(\"Foundry game object is not available or version cannot be determined\");\r\n  }\r\n\r\n  // game.version is typed as string by fvtt-types\r\n  // Format is \"{major}.{minor}\" (e.g., \"13.348\")\r\n  const versionString = game.version;\r\n  if (!versionString) {\r\n    return err(\"Foundry version is not available on the game object\");\r\n  }\r\n\r\n  const match = versionString.match(/^(\\d+)/);\r\n  if (!match) {\r\n    return err(`Could not parse Foundry version from: ${versionString}`);\r\n  }\r\n\r\n  // match[1] is guaranteed by the regex above capturing at least one group of digits\r\n  /* type-coverage:ignore-next-line */\r\n  return ok(Number.parseInt(match[1]!, 10));\r\n}\r\n\r\n/**\r\n * Gets the major version number of the currently running Foundry VTT instance.\r\n * Returns a Result for proper error handling.\r\n *\r\n * Performance: Version is cached after first detection to avoid repeated game.version access.\r\n *\r\n * @returns Result with major version number (e.g., 13 for \"13.348\") or error message\r\n *\r\n * @example\r\n * ```typescript\r\n * const versionResult = getFoundryVersionResult();\r\n * if (versionResult.ok) {\r\n *   console.log(`Foundry version: ${versionResult.value}`);\r\n * } else {\r\n *   console.error(`Version detection failed: ${versionResult.error}`);\r\n * }\r\n * ```\r\n */\r\nexport function getFoundryVersionResult(): Result<number, string> {\r\n  if (cachedVersion === null) {\r\n    cachedVersion = detectFoundryVersion();\r\n  }\r\n  return cachedVersion;\r\n}\r\n\r\n/**\r\n * Resets the version cache.\r\n *\r\n * @internal For testing purposes only.\r\n *\r\n * Should be called in test cleanup (afterEach) to ensure test isolation.\r\n * DO NOT use in production code - version detection is intentionally cached\r\n * for performance reasons.\r\n */\r\nexport function resetVersionCache(): void {\r\n  cachedVersion = null;\r\n}\r\n\r\n/**\r\n * Safely gets the Foundry version, returning undefined if it cannot be determined.\r\n * @returns The major version number or undefined if not available\r\n */\r\nexport function tryGetFoundryVersion(): number | undefined {\r\n  const result = getFoundryVersionResult();\r\n  return result.ok ? result.value : undefined;\r\n}\r\n","/**\r\n * Event system for PortSelector observability.\r\n *\r\n * **Design Rationale:**\r\n * - Decouples PortSelector from logging and metrics concerns\r\n * - Follows Observer Pattern for extensible observability\r\n * - Reduces PortSelector dependencies from 3 to 0\r\n * - Allows multiple observers without modifying PortSelector\r\n *\r\n * @see PortSelector for event emission\r\n * @see PortSelectionObserver for event consumption\r\n */\r\n\r\n/**\r\n * Event emitted when port selection completes successfully.\r\n */\r\nexport interface PortSelectionSuccessEvent {\r\n  type: \"success\";\r\n  selectedVersion: number;\r\n  foundryVersion: number;\r\n  adapterName: string | undefined;\r\n  durationMs: number;\r\n}\r\n\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\n\r\n/**\r\n * Event emitted when port selection fails.\r\n */\r\nexport interface PortSelectionFailureEvent {\r\n  type: \"failure\";\r\n  foundryVersion: number;\r\n  availableVersions: string;\r\n  adapterName: string | undefined;\r\n  error: FoundryError;\r\n}\r\n\r\n/**\r\n * Union type of all port selection events.\r\n */\r\nexport type PortSelectionEvent = PortSelectionSuccessEvent | PortSelectionFailureEvent;\r\n\r\n/**\r\n * Callback function for port selection events.\r\n */\r\nexport type PortSelectionEventCallback = (event: PortSelectionEvent) => void;\r\n\r\n/**\r\n * Simple event emitter for port selection events.\r\n *\r\n * **Design:**\r\n * - Lightweight, no external dependencies\r\n * - Synchronous event dispatch\r\n * - Multiple subscribers supported\r\n *\r\n * @example\r\n * ```typescript\r\n * const emitter = new PortSelectionEventEmitter();\r\n * emitter.subscribe((event) => {\r\n *   if (event.type === 'success') {\r\n *     console.log(`Port v${event.selectedVersion} selected`);\r\n *   }\r\n * });\r\n * emitter.emit({ type: 'success', selectedVersion: 13, foundryVersion: 13, durationMs: 5 });\r\n * ```\r\n */\r\nexport class PortSelectionEventEmitter {\r\n  private subscribers: PortSelectionEventCallback[] = [];\r\n\r\n  /**\r\n   * Subscribe to port selection events.\r\n   *\r\n   * @param callback - Function to call when events are emitted\r\n   * @returns Unsubscribe function\r\n   */\r\n  subscribe(callback: PortSelectionEventCallback): () => void {\r\n    this.subscribers.push(callback);\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n      const index = this.subscribers.indexOf(callback);\r\n      if (index !== -1) {\r\n        this.subscribers.splice(index, 1);\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Emit a port selection event to all subscribers.\r\n   *\r\n   * Events are dispatched synchronously.\r\n   *\r\n   * @param event - The event to emit\r\n   */\r\n  emit(event: PortSelectionEvent): void {\r\n    for (const subscriber of this.subscribers) {\r\n      try {\r\n        subscriber(event);\r\n      } catch (error) {\r\n        // Prevent one subscriber's error from affecting others\r\n        // Log to console since we don't have logger access here\r\n        console.error(\"PortSelectionEventEmitter: Subscriber error\", error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Remove all subscribers.\r\n   * Useful for cleanup in tests.\r\n   */\r\n  clear(): void {\r\n    this.subscribers = [];\r\n  }\r\n\r\n  /**\r\n   * Get current subscriber count.\r\n   * Useful for testing and diagnostics.\r\n   */\r\n  getSubscriberCount(): number {\r\n    return this.subscribers.length;\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { err, ok } from \"@/utils/functional/result\";\r\nimport { getFoundryVersionResult } from \"./versiondetector\";\r\nimport { createFoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { MODULE_CONSTANTS } from \"@/constants\";\r\nimport { PortSelectionEventEmitter } from \"@/foundry/versioning/port-selection-events\";\r\nimport type { PortSelectionEventCallback } from \"@/foundry/versioning/port-selection-events\";\r\n\r\n/**\r\n * Factory function type for creating port instances.\r\n * Enables lazy instantiation to prevent crashes from incompatible constructors.\r\n */\r\nexport type PortFactory<T> = () => T;\r\n\r\n/**\r\n * Selects the appropriate port implementation based on Foundry version.\r\n * Implements the logic:\r\n * - Foundry v13  uses v13 ports\r\n * - Foundry v14  uses v14 ports (if available), otherwise falls back to v13\r\n * - Never uses ports with version number higher than current Foundry version\r\n *\r\n * **Observability:**\r\n * - Emits events for success/failure instead of direct logging/metrics\r\n * - Zero dependencies for improved testability and separation of concerns\r\n * - Observers can subscribe to events for logging, metrics, etc.\r\n */\r\nexport class PortSelector {\r\n  static dependencies = [] as const;\r\n\r\n  private readonly eventEmitter = new PortSelectionEventEmitter();\r\n\r\n  constructor() {}\r\n\r\n  /**\r\n   * Subscribe to port selection events.\r\n   *\r\n   * Allows observers to be notified of port selection success/failure for\r\n   * logging, metrics, and other observability concerns.\r\n   *\r\n   * @param callback - Function to call when port selection events occur\r\n   * @returns Unsubscribe function\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const selector = new PortSelector();\r\n   * const unsubscribe = selector.onEvent((event) => {\r\n   *   if (event.type === 'success') {\r\n   *     console.log(`Port v${event.selectedVersion} selected`);\r\n   *   }\r\n   * });\r\n   * ```\r\n   */\r\n  onEvent(callback: PortSelectionEventCallback): () => void {\r\n    return this.eventEmitter.subscribe(callback);\r\n  }\r\n\r\n  /**\r\n   * Selects and instantiates the appropriate port from factories.\r\n   *\r\n   * CRITICAL: Works with factory map to avoid eager instantiation.\r\n   * Only the selected factory is executed, preventing crashes from\r\n   * incompatible constructors accessing unavailable APIs.\r\n   *\r\n   * @template T - The port type\r\n   * @param factories - Map of version numbers to port factories\r\n   * @param foundryVersion - Optional version override (uses getFoundryVersion() if not provided)\r\n   * @returns Result with instantiated port or error\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const factories = new Map([\r\n   *   [13, () => new FoundryGamePortV13()],\r\n   *   [14, () => new FoundryGamePortV14()]\r\n   * ]);\r\n   * const selector = new PortSelector();\r\n   * const result = selector.selectPortFromFactories(factories);\r\n   * // On Foundry v13: creates only v13 port (v14 factory never called)\r\n   * // On Foundry v14: creates v14 port\r\n   * ```\r\n   */\r\n  selectPortFromFactories<T>(\r\n    factories: Map<number, PortFactory<T>>,\r\n    foundryVersion?: number,\r\n    adapterName?: string\r\n  ): Result<T, FoundryError> {\r\n    // Inline performance tracking (no dependency on PerformanceTrackingService)\r\n    const startTime = performance.now();\r\n\r\n    // Use central version detection\r\n    let version: number;\r\n    if (foundryVersion !== undefined) {\r\n      version = foundryVersion;\r\n    } else {\r\n      const versionResult = getFoundryVersionResult();\r\n      if (!versionResult.ok) {\r\n        return err(\r\n          createFoundryError(\r\n            \"PORT_SELECTION_FAILED\",\r\n            \"Could not determine Foundry version\",\r\n            undefined,\r\n            versionResult.error\r\n          )\r\n        );\r\n      }\r\n      version = versionResult.value;\r\n    }\r\n\r\n    /**\r\n     * Version Matching Algorithm: Find highest compatible port\r\n     *\r\n     * Strategy: Greedy selection of the newest compatible port version\r\n     *\r\n     * Rules:\r\n     * 1. Never select a port with version > current Foundry version\r\n     *    (prevents using APIs that don't exist yet)\r\n     * 2. Select the highest port version that is <= Foundry version\r\n     *    (use the newest compatible implementation)\r\n     *\r\n     * Example Scenarios:\r\n     * - Foundry v13 + Ports [v12, v13, v14]  Select v13 (exact match)\r\n     * - Foundry v14 + Ports [v12, v13]  Select v13 (fallback to highest compatible)\r\n     * - Foundry v13 + Ports [v14, v15]  ERROR (no compatible port, all too new)\r\n     * - Foundry v20 + Ports [v13, v14]  Select v14 (future-proof fallback)\r\n     *\r\n     * Time Complexity: O(n) where n = number of registered ports\r\n     * Space Complexity: O(1)\r\n     *\r\n     * Note: This algorithm assumes ports are forward-compatible within reason.\r\n     * A v13 port should work on v14+ unless breaking API changes occur.\r\n     */\r\n    let selectedFactory: PortFactory<T> | undefined;\r\n    let selectedVersion: number = MODULE_CONSTANTS.DEFAULTS.NO_VERSION_SELECTED;\r\n\r\n    // Linear search for highest compatible version\r\n    // Could be optimized with sorted array + binary search, but n is typically small (2-5 ports)\r\n    for (const [portVersion, factory] of factories.entries()) {\r\n      // Rule 1: Skip ports newer than current Foundry version\r\n      // These ports may use APIs that don't exist yet  runtime crashes\r\n      if (portVersion > version) {\r\n        continue; // Incompatible (too new)\r\n      }\r\n\r\n      // Rule 2: Greedy selection - always prefer higher version numbers\r\n      // Track the highest compatible version seen so far\r\n      if (portVersion > selectedVersion) {\r\n        selectedVersion = portVersion;\r\n        selectedFactory = factory;\r\n      }\r\n    }\r\n\r\n    if (selectedFactory === undefined) {\r\n      const availableVersions = Array.from(factories.keys())\r\n        .sort((a, b) => a - b)\r\n        .join(\", \");\r\n\r\n      const error = createFoundryError(\r\n        \"PORT_SELECTION_FAILED\",\r\n        `No compatible port found for Foundry version ${version}`,\r\n        { version, availableVersions: availableVersions || \"none\" }\r\n      );\r\n\r\n      // Emit failure event for observability\r\n      this.eventEmitter.emit({\r\n        type: \"failure\",\r\n        foundryVersion: version,\r\n        availableVersions,\r\n        adapterName,\r\n        error,\r\n      });\r\n\r\n      return err(error);\r\n    }\r\n\r\n    // CRITICAL: Only now instantiate the selected port\r\n    try {\r\n      const port = selectedFactory();\r\n      const durationMs = performance.now() - startTime;\r\n\r\n      // Emit success event for observability\r\n      this.eventEmitter.emit({\r\n        type: \"success\",\r\n        selectedVersion,\r\n        foundryVersion: version,\r\n        adapterName,\r\n        durationMs,\r\n      });\r\n\r\n      return ok(port);\r\n    } catch (error) {\r\n      const foundryError = createFoundryError(\r\n        \"PORT_SELECTION_FAILED\",\r\n        `Failed to instantiate port v${selectedVersion}`,\r\n        { selectedVersion },\r\n        error\r\n      );\r\n\r\n      // Emit failure event for observability\r\n      this.eventEmitter.emit({\r\n        type: \"failure\",\r\n        foundryVersion: version,\r\n        availableVersions: Array.from(factories.keys())\r\n          .sort((a, b) => a - b)\r\n          .join(\", \"),\r\n        adapterName,\r\n        error: foundryError,\r\n      });\r\n\r\n      return err(foundryError);\r\n    }\r\n  }\r\n}\r\n","/**\r\n * Registry for managing available port implementations across different Foundry versions.\r\n * Centralizes port registration and discovery.\r\n */\r\n\r\nimport type { Result } from \"@/types/result\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\nimport { createFoundryError, type FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\n\r\nexport type PortFactory<T> = () => T;\r\n\r\n/**\r\n * Registry that holds exactly one port factory per version.\r\n * @template T - The port interface type\r\n */\r\nexport class PortRegistry<T> {\r\n  // Exactly one factory per version\r\n  private readonly factories = new Map<number, PortFactory<T>>();\r\n\r\n  /**\r\n   * Registers a port factory for a specific Foundry version.\r\n   * @param version - The Foundry version this port supports\r\n   * @param factory - Factory function that creates the port instance\r\n   * @returns Result indicating success or duplicate registration error\r\n   */\r\n  register(version: number, factory: PortFactory<T>): Result<void, FoundryError> {\r\n    if (this.factories.has(version)) {\r\n      return err(\r\n        createFoundryError(\r\n          \"PORT_REGISTRY_ERROR\",\r\n          `Port for version ${version} already registered`,\r\n          { version }\r\n        )\r\n      );\r\n    }\r\n    this.factories.set(version, factory);\r\n    return ok(undefined);\r\n  }\r\n\r\n  /**\r\n   * Gets all registered port versions.\r\n   * @returns Array of registered version numbers, sorted ascending\r\n   */\r\n  getAvailableVersions(): number[] {\r\n    return Array.from(this.factories.keys()).sort((a, b) => a - b);\r\n  }\r\n\r\n  /**\r\n   * Gets the factory map without instantiating ports.\r\n   * Use with PortSelector.selectPortFromFactories() for safe lazy instantiation.\r\n   *\r\n   * @returns Map of version numbers to factory functions (NOT instances)\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const registry = new PortRegistry<FoundryGame>();\r\n   * registry.register(13, () => new FoundryGamePortV13());\r\n   * registry.register(14, () => new FoundryGamePortV14());\r\n   *\r\n   * const factories = registry.getFactories();\r\n   * const selector = new PortSelector();\r\n   * const result = selector.selectPortFromFactories(factories);\r\n   * // Only compatible port is instantiated\r\n   * ```\r\n   */\r\n  getFactories(): Map<number, PortFactory<T>> {\r\n    return new Map(this.factories);\r\n  }\r\n\r\n  /**\r\n   * Creates only the port for the specified version or the highest compatible version.\r\n   * More efficient than createAll() when only one port is needed.\r\n   * @param version - The target Foundry version\r\n   * @returns Result containing the port instance or error\r\n   */\r\n  createForVersion(version: number): Result<T, FoundryError> {\r\n    // Find highest compatible version (<= target version)\r\n    const compatibleVersions = Array.from(this.factories.keys())\r\n      .filter((v) => v <= version)\r\n      .sort((a, b) => b - a);\r\n\r\n    if (compatibleVersions.length === 0) {\r\n      const availableVersions = this.getAvailableVersions().join(\", \") || \"none\";\r\n      return err(\r\n        createFoundryError(\r\n          \"PORT_NOT_FOUND\",\r\n          `No compatible port for Foundry v${version}. Available ports: ${availableVersions}`,\r\n          { version, availableVersions }\r\n        )\r\n      );\r\n    }\r\n\r\n    const selectedVersion = compatibleVersions[0];\r\n    /* c8 ignore start -- Defensive check: selectedVersion cannot be undefined after compatibleVersions length check */\r\n    if (selectedVersion === undefined) {\r\n      return err(createFoundryError(\"PORT_NOT_FOUND\", \"No compatible version found\", { version }));\r\n    }\r\n    /* c8 ignore stop */\r\n    // Version list is sorted descending; index 0 exists so subsequent factory lookup is safe\r\n    const factory = this.factories.get(selectedVersion);\r\n    /* c8 ignore start -- Defensive check: factory cannot be undefined after selectedVersion is validated from compatibleVersions */\r\n    if (!factory) {\r\n      return err(\r\n        createFoundryError(\"PORT_NOT_FOUND\", `Factory not found for version ${selectedVersion}`, {\r\n          selectedVersion,\r\n        })\r\n      );\r\n    }\r\n    /* c8 ignore stop */\r\n    return ok(factory());\r\n  }\r\n\r\n  /**\r\n   * Checks if a port is registered for a specific version.\r\n   * @param version - The version to check\r\n   * @returns True if a port is registered for this version\r\n   */\r\n  hasVersion(version: number): boolean {\r\n    return this.factories.has(version);\r\n  }\r\n\r\n  /**\r\n   * Gets the highest registered port version.\r\n   * @returns The highest version number or undefined if no ports are registered\r\n   */\r\n  getHighestVersion(): number | undefined {\r\n    const versions = this.getAvailableVersions();\r\n    // getAvailableVersions returns a sorted array; when non-empty last element is defined\r\n    /* type-coverage:ignore-next-line */\r\n    return versions.length > 0 ? versions[versions.length - 1]! : undefined;\r\n  }\r\n}\r\n","/**\r\n * Observer for PortSelector events that handles observability concerns.\r\n *\r\n * **Design Rationale:**\r\n * - Separates observability logic from port selection logic\r\n * - PortSelector remains focused on its core responsibility\r\n * - Observability can be easily extended without modifying PortSelector\r\n * - Testable in isolation\r\n *\r\n * @see PortSelector for event emission\r\n * @see PortSelectionEventEmitter for event infrastructure\r\n */\r\n\r\nimport type { Logger } from \"@/interfaces/logger\";\r\nimport type { MetricsRecorder } from \"@/observability/interfaces/metrics-recorder\";\r\nimport type { PortSelectionEvent } from \"@/foundry/versioning/port-selection-events\";\r\n\r\n/**\r\n * Observes port selection events and handles logging and metrics.\r\n *\r\n * **Responsibilities:**\r\n * - Log port selection success/failure\r\n * - Record port selection metrics\r\n * - No business logic, pure observability\r\n *\r\n * @example\r\n * ```typescript\r\n * const observer = new PortSelectionObserver(logger, metricsRecorder);\r\n * portSelector.onEvent((event) => observer.handleEvent(event));\r\n * ```\r\n */\r\nexport class PortSelectionObserver {\r\n  constructor(\r\n    private readonly logger: Logger,\r\n    private readonly metrics: MetricsRecorder\r\n  ) {}\r\n\r\n  /**\r\n   * Handle a port selection event.\r\n   *\r\n   * Performs appropriate logging and metrics recording based on event type.\r\n   *\r\n   * @param event - The port selection event to handle\r\n   */\r\n  handleEvent(event: PortSelectionEvent): void {\r\n    if (event.type === \"success\") {\r\n      this.handleSuccess(event);\r\n    } else {\r\n      this.handleFailure(event);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle successful port selection.\r\n   *\r\n   * Logs debug message and records metrics.\r\n   */\r\n  private handleSuccess(event: PortSelectionEvent & { type: \"success\" }): void {\r\n    // Log success with detailed information\r\n    this.logger.debug(\r\n      `Port selection completed in ${event.durationMs.toFixed(2)}ms (selected: v${event.selectedVersion}${event.adapterName ? ` for ${event.adapterName}` : \"\"})`\r\n    );\r\n\r\n    // Record successful port selection in metrics\r\n    this.metrics.recordPortSelection(event.selectedVersion);\r\n  }\r\n\r\n  /**\r\n   * Handle failed port selection.\r\n   *\r\n   * Logs error and records failure metrics.\r\n   */\r\n  private handleFailure(event: PortSelectionEvent & { type: \"failure\" }): void {\r\n    // Log failure with diagnostic information\r\n    this.logger.error(\"No compatible port found\", {\r\n      foundryVersion: event.foundryVersion,\r\n      availableVersions: event.availableVersions,\r\n      adapterName: event.adapterName,\r\n    });\r\n\r\n    // Record port selection failure in metrics\r\n    this.metrics.recordPortSelectionFailure(event.foundryVersion);\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryGame } from \"@/foundry/interfaces/FoundryGame\";\r\nimport type { FoundryJournalEntry } from \"@/foundry/types\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport type { Disposable } from \"@/di_infrastructure/interfaces/disposable\";\r\nimport type { PortSelector } from \"@/foundry/versioning/portselector\";\r\nimport type { PortRegistry } from \"@/foundry/versioning/portregistry\";\r\nimport { portSelectorToken, foundryGamePortRegistryToken } from \"@/foundry/foundrytokens\";\r\n\r\n/**\r\n * Service wrapper for FoundryGame that automatically selects the appropriate port\r\n * based on the current Foundry version.\r\n *\r\n * Implements Disposable for resource cleanup consistency.\r\n */\r\nexport class FoundryGameService implements FoundryGame, Disposable {\r\n  static dependencies = [portSelectorToken, foundryGamePortRegistryToken] as const;\r\n\r\n  private port: FoundryGame | null = null;\r\n  private readonly portSelector: PortSelector;\r\n  private readonly portRegistry: PortRegistry<FoundryGame>;\r\n\r\n  constructor(portSelector: PortSelector, portRegistry: PortRegistry<FoundryGame>) {\r\n    this.portSelector = portSelector;\r\n    this.portRegistry = portRegistry;\r\n  }\r\n\r\n  /**\r\n   * Lazy-loads the appropriate port based on Foundry version.\r\n   * Uses PortSelector with factory-based selection to prevent eager instantiation.\r\n   *\r\n   * CRITICAL: This prevents crashes when newer port constructors access\r\n   * APIs not available in the current Foundry version.\r\n   *\r\n   * @returns Result containing the port or a FoundryError if no compatible port can be selected\r\n   */\r\n  private getPort(): Result<FoundryGame, FoundryError> {\r\n    if (this.port === null) {\r\n      // Get factories (not instances) to avoid eager instantiation\r\n      const factories = this.portRegistry.getFactories();\r\n\r\n      // Use PortSelector with factory-based selection\r\n      const portResult = this.portSelector.selectPortFromFactories(\r\n        factories,\r\n        undefined,\r\n        \"FoundryGame\"\r\n      );\r\n      if (!portResult.ok) {\r\n        return portResult;\r\n      }\r\n\r\n      this.port = portResult.value;\r\n    }\r\n    return { ok: true, value: this.port };\r\n  }\r\n\r\n  getJournalEntries(): Result<FoundryJournalEntry[], FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.getJournalEntries();\r\n  }\r\n\r\n  getJournalEntryById(id: string): Result<FoundryJournalEntry | null, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.getJournalEntryById(id);\r\n  }\r\n\r\n  /**\r\n   * Cleans up resources.\r\n   * Disposes the port if it implements Disposable, then resets the reference.\r\n   */\r\n  dispose(): void {\r\n    // Dispose port if it implements Disposable interface\r\n    /* c8 ignore start -- Defensive: Ports do not currently implement dispose(); reserved for future extensions */\r\n    if (this.port && \"dispose\" in this.port && typeof this.port.dispose === \"function\") {\r\n      // Double cast narrows from generic ServiceType to Disposable at runtime\r\n      /* type-coverage:ignore-next-line */\r\n      (this.port as unknown as Disposable).dispose();\r\n    }\r\n    /* c8 ignore stop */\r\n    this.port = null;\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryHooks } from \"@/foundry/interfaces/FoundryHooks\";\r\nimport type { FoundryHookCallback } from \"@/foundry/types\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport type { Disposable } from \"@/di_infrastructure/interfaces/disposable\";\r\nimport type { Logger } from \"@/interfaces/logger\";\r\nimport { PortSelector } from \"@/foundry/versioning/portselector\";\r\nimport { PortRegistry } from \"@/foundry/versioning/portregistry\";\r\nimport { portSelectorToken, foundryHooksPortRegistryToken } from \"@/foundry/foundrytokens\";\r\nimport { loggerToken } from \"@/tokens/tokenindex\";\r\n\r\n/**\r\n * Type-safe interface for Foundry Hooks with dynamic hook names.\r\n * Allows calling Hooks.off() with runtime-determined hook names without using 'any'.\r\n */\r\ninterface DynamicHooksApi {\r\n  off(hookName: string, callback: (...args: unknown[]) => unknown): void;\r\n  on(hookName: string, callback: (...args: unknown[]) => unknown): number;\r\n  once(hookName: string, callback: (...args: unknown[]) => unknown): number;\r\n}\r\n\r\n/**\r\n * Service wrapper for FoundryHooks that automatically selects the appropriate port\r\n * based on the current Foundry version.\r\n *\r\n * Implements Disposable to clean up registered hooks when the container is disposed.\r\n */\r\nexport class FoundryHooksService implements FoundryHooks, Disposable {\r\n  static dependencies = [portSelectorToken, foundryHooksPortRegistryToken, loggerToken] as const;\r\n\r\n  private port: FoundryHooks | null = null;\r\n  private readonly portSelector: PortSelector;\r\n  private readonly portRegistry: PortRegistry<FoundryHooks>;\r\n  private readonly logger: Logger;\r\n  private registeredHooks = new Map<string, Map<number, FoundryHookCallback>>();\r\n  // Bidirectional mapping: callback function -> array of hook registrations (supports reused callbacks)\r\n  private callbackToIdMap = new Map<FoundryHookCallback, Array<{ hookName: string; id: number }>>();\r\n\r\n  constructor(\r\n    portSelector: PortSelector,\r\n    portRegistry: PortRegistry<FoundryHooks>,\r\n    logger: Logger\r\n  ) {\r\n    this.portSelector = portSelector;\r\n    this.portRegistry = portRegistry;\r\n    this.logger = logger;\r\n  }\r\n\r\n  /**\r\n   * Lazy-loads the appropriate port based on Foundry version.\r\n   * Uses PortSelector with factory-based selection to prevent eager instantiation.\r\n   *\r\n   * CRITICAL: This prevents crashes when newer port constructors access\r\n   * APIs not available in the current Foundry version.\r\n   *\r\n   * @returns Result containing the port or a FoundryError if no compatible port can be selected\r\n   */\r\n  private getPort(): Result<FoundryHooks, FoundryError> {\r\n    if (this.port === null) {\r\n      // Get factories (not instances) to avoid eager instantiation\r\n      const factories = this.portRegistry.getFactories();\r\n\r\n      // Use PortSelector with factory-based selection\r\n      const portResult = this.portSelector.selectPortFromFactories(\r\n        factories,\r\n        undefined,\r\n        \"FoundryHooks\"\r\n      );\r\n      if (!portResult.ok) {\r\n        return portResult;\r\n      }\r\n\r\n      this.port = portResult.value;\r\n    }\r\n    return { ok: true, value: this.port };\r\n  }\r\n\r\n  on(hookName: string, callback: FoundryHookCallback): Result<number, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n\r\n    const result = portResult.value.on(hookName, callback);\r\n\r\n    if (result.ok) {\r\n      // Track registered hook for cleanup (both directions)\r\n      if (!this.registeredHooks.has(hookName)) {\r\n        this.registeredHooks.set(hookName, new Map());\r\n      }\r\n      // Hook map is created above when missing; bang assertion is safe\r\n      /* type-coverage:ignore-next-line */\r\n      this.registeredHooks.get(hookName)!.set(result.value, callback);\r\n\r\n      // Support multiple registrations of the same callback\r\n      const existing = this.callbackToIdMap.get(callback) || [];\r\n      existing.push({ hookName, id: result.value });\r\n      this.callbackToIdMap.set(callback, existing);\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  once(hookName: string, callback: FoundryHookCallback): Result<number, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n\r\n    // once() hooks are automatically deregistered by Foundry after firing\r\n    // No tracking needed - they clean themselves up\r\n    return portResult.value.once(hookName, callback);\r\n  }\r\n\r\n  off(hookName: string, callbackOrId: FoundryHookCallback | number): Result<void, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n\r\n    const result = portResult.value.off(hookName, callbackOrId);\r\n\r\n    if (result.ok) {\r\n      // Remove from tracked hooks (handle both ID and callback variants)\r\n      if (typeof callbackOrId === \"number\") {\r\n        // ID variant: remove by ID\r\n        const hooks = this.registeredHooks.get(hookName);\r\n        if (hooks) {\r\n          const callback = hooks.get(callbackOrId);\r\n          hooks.delete(callbackOrId);\r\n          // Clean up bidirectional mapping - remove only this specific registration\r\n          if (callback) {\r\n            const hookInfos = this.callbackToIdMap.get(callback);\r\n            if (hookInfos) {\r\n              const filtered = hookInfos.filter(\r\n                (info) => !(info.hookName === hookName && info.id === callbackOrId)\r\n              );\r\n              if (filtered.length === 0) {\r\n                this.callbackToIdMap.delete(callback);\r\n              } else {\r\n                this.callbackToIdMap.set(callback, filtered);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        // Callback variant: lookup all registrations for this hookName via callbackToIdMap\r\n        const hookInfos = this.callbackToIdMap.get(callbackOrId);\r\n        if (hookInfos) {\r\n          // Find all registrations for this specific hookName\r\n          const matchingInfos = hookInfos.filter((info) => info.hookName === hookName);\r\n\r\n          // Remove from registeredHooks\r\n          const hooks = this.registeredHooks.get(hookName);\r\n          if (hooks) {\r\n            for (const info of matchingInfos) {\r\n              hooks.delete(info.id);\r\n            }\r\n          }\r\n\r\n          // Update callbackToIdMap - keep registrations for other hooks\r\n          const filtered = hookInfos.filter((info) => info.hookName !== hookName);\r\n          if (filtered.length === 0) {\r\n            this.callbackToIdMap.delete(callbackOrId);\r\n          } else {\r\n            this.callbackToIdMap.set(callbackOrId, filtered);\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Cleans up all registered hooks.\r\n   * Called automatically when the container is disposed.\r\n   */\r\n  dispose(): void {\r\n    // Iterate through all callbacks and their registrations\r\n    for (const [callback, hookInfos] of this.callbackToIdMap) {\r\n      for (const info of hookInfos) {\r\n        try {\r\n          if (typeof Hooks !== \"undefined\") {\r\n            // Type-safe cast for dynamic hook names\r\n            // Foundry's Hooks API supports dynamic hook names, but fvtt-types\r\n            // has strict keyof HookConfig typing that doesn't allow runtime strings\r\n            (Hooks as DynamicHooksApi).off(info.hookName, callback);\r\n          }\r\n        } catch (error) {\r\n          this.logger.warn(\"Failed to unregister hook\", {\r\n            hookName: info.hookName,\r\n            hookId: info.id,\r\n            error,\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    this.registeredHooks.clear();\r\n    this.callbackToIdMap.clear();\r\n    this.port = null;\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryDocument } from \"@/foundry/interfaces/FoundryDocument\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport type { Disposable } from \"@/di_infrastructure/interfaces/disposable\";\r\nimport { PortSelector } from \"@/foundry/versioning/portselector\";\r\nimport { PortRegistry } from \"@/foundry/versioning/portregistry\";\r\nimport { portSelectorToken, foundryDocumentPortRegistryToken } from \"@/foundry/foundrytokens\";\r\n\r\n/**\r\n * Service wrapper for FoundryDocument that automatically selects the appropriate port\r\n * based on the current Foundry version.\r\n *\r\n * Implements Disposable for resource cleanup consistency.\r\n */\r\nexport class FoundryDocumentService implements FoundryDocument, Disposable {\r\n  static dependencies = [portSelectorToken, foundryDocumentPortRegistryToken] as const;\r\n\r\n  private port: FoundryDocument | null = null;\r\n  private readonly portSelector: PortSelector;\r\n  private readonly portRegistry: PortRegistry<FoundryDocument>;\r\n\r\n  constructor(portSelector: PortSelector, portRegistry: PortRegistry<FoundryDocument>) {\r\n    this.portSelector = portSelector;\r\n    this.portRegistry = portRegistry;\r\n  }\r\n\r\n  /**\r\n   * Lazy-loads the appropriate port based on Foundry version.\r\n   * Uses PortSelector with factory-based selection to prevent eager instantiation.\r\n   *\r\n   * CRITICAL: This prevents crashes when newer port constructors access\r\n   * APIs not available in the current Foundry version.\r\n   *\r\n   * @returns Result containing the port or a FoundryError if no compatible port can be selected\r\n   */\r\n  private getPort(): Result<FoundryDocument, FoundryError> {\r\n    if (this.port === null) {\r\n      // Get factories (not instances) to avoid eager instantiation\r\n      const factories = this.portRegistry.getFactories();\r\n\r\n      // Use PortSelector with factory-based selection\r\n      const portResult = this.portSelector.selectPortFromFactories(\r\n        factories,\r\n        undefined,\r\n        \"FoundryDocument\"\r\n      );\r\n      if (!portResult.ok) {\r\n        return portResult;\r\n      }\r\n\r\n      this.port = portResult.value;\r\n    }\r\n    return { ok: true, value: this.port };\r\n  }\r\n\r\n  getFlag<T = unknown>(\r\n    document: { getFlag: (scope: string, key: string) => unknown },\r\n    scope: string,\r\n    key: string\r\n  ): Result<T | null, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.getFlag<T>(document, scope, key);\r\n  }\r\n\r\n  async setFlag<T = unknown>(\r\n    document: { setFlag: (scope: string, key: string, value: T) => Promise<unknown> },\r\n    scope: string,\r\n    key: string,\r\n    value: T\r\n  ): Promise<Result<void, FoundryError>> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return await portResult.value.setFlag(document, scope, key, value);\r\n  }\r\n\r\n  /**\r\n   * Cleans up resources.\r\n   * Resets the port reference to allow garbage collection.\r\n   */\r\n  dispose(): void {\r\n    // Dispose port if it implements Disposable interface\r\n    /* c8 ignore start -- Defensive: Ports do not currently implement dispose(); reserved for future extensions */\r\n    if (this.port && \"dispose\" in this.port && typeof this.port.dispose === \"function\") {\r\n      // Double cast narrows from generic ServiceType to Disposable for runtime cleanup\r\n      /* type-coverage:ignore-next-line */\r\n      (this.port as unknown as Disposable).dispose();\r\n    }\r\n    /* c8 ignore stop */\r\n    this.port = null;\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryUI } from \"@/foundry/interfaces/FoundryUI\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport type { Disposable } from \"@/di_infrastructure/interfaces/disposable\";\r\nimport { PortSelector } from \"@/foundry/versioning/portselector\";\r\nimport { PortRegistry } from \"@/foundry/versioning/portregistry\";\r\nimport { portSelectorToken, foundryUIPortRegistryToken } from \"@/foundry/foundrytokens\";\r\n\r\n/**\r\n * Service wrapper for FoundryUI that automatically selects the appropriate port\r\n * based on the current Foundry version.\r\n *\r\n * Implements Disposable for resource cleanup consistency.\r\n */\r\nexport class FoundryUIService implements FoundryUI, Disposable {\r\n  static dependencies = [portSelectorToken, foundryUIPortRegistryToken] as const;\r\n\r\n  private port: FoundryUI | null = null;\r\n  private readonly portSelector: PortSelector;\r\n  private readonly portRegistry: PortRegistry<FoundryUI>;\r\n\r\n  constructor(portSelector: PortSelector, portRegistry: PortRegistry<FoundryUI>) {\r\n    this.portSelector = portSelector;\r\n    this.portRegistry = portRegistry;\r\n  }\r\n\r\n  /**\r\n   * Lazy-loads the appropriate port based on Foundry version.\r\n   * Uses PortSelector with factory-based selection to prevent eager instantiation.\r\n   *\r\n   * CRITICAL: This prevents crashes when newer port constructors access\r\n   * APIs not available in the current Foundry version.\r\n   *\r\n   * @returns Result containing the port or a FoundryError if no compatible port can be selected\r\n   */\r\n  private getPort(): Result<FoundryUI, FoundryError> {\r\n    if (this.port === null) {\r\n      // Get factories (not instances) to avoid eager instantiation\r\n      const factories = this.portRegistry.getFactories();\r\n\r\n      // Use PortSelector with factory-based selection\r\n      const portResult = this.portSelector.selectPortFromFactories(\r\n        factories,\r\n        undefined,\r\n        \"FoundryUI\"\r\n      );\r\n      if (!portResult.ok) {\r\n        return portResult;\r\n      }\r\n\r\n      this.port = portResult.value;\r\n    }\r\n    return { ok: true, value: this.port };\r\n  }\r\n\r\n  removeJournalElement(\r\n    journalId: string,\r\n    journalName: string,\r\n    html: HTMLElement\r\n  ): Result<void, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.removeJournalElement(journalId, journalName, html);\r\n  }\r\n\r\n  findElement(container: HTMLElement, selector: string): Result<HTMLElement | null, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.findElement(container, selector);\r\n  }\r\n\r\n  notify(message: string, type: \"info\" | \"warning\" | \"error\"): Result<void, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.notify(message, type);\r\n  }\r\n\r\n  /**\r\n   * Cleans up resources.\r\n   * Resets the port reference to allow garbage collection.\r\n   */\r\n  dispose(): void {\r\n    // Dispose port if it implements Disposable interface\r\n    /* c8 ignore start -- Defensive: Ports do not currently implement dispose(); reserved for future extensions */\r\n    if (this.port && \"dispose\" in this.port && typeof this.port.dispose === \"function\") {\r\n      // Double cast narrows from generic ServiceType to Disposable for runtime cleanup\r\n      /* type-coverage:ignore-next-line */\r\n      (this.port as unknown as Disposable).dispose();\r\n    }\r\n    /* c8 ignore stop */\r\n    this.port = null;\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundrySettings, SettingConfig } from \"@/foundry/interfaces/FoundrySettings\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport type { Disposable } from \"@/di_infrastructure/interfaces/disposable\";\r\nimport type { PortSelector } from \"@/foundry/versioning/portselector\";\r\nimport type { PortRegistry } from \"@/foundry/versioning/portregistry\";\r\nimport { portSelectorToken, foundrySettingsPortRegistryToken } from \"@/foundry/foundrytokens\";\r\n\r\n/**\r\n * Service wrapper for FoundrySettings that automatically selects the appropriate port\r\n * based on the current Foundry version.\r\n *\r\n * Implements Disposable for resource cleanup consistency.\r\n */\r\nexport class FoundrySettingsService implements FoundrySettings, Disposable {\r\n  static dependencies = [portSelectorToken, foundrySettingsPortRegistryToken] as const;\r\n\r\n  private port: FoundrySettings | null = null;\r\n  private readonly portSelector: PortSelector;\r\n  private readonly portRegistry: PortRegistry<FoundrySettings>;\r\n\r\n  constructor(portSelector: PortSelector, portRegistry: PortRegistry<FoundrySettings>) {\r\n    this.portSelector = portSelector;\r\n    this.portRegistry = portRegistry;\r\n  }\r\n\r\n  /**\r\n   * Lazy-loads the appropriate port based on Foundry version.\r\n   * Uses PortSelector with factory-based selection to prevent eager instantiation.\r\n   *\r\n   * CRITICAL: This prevents crashes when newer port constructors access\r\n   * APIs not available in the current Foundry version.\r\n   *\r\n   * @returns Result containing the port or a FoundryError if no compatible port can be selected\r\n   */\r\n  private getPort(): Result<FoundrySettings, FoundryError> {\r\n    if (this.port === null) {\r\n      const factories = this.portRegistry.getFactories();\r\n      const portResult = this.portSelector.selectPortFromFactories(\r\n        factories,\r\n        undefined,\r\n        \"FoundrySettings\"\r\n      );\r\n      if (!portResult.ok) {\r\n        return portResult;\r\n      }\r\n      this.port = portResult.value;\r\n    }\r\n    return { ok: true, value: this.port };\r\n  }\r\n\r\n  register<T>(\r\n    namespace: string,\r\n    key: string,\r\n    config: SettingConfig<T>\r\n  ): Result<void, FoundryError> {\r\n    const portResult = this.getPort();\r\n    /* c8 ignore next -- Branch: Port error path tested in port selection tests */\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.register(namespace, key, config);\r\n  }\r\n\r\n  get<T>(namespace: string, key: string): Result<T, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.get<T>(namespace, key);\r\n  }\r\n\r\n  async set<T>(namespace: string, key: string, value: T): Promise<Result<void, FoundryError>> {\r\n    const portResult = this.getPort();\r\n    /* c8 ignore next -- Branch: Port error path tested in port selection tests */\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.set(namespace, key, value);\r\n  }\r\n\r\n  /**\r\n   * Cleans up resources.\r\n   * Resets the port reference to allow garbage collection.\r\n   */\r\n  dispose(): void {\r\n    // Dispose port if it implements Disposable interface\r\n    /* c8 ignore start -- Defensive: Ports do not currently implement dispose(); reserved for future extensions */\r\n    if (this.port && \"dispose\" in this.port && typeof this.port.dispose === \"function\") {\r\n      // Double cast narrows from generic ServiceType to Disposable for runtime cleanup\r\n      /* type-coverage:ignore-next-line */\r\n      (this.port as unknown as Disposable).dispose();\r\n    }\r\n    /* c8 ignore stop */\r\n    this.port = null;\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryI18n } from \"@/foundry/interfaces/FoundryI18n\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { PortSelector } from \"@/foundry/versioning/portselector\";\r\nimport { PortRegistry } from \"@/foundry/versioning/portregistry\";\r\nimport { portSelectorToken, foundryI18nPortRegistryToken } from \"@/foundry/foundrytokens\";\r\n\r\n/**\r\n * Service wrapper for FoundryI18n that automatically selects the appropriate port\r\n * based on the current Foundry version.\r\n *\r\n * Uses lazy port loading to prevent crashes from incompatible API access.\r\n */\r\nexport class FoundryI18nService implements FoundryI18n {\r\n  static dependencies = [portSelectorToken, foundryI18nPortRegistryToken] as const;\r\n\r\n  private port: FoundryI18n | null = null;\r\n  private readonly portSelector: PortSelector;\r\n  private readonly portRegistry: PortRegistry<FoundryI18n>;\r\n\r\n  constructor(portSelector: PortSelector, portRegistry: PortRegistry<FoundryI18n>) {\r\n    this.portSelector = portSelector;\r\n    this.portRegistry = portRegistry;\r\n  }\r\n\r\n  /**\r\n   * Lazy-loads the appropriate port based on Foundry version.\r\n   *\r\n   * @returns Result containing the port or error if no compatible port can be selected\r\n   */\r\n  private getPort(): Result<FoundryI18n, FoundryError> {\r\n    if (this.port === null) {\r\n      const factories = this.portRegistry.getFactories();\r\n      const portResult = this.portSelector.selectPortFromFactories(\r\n        factories,\r\n        undefined,\r\n        \"FoundryI18n\"\r\n      );\r\n      if (!portResult.ok) {\r\n        return portResult;\r\n      }\r\n      this.port = portResult.value;\r\n    }\r\n    return { ok: true, value: this.port };\r\n  }\r\n\r\n  localize(key: string): Result<string, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.localize(key);\r\n  }\r\n\r\n  format(key: string, data: Record<string, unknown>): Result<string, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.format(key, data);\r\n  }\r\n\r\n  has(key: string): Result<boolean, FoundryError> {\r\n    const portResult = this.getPort();\r\n    if (!portResult.ok) return portResult;\r\n    return portResult.value.has(key);\r\n  }\r\n}\r\n","/**\r\n * Implementation of FoundryJournalFacade.\r\n *\r\n * Combines FoundryGame, FoundryDocument, and FoundryUI services\r\n * into a unified facade for journal operations.\r\n */\r\n\r\nimport type { Result } from \"@/types/result\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport type { FoundryJournalEntry } from \"@/foundry/types\";\r\nimport type { FoundryGame } from \"@/foundry/interfaces/FoundryGame\";\r\nimport type { FoundryDocument } from \"@/foundry/interfaces/FoundryDocument\";\r\nimport type { FoundryUI } from \"@/foundry/interfaces/FoundryUI\";\r\nimport type { FoundryJournalFacade as IFoundryJournalFacade } from \"./foundry-journal-facade.interface\";\r\nimport { foundryGameToken, foundryDocumentToken, foundryUIToken } from \"@/foundry/foundrytokens\";\r\nimport { MODULE_CONSTANTS } from \"@/constants\";\r\n\r\n/**\r\n * Facade for journal-related Foundry operations.\r\n *\r\n * **Benefits:**\r\n * - Reduces JournalVisibilityService dependencies from 4 to 2 (facade + logger)\r\n * - Provides cohesive journal-specific API\r\n * - Easier to test (single facade mock instead of 3 service mocks)\r\n * - Clear boundary for journal-related operations\r\n */\r\nexport class FoundryJournalFacade implements IFoundryJournalFacade {\r\n  static dependencies = [foundryGameToken, foundryDocumentToken, foundryUIToken] as const;\r\n\r\n  constructor(\r\n    private readonly game: FoundryGame,\r\n    private readonly document: FoundryDocument,\r\n    private readonly ui: FoundryUI\r\n  ) {}\r\n\r\n  /**\r\n   * Get all journal entries from Foundry.\r\n   *\r\n   * Delegates to FoundryGame.getJournalEntries().\r\n   */\r\n  getJournalEntries(): Result<FoundryJournalEntry[], FoundryError> {\r\n    return this.game.getJournalEntries();\r\n  }\r\n\r\n  /**\r\n   * Get a module flag from a journal entry.\r\n   *\r\n   * Delegates to FoundryDocument.getFlag() with module scope.\r\n   *\r\n   * @template T - The flag value type\r\n   * @param entry - The journal entry object\r\n   * @param key - The flag key\r\n   */\r\n  getEntryFlag<T>(entry: unknown, key: string): Result<T | null, FoundryError> {\r\n    return this.document.getFlag<T>(\r\n      // Journal entries from Foundry provide getFlag; cast retains narrow interface\r\n      /* type-coverage:ignore-next-line */\r\n      entry as { getFlag: (scope: string, key: string) => unknown },\r\n      MODULE_CONSTANTS.MODULE.ID,\r\n      key\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Remove a journal element from the UI.\r\n   *\r\n   * Delegates to FoundryUI.removeJournalElement().\r\n   *\r\n   * @param id - Journal entry ID\r\n   * @param name - Journal entry name (for logging)\r\n   * @param html - HTML container element\r\n   */\r\n  removeJournalElement(id: string, name: string, html: HTMLElement): Result<void, FoundryError> {\r\n    return this.ui.removeJournalElement(id, name, html);\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport { ok } from \"@/utils/functional/result\";\r\n\r\n/**\r\n * Escapes special regex characters in a string.\r\n * Prevents regex injection when using user-provided strings in RegExp.\r\n *\r\n * @param str - String to escape\r\n * @returns Escaped string safe for use in RegExp\r\n */\r\nfunction escapeRegex(str: string): string {\r\n  return str.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n}\r\n\r\n/**\r\n * Local, Foundry-independent internationalization service.\r\n *\r\n * Provides fallback translations from JSON files when Foundry's i18n is unavailable.\r\n * Uses browser's locale detection for automatic language selection.\r\n *\r\n * **Design:**\r\n * - No Foundry dependency (can be used outside Foundry VTT)\r\n * - JSON-based translations loaded from `lang/` directory\r\n * - Browser locale detection via `navigator.language`\r\n * - Simple key-value lookup with fallback to key itself\r\n */\r\nexport class LocalI18nService {\r\n  static dependencies = [] as const;\r\n\r\n  private translations: Map<string, string> = new Map();\r\n  private currentLocale: string = \"en\";\r\n\r\n  constructor() {\r\n    this.detectLocale();\r\n  }\r\n\r\n  /**\r\n   * Detects browser locale and sets current language.\r\n   * Falls back to 'en' if detection fails.\r\n   */\r\n  private detectLocale(): void {\r\n    if (typeof navigator !== \"undefined\" && navigator.language) {\r\n      // Extract base language from locale (e.g., \"de-DE\"  \"de\")\r\n      const lang = navigator.language.split(\"-\")[0];\r\n      /* c8 ignore next -- Defensive: navigator.language.split always returns non-empty array; fallback is safety guard */\r\n      this.currentLocale = lang ?? \"en\";\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Loads translations from a JSON object.\r\n   * Useful for testing or pre-loaded translation data.\r\n   *\r\n   * @param translations - Object with key-value pairs\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const i18n = new LocalI18nService();\r\n   * i18n.loadTranslations({\r\n   *   \"MODULE.SETTINGS.enableFeature\": \"Enable Feature\",\r\n   *   \"MODULE.WELCOME\": \"Welcome, {name}!\"\r\n   * });\r\n   * ```\r\n   */\r\n  loadTranslations(translations: Record<string, string>): void {\r\n    for (const [key, value] of Object.entries(translations)) {\r\n      this.translations.set(key, value);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Translates a key using local translations.\r\n   *\r\n   * @param key - Translation key\r\n   * @returns Result with translated string (or key itself if not found)\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const result = i18n.translate(\"MODULE.SETTINGS.enableFeature\");\r\n   * if (result.ok) {\r\n   *   console.log(result.value); // \"Enable Feature\" or key if not found\r\n   * }\r\n   * ```\r\n   */\r\n  translate(key: string): Result<string, string> {\r\n    const value = this.translations.get(key);\r\n    return ok(value ?? key); // Fallback to key itself if not found\r\n  }\r\n\r\n  /**\r\n   * Formats a string with placeholders.\r\n   * Simple implementation: replaces `{key}` with values from data object.\r\n   *\r\n   * @param key - Translation key\r\n   * @param data - Object with placeholder values\r\n   * @returns Result with formatted string\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * // Translation: \"Welcome, {name}!\"\r\n   * const result = i18n.format(\"MODULE.WELCOME\", { name: \"Alice\" });\r\n   * if (result.ok) {\r\n   *   console.log(result.value); // \"Welcome, Alice!\"\r\n   * }\r\n   * ```\r\n   */\r\n  format(key: string, data: Record<string, unknown>): Result<string, string> {\r\n    const template = this.translations.get(key) ?? key;\r\n    let formatted = template;\r\n\r\n    // Simple placeholder replacement: {key}  value\r\n    // Escape placeholder to prevent regex injection with special characters\r\n    for (const [placeholder, value] of Object.entries(data)) {\r\n      const escapedPlaceholder = escapeRegex(placeholder);\r\n      const regex = new RegExp(`\\\\{${escapedPlaceholder}\\\\}`, \"g\");\r\n      formatted = formatted.replace(regex, String(value));\r\n    }\r\n\r\n    return ok(formatted);\r\n  }\r\n\r\n  /**\r\n   * Checks if a translation key exists.\r\n   *\r\n   * @param key - Translation key to check\r\n   * @returns Result with boolean\r\n   */\r\n  has(key: string): Result<boolean, string> {\r\n    return ok(this.translations.has(key));\r\n  }\r\n\r\n  /**\r\n   * Gets the current locale.\r\n   *\r\n   * @returns Current locale string (e.g., \"en\", \"de\")\r\n   */\r\n  getCurrentLocale(): string {\r\n    return this.currentLocale;\r\n  }\r\n\r\n  /**\r\n   * Sets the current locale.\r\n   * Note: Changing locale requires reloading translations for the new language.\r\n   *\r\n   * @param locale - Locale code (e.g., \"en\", \"de\", \"fr\")\r\n   */\r\n  setLocale(locale: string): void {\r\n    this.currentLocale = locale;\r\n  }\r\n}\r\n","import type { FoundryI18nService } from \"@/foundry/services/FoundryI18nService\";\r\nimport type { LocalI18nService } from \"@/services/LocalI18nService\";\r\nimport { foundryI18nToken, localI18nToken } from \"@/tokens/tokenindex\";\r\n\r\n/**\r\n * Facade service that combines Foundry's i18n and local fallback translations.\r\n *\r\n * **Strategy: Foundry-First with Fallback**\r\n * 1. Try Foundry's `game.i18n` (if available and key exists)\r\n * 2. Fall back to local JSON-based translations\r\n * 3. Final fallback: return key itself or provided fallback string\r\n *\r\n * **Use Cases:**\r\n * - Development/testing without Foundry runtime (uses LocalI18nService)\r\n * - Production with Foundry VTT (uses FoundryI18nService)\r\n * - Graceful degradation when translations are missing\r\n *\r\n * @example\r\n * ```typescript\r\n * const i18n = container.resolve(i18nFacadeToken);\r\n *\r\n * // Try Foundry first, then local, then fallback\r\n * const text = i18n.translate(\"MODULE.SETTINGS.enableFeature\", \"Enable Feature\");\r\n * console.log(text); // Translated or fallback\r\n * ```\r\n */\r\nexport class I18nFacadeService {\r\n  static dependencies = [foundryI18nToken, localI18nToken] as const;\r\n\r\n  constructor(\r\n    private readonly foundryI18n: FoundryI18nService,\r\n    private readonly localI18n: LocalI18nService\r\n  ) {}\r\n\r\n  /**\r\n   * Translates a key using Foundry i18n  Local i18n  Fallback.\r\n   *\r\n   * @param key - Translation key\r\n   * @param fallback - Optional fallback string (defaults to key itself)\r\n   * @returns Translated string or fallback\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * // With fallback\r\n   * const text = i18n.translate(\"MODULE.UNKNOWN_KEY\", \"Default Text\");\r\n   * console.log(text); // \"Default Text\"\r\n   *\r\n   * // Without fallback (returns key)\r\n   * const text2 = i18n.translate(\"MODULE.UNKNOWN_KEY\");\r\n   * console.log(text2); // \"MODULE.UNKNOWN_KEY\"\r\n   * ```\r\n   */\r\n  translate(key: string, fallback?: string): string {\r\n    // 1. Try Foundry's i18n\r\n    const foundryResult = this.foundryI18n.localize(key);\r\n    if (foundryResult.ok && foundryResult.value !== key) {\r\n      return foundryResult.value; // Foundry has a translation (not just the key)\r\n    }\r\n\r\n    // 2. Try local i18n\r\n    const localResult = this.localI18n.translate(key);\r\n    if (localResult.ok && localResult.value !== key) {\r\n      return localResult.value; // Local has a translation\r\n    }\r\n\r\n    // 3. Fallback\r\n    return fallback ?? key;\r\n  }\r\n\r\n  /**\r\n   * Formats a string with placeholders.\r\n   *\r\n   * @param key - Translation key\r\n   * @param data - Object with placeholder values\r\n   * @param fallback - Optional fallback string\r\n   * @returns Formatted string or fallback\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * const text = i18n.format(\"MODULE.WELCOME\", { name: \"Alice\" }, \"Welcome!\");\r\n   * console.log(text); // \"Welcome, Alice!\" or \"Welcome!\"\r\n   * ```\r\n   */\r\n  format(key: string, data: Record<string, unknown>, fallback?: string): string {\r\n    // 1. Try Foundry's i18n\r\n    const foundryResult = this.foundryI18n.format(key, data);\r\n    if (foundryResult.ok && foundryResult.value !== key) {\r\n      return foundryResult.value;\r\n    }\r\n\r\n    // 2. Try local i18n\r\n    const localResult = this.localI18n.format(key, data);\r\n    if (localResult.ok && localResult.value !== key) {\r\n      return localResult.value;\r\n    }\r\n\r\n    // 3. Fallback\r\n    return fallback ?? key;\r\n  }\r\n\r\n  /**\r\n   * Checks if a translation key exists in either i18n system.\r\n   *\r\n   * @param key - Translation key to check\r\n   * @returns True if key exists in Foundry or local i18n\r\n   */\r\n  has(key: string): boolean {\r\n    // Check Foundry first\r\n    const foundryResult = this.foundryI18n.has(key);\r\n    if (foundryResult.ok && foundryResult.value) {\r\n      return true;\r\n    }\r\n\r\n    // Check local i18n\r\n    const localResult = this.localI18n.has(key);\r\n    return localResult.ok && localResult.value;\r\n  }\r\n\r\n  /**\r\n   * Loads local translations from a JSON object.\r\n   * Useful for initializing translations on module startup.\r\n   *\r\n   * @param translations - Object with key-value pairs\r\n   *\r\n   * @example\r\n   * ```typescript\r\n   * i18n.loadLocalTranslations({\r\n   *   \"MODULE.SETTINGS.enableFeature\": \"Enable Feature\",\r\n   *   \"MODULE.WELCOME\": \"Welcome, {name}!\"\r\n   * });\r\n   * ```\r\n   */\r\n  loadLocalTranslations(translations: Record<string, string>): void {\r\n    this.localI18n.loadTranslations(translations);\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\nimport { createFoundryError, type FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { VALIDATION_CONSTRAINTS } from \"@/constants\";\r\n\r\n/**\r\n * Validates a journal entry ID.\r\n *\r\n * Fast manual validation optimized for hot-path operations.\r\n * Validates format, length, and character constraints.\r\n *\r\n * Rules:\r\n * - Must be a non-empty string\r\n * - Maximum 100 characters (VALIDATION_CONSTRAINTS.MAX_ID_LENGTH)\r\n * - Only alphanumeric characters, hyphens, and underscores\r\n *\r\n * @param id - Journal entry ID to validate\r\n * @returns Result with validated ID or FoundryError\r\n *\r\n * @example\r\n * ```typescript\r\n * const result = validateJournalId(\"journal-entry-123\");\r\n * if (result.ok) {\r\n *   // Safe to use result.value\r\n * }\r\n * ```\r\n */\r\nexport function validateJournalId(id: string): Result<string, FoundryError> {\r\n  /* c8 ignore start -- TypeScript ensures id is string at compile time; runtime check is defensive */\r\n  if (typeof id !== \"string\") {\r\n    return err(createFoundryError(\"VALIDATION_FAILED\", \"ID must be a string\"));\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  if (id.length === 0) {\r\n    return err(createFoundryError(\"VALIDATION_FAILED\", \"ID cannot be empty\"));\r\n  }\r\n\r\n  if (id.length > VALIDATION_CONSTRAINTS.MAX_ID_LENGTH) {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        `ID too long (max ${VALIDATION_CONSTRAINTS.MAX_ID_LENGTH} characters)`\r\n      )\r\n    );\r\n  }\r\n\r\n  if (!/^[a-zA-Z0-9-_]+$/.test(id)) {\r\n    return err(\r\n      createFoundryError(\r\n        \"VALIDATION_FAILED\",\r\n        \"ID contains invalid characters (allowed: a-z, A-Z, 0-9, -, _)\",\r\n        { id }\r\n      )\r\n    );\r\n  }\r\n\r\n  return ok(id);\r\n}\r\n\r\n/**\r\n * Validates a journal entry name.\r\n *\r\n * Rules:\r\n * - Must be a non-empty string\r\n * - Maximum 255 characters\r\n *\r\n * @param name - Journal entry name to validate\r\n * @returns Result with validated name or FoundryError\r\n */\r\nexport function validateJournalName(name: string): Result<string, FoundryError> {\r\n  if (typeof name !== \"string\" || name.length === 0) {\r\n    return err(createFoundryError(\"VALIDATION_FAILED\", \"Name cannot be empty\"));\r\n  }\r\n\r\n  if (name.length > 255) {\r\n    return err(createFoundryError(\"VALIDATION_FAILED\", \"Name too long (max 255 characters)\"));\r\n  }\r\n\r\n  return ok(name);\r\n}\r\n\r\n/**\r\n * Validates a module flag key.\r\n *\r\n * Rules:\r\n * - Must be a non-empty string\r\n * - Maximum 100 characters (VALIDATION_CONSTRAINTS.MAX_ID_LENGTH)\r\n * - Only alphanumeric characters and underscores\r\n *\r\n * @param key - Flag key to validate\r\n * @returns Result with validated key or FoundryError\r\n */\r\nexport function validateFlagKey(key: string): Result<string, FoundryError> {\r\n  if (\r\n    typeof key !== \"string\" ||\r\n    key.length === 0 ||\r\n    key.length > VALIDATION_CONSTRAINTS.MAX_FLAG_KEY_LENGTH\r\n  ) {\r\n    return err(createFoundryError(\"VALIDATION_FAILED\", \"Invalid flag key length\"));\r\n  }\r\n\r\n  if (!/^[a-zA-Z0-9_]+$/.test(key)) {\r\n    return err(createFoundryError(\"VALIDATION_FAILED\", \"Invalid flag key format\"));\r\n  }\r\n\r\n  return ok(key);\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryGame } from \"@/foundry/interfaces/FoundryGame\";\r\nimport type { FoundryJournalEntry } from \"@/foundry/types\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { tryCatch, err } from \"@/utils/functional/result\";\r\nimport { createFoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { validateJournalEntries } from \"@/foundry/validation/schemas\";\r\nimport { validateJournalId } from \"@/foundry/validation/input-validators\";\r\nimport { MODULE_CONSTANTS } from \"@/constants\";\r\n\r\n/**\r\n * v13 implementation of FoundryGame interface.\r\n * Encapsulates Foundry v13-specific game API access.\r\n *\r\n * Performance optimization: Caches validated journal entries with TTL-based invalidation\r\n * to avoid expensive Valibot validation on every call. Cache expires after 5 seconds.\r\n */\r\nexport class FoundryGamePortV13 implements FoundryGame {\r\n  private cachedEntries: FoundryJournalEntry[] | null = null;\r\n  private lastCheckTimestamp = 0;\r\n  private readonly cacheTtlMs = MODULE_CONSTANTS.DEFAULTS.CACHE_TTL_MS;\r\n\r\n  getJournalEntries(): Result<FoundryJournalEntry[], FoundryError> {\r\n    if (typeof game === \"undefined\" || !game?.journal) {\r\n      return err(createFoundryError(\"API_NOT_AVAILABLE\", \"Foundry game API not available\"));\r\n    }\r\n\r\n    const now = Date.now();\r\n    const cacheAge = now - this.lastCheckTimestamp;\r\n\r\n    // Check TTL-based cache validity\r\n    if (this.cachedEntries !== null && cacheAge < this.cacheTtlMs) {\r\n      // Cache hit - return cached entries\r\n      return { ok: true, value: this.cachedEntries };\r\n    }\r\n\r\n    // Cache miss - fetch fresh entries\r\n\r\n    // game.journal is typed as DocumentCollection<JournalEntry> by fvtt-types\r\n    // DocumentCollection.contents is an array of the stored documents\r\n    const entries = tryCatch(\r\n      () => Array.from(game.journal.contents),\r\n      (error) =>\r\n        createFoundryError(\"OPERATION_FAILED\", \"Failed to access journal entries\", undefined, error)\r\n    );\r\n\r\n    if (!entries.ok) {\r\n      return entries;\r\n    }\r\n\r\n    // Validate entries to ensure they have expected structure (expensive, cached for TTL duration)\r\n    // IMPORTANT: Use validation as guard only, keep original Foundry objects with prototypes\r\n    const validationResult = validateJournalEntries(entries.value);\r\n    if (!validationResult.ok) {\r\n      // Return validation error directly (preserves VALIDATION_FAILED code and details)\r\n      return validationResult;\r\n    }\r\n\r\n    // Update cache with ORIGINAL entries (preserving Foundry prototypes like sheet.render, update, etc.)\r\n    // Do NOT cache validationResult.value as it strips prototypes\r\n    this.cachedEntries = entries.value;\r\n    this.lastCheckTimestamp = now;\r\n\r\n    return { ok: true, value: this.cachedEntries };\r\n  }\r\n\r\n  /**\r\n   * Invalidates the journal entries cache.\r\n   * Forces the next getJournalEntries() call to fetch and validate fresh data.\r\n   */\r\n  invalidateCache(): void {\r\n    this.cachedEntries = null;\r\n    this.lastCheckTimestamp = 0;\r\n  }\r\n\r\n  getJournalEntryById(id: string): Result<FoundryJournalEntry | null, FoundryError> {\r\n    // Validate input\r\n    const validationResult = validateJournalId(id);\r\n    /* c8 ignore start -- Input validation tested in input-validators.test.ts */\r\n    if (!validationResult.ok) {\r\n      return validationResult;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    if (typeof game === \"undefined\" || !game?.journal) {\r\n      return err(createFoundryError(\"API_NOT_AVAILABLE\", \"Foundry game API not available\"));\r\n    }\r\n\r\n    return tryCatch(\r\n      () => {\r\n        // game.journal.get() is typed by fvtt-types and returns JournalEntry | undefined\r\n        const entry = game.journal.get(validationResult.value);\r\n        return entry ?? null;\r\n      },\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to get journal entry by ID ${validationResult.value}`,\r\n          { id: validationResult.value },\r\n          error\r\n        )\r\n    );\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryHooks } from \"@/foundry/interfaces/FoundryHooks\";\r\nimport type { FoundryHookCallback } from \"@/foundry/types\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { tryCatch } from \"@/utils/functional/result\";\r\nimport { createFoundryError } from \"@/foundry/errors/FoundryErrors\";\r\n\r\n/**\r\n * Type-safe interface for Foundry Hooks with dynamic hook names.\r\n * Avoids 'any' while working around fvtt-types strict hook name typing.\r\n */\r\ninterface DynamicHooksApi {\r\n  on(hookName: string, callback: (...args: unknown[]) => unknown): number;\r\n  once(hookName: string, callback: (...args: unknown[]) => unknown): number;\r\n  off(hookName: string, callbackOrId: number | ((...args: unknown[]) => unknown)): void;\r\n}\r\n\r\n/**\r\n * v13 implementation of FoundryHooks interface.\r\n * Encapsulates Foundry v13-specific hook system access.\r\n *\r\n * Based on Foundry VTT v13 Hooks API:\r\n * https://foundryvtt.com/api/classes/foundry.helpers.Hooks.html\r\n */\r\nexport class FoundryHooksPortV13 implements FoundryHooks {\r\n  on(hookName: string, callback: FoundryHookCallback): Result<number, FoundryError> {\r\n    return tryCatch(\r\n      () => {\r\n        if (typeof Hooks === \"undefined\") {\r\n          throw new Error(\"Foundry Hooks API is not available\");\r\n        }\r\n        // Type-safe cast for dynamic hook names\r\n        // Foundry's Hooks API supports dynamic hook names, but fvtt-types\r\n        // has strict keyof HookConfig typing that doesn't allow runtime strings\r\n        const hookId = (Hooks as DynamicHooksApi).on(hookName, callback);\r\n        return hookId;\r\n      },\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to register hook ${hookName}`,\r\n          { hookName },\r\n          error\r\n        )\r\n    );\r\n  }\r\n\r\n  once(hookName: string, callback: FoundryHookCallback): Result<number, FoundryError> {\r\n    return tryCatch(\r\n      () => {\r\n        if (typeof Hooks === \"undefined\") {\r\n          throw new Error(\"Foundry Hooks API is not available\");\r\n        }\r\n        // Type-safe cast for dynamic hook names\r\n        // Foundry's Hooks API supports dynamic hook names, but fvtt-types\r\n        // has strict keyof HookConfig typing that doesn't allow runtime strings\r\n        const hookId = (Hooks as DynamicHooksApi).once(hookName, callback);\r\n        return hookId;\r\n      },\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to register one-time hook ${hookName}`,\r\n          { hookName },\r\n          error\r\n        )\r\n    );\r\n  }\r\n\r\n  off(hookName: string, callbackOrId: FoundryHookCallback | number): Result<void, FoundryError> {\r\n    return tryCatch(\r\n      () => {\r\n        if (typeof Hooks === \"undefined\") {\r\n          throw new Error(\"Foundry Hooks API is not available\");\r\n        }\r\n        // Type-safe cast for dynamic hook names\r\n        // Foundry's Hooks API supports dynamic hook names, but fvtt-types\r\n        // has strict keyof HookConfig typing that doesn't allow runtime strings\r\n        (Hooks as DynamicHooksApi).off(hookName, callbackOrId);\r\n        return undefined;\r\n      },\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to unregister hook ${hookName}`,\r\n          { hookName },\r\n          error\r\n        )\r\n    );\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryDocument } from \"@/foundry/interfaces/FoundryDocument\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { fromPromise, tryCatch } from \"@/utils/functional/result\";\r\nimport { createFoundryError } from \"@/foundry/errors/FoundryErrors\";\r\n\r\n/**\r\n * v13 implementation of FoundryDocument interface.\r\n * Encapsulates Foundry v13-specific document operations.\r\n */\r\nexport class FoundryDocumentPortV13 implements FoundryDocument {\r\n  getFlag<T = unknown>(\r\n    document: { getFlag: (scope: string, key: string) => unknown },\r\n    scope: string,\r\n    key: string\r\n  ): Result<T | null, FoundryError> {\r\n    return tryCatch(\r\n      () => {\r\n        if (!document?.getFlag) {\r\n          throw new Error(\"Document does not have getFlag method\");\r\n        }\r\n        // Foundry getFlag returns unknown; cast narrows to expected generic type while preserving null fallback\r\n        /* type-coverage:ignore-next-line */\r\n        const value = document.getFlag(scope, key) as T | null | undefined;\r\n        return value ?? null;\r\n      },\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to get flag ${scope}.${key}`,\r\n          { scope, key },\r\n          error\r\n        )\r\n    );\r\n  }\r\n\r\n  async setFlag<T = unknown>(\r\n    document: { setFlag: (scope: string, key: string, value: T) => Promise<unknown> },\r\n    scope: string,\r\n    key: string,\r\n    value: T\r\n  ): Promise<Result<void, FoundryError>> {\r\n    return fromPromise<void, FoundryError>(\r\n      (async () => {\r\n        if (!document?.setFlag) {\r\n          throw new Error(\"Document does not have setFlag method\");\r\n        }\r\n        await document.setFlag(scope, key, value);\r\n      })(),\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to set flag ${scope}.${key}`,\r\n          { scope, key, value },\r\n          error\r\n        )\r\n    );\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryUI } from \"@/foundry/interfaces/FoundryUI\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\nimport { createFoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { sanitizeId } from \"@/foundry/validation/schemas\";\r\n\r\n/**\r\n * v13 implementation of FoundryUI interface.\r\n * Encapsulates Foundry v13-specific UI manipulation.\r\n */\r\nexport class FoundryUIPortV13 implements FoundryUI {\r\n  removeJournalElement(\r\n    journalId: string,\r\n    journalName: string,\r\n    html: HTMLElement\r\n  ): Result<void, FoundryError> {\r\n    // Sanitize ID to prevent CSS injection\r\n    const safeId = sanitizeId(journalId);\r\n\r\n    // Support both selectors: Foundry v13 uses data-document-id, older versions used data-entry-id\r\n    const element = html.querySelector(\r\n      `li.directory-item[data-document-id=\"${safeId}\"], li.directory-item[data-entry-id=\"${safeId}\"]`\r\n    ) as HTMLElement | null;\r\n\r\n    if (!element) {\r\n      return err(\r\n        createFoundryError(\r\n          \"NOT_FOUND\",\r\n          `Could not find element for journal entry: ${journalName}`,\r\n          { journalName, journalId: safeId }\r\n        )\r\n      );\r\n    }\r\n\r\n    try {\r\n      element.remove();\r\n      return ok(undefined);\r\n    } catch (error) {\r\n      return err(\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          \"Failed to remove element from DOM\",\r\n          { journalName, journalId: safeId },\r\n          error\r\n        )\r\n      );\r\n    }\r\n  }\r\n\r\n  findElement(container: HTMLElement, selector: string): Result<HTMLElement | null, FoundryError> {\r\n    const element = container.querySelector(selector) as HTMLElement | null;\r\n    return ok(element);\r\n  }\r\n\r\n  notify(message: string, type: \"info\" | \"warning\" | \"error\"): Result<void, FoundryError> {\r\n    if (typeof ui === \"undefined\" || !ui?.notifications) {\r\n      return err(createFoundryError(\"API_NOT_AVAILABLE\", \"Foundry UI notifications not available\"));\r\n    }\r\n\r\n    try {\r\n      switch (type) {\r\n        case \"info\":\r\n          ui.notifications.info(message);\r\n          break;\r\n        case \"warning\":\r\n          ui.notifications.warn(message);\r\n          break;\r\n        case \"error\":\r\n          ui.notifications.error(message);\r\n          break;\r\n      }\r\n      return ok(undefined);\r\n    } catch (error) {\r\n      return err(\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          \"Failed to show notification\",\r\n          { message, type },\r\n          error\r\n        )\r\n      );\r\n    }\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundrySettings, SettingConfig } from \"@/foundry/interfaces/FoundrySettings\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { tryCatch, err, fromPromise } from \"@/utils/functional/result\";\r\nimport { createFoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { validateSettingConfig } from \"@/foundry/validation/schemas\";\r\n\r\n/**\r\n * Type-safe interface for Foundry Settings with dynamic namespaces.\r\n * Avoids 'any' while working around fvtt-types namespace restrictions.\r\n */\r\ninterface DynamicSettingsApi {\r\n  register<T>(namespace: string, key: string, config: SettingConfig<T>): void;\r\n  get<T>(namespace: string, key: string): T;\r\n  set<T>(namespace: string, key: string, value: T): Promise<T>;\r\n}\r\n\r\n/**\r\n * v13 implementation of FoundrySettings interface.\r\n * Encapsulates Foundry v13-specific settings API access.\r\n *\r\n * Supports all three setting scopes:\r\n * - world: Shared across all users in the world\r\n * - client: Browser/device-specific\r\n * - user: User-specific within a world (new in v13)\r\n */\r\nexport class FoundrySettingsPortV13 implements FoundrySettings {\r\n  register<T>(\r\n    namespace: string,\r\n    key: string,\r\n    config: SettingConfig<T>\r\n  ): Result<void, FoundryError> {\r\n    // Validate config before attempting registration\r\n    const configValidation = validateSettingConfig(namespace, key, config);\r\n    /* c8 ignore start -- Error propagation: validateSettingConfig tested in schemas.test.ts */\r\n    if (!configValidation.ok) {\r\n      return err(configValidation.error);\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    if (typeof game === \"undefined\" || !game?.settings) {\r\n      return err(createFoundryError(\"API_NOT_AVAILABLE\", \"Foundry settings API not available\"));\r\n    }\r\n\r\n    return tryCatch(\r\n      () => {\r\n        // Type-safe cast for dynamic namespaces\r\n        // Foundry's Settings API supports module namespaces, but fvtt-types\r\n        // restricts namespace to \"core\" only\r\n        /* type-coverage:ignore-next-line */\r\n        (game.settings as DynamicSettingsApi).register(namespace, key, config);\r\n        return undefined;\r\n      },\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to register setting ${namespace}.${key}`,\r\n          { namespace, key },\r\n          error\r\n        )\r\n    );\r\n  }\r\n\r\n  get<T>(namespace: string, key: string): Result<T, FoundryError> {\r\n    if (typeof game === \"undefined\" || !game?.settings) {\r\n      return err(createFoundryError(\"API_NOT_AVAILABLE\", \"Foundry settings API not available\"));\r\n    }\r\n\r\n    return tryCatch(\r\n      () =>\r\n        /* type-coverage:ignore-next-line */\r\n        (game.settings.get as (ns: string, key: string) => unknown)(namespace, key) as T,\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to get setting ${namespace}.${key}`,\r\n          { namespace, key },\r\n          error\r\n        )\r\n    );\r\n  }\r\n\r\n  async set<T>(namespace: string, key: string, value: T): Promise<Result<void, FoundryError>> {\r\n    if (typeof game === \"undefined\" || !game?.settings) {\r\n      return err(createFoundryError(\"API_NOT_AVAILABLE\", \"Foundry settings API not available\"));\r\n    }\r\n\r\n    return fromPromise(\r\n      /* type-coverage:ignore-next-line */\r\n      (game.settings.set as (ns: string, key: string, val: unknown) => Promise<unknown>)(\r\n        namespace,\r\n        key,\r\n        value\r\n      ).then(() => undefined),\r\n      (error) =>\r\n        createFoundryError(\r\n          \"OPERATION_FAILED\",\r\n          `Failed to set setting ${namespace}.${key}`,\r\n          { namespace, key, value },\r\n          error\r\n        )\r\n    );\r\n  }\r\n}\r\n","import type { Result } from \"@/types/result\";\r\nimport type { FoundryI18n } from \"@/foundry/interfaces/FoundryI18n\";\r\nimport type { FoundryError } from \"@/foundry/errors/FoundryErrors\";\r\nimport { ok } from \"@/utils/functional/result\";\r\n\r\n/**\r\n * Foundry VTT v13+ implementation of the i18n interface.\r\n *\r\n * Wraps `game.i18n` API with Result pattern for type-safe error handling.\r\n *\r\n * @implements {FoundryI18n}\r\n */\r\nexport class FoundryI18nPortV13 implements FoundryI18n {\r\n  static dependencies = [] as const;\r\n\r\n  /**\r\n   * Localizes a translation key using Foundry's i18n system.\r\n   *\r\n   * @param key - Translation key\r\n   * @returns Result with translated string (returns key itself if not found)\r\n   */\r\n  localize(key: string): Result<string, FoundryError> {\r\n    try {\r\n      /* c8 ignore start -- Requires Foundry game globals; tested in integration tests */\r\n      if (typeof game === \"undefined\" || !game?.i18n) {\r\n        return ok(key); // Graceful degradation: return key as-is\r\n      }\r\n      /* c8 ignore stop */\r\n\r\n      /* c8 ignore next -- Foundry API call; tested in integration tests */\r\n      const translated = game.i18n.localize(key);\r\n      return ok(translated);\r\n    } catch {\r\n      /* c8 ignore start -- Defensive error handling; game.i18n.localize rarely throws */\r\n      return ok(key); // Fallback: return key on error\r\n      /* c8 ignore stop */\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Formats a translation key with placeholder values.\r\n   *\r\n   * @param key - Translation key\r\n   * @param data - Object with placeholder values\r\n   * @returns Result with formatted string\r\n   */\r\n  format(key: string, data: Record<string, unknown>): Result<string, FoundryError> {\r\n    try {\r\n      /* c8 ignore start -- Requires Foundry game globals; tested in integration tests */\r\n      if (typeof game === \"undefined\" || !game?.i18n) {\r\n        return ok(key); // Graceful degradation\r\n      }\r\n      /* c8 ignore stop */\r\n\r\n      // Convert unknown values to strings for Foundry's type requirements\r\n      const stringData: Record<string, string> = {};\r\n      for (const [k, v] of Object.entries(data)) {\r\n        stringData[k] = String(v);\r\n      }\r\n\r\n      /* c8 ignore next -- Foundry API call; tested in integration tests */\r\n      const formatted = game.i18n.format(key, stringData);\r\n      return ok(formatted);\r\n    } catch {\r\n      /* c8 ignore start -- Defensive error handling; game.i18n.format rarely throws */\r\n      return ok(key); // Fallback: return key on error\r\n      /* c8 ignore stop */\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks if a translation key exists.\r\n   *\r\n   * @param key - Translation key to check\r\n   * @returns Result with boolean indicating existence\r\n   */\r\n  has(key: string): Result<boolean, FoundryError> {\r\n    try {\r\n      /* c8 ignore start -- Requires Foundry game globals; tested in integration tests */\r\n      if (typeof game === \"undefined\" || !game?.i18n) {\r\n        return ok(false); // No game.i18n available  key doesn't exist\r\n      }\r\n      /* c8 ignore stop */\r\n\r\n      /* c8 ignore next -- Foundry API call; tested in integration tests */\r\n      const exists = game.i18n.has(key);\r\n      return ok(exists);\r\n    } catch {\r\n      /* c8 ignore start -- Defensive error handling */\r\n      return ok(false); // Fallback: assume key doesn't exist on error\r\n      /* c8 ignore stop */\r\n    }\r\n  }\r\n}\r\n","import { ServiceContainer } from \"@/di_infrastructure/container\";\r\nimport {\r\n  loggerToken,\r\n  journalVisibilityServiceToken,\r\n  metricsCollectorToken,\r\n  metricsRecorderToken,\r\n  metricsSamplerToken,\r\n  foundryI18nToken,\r\n  localI18nToken,\r\n  i18nFacadeToken,\r\n  environmentConfigToken,\r\n  moduleHealthServiceToken,\r\n  performanceTrackingServiceToken,\r\n  retryServiceToken,\r\n} from \"@/tokens/tokenindex\";\r\nimport { ConsoleLoggerService } from \"@/services/consolelogger\";\r\nimport { JournalVisibilityService } from \"@/services/JournalVisibilityService\";\r\nimport { MetricsCollector } from \"@/observability/metrics-collector\";\r\nimport { ModuleHealthService } from \"@/core/module-health-service\";\r\nimport { PerformanceTrackingService } from \"@/services/PerformanceTrackingService\";\r\nimport { RetryService } from \"@/services/RetryService\";\r\nimport { ServiceLifecycle } from \"@/di_infrastructure/types/servicelifecycle\";\r\nimport { ok, err, isErr } from \"@/utils/functional/result\";\r\nimport type { Result } from \"@/types/result\";\r\nimport type { Logger } from \"@/interfaces/logger\";\r\nimport { ENV } from \"@/config/environment\";\r\nimport {\r\n  foundryGameToken,\r\n  foundryHooksToken,\r\n  foundryDocumentToken,\r\n  foundryUIToken,\r\n  foundrySettingsToken,\r\n  foundryI18nPortRegistryToken,\r\n  foundryJournalFacadeToken,\r\n  portSelectorToken,\r\n  foundryGamePortRegistryToken,\r\n  foundryHooksPortRegistryToken,\r\n  foundryDocumentPortRegistryToken,\r\n  foundryUIPortRegistryToken,\r\n  foundrySettingsPortRegistryToken,\r\n} from \"@/foundry/foundrytokens\";\r\nimport { PortSelector } from \"@/foundry/versioning/portselector\";\r\nimport { PortRegistry } from \"@/foundry/versioning/portregistry\";\r\nimport { PortSelectionObserver } from \"@/foundry/versioning/port-selection-observer\";\r\nimport { FoundryGameService } from \"@/foundry/services/FoundryGameService\";\r\nimport { FoundryHooksService } from \"@/foundry/services/FoundryHooksService\";\r\nimport { FoundryDocumentService } from \"@/foundry/services/FoundryDocumentService\";\r\nimport { FoundryUIService } from \"@/foundry/services/FoundryUIService\";\r\nimport { FoundrySettingsService } from \"@/foundry/services/FoundrySettingsService\";\r\nimport { FoundryI18nService } from \"@/foundry/services/FoundryI18nService\";\r\nimport { FoundryJournalFacade } from \"@/foundry/facades/foundry-journal-facade\";\r\nimport { LocalI18nService } from \"@/services/LocalI18nService\";\r\nimport { I18nFacadeService } from \"@/services/I18nFacadeService\";\r\nimport { FoundryGamePortV13 } from \"@/foundry/ports/v13/FoundryGamePort\";\r\nimport { FoundryHooksPortV13 } from \"@/foundry/ports/v13/FoundryHooksPort\";\r\nimport { FoundryDocumentPortV13 } from \"@/foundry/ports/v13/FoundryDocumentPort\";\r\nimport { FoundryUIPortV13 } from \"@/foundry/ports/v13/FoundryUIPort\";\r\nimport { FoundrySettingsPortV13 } from \"@/foundry/ports/v13/FoundrySettingsPort\";\r\nimport { FoundryI18nPortV13 } from \"@/foundry/ports/v13/FoundryI18nPort\";\r\nimport type { FoundryGame } from \"@/foundry/interfaces/FoundryGame\";\r\nimport type { FoundryHooks } from \"@/foundry/interfaces/FoundryHooks\";\r\nimport type { FoundryDocument } from \"@/foundry/interfaces/FoundryDocument\";\r\nimport type { FoundryUI } from \"@/foundry/interfaces/FoundryUI\";\r\nimport type { FoundrySettings } from \"@/foundry/interfaces/FoundrySettings\";\r\nimport type { FoundryI18n } from \"@/foundry/interfaces/FoundryI18n\";\r\n\r\n/**\r\n * Helper function for port registration.\r\n * Reduces duplication when registering multiple ports.\r\n *\r\n * @template T - The port type\r\n * @param registry - The port registry to register to\r\n * @param version - The Foundry version this port supports\r\n * @param factory - Factory function that creates the port instance\r\n * @param portName - Name of the port (for error messages)\r\n * @param errors - Array to collect error messages\r\n */\r\nfunction registerPortToRegistry<T>(\r\n  registry: PortRegistry<T>,\r\n  version: number,\r\n  factory: () => T,\r\n  portName: string,\r\n  errors: string[]\r\n): void {\r\n  const result = registry.register(version, factory);\r\n  /* c8 ignore start -- Defensive: Port registration can only fail if version is duplicate, which is controlled by hardcoded port registrations */\r\n  if (isErr(result)) {\r\n    errors.push(`${portName} v${version}: ${result.error}`);\r\n  }\r\n  /* c8 ignore stop */\r\n}\r\n\r\n/**\r\n * Configures all dependency injection mappings for the application.\r\n * This is the central place where tokens are connected to their factories.\r\n *\r\n * Also registers fallback factories for critical services that should always be available\r\n * even if container resolution fails.\r\n *\r\n * @param container - The service container to configure\r\n * @returns Result indicating success or configuration errors\r\n *\r\n * @example\r\n * ```typescript\r\n * const container = ServiceContainer.createRoot();\r\n * const result = configureDependencies(container);\r\n * if (isOk(result)) {\r\n *   const logger = container.resolve(loggerToken); // Direct resolution with fallback\r\n * }\r\n * ```\r\n */\r\n/**\r\n * Registers fallback factories for critical services.\r\n */\r\nfunction registerFallbacks(container: ServiceContainer): void {\r\n  container.registerFallback<Logger>(loggerToken, () => new ConsoleLoggerService());\r\n}\r\n\r\n/**\r\n * Registers core infrastructure services (EnvironmentConfig, MetricsCollector, Logger, ModuleHealthService).\r\n *\r\n * CRITICAL INITIALIZATION ORDER:\r\n * 1. EnvironmentConfig (no dependencies) - needed by MetricsCollector\r\n * 2. MetricsCollector (deps: [environmentConfigToken]) - needed by ServiceResolver\r\n * 3. MetricsRecorder/MetricsSampler (aliases to MetricsCollector) - segregated interfaces\r\n * 4. Logger (no dependencies) - needed by all services\r\n * 5. ModuleHealthService (deps: [container, metricsCollectorToken]) - special case with container self-reference\r\n *\r\n * Note: PortSelector now has zero dependencies and uses event-based observability.\r\n */\r\nfunction registerCoreServices(container: ServiceContainer): Result<void, string> {\r\n  // Register EnvironmentConfig (needed by MetricsCollector and PortSelector)\r\n  const envResult = container.registerValue(environmentConfigToken, ENV);\r\n\r\n  /* c8 ignore start -- Defensive: Value registration can only fail if token is duplicate */\r\n  if (isErr(envResult)) {\r\n    return err(`Failed to register EnvironmentConfig: ${envResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  // Register MetricsCollector (needed early for ServiceResolver and PortSelector)\r\n  const metricsResult = container.registerClass(\r\n    metricsCollectorToken,\r\n    MetricsCollector,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  /* c8 ignore start -- Defensive: MetricsCollector has no dependencies and cannot fail registration */\r\n  if (isErr(metricsResult)) {\r\n    return err(`Failed to register MetricsCollector: ${metricsResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  // Register segregated interface aliases for MetricsCollector (Interface Segregation Principle)\r\n  // This allows services to depend on only the interface they need\r\n  const recorderAliasResult = container.registerAlias(metricsRecorderToken, metricsCollectorToken);\r\n  /* c8 ignore start -- Defensive: Alias registration can only fail if token is duplicate */\r\n  if (isErr(recorderAliasResult)) {\r\n    return err(`Failed to register MetricsRecorder alias: ${recorderAliasResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  const samplerAliasResult = container.registerAlias(metricsSamplerToken, metricsCollectorToken);\r\n  /* c8 ignore start -- Defensive: Alias registration can only fail if token is duplicate */\r\n  if (isErr(samplerAliasResult)) {\r\n    return err(`Failed to register MetricsSampler alias: ${samplerAliasResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  // Register logger (needed by PortSelector and all services for structured logging)\r\n  const loggerResult = container.registerClass(\r\n    loggerToken,\r\n    ConsoleLoggerService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  if (isErr(loggerResult)) {\r\n    return err(`Failed to register logger: ${loggerResult.error.message}`);\r\n  }\r\n\r\n  // Register ModuleHealthService with factory (special case: needs container reference)\r\n  const healthResult = container.registerFactory(\r\n    moduleHealthServiceToken,\r\n    () => {\r\n      const metricsResult = container.resolveWithError(metricsCollectorToken);\r\n      /* c8 ignore start -- Defensive: MetricsCollector is always registered at this point */\r\n      if (!metricsResult.ok) {\r\n        throw new Error(\"MetricsCollector not available for ModuleHealthService\");\r\n      }\r\n      /* c8 ignore stop */\r\n      return new ModuleHealthService(container, metricsResult.value);\r\n    },\r\n    ServiceLifecycle.SINGLETON,\r\n    [metricsCollectorToken]\r\n  );\r\n\r\n  /* c8 ignore start -- Defensive: Factory registration can only fail if token is duplicate */\r\n  if (isErr(healthResult)) {\r\n    return err(`Failed to register ModuleHealthService: ${healthResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  return ok(undefined);\r\n}\r\n\r\n/**\r\n * Registers Ports to PortRegistries.\r\n * Returns the created registries for further processing.\r\n */\r\nfunction createPortRegistries(): Result<\r\n  {\r\n    gamePortRegistry: PortRegistry<FoundryGame>;\r\n    hooksPortRegistry: PortRegistry<FoundryHooks>;\r\n    documentPortRegistry: PortRegistry<FoundryDocument>;\r\n    uiPortRegistry: PortRegistry<FoundryUI>;\r\n    settingsPortRegistry: PortRegistry<FoundrySettings>;\r\n    i18nPortRegistry: PortRegistry<FoundryI18n>;\r\n  },\r\n  string\r\n> {\r\n  const portRegistrationErrors: string[] = [];\r\n\r\n  const gamePortRegistry = new PortRegistry<FoundryGame>();\r\n  registerPortToRegistry(\r\n    gamePortRegistry,\r\n    13,\r\n    () => new FoundryGamePortV13(),\r\n    \"FoundryGame\",\r\n    portRegistrationErrors\r\n  );\r\n\r\n  const hooksPortRegistry = new PortRegistry<FoundryHooks>();\r\n  registerPortToRegistry(\r\n    hooksPortRegistry,\r\n    13,\r\n    () => new FoundryHooksPortV13(),\r\n    \"FoundryHooks\",\r\n    portRegistrationErrors\r\n  );\r\n\r\n  const documentPortRegistry = new PortRegistry<FoundryDocument>();\r\n  registerPortToRegistry(\r\n    documentPortRegistry,\r\n    13,\r\n    () => new FoundryDocumentPortV13(),\r\n    \"FoundryDocument\",\r\n    portRegistrationErrors\r\n  );\r\n\r\n  const uiPortRegistry = new PortRegistry<FoundryUI>();\r\n  registerPortToRegistry(\r\n    uiPortRegistry,\r\n    13,\r\n    () => new FoundryUIPortV13(),\r\n    \"FoundryUI\",\r\n    portRegistrationErrors\r\n  );\r\n\r\n  const settingsPortRegistry = new PortRegistry<FoundrySettings>();\r\n  registerPortToRegistry(\r\n    settingsPortRegistry,\r\n    13,\r\n    () => new FoundrySettingsPortV13(),\r\n    \"FoundrySettings\",\r\n    portRegistrationErrors\r\n  );\r\n\r\n  const i18nPortRegistry = new PortRegistry<FoundryI18n>();\r\n  registerPortToRegistry(\r\n    i18nPortRegistry,\r\n    13,\r\n    () => new FoundryI18nPortV13(),\r\n    \"FoundryI18n\",\r\n    portRegistrationErrors\r\n  );\r\n\r\n  // Return early if any port registration failed\r\n  /* c8 ignore start -- Port registration errors already tested individually; aggregation is defensive */\r\n  if (portRegistrationErrors.length > 0) {\r\n    return err(`Port registration failed: ${portRegistrationErrors.join(\"; \")}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  return ok({\r\n    gamePortRegistry,\r\n    hooksPortRegistry,\r\n    documentPortRegistry,\r\n    uiPortRegistry,\r\n    settingsPortRegistry,\r\n    i18nPortRegistry,\r\n  });\r\n}\r\n\r\n/**\r\n * Registers PortSelector and PortRegistries in the container.\r\n *\r\n * **Observability:**\r\n * - PortSelector has zero dependencies (improved testability)\r\n * - PortSelectionObserver subscribes to PortSelector events for logging/metrics\r\n * - Observer pattern decouples port selection from observability concerns\r\n */\r\nfunction registerPortInfrastructure(container: ServiceContainer): Result<void, string> {\r\n  // Register PortSelector (no dependencies)\r\n  const portSelectorResult = container.registerClass(\r\n    portSelectorToken,\r\n    PortSelector,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  /* c8 ignore start -- Defensive: Class registration can only fail if token is duplicate or container is in invalid state, which cannot happen during normal bootstrap */\r\n  if (isErr(portSelectorResult)) {\r\n    return err(`Failed to register PortSelector: ${portSelectorResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  // Wire up observability: Create observer and subscribe to PortSelector events\r\n  // This is optional - only wire if all dependencies are available\r\n  const portSelectorResolve = container.resolveWithError(portSelectorToken);\r\n  const loggerResult = container.resolveWithError(loggerToken);\r\n  const recorderResult = container.resolveWithError(metricsRecorderToken);\r\n\r\n  /* c8 ignore start -- Defensive: Observer wiring is optional; only wire if all dependencies available */\r\n  if (portSelectorResolve.ok && loggerResult.ok && recorderResult.ok) {\r\n    const observer = new PortSelectionObserver(loggerResult.value, recorderResult.value);\r\n    portSelectorResolve.value.onEvent((event) => observer.handleEvent(event));\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  // Create port registries\r\n  const portsResult = createPortRegistries();\r\n  /* c8 ignore next -- Error propagation: createPortRegistries failure tested in sub-function */\r\n  if (isErr(portsResult)) return portsResult;\r\n\r\n  const {\r\n    gamePortRegistry,\r\n    hooksPortRegistry,\r\n    documentPortRegistry,\r\n    uiPortRegistry,\r\n    settingsPortRegistry,\r\n    i18nPortRegistry,\r\n  } = portsResult.value;\r\n\r\n  const gameRegistryResult = container.registerValue(\r\n    foundryGamePortRegistryToken,\r\n    gamePortRegistry\r\n  );\r\n  if (isErr(gameRegistryResult)) {\r\n    return err(`Failed to register FoundryGame PortRegistry: ${gameRegistryResult.error.message}`);\r\n  }\r\n\r\n  const hooksRegistryResult = container.registerValue(\r\n    foundryHooksPortRegistryToken,\r\n    hooksPortRegistry\r\n  );\r\n  /* c8 ignore start -- Defensive: Value registration can only fail if token is duplicate or container is in invalid state, which cannot happen during normal bootstrap */\r\n  if (isErr(hooksRegistryResult)) {\r\n    return err(\r\n      `Failed to register FoundryHooks PortRegistry: ${hooksRegistryResult.error.message}`\r\n    );\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  const documentRegistryResult = container.registerValue(\r\n    foundryDocumentPortRegistryToken,\r\n    documentPortRegistry\r\n  );\r\n  /* c8 ignore start -- Defensive: Value registration can only fail if token is duplicate or container is in invalid state, which cannot happen during normal bootstrap */\r\n  if (isErr(documentRegistryResult)) {\r\n    return err(\r\n      `Failed to register FoundryDocument PortRegistry: ${documentRegistryResult.error.message}`\r\n    );\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  const uiRegistryResult = container.registerValue(foundryUIPortRegistryToken, uiPortRegistry);\r\n  /* c8 ignore start -- Defensive: Value registration can only fail if token is duplicate or container is in invalid state, which cannot happen during normal bootstrap */\r\n  if (isErr(uiRegistryResult)) {\r\n    return err(`Failed to register FoundryUI PortRegistry: ${uiRegistryResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  const settingsRegistryResult = container.registerValue(\r\n    foundrySettingsPortRegistryToken,\r\n    settingsPortRegistry\r\n  );\r\n  if (isErr(settingsRegistryResult)) {\r\n    return err(\r\n      `Failed to register FoundrySettings PortRegistry: ${settingsRegistryResult.error.message}`\r\n    );\r\n  }\r\n\r\n  const i18nRegistryResult = container.registerValue(\r\n    foundryI18nPortRegistryToken,\r\n    i18nPortRegistry\r\n  );\r\n  /* c8 ignore start -- Defensive: PortRegistry value registration cannot fail; tested in other registry registrations */\r\n  if (isErr(i18nRegistryResult)) {\r\n    return err(`Failed to register FoundryI18n PortRegistry: ${i18nRegistryResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  return ok(undefined);\r\n}\r\n\r\n/**\r\n * Registers Foundry service wrappers.\r\n */\r\nfunction registerFoundryServices(container: ServiceContainer): Result<void, string> {\r\n  // Register Foundry Services using registerClass (with static dependencies)\r\n  const gameServiceResult = container.registerClass(\r\n    foundryGameToken,\r\n    FoundryGameService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  if (isErr(gameServiceResult)) {\r\n    return err(`Failed to register FoundryGame service: ${gameServiceResult.error.message}`);\r\n  }\r\n\r\n  const hooksServiceResult = container.registerClass(\r\n    foundryHooksToken,\r\n    FoundryHooksService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  if (isErr(hooksServiceResult)) {\r\n    return err(`Failed to register FoundryHooks service: ${hooksServiceResult.error.message}`);\r\n  }\r\n\r\n  const documentServiceResult = container.registerClass(\r\n    foundryDocumentToken,\r\n    FoundryDocumentService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  if (isErr(documentServiceResult)) {\r\n    return err(\r\n      `Failed to register FoundryDocument service: ${documentServiceResult.error.message}`\r\n    );\r\n  }\r\n\r\n  const uiServiceResult = container.registerClass(\r\n    foundryUIToken,\r\n    FoundryUIService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  if (isErr(uiServiceResult)) {\r\n    return err(`Failed to register FoundryUI service: ${uiServiceResult.error.message}`);\r\n  }\r\n\r\n  const settingsServiceResult = container.registerClass(\r\n    foundrySettingsToken,\r\n    FoundrySettingsService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  if (isErr(settingsServiceResult)) {\r\n    return err(\r\n      `Failed to register FoundrySettings service: ${settingsServiceResult.error.message}`\r\n    );\r\n  }\r\n\r\n  // Register FoundryJournalFacade (combines Game, Document, UI for journal operations)\r\n  // Must be registered BEFORE JournalVisibilityService which depends on it\r\n  const journalFacadeResult = container.registerClass(\r\n    foundryJournalFacadeToken,\r\n    FoundryJournalFacade,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  /* c8 ignore start -- Defensive: FoundryJournalFacade registration cannot fail with valid dependencies */\r\n  if (isErr(journalFacadeResult)) {\r\n    return err(`Failed to register FoundryJournalFacade: ${journalFacadeResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  const journalVisibilityResult = container.registerClass(\r\n    journalVisibilityServiceToken,\r\n    JournalVisibilityService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n\r\n  if (isErr(journalVisibilityResult)) {\r\n    return err(\r\n      `Failed to register JournalVisibility service: ${journalVisibilityResult.error.message}`\r\n    );\r\n  }\r\n\r\n  return ok(undefined);\r\n}\r\n\r\n/**\r\n * Registers utility services (PerformanceTracking, Retry).\r\n */\r\nfunction registerUtilityServices(container: ServiceContainer): Result<void, string> {\r\n  // Register PerformanceTrackingService\r\n  const perfTrackingResult = container.registerClass(\r\n    performanceTrackingServiceToken,\r\n    PerformanceTrackingService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n  /* c8 ignore start -- Defensive: Service registration can only fail if token is duplicate or dependencies are invalid */\r\n  if (isErr(perfTrackingResult)) {\r\n    return err(\r\n      `Failed to register PerformanceTrackingService: ${perfTrackingResult.error.message}`\r\n    );\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  // Register RetryService\r\n  const retryServiceResult = container.registerClass(\r\n    retryServiceToken,\r\n    RetryService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n  /* c8 ignore start -- Defensive: Service registration can only fail if token is duplicate or dependencies are invalid */\r\n  if (isErr(retryServiceResult)) {\r\n    return err(`Failed to register RetryService: ${retryServiceResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  return ok(undefined);\r\n}\r\n\r\n/**\r\n * Registers i18n services (Foundry, Local, and Facade).\r\n */\r\nfunction registerI18nServices(container: ServiceContainer): Result<void, string> {\r\n  // Register FoundryI18nService\r\n  const foundryI18nResult = container.registerClass(\r\n    foundryI18nToken,\r\n    FoundryI18nService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n  /* c8 ignore start -- Defensive: Service registration can only fail if token is duplicate or dependencies are invalid */\r\n  if (isErr(foundryI18nResult)) {\r\n    return err(`Failed to register FoundryI18nService: ${foundryI18nResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  // Register LocalI18nService\r\n  const localI18nResult = container.registerClass(\r\n    localI18nToken,\r\n    LocalI18nService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n  /* c8 ignore start -- Defensive: Service registration can only fail if token is duplicate or dependencies are invalid */\r\n  if (isErr(localI18nResult)) {\r\n    return err(`Failed to register LocalI18nService: ${localI18nResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  // Register I18nFacadeService\r\n  const facadeResult = container.registerClass(\r\n    i18nFacadeToken,\r\n    I18nFacadeService,\r\n    ServiceLifecycle.SINGLETON\r\n  );\r\n  /* c8 ignore start -- Defensive: Service registration can only fail if token is duplicate or dependencies are invalid */\r\n  if (isErr(facadeResult)) {\r\n    return err(`Failed to register I18nFacadeService: ${facadeResult.error.message}`);\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  return ok(undefined);\r\n}\r\n\r\n/**\r\n * Validates the container configuration.\r\n */\r\nfunction validateContainer(container: ServiceContainer): Result<void, string> {\r\n  const validateResult = container.validate();\r\n  /* c8 ignore start -- Defensive: Validation can only fail if dependencies are missing or circular, which cannot happen with hardcoded dependency graph */\r\n  if (isErr(validateResult)) {\r\n    const errorMessages = validateResult.error.map((e) => e.message).join(\", \");\r\n    return err(`Validation failed: ${errorMessages}`);\r\n  }\r\n  /* c8 ignore stop */\r\n  return ok(undefined);\r\n}\r\n\r\n/**\r\n * Configures logger with environment settings.\r\n */\r\nfunction configureLogger(container: ServiceContainer): void {\r\n  const resolvedLoggerResult = container.resolveWithError(loggerToken);\r\n  if (resolvedLoggerResult.ok) {\r\n    const loggerInstance = resolvedLoggerResult.value;\r\n    if (loggerInstance.setMinLevel) {\r\n      loggerInstance.setMinLevel(ENV.logLevel);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Main configuration orchestrator.\r\n * Configures all dependencies, registries, and services in the container.\r\n *\r\n * @param container - The DI container to configure\r\n * @returns Result indicating success or error with details\r\n *\r\n * @example\r\n * ```typescript\r\n * const container = ServiceContainer.createRoot();\r\n * const result = configureDependencies(container);\r\n * if (isOk(result)) {\r\n *   const logger = container.resolve(loggerToken);\r\n * }\r\n * ```\r\n */\r\nexport function configureDependencies(container: ServiceContainer): Result<void, string> {\r\n  registerFallbacks(container);\r\n\r\n  const coreResult = registerCoreServices(container);\r\n  if (isErr(coreResult)) return coreResult;\r\n\r\n  const utilityResult = registerUtilityServices(container);\r\n  /* c8 ignore next -- Error propagation: registerUtilityServices failure tested in sub-function */\r\n  if (isErr(utilityResult)) return utilityResult;\r\n\r\n  const portInfraResult = registerPortInfrastructure(container);\r\n  if (isErr(portInfraResult)) return portInfraResult;\r\n\r\n  const foundryServicesResult = registerFoundryServices(container);\r\n  if (isErr(foundryServicesResult)) return foundryServicesResult;\r\n\r\n  const i18nServicesResult = registerI18nServices(container);\r\n  /* c8 ignore next -- Error propagation: registerI18nServices failure tested in sub-function */\r\n  if (isErr(i18nServicesResult)) return i18nServicesResult;\r\n\r\n  const validationResult = validateContainer(container);\r\n  /* c8 ignore next -- Error propagation: validateContainer failure tested in sub-function */\r\n  if (isErr(validationResult)) return validationResult;\r\n\r\n  configureLogger(container);\r\n\r\n  return ok(undefined);\r\n}\r\n","import { MODULE_CONSTANTS } from \"@/constants\";\r\nimport type { Result } from \"@/types/result\";\r\nimport { ServiceContainer } from \"@/di_infrastructure/container\";\r\nimport { configureDependencies } from \"@/config/dependencyconfig\";\r\nimport type { InjectionToken } from \"@/di_infrastructure/types/injectiontoken\";\r\nimport { markAsApiSafe } from \"@/di_infrastructure/types/api-safe-token\";\r\nimport type { ModuleApi, ModuleApiTokens, TokenInfo, HealthStatus } from \"@/core/module-api\";\r\nimport type { ServiceType } from \"@/types/servicetypeindex\";\r\nimport { ENV } from \"@/config/environment\";\r\nimport { BootstrapPerformanceTracker } from \"@/observability/bootstrap-performance-tracker\";\r\nimport {\r\n  loggerToken,\r\n  journalVisibilityServiceToken,\r\n  metricsCollectorToken,\r\n  moduleHealthServiceToken,\r\n} from \"@/tokens/tokenindex\";\r\nimport {\r\n  foundryGameToken,\r\n  foundryHooksToken,\r\n  foundryDocumentToken,\r\n  foundryUIToken,\r\n  foundrySettingsToken,\r\n} from \"@/foundry/foundrytokens\";\r\n\r\n/**\r\n * CompositionRoot\r\n *\r\n * Zentraler Bootkernel: erstellt den DI-Container, fhrt die Basis-Registrierungen\r\n * via configureDependencies aus und stellt die ffentliche Modul-API (nur resolve)\r\n * unter game.modules.get(MODULE_ID).api bereit.\r\n *\r\n * Zweiphasiger Bootstrap:\r\n * - Phase 1 (vor Foundry init): Container erstellen und Grund-Registrierungen.\r\n * - Phase 2 (im Foundry init): Ports selektieren/binden und Hooks registrieren.\r\n */\r\nexport class CompositionRoot {\r\n  private container: ServiceContainer | null = null;\r\n\r\n  /**\r\n   * Erstellt den ServiceContainer und fhrt Basis-Registrierungen aus.\r\n   * Misst Performance fr Diagnose-Zwecke.\r\n   *\r\n   * **Performance Tracking:**\r\n   * Uses BootstrapPerformanceTracker with ENV (direct import) and null MetricsCollector.\r\n   * MetricsCollector is not yet available during bootstrap phase.\r\n   *\r\n   * @returns Result mit initialisiertem Container oder Fehlermeldung\r\n   */\r\n  bootstrap(): Result<ServiceContainer, string> {\r\n    const container = ServiceContainer.createRoot();\r\n\r\n    // Track bootstrap performance (no MetricsCollector yet)\r\n    const performanceTracker = new BootstrapPerformanceTracker(ENV, null);\r\n\r\n    const configured = performanceTracker.track(\r\n      () => configureDependencies(container),\r\n      /* c8 ignore start -- onComplete callback is only called when performance tracking is enabled and sampling passes */\r\n      (duration) => {\r\n        // Use logger from container if available (container is validated at this point)\r\n        const loggerResult = container.resolveWithError(loggerToken);\r\n        if (loggerResult.ok) {\r\n          loggerResult.value.debug(`Bootstrap completed in ${duration.toFixed(2)}ms`);\r\n        }\r\n      }\r\n      /* c8 ignore stop */\r\n    );\r\n\r\n    if (configured.ok) {\r\n      this.container = container;\r\n      return { ok: true, value: container };\r\n    }\r\n    return { ok: false, error: configured.error };\r\n  }\r\n\r\n  /**\r\n   * Exponiert die ffentliche Modul-API unter game.modules.get(MODULE_ID).api.\r\n   * Stellt resolve(), getAvailableTokens() und tokens bereit.\r\n   * Darf erst nach erfolgreichem Bootstrap aufgerufen werden.\r\n   * @throws Fehler, wenn das Foundry-Modul-Objekt nicht verfgbar ist\r\n   */\r\n  /* c8 ignore next -- Requires Foundry game module globals */\r\n  exposeToModuleApi(): void {\r\n    const containerResult = this.getContainer();\r\n    if (!containerResult.ok) {\r\n      throw new Error(containerResult.error);\r\n    }\r\n    const container = containerResult.value;\r\n\r\n    // game.modules is typed as ModuleCollection (Map<string, Module>) by fvtt-types\r\n    if (typeof game === \"undefined\" || !game?.modules) {\r\n      throw new Error(`${MODULE_CONSTANTS.LOG_PREFIX} Game modules not available`);\r\n    }\r\n    const mod = game.modules.get(MODULE_CONSTANTS.MODULE.ID);\r\n    if (!mod) {\r\n      throw new Error(`${MODULE_CONSTANTS.LOG_PREFIX} Module not available to expose API`);\r\n    }\r\n\r\n    // Type-safe token collection - mark all tokens as API-safe for external consumption\r\n    const wellKnownTokens: ModuleApiTokens = {\r\n      loggerToken: markAsApiSafe(loggerToken),\r\n      journalVisibilityServiceToken: markAsApiSafe(journalVisibilityServiceToken),\r\n      foundryGameToken: markAsApiSafe(foundryGameToken),\r\n      foundryHooksToken: markAsApiSafe(foundryHooksToken),\r\n      foundryDocumentToken: markAsApiSafe(foundryDocumentToken),\r\n      foundryUIToken: markAsApiSafe(foundryUIToken),\r\n      foundrySettingsToken: markAsApiSafe(foundrySettingsToken),\r\n    };\r\n\r\n    const api: ModuleApi = {\r\n      version: MODULE_CONSTANTS.API.VERSION,\r\n\r\n      // Bind container.resolve() directly (already typed as ApiSafeToken in ModuleApi interface)\r\n      // eslint-disable-next-line @typescript-eslint/no-deprecated -- API boundary: External modules use resolve()\r\n      resolve: container.resolve.bind(container),\r\n\r\n      getAvailableTokens: (): Map<symbol, TokenInfo> => {\r\n        const tokenMap = new Map<symbol, TokenInfo>();\r\n\r\n        // Add well-known tokens with their registration status\r\n        const tokenEntries: Array<[string, InjectionToken<ServiceType>]> = [\r\n          [\"loggerToken\", loggerToken],\r\n          [\"journalVisibilityServiceToken\", journalVisibilityServiceToken],\r\n          [\"foundryGameToken\", foundryGameToken],\r\n          [\"foundryHooksToken\", foundryHooksToken],\r\n          [\"foundryDocumentToken\", foundryDocumentToken],\r\n          [\"foundryUIToken\", foundryUIToken],\r\n          [\"foundrySettingsToken\", foundrySettingsToken],\r\n        ];\r\n\r\n        for (const [, token] of tokenEntries) {\r\n          const isRegisteredResult = container.isRegistered(token);\r\n          tokenMap.set(token, {\r\n            description: String(token).replace(\"Symbol(\", \"\").replace(\")\", \"\"),\r\n            /* c8 ignore next -- isRegistered never fails; ok check is defensive */\r\n            isRegistered: isRegisteredResult.ok ? isRegisteredResult.value : false,\r\n          });\r\n        }\r\n\r\n        return tokenMap;\r\n      },\r\n\r\n      tokens: wellKnownTokens,\r\n\r\n      getMetrics: () => {\r\n        const metricsResult = container.resolveWithError(metricsCollectorToken);\r\n        /* c8 ignore start -- Defensive: MetricsCollector is always registered; fallback returns empty metrics */\r\n        if (!metricsResult.ok) {\r\n          return {\r\n            containerResolutions: 0,\r\n            resolutionErrors: 0,\r\n            avgResolutionTimeMs: 0,\r\n            portSelections: {},\r\n            portSelectionFailures: {},\r\n            cacheHitRate: 0,\r\n          };\r\n        }\r\n        /* c8 ignore stop */\r\n        return metricsResult.value.getSnapshot();\r\n      },\r\n\r\n      getHealth: (): HealthStatus => {\r\n        // Delegate to ModuleHealthService for health checks\r\n        const healthServiceResult = container.resolveWithError(moduleHealthServiceToken);\r\n        /* c8 ignore start -- Defensive: ModuleHealthService fallback when resolution fails */\r\n        if (!healthServiceResult.ok) {\r\n          // Fallback health status if service cannot be resolved\r\n          return {\r\n            status: \"unhealthy\",\r\n            checks: {\r\n              containerValidated: false,\r\n              portsSelected: false,\r\n              lastError: \"ModuleHealthService not available\",\r\n            },\r\n            timestamp: new Date().toISOString(),\r\n          };\r\n        }\r\n        /* c8 ignore stop */\r\n        return healthServiceResult.value.getHealth();\r\n      },\r\n    };\r\n\r\n    // Type-safe assignment thanks to Module augmentation in global.d.ts\r\n    mod.api = api;\r\n  }\r\n\r\n  /**\r\n   * Liefert den initialisierten Container als Result.\r\n   * @returns Result mit Container oder Fehlermeldung\r\n   */\r\n  getContainer(): Result<ServiceContainer, string> {\r\n    if (!this.container) {\r\n      return { ok: false, error: `${MODULE_CONSTANTS.LOG_PREFIX} Container not initialized` };\r\n    }\r\n    return { ok: true, value: this.container };\r\n  }\r\n}\r\n","/**\r\n * Throttles a function to only execute once per specified time window.\r\n *\r\n * Useful for rate-limiting high-frequency events (e.g. Foundry hooks).\r\n * First call executes immediately, subsequent calls within the window are ignored.\r\n *\r\n * @param fn - Function to throttle\r\n * @param windowMs - Time window in milliseconds\r\n * @returns Throttled function\r\n *\r\n * @example\r\n * ```typescript\r\n * const throttled = throttle(() => console.log(\"fired\"), 1000);\r\n * throttled(); // Executes immediately\r\n * throttled(); // Ignored (within 1000ms window)\r\n * setTimeout(throttled, 1500); // Executes (window expired)\r\n * ```\r\n */\r\nexport function throttle<Args extends unknown[]>(\r\n  fn: (...args: Args) => void,\r\n  windowMs: number\r\n): (...args: Args) => void {\r\n  let isThrottled = false;\r\n\r\n  return function throttled(...args: Args): void {\r\n    if (!isThrottled) {\r\n      // First call or window expired - execute immediately\r\n      fn(...args);\r\n      isThrottled = true;\r\n\r\n      // Reset throttle after window\r\n      setTimeout(() => {\r\n        isThrottled = false;\r\n      }, windowMs);\r\n    }\r\n    // Subsequent calls within window are ignored\r\n  };\r\n}\r\n\r\n/**\r\n * Debounces a function to only execute after a specified delay of inactivity.\r\n *\r\n * Each call resets the delay timer. Only executes when no calls occur\r\n * for the specified delay period.\r\n *\r\n * @param fn - Function to debounce\r\n * @param delayMs - Delay in milliseconds\r\n * @returns Debounced function with cancel method\r\n *\r\n * @example\r\n * ```typescript\r\n * const debounced = debounce(() => console.log(\"fired\"), 500);\r\n * debounced(); // Starts 500ms timer\r\n * debounced(); // Resets timer\r\n * debounced(); // Resets timer\r\n * // After 500ms of no calls: \"fired\" is logged\r\n *\r\n * // Cancel pending execution:\r\n * debounced.cancel();\r\n * ```\r\n */\r\nexport function debounce<Args extends unknown[]>(\r\n  fn: (...args: Args) => void,\r\n  delayMs: number\r\n): ((...args: Args) => void) & { cancel: () => void } {\r\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\r\n\r\n  const debounced = function (...args: Args): void {\r\n    // Clear existing timer\r\n    if (timeoutId !== null) {\r\n      clearTimeout(timeoutId);\r\n    }\r\n\r\n    // Set new timer\r\n    timeoutId = setTimeout(() => {\r\n      fn(...args);\r\n      timeoutId = null;\r\n    }, delayMs);\r\n  };\r\n\r\n  debounced.cancel = function (): void {\r\n    if (timeoutId !== null) {\r\n      clearTimeout(timeoutId);\r\n      timeoutId = null;\r\n    }\r\n  };\r\n\r\n  return debounced;\r\n}\r\n","/**\r\n * Hook implementation for renderJournalDirectory.\r\n *\r\n * Handles journal visibility processing when the journal directory is rendered.\r\n *\r\n * **Responsibilities:**\r\n * - Register renderJournalDirectory hook with Foundry\r\n * - Resolve required services from DI container\r\n * - Delegate business logic to JournalVisibilityService\r\n * - Handle cleanup on disposal\r\n */\r\n\r\nimport type { Result } from \"@/types/result\";\r\nimport type { ServiceContainer } from \"@/di_infrastructure/container\";\r\nimport type { HookRegistrar } from \"./hook-registrar.interface\";\r\nimport { MODULE_CONSTANTS, HOOK_THROTTLE_WINDOW_MS } from \"@/constants\";\r\nimport { loggerToken, journalVisibilityServiceToken } from \"@/tokens/tokenindex\";\r\nimport { foundryHooksToken } from \"@/foundry/foundrytokens\";\r\nimport { validateHookApp } from \"@/foundry/validation/schemas\";\r\nimport { throttle } from \"@/utils/events/throttle\";\r\nimport { ok, err } from \"@/utils/functional/result\";\r\n\r\n/**\r\n * Type guard for jQuery objects.\r\n */\r\nfunction isJQueryObject(value: unknown): value is { [index: number]: HTMLElement; length: number } {\r\n  if (value === null || typeof value !== \"object\") return false;\r\n  // Narrow generic object to indexable record for property checks\r\n  /* type-coverage:ignore-next-line */\r\n  const obj = value as Record<string, unknown>;\r\n  return \"length\" in obj && typeof obj.length === \"number\" && obj.length > 0 && \"0\" in obj;\r\n}\r\n\r\n/**\r\n * Extracts HTMLElement from hook argument (jQuery or native DOM).\r\n */\r\nfunction extractHtmlElement(html: unknown): HTMLElement | null {\r\n  if (html instanceof HTMLElement) {\r\n    return html;\r\n  }\r\n\r\n  if (isJQueryObject(html) && html[0] instanceof HTMLElement) {\r\n    return html[0];\r\n  }\r\n\r\n  if (html && typeof html === \"object\" && \"get\" in html) {\r\n    const obj = html as Record<string, unknown>;\r\n    if (typeof obj.get === \"function\") {\r\n      try {\r\n        // jQuery get returns unknown; treat as index-based accessor for HTMLElement lookup\r\n        /* type-coverage:ignore-next-line */\r\n        const element = (obj.get as (index: number) => unknown)(0);\r\n        if (element instanceof HTMLElement) {\r\n          return element;\r\n        }\r\n        /* c8 ignore start -- Defensive: Ignore errors from accessing journal entry properties that may not exist */\r\n      } catch {\r\n        // Ignore\r\n      }\r\n      /* c8 ignore stop */\r\n    }\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\n/**\r\n * RenderJournalDirectory hook implementation.\r\n */\r\nexport class RenderJournalDirectoryHook implements HookRegistrar {\r\n  private unsubscribe: (() => void) | null = null;\r\n\r\n  register(container: ServiceContainer): Result<void, Error> {\r\n    const foundryHooksResult = container.resolveWithError(foundryHooksToken);\r\n    const loggerResult = container.resolveWithError(loggerToken);\r\n    const journalVisibilityResult = container.resolveWithError(journalVisibilityServiceToken);\r\n\r\n    /* c8 ignore start -- Defensive: Service resolution can only fail if container is not validated or services are not registered, which cannot happen in normal flow */\r\n    if (!foundryHooksResult.ok || !loggerResult.ok || !journalVisibilityResult.ok) {\r\n      if (loggerResult.ok) {\r\n        loggerResult.value.error(\"DI resolution failed in RenderJournalDirectoryHook\", {\r\n          foundryHooksResolved: foundryHooksResult.ok,\r\n          journalVisibilityResolved: journalVisibilityResult.ok,\r\n        });\r\n      }\r\n      return err(new Error(\"Failed to resolve required services for RenderJournalDirectoryHook\"));\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    const foundryHooks = foundryHooksResult.value;\r\n    const logger = loggerResult.value;\r\n    const journalVisibility = journalVisibilityResult.value;\r\n\r\n    const throttledCallback = throttle((app: unknown, html: unknown) => {\r\n      logger.debug(`${MODULE_CONSTANTS.HOOKS.RENDER_JOURNAL_DIRECTORY} fired`);\r\n\r\n      const appValidation = validateHookApp(app);\r\n      if (!appValidation.ok) {\r\n        logger.error(\r\n          `Invalid app parameter in ${MODULE_CONSTANTS.HOOKS.RENDER_JOURNAL_DIRECTORY} hook`,\r\n          {\r\n            code: appValidation.error.code,\r\n            message: appValidation.error.message,\r\n            details: appValidation.error.details,\r\n          }\r\n        );\r\n        return;\r\n      }\r\n\r\n      const htmlElement = extractHtmlElement(html);\r\n      if (!htmlElement) {\r\n        logger.error(\"Failed to get HTMLElement from hook - incompatible format\");\r\n        return;\r\n      }\r\n\r\n      journalVisibility.processJournalDirectory(htmlElement);\r\n    }, HOOK_THROTTLE_WINDOW_MS);\r\n\r\n    const hookResult = foundryHooks.on(\r\n      MODULE_CONSTANTS.HOOKS.RENDER_JOURNAL_DIRECTORY,\r\n      throttledCallback\r\n    );\r\n\r\n    if (!hookResult.ok) {\r\n      logger.error(\r\n        `Failed to register ${MODULE_CONSTANTS.HOOKS.RENDER_JOURNAL_DIRECTORY} hook: ${hookResult.error.message}`,\r\n        {\r\n          code: hookResult.error.code,\r\n          details: hookResult.error.details,\r\n          cause: hookResult.error.cause,\r\n        }\r\n      );\r\n      return err(new Error(`Hook registration failed: ${hookResult.error.message}`));\r\n    }\r\n\r\n    return ok(undefined);\r\n  }\r\n\r\n  /* c8 ignore start -- Lifecycle method: Called when module is disabled; cleanup logic not testable in unit tests */\r\n  dispose(): void {\r\n    if (this.unsubscribe) {\r\n      this.unsubscribe();\r\n      this.unsubscribe = null;\r\n    }\r\n  }\r\n  /* c8 ignore stop */\r\n}\r\n","import type { ServiceContainer } from \"@/di_infrastructure/container\";\r\nimport type { HookRegistrar } from \"@/core/hooks/hook-registrar.interface\";\r\nimport { RenderJournalDirectoryHook } from \"@/core/hooks/render-journal-directory-hook\";\r\n\r\n/**\r\n * ModuleHookRegistrar\r\n *\r\n * Manages registration of all Foundry hooks using Strategy Pattern.\r\n * Each hook is implemented as a separate HookRegistrar class.\r\n *\r\n * **Design Benefits:**\r\n * - Easy to add new hooks without modifying this class\r\n * - Each hook can be tested in isolation\r\n * - Clear separation of concerns\r\n */\r\nexport class ModuleHookRegistrar {\r\n  private hooks: HookRegistrar[] = [\r\n    new RenderJournalDirectoryHook(),\r\n    // Add new hooks here\r\n  ];\r\n\r\n  /**\r\n   * Registers all hooks with Foundry VTT.\r\n   * @param container - DI container with registered services\r\n   */\r\n  registerAll(container: ServiceContainer): void {\r\n    for (const hook of this.hooks) {\r\n      const result = hook.register(container);\r\n      if (!result.ok) {\r\n        console.error(`Failed to register hook: ${result.error.message}`);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Dispose all hooks.\r\n   * Called when the module is disabled or reloaded.\r\n   */\r\n  /* c8 ignore start -- Lifecycle method: Called when module is disabled; not testable in unit tests */\r\n  disposeAll(): void {\r\n    for (const hook of this.hooks) {\r\n      hook.dispose();\r\n    }\r\n  }\r\n  /* c8 ignore stop */\r\n}\r\n","/**\r\n * Log level setting definition.\r\n *\r\n * Configures the minimum log level for the module's console output.\r\n */\r\n\r\nimport type { SettingDefinition } from \"./setting-definition.interface\";\r\nimport { MODULE_CONSTANTS } from \"@/constants\";\r\nimport { LogLevel } from \"@/config/environment\";\r\nimport type { I18nFacadeService } from \"@/services/I18nFacadeService\";\r\nimport type { Logger } from \"@/interfaces/logger\";\r\n\r\n/**\r\n * Log level setting definition.\r\n *\r\n * Provides dropdown with DEBUG/INFO/WARN/ERROR options.\r\n * OnChange handler dynamically reconfigures the logger.\r\n */\r\nexport const logLevelSetting: SettingDefinition<LogLevel> = {\r\n  key: MODULE_CONSTANTS.SETTINGS.LOG_LEVEL,\r\n\r\n  createConfig(i18n: I18nFacadeService, logger: Logger) {\r\n    return {\r\n      name: i18n.translate(\"MODULE.SETTINGS.logLevel.name\", \"Log Level\"),\r\n      hint: i18n.translate(\r\n        \"MODULE.SETTINGS.logLevel.hint\",\r\n        \"Minimum log level for module output. DEBUG shows all logs, ERROR only critical errors.\"\r\n      ),\r\n      scope: \"world\",\r\n      config: true,\r\n      type: Number,\r\n      choices: {\r\n        [LogLevel.DEBUG]: i18n.translate(\r\n          \"MODULE.SETTINGS.logLevel.choices.debug\",\r\n          \"DEBUG (All logs - for debugging)\"\r\n        ),\r\n        [LogLevel.INFO]: i18n.translate(\"MODULE.SETTINGS.logLevel.choices.info\", \"INFO (Standard)\"),\r\n        [LogLevel.WARN]: i18n.translate(\r\n          \"MODULE.SETTINGS.logLevel.choices.warn\",\r\n          \"WARN (Warnings and errors only)\"\r\n        ),\r\n        [LogLevel.ERROR]: i18n.translate(\r\n          \"MODULE.SETTINGS.logLevel.choices.error\",\r\n          \"ERROR (Critical errors only)\"\r\n        ),\r\n      },\r\n      default: LogLevel.INFO,\r\n      onChange: (value: LogLevel) => {\r\n        // Dynamically reconfigure logger when setting changes\r\n        if (logger.setMinLevel) {\r\n          logger.setMinLevel(value);\r\n          logger.info(`Log level changed to: ${LogLevel[value]}`);\r\n        }\r\n      },\r\n    };\r\n  },\r\n};\r\n","import { MODULE_CONSTANTS } from \"@/constants\";\r\nimport { loggerToken, i18nFacadeToken } from \"@/tokens/tokenindex\";\r\nimport { foundrySettingsToken } from \"@/foundry/foundrytokens\";\r\nimport type { ServiceContainer } from \"@/di_infrastructure/container\";\r\nimport type { SettingDefinition } from \"@/core/settings/setting-definition.interface\";\r\nimport type { LogLevel } from \"@/config/environment\";\r\nimport { logLevelSetting } from \"@/core/settings/log-level-setting\";\r\n\r\n/**\r\n * ModuleSettingsRegistrar\r\n *\r\n * Registers all Foundry module settings using definition-based approach.\r\n * Each setting is defined separately for better organization and testability.\r\n *\r\n * **Design Benefits:**\r\n * - Easy to add new settings without modifying this class\r\n * - Each setting definition can be tested in isolation\r\n * - Clear separation between registration logic and setting configuration\r\n */\r\nexport class ModuleSettingsRegistrar {\r\n  // Array of setting definitions with their specific types preserved\r\n  private settings: readonly SettingDefinition<LogLevel>[] =\r\n  // Add new setting types here\r\n    [\r\n      logLevelSetting,\r\n      // Add new settings here\r\n    ];\r\n\r\n  /**\r\n   * Registers all module settings.\r\n   * Must be called during or after the 'init' hook.\r\n   *\r\n   * @param container - DI container with registered services\r\n   */\r\n  registerAll(container: ServiceContainer): void {\r\n    const settingsResult = container.resolveWithError(foundrySettingsToken);\r\n    const loggerResult = container.resolveWithError(loggerToken);\r\n    const i18nResult = container.resolveWithError(i18nFacadeToken);\r\n\r\n    // Early return if any resolution failed\r\n    /* c8 ignore start -- Defensive: Service resolution can only fail if container is not validated or services are not registered, which cannot happen in normal flow */\r\n    if (!settingsResult.ok || !loggerResult.ok || !i18nResult.ok) {\r\n      // Use logger if available, otherwise fallback to console\r\n      if (loggerResult.ok) {\r\n        loggerResult.value.error(\"DI resolution failed in ModuleSettingsRegistrar\", {\r\n          settingsResolved: settingsResult.ok,\r\n          i18nResolved: i18nResult.ok,\r\n        });\r\n      } else {\r\n        // Fallback only if logger itself failed to resolve\r\n        console.error(\"Failed to resolve required services for settings registration\");\r\n      }\r\n      return;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    const foundrySettings = settingsResult.value;\r\n    const logger = loggerResult.value;\r\n    const i18n = i18nResult.value;\r\n\r\n    // Register all settings\r\n    for (const setting of this.settings) {\r\n      const config = setting.createConfig(i18n, logger);\r\n      const result = foundrySettings.register(MODULE_CONSTANTS.MODULE.ID, setting.key, config);\r\n\r\n      if (!result.ok) {\r\n        logger.error(`Failed to register ${setting.key} setting`, result.error);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { MODULE_CONSTANTS } from \"@/constants\";\r\n\r\n/**\r\n * Context information for error logging.\r\n * Provides structured metadata about where and when an error occurred.\r\n */\r\nexport interface ErrorContext {\r\n  /** Phase of module lifecycle when error occurred */\r\n  phase: \"bootstrap\" | \"initialization\" | \"runtime\";\r\n  /** Component or service where error originated */\r\n  component?: string;\r\n  /** Additional contextual metadata */\r\n  metadata?: Record<string, unknown>;\r\n}\r\n\r\n/**\r\n * Centralized error handler for bootstrap and initialization errors.\r\n *\r\n * Provides structured, grouped error logging in the browser console.\r\n * Uses console.group() for clear, collapsible output that's easy to\r\n * screenshot and share for debugging.\r\n *\r\n * @remarks\r\n * Foundry v13 does not write module console logs to error.log files,\r\n * so this handler optimizes for browser console readability.\r\n *\r\n * @example\r\n * ```typescript\r\n * BootstrapErrorHandler.logError(error, {\r\n *   phase: 'bootstrap',\r\n *   component: 'CompositionRoot',\r\n *   metadata: { foundryVersion: 13 }\r\n * });\r\n * ```\r\n */\r\nexport class BootstrapErrorHandler {\r\n  /**\r\n   * Logs an error with structured context in the browser console.\r\n   *\r\n   * Creates a collapsible group with timestamp, phase, component,\r\n   * error details, and metadata for easy debugging and screenshotting.\r\n   *\r\n   * @param error - The error that occurred (Error object, string, or unknown)\r\n   * @param context - Context information about the error\r\n   */\r\n  static logError(error: unknown, context: ErrorContext): void {\r\n    const timestamp = new Date().toISOString();\r\n\r\n    console.group(`[${timestamp}] ${MODULE_CONSTANTS.LOG_PREFIX} Error in ${context.phase}`);\r\n\r\n    if (context.component) {\r\n      console.error(\"Component:\", context.component);\r\n    }\r\n\r\n    console.error(\"Error:\", error);\r\n\r\n    if (context.metadata && Object.keys(context.metadata).length > 0) {\r\n      console.error(\"Metadata:\", context.metadata);\r\n    }\r\n\r\n    console.groupEnd();\r\n  }\r\n}\r\n","import { MODULE_CONSTANTS } from \"../constants\";\r\nimport { isOk } from \"@/utils/functional/result\";\r\nimport { loggerToken } from \"@/tokens/tokenindex\";\r\nimport { CompositionRoot } from \"@/core/composition-root\";\r\nimport { ModuleHookRegistrar } from \"@/core/module-hook-registrar\";\r\nimport { ModuleSettingsRegistrar } from \"@/core/module-settings-registrar\";\r\nimport { tryGetFoundryVersion } from \"@/foundry/versioning/versiondetector\";\r\nimport { foundrySettingsToken } from \"@/foundry/foundrytokens\";\r\nimport { LogLevel } from \"@/config/environment\";\r\nimport { BootstrapErrorHandler } from \"@/core/bootstrap-error-handler\";\r\n\r\n/**\r\n * Boot-Orchestrierung fr das Modul.\r\n *\r\n * Ablauf:\r\n * - Vor init: DI-Container erstellen (CompositionRoot.bootstrap) und bei Fehler abbrechen\r\n * - In init: API (resolve) exponieren, Ports selektieren/binden (via externem Selector), Hooks registrieren\r\n * - In ready: nur Logging o..  Services sind ber api.resolve nutzbar\r\n */\r\n\r\n/**\r\n * Function to encapsulate initialization logic.\r\n * This allows us to use return statements for soft aborts.\r\n */\r\n/* c8 ignore start -- Entire function requires Foundry Hooks globals to be present */\r\nfunction initializeFoundryModule(): void {\r\n  const containerResult = root.getContainer();\r\n  /* c8 ignore start -- Bootstrap failure path tested in init-solid.test.ts bootstrap failure tests */\r\n  if (!containerResult.ok) {\r\n    console.error(`${MODULE_CONSTANTS.LOG_PREFIX} ${containerResult.error}`);\r\n    return;\r\n  }\r\n  /* c8 ignore stop */\r\n\r\n  const loggerResult = containerResult.value.resolveWithError(loggerToken);\r\n  /* c8 ignore start -- Defensive: Logger resolution can only fail if container is not validated, which is checked in bootstrap */\r\n  if (!loggerResult.ok) {\r\n    console.error(\r\n      `${MODULE_CONSTANTS.LOG_PREFIX} Failed to resolve logger: ${loggerResult.error.message}`\r\n    );\r\n    return;\r\n  }\r\n  /* c8 ignore stop */\r\n  const logger = loggerResult.value;\r\n\r\n  // Guard: Ensure Foundry Hooks API is available\r\n  /* c8 ignore next -- Requires Foundry Hooks global */\r\n  if (typeof Hooks === \"undefined\") {\r\n    logger.warn(\"Foundry Hooks API not available - module initialization skipped\");\r\n    return; // Soft abort - OK inside function\r\n  }\r\n\r\n  /* c8 ignore next -- Registers Foundry hook callbacks */\r\n  Hooks.on(\"init\", () => {\r\n    logger.info(\"init-phase\");\r\n    root.exposeToModuleApi();\r\n\r\n    const initContainerResult = root.getContainer();\r\n    /* c8 ignore start -- Defensive: Container is available after successful bootstrap */\r\n    if (!initContainerResult.ok) {\r\n      logger.error(`Failed to get container in init hook: ${initContainerResult.error}`);\r\n      return;\r\n    }\r\n    /* c8 ignore stop */\r\n\r\n    // Register module settings (must be done before settings are read)\r\n    new ModuleSettingsRegistrar().registerAll(initContainerResult.value);\r\n\r\n    // Configure logger with current setting value\r\n    const settingsResult = initContainerResult.value.resolveWithError(foundrySettingsToken);\r\n    if (settingsResult.ok) {\r\n      const settings = settingsResult.value;\r\n      const logLevelResult = settings.get<number>(\r\n        MODULE_CONSTANTS.MODULE.ID,\r\n        MODULE_CONSTANTS.SETTINGS.LOG_LEVEL\r\n      );\r\n\r\n      /* c8 ignore start -- Logger configuration: setMinLevel is optional method, and log level setting may not be configured yet */\r\n      if (logLevelResult.ok && logger.setMinLevel) {\r\n        logger.setMinLevel(logLevelResult.value as LogLevel);\r\n        logger.debug(`Logger configured with level: ${LogLevel[logLevelResult.value]}`);\r\n      }\r\n      /* c8 ignore stop */\r\n    }\r\n\r\n    // Register module hooks\r\n    new ModuleHookRegistrar().registerAll(initContainerResult.value);\r\n    logger.info(\"init-phase completed\");\r\n  });\r\n\r\n  /* c8 ignore next -- Registers Foundry hook callbacks */\r\n  Hooks.on(\"ready\", () => {\r\n    logger.info(\"ready-phase\");\r\n    logger.info(\"ready-phase completed\");\r\n  });\r\n}\r\n/* c8 ignore stop */\r\n\r\n// Eager bootstrap DI before Foundry init\r\nconst root = new CompositionRoot();\r\nconst bootstrapResult = root.bootstrap();\r\nconst bootstrapOk = isOk(bootstrapResult);\r\n\r\n/* c8 ignore next -- Branch depends on Foundry UI notifications */\r\nif (!bootstrapOk) {\r\n  BootstrapErrorHandler.logError(bootstrapResult.error, {\r\n    phase: \"bootstrap\",\r\n    component: \"CompositionRoot\",\r\n    metadata: {\r\n      foundryVersion: tryGetFoundryVersion(),\r\n    },\r\n  });\r\n\r\n  // Check if error is due to old Foundry version\r\n  let isOldFoundryVersion = false;\r\n  /* c8 ignore next -- Requires Foundry version detection context */\r\n  if (\r\n    typeof bootstrapResult.error === \"string\" &&\r\n    bootstrapResult.error.includes(\"PORT_SELECTION_FAILED\")\r\n  ) {\r\n    const foundryVersion = tryGetFoundryVersion();\r\n    if (foundryVersion !== undefined && foundryVersion < 13) {\r\n      isOldFoundryVersion = true;\r\n      /* c8 ignore next -- Displays Foundry notification */\r\n      if (typeof ui !== \"undefined\" && ui?.notifications) {\r\n        ui.notifications.error(\r\n          `${MODULE_CONSTANTS.MODULE.NAME} bentigt mindestens Foundry VTT Version 13. ` +\r\n            `Ihre Version: ${foundryVersion}. Bitte aktualisieren Sie Foundry VTT.`,\r\n          { permanent: true }\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  // Show generic error notification (only if not old Foundry version)\r\n  /* c8 ignore next -- Displays Foundry notification */\r\n  if (!isOldFoundryVersion && typeof ui !== \"undefined\" && ui?.notifications) {\r\n    ui.notifications?.error(\r\n      `${MODULE_CONSTANTS.MODULE.NAME} failed to initialize. Check console for details.`,\r\n      { permanent: true }\r\n    );\r\n  }\r\n\r\n  // Soft abort: Don't proceed with initialization\r\n  // (no throw, no return - just don't call initializeFoundryModule)\r\n} else {\r\n  // Only initialize if bootstrap succeeded\r\n  initializeFoundryModule();\r\n}\r\n"],"file":"fvtt_relationship_app_module.js"}