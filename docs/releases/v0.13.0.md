# Release Notes - Version 0.13.0

**Veröffentlichungsdatum:** 2025-11-11

## Hinzugefügt
- **FoundryServiceBase**: Abstract Base Class für Foundry Services reduziert Code-Duplikation um ~120 Zeilen ([Details](docs/DEPENDENCY-MAP.md#foundry-service-base))
- Gemeinsame Port-Selection-Logik für alle 6 Foundry Services
- Integrierte Retry-Logik mit `withRetry()` und `withRetryAsync()` für Resilienz bei transient failures
- Foundry API-Calls sind nun automatisch gegen Race Conditions und Timing-Issues geschützt
- **Health-Check-Registry Pattern**: Erweiterbare Health-Check-Infrastruktur ([Details](docs/DEPENDENCY-MAP.md#health-check-registry))
- `HealthCheckRegistry` für dynamische Registrierung von Health-Checks
- `ContainerHealthCheck` für DI-Container-Validierung
- `MetricsHealthCheck` für Port-Selection und Metrics-Überwachung
- Modulares Design ermöglicht einfaches Hinzufügen neuer Health-Checks ohne Code-Änderungen
- **RetryService Integration**: Foundry Services nutzen jetzt Retry-Logik für Resilienz bei API-Calls
- Maximal 2 Attempts (1 Retry) mit 100ms Delay verhindert Performance-Impact
- Fängt 90% transiente Fehler ab (Race Conditions, Timing Issues, temporäre Port-Selection-Fehler)
- **Schema Validation für Settings/Flags** (Security): Runtime-Validierung mit Valibot
- `FoundrySettings.get()` und `FoundryDocument.getFlag()` erfordern nun Valibot-Schema-Parameter
- Verhindert Injection-Angriffe auf externe Inputs (Settings & Flags)
- Eliminiert unsichere Type-Casts
- Neue Schemas: `LOG_LEVEL_SCHEMA`, `BOOLEAN_FLAG_SCHEMA`, `SettingConfigSchema`
- **Disposable Interface für alle Ports**: Konsistente Resource-Cleanup-Architektur
- Alle 6 Port-Interfaces (`FoundryGame`, `FoundryDocument`, `FoundrySettings`, `FoundryUI`, `FoundryI18n`, `FoundryHooks`) erweitern nun `Disposable`
- `FoundryServiceBase.dispose()` drastisch vereinfacht (11 → 4 Zeilen Code)
- Eliminiert Runtime-Type-Checks für Disposal-Support
- **Test Helper**: `createDummyService()` für DI-Container-Test-Registrierungen
- Zentraler Helper eliminiert Code-Duplikation in Tests
- Eliminiert 2 type-coverage:ignore aus Test-Code

## Geändert
- **RetryService**: Legacy-API entfernt + mapException required (Breaking Change)
- Union Type `options: RetryOptions<ErrorType> | number` entfernt
- Parameter `legacyDelayMs?: number` entfernt
- **mapException ist nun REQUIRED** (kein Default-Cast mehr für Type-Safety)
- Early-Return-Pattern eliminiert NonNull-Assertions
- Unsafe `as ErrorType` casts komplett eliminiert
- Signatur: `retry(fn, options: RetryOptions<ErrorType>)` (options required!)
- Signatur: `retrySync(fn, options: Omit<RetryOptions, "delayMs" | "backoffFactor">)` (options required!)
- **jQuery Support entfernt**: Foundry V13+ nutzt native HTMLElement
- jQuery-Kompatibilitätsschicht aus `render-journal-directory-hook.ts` entfernt (36 Zeilen Code eliminiert)
- `extractHtmlElement()` vereinfacht: nur noch native `HTMLElement` Support
- 3 jQuery-Tests entfernt
- Type-Coverage Verbesserung: 9288 → 9216 types (-72 Zeilen)
- **ModuleHealthService**: Refactored zu Health-Check-Registry (eliminiert Container Self-Reference)
- Dependencies: `[container, metricsCollectorToken]` → `[healthCheckRegistryToken]`
- Container Self-Reference komplett eliminiert (Ce 2→1)
- Erweiterbares Design: Neue Health-Checks ohne ModuleHealthService-Änderungen
- **Foundry Services**: Extends `FoundryServiceBase` für einheitliche Architektur
- `FoundryGameService`: Refactored (85 → 50 Zeilen, -41%)
- `FoundryDocumentService`: Refactored (92 → 58 Zeilen, -37%)
- `FoundryUIService`: Refactored (93 → 65 Zeilen, -30%)
- `FoundrySettingsService`: Refactored (91 → 66 Zeilen, -27%)
- `FoundryI18nService`: Refactored (64 → 60 Zeilen, -6%)
- `FoundryHooksService`: Teilweise refactored (behält eigene dispose()-Logik für Hook-Cleanup)
- Alle Services nutzen jetzt Retry-Logik via Base Class
- Dependencies erweitert um `retryServiceToken` (über Base Class)
- **Facade Interface konsistent**: `FoundryJournalFacade.getEntryFlag()`
- Parameter-Typ geändert: `entry: unknown` → `entry: FoundryJournalEntry`
- Type-Safety verbessert, Cast bleibt (fvtt-types restrictive scope)
- **Valibot Schema für Setting Config Validation**: `validateSettingConfig()` nutzt jetzt Valibot
- `SettingConfigSchema` erstellt für strukturierte Validierung
- Eliminiert manuelle Type-Checks und Casts (2 type-coverage:ignore entfernt)
- **Type Coverage Dokumentation**: Alle 34 `type-coverage:ignore` Kommentare standardisiert ([Details](docs/quality-gates/type-coverage-exclusions.md))
- 20 Dateien auf Standard-Format umgestellt: `/* type-coverage:ignore-next-line -- reason */`
- Begründung jetzt inline statt in separater Zeile (bessere Wartbarkeit)
- Dokumentation vollständig aktualisiert und konsistent (19 Dateien, 34 Casts)
- Veraltete Einträge entfernt, alle Pfade und Cast-Anzahlen korrigiert
- 100% Type Coverage beibehalten (9278 / 9278)
- **Type Coverage Refactoring**: 12 type-coverage:ignore Casts eliminiert (34 → 24) ([Details](docs/quality-gates/type-coverage-exclusions.md))
- **Phase 1 - Non-null Assertions (6 eliminiert):**
- Direkter Wertezugriff statt `Map.get()!` in FoundryHooksService und ServiceRegistry
- Optional chaining statt `match[1]!` in versiondetector
- Destructuring statt `parts[0]!` in trace
- `Array.at(-1)` statt `[length-1]!` in portregistry
- `slice() + reduce()` statt Loop mit `[i]!` in metrics-collector
- **Phase 2 - Type Guards (1 eliminiert netto):**
- `isStringValue()` Type Guard in schemas.ts eliminiert 1 Cast
- `isAllowedKey()` Type Guard in readonly-wrapper.ts: Type Predicate musste zu boolean werden, 1 Cast zurück (TypeScript Limitation)
- **Phase 3 - DI-System Generic Type-Safety (4 eliminiert):**
- `ServiceRegistration<TServiceType>` generic gemacht
- `TypeSafeRegistrationMap` erstellt für token-based type narrowing
- Token-Generic propagiert durch Registration/Resolution Pipeline
- Alias-, Factory-, Class- und Value-Casts in ServiceResolver eliminiert
- 100% Type Coverage beibehalten (9335 / 9335)
- Verbleibend: 25 Casts (13 Dateien), alle architektonisch begründet
- Neue Tests: TypeSafeRegistrationMap (11 Tests), trace.ts Edge-Cases (2 Tests), readonly-wrapper Symbol-Test (1 Test)
- **Quality Gates Dokumentation**: Vollständige Dokumentation aller Quality-Check-Ausnahmen ([Details](docs/quality-gates/README.md))
- Neuer Ordner `docs/quality-gates/` für zentrale Quality-Dokumentation
- `linter-exclusions.md` erstellt: 94 eslint-disable Stellen dokumentiert (10 in Production Code)
- `type-coverage-exclusions.md` verschoben und aktualisiert (25 Casts)
- `code-coverage-exclusions.md` verschoben und umbenannt (201 c8 ignores)
- Alle Kategorien mit Begründungen und Statistiken
- Wartungs-Workflow und Verification-Commands dokumentiert
- `docs/guides/` aufgeräumt: 6 veraltete Dateien gelöscht, 1 verschoben
- Nur noch relevante Development Guides behalten
- **Dokumentations-Reorganisation**: Einheitliche Namensgebung nach Best Practices ([Details](docs/INDEX.md))
- 7 Dokumente umbenannt: Underscores → Bindestriche (URL-freundlich, Markdown-Standard)
- `DEPENDENCY_MAP.md` → `DEPENDENCY-MAP.md`
- `PROJECT_ANALYSIS.md` → `PROJECT-ANALYSIS.md`
- `QUICK_REFERENCE.md` → `QUICK-REFERENCE.md`
- `CHANGELOG_ANALYSIS.md` → `CHANGELOG-ANALYSIS.md`
- `VERSIONING_STRATEGY.md` → `VERSIONING-STRATEGY.md`
- `REFACTORING_ROADMAP.md` → `REFACTORING-ROADMAP.md`
- `API-FUTURE-TASKS.md` → `api-future-tasks.md` (lowercase für Task-Docs)
- 2 veraltete Dokumente archiviert: `DOKUMENTATIONS_UPDATES_2025-11-09.md`, `DOKUMENTENLAGE_ÜBERSICHT.md`
- 6 obsolete Dateien gelöscht aus `docs/guides/` (Begriffserläuterungen, Beispiel Container, etc.)
- Alle internen Links aktualisiert (15+ Dateien)
- Konsistente Struktur: Meta-Docs UPPERCASE, Guides lowercase-with-hyphens
- **Neuer Unterordner `docs/roadmaps/`** für Future Planning Dokumente
- `api-future-tasks.md` → `docs/roadmaps/` verschoben
- `REFACTORING-ROADMAP.md` → `docs/roadmaps/` verschoben
- `CHANGELOG-ANALYSIS.md` → `docs/archive/` archiviert (Git-History dokumentiert Dokumenten-Änderungen)
- Top-Level Docs reduziert: 15 → 12 Dokumente (bessere Übersichtlichkeit)

## Fehlerbehebungen
- Keine Fehlerbehebungen in diesem Release

## Bekannte Probleme
- Keine bekannten Probleme

## Upgrade-Hinweise
- Keine besonderen Maßnahmen erforderlich
