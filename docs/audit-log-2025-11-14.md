# Code-Audit Log – 2025‑11‑14

> Temporäre Notiz: Diese Log-Datei dient nur der kurzfristigen Nachverfolgung und kann gelöscht werden, sobald alle Maßnahmen umgesetzt oder ins reguläre Backlog übertragen wurden.

## Zusammenfassung

- **Datum / Auditor**: 2025‑11‑14, Claude Sonnet 4.5  
- **Scope**: Security, Performance, Architektur, CI/Tooling  
- **Quellen**: `src/core/hooks/render-journal-directory-hook.ts`, `src/services/JournalVisibilityService.ts`, `dist/fvtt_relationship_app_module.js`, `.github/workflows/ci.yml`, `package.json`

## Findings & Maßnahmenstatus

| ID | Kategorie | Beschreibung | Status | Owner |
|----|-----------|--------------|--------|-------|
| CA-01 | Security | Hook entfernt bewusst Journale clientseitig, damit „Datencontainer“ unsichtbar werden. Spieler dürfen lediglich ihre Existenz (DOM-Removal) sehen, nicht die Inhalte. Konsolen-Logging läuft jetzt ausschließlich über das NotificationCenter (ConsoleChannel). | ⚠️ Akzeptiertes Risiko (Design) | — |
| CA-02 | Performance | `JournalVisibilityService.getHiddenJournalEntries()` lädt weiterhin bei jedem Render alle Journale ohne Cache ein; die CacheRegistry-Idee wurde wieder verworfen. | Offen | — |
| CA-03 | Bundle Size | Release-Bundle ~400 KB trotz fehlender UI; `@xyflow/svelte` & `flowbite` Styles werden immer geladen. | ✅ Gelöst (Style-Import entfernt) | — |
| CA-04 | CI/Tooling | Workflow führte Tests & Coverage doppelt aus, `check-all` formatiert Dateien im CI und Release-Job wurde wegen fehlender Tag-Trigger nie ausgeführt. | ✅ Gelöst (CI Optimierung + Tag Trigger) | — |

## Empfohlene Next Steps

1. **Dokumentation CA-01**  
   - Hinweis im Modul/README festhalten, dass Journale absichtlich clientseitig entfernt werden, um Network-Datencontainer zu verstecken.  
   - Keine technische Änderung nötig, solange World-Permissions korrekt gesetzt sind.

2. **Hidden-Entry Cache (CA-02)**  
   - Offene Maßnahme: Hidden-Journal-Ermittlung benötigt weiterhin pro Render vollständige Datenbank-Läufe.  
   - CacheRegistry-Ansatz wurde zurückgenommen; neuer Vorschlag erforderlich (z. B. leichter In-Memory-Cache im Service selbst oder Foundry-Event-basierte Differenzierung).  
   - Dokumentation und Changelog erst anpassen, sobald eine stabile Lösung umgesetzt ist.

3. ~~Bundle Review (CA-03)~~ ✅  
   - Entry import für `@xyflow/svelte` Styles entfernt; UI-Assets werden erst bei tatsächlichem Feature-Re-Enable geladen (`src/index.ts`).  
   - Bei UI-Launch erneut evaluieren, ggf. dynamisch nachladen.

4. ~~CI Optimierung (CA-04)~~ ✅  
   - `ci.yml` reagiert jetzt auch auf `v*`-Tags, führt Coverage nur einmal (Node 20) aus und nutzt für Node 22 einen schnellen Testlauf.  
   - `build:dev` ist aus dem CI entfernt; `check-all` verwendet `format:check`, sodass keine Dateien mehr in CI runs mutiert werden.  
   - Releases werden wieder erstellt, sobald ein `v*`-Tag gepusht wird (Body bleibt docs/releases/<tag>.md).

> Hinweis: Sobald diese Punkte adressiert und im CHANGELOG/Backlog dokumentiert wurden, kann diese Datei entfernt werden, um die Repo-Historie schlank zu halten.

