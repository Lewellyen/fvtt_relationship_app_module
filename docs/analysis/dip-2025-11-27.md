# Dependency Inversion Principle Review (2025-11-27)

## Scope
- Layered boundaries: domain, application, framework, infrastructure.
- Focus on dependencies between high-level policies (domain/application/framework orchestration) and lower-level details (infrastructure/adapters).

## Findings

### 1. Application services depend on NotificationCenter concrete implementation
- Multiple application services and use-cases type their notification dependency as the infrastructure class `NotificationCenter` instead of an abstraction, e.g. `ModuleEventRegistrar`, `JournalVisibilityService`, and various use-cases.
- DI tokens (`notificationCenterToken`) are also typed to the concrete class, so high-level logic is coupled to infrastructure details and cannot swap notification implementations without touching application code.
- This violates DIP because high-level policies depend on a concrete infrastructure service rather than an interface/port.
- **Suggested remediation:** Introduce an interface/port for notification delivery (e.g., `NotificationService`) and have `NotificationCenter` implement it. Retype DI tokens and application/service constructors to consume the interface so different notification hubs/channels can be substituted without changing high-level logic.

### 2. Container health check ties to concrete ServiceContainer class
- `ContainerHealthCheck` imports and stores the concrete `ServiceContainer` implementation, and the `serviceContainerToken` is typed to the class as well.
- The health check only requires the container contract (`getValidationState`) and not the concrete implementation details.
- Depending on the class instead of the container interface tightens coupling to a specific DI implementation, reducing substitutability and violating DIP.
- **Suggested remediation:** Depend on the DI container interface (e.g., `Container` from the DI module) for the health check and token typing. This keeps the health check aligned with an abstraction and allows alternative container implementations in the future.
